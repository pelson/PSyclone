<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>PSyclone: src/psyclone/dynamo0p3.py Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="psyclone_v1.0_small.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PSyclone
   &#160;<span id="projectnumber">1.7.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('dynamo0p3_8py_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">dynamo0p3.py</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment"># -----------------------------------------------------------------------------</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"># BSD 3-Clause License</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">#</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"># Copyright (c) 2017-2019, Science and Technology Facilities Council.</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"># All rights reserved.</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">#</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"># Redistribution and use in source and binary forms, with or without</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"># modification, are permitted provided that the following conditions are met:</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">#</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"># * Redistributions of source code must retain the above copyright notice, this</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">#   list of conditions and the following disclaimer.</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">#</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"># * Redistributions in binary form must reproduce the above copyright notice,</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">#   this list of conditions and the following disclaimer in the documentation</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">#   and/or other materials provided with the distribution.</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">#</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"># * Neither the name of the copyright holder nor the names of its</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">#   contributors may be used to endorse or promote products derived from</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">#   this software without specific prior written permission.</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">#</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"># THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"># &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"># LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"># FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"># COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"># INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"># BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"># LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"># CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"># LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment"># ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment"># POSSIBILITY OF SUCH DAMAGE.</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment"># -----------------------------------------------------------------------------</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment"># Authors R. W. Ford and A. R. Porter, STFC Daresbury Lab</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment"># Modified I. Kavcic, Met Office</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="stringliteral">&#39;&#39;&#39; This module implements the PSyclone Dynamo 0.3 API by 1)</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="stringliteral">    specialising the required base classes in parser.py (Descriptor,</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="stringliteral">    KernelType) and adding a new class (DynFuncDescriptor03) to</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="stringliteral">    capture function descriptor metadata and 2) specialising the</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="stringliteral">    required base classes in psyGen.py (PSy, Invokes, Invoke, Schedule,</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="stringliteral">    Loop, Kern, Inf, Arguments and Argument). &#39;&#39;&#39;</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment"># Imports</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function, absolute_import</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="keyword">import</span> os</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="keyword">from</span> collections <span class="keyword">import</span> OrderedDict</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="keyword">import</span> fparser</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1parse.html">psyclone.parse</a> <span class="keyword">import</span> Descriptor, KernelType, ParseError</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="keyword">import</span> <a class="code" href="namespacepsyclone_1_1expression.html">psyclone.expression</a> <span class="keyword">as</span> expr</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="keyword">from</span> psyclone <span class="keyword">import</span> psyGen</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1configuration.html">psyclone.configuration</a> <span class="keyword">import</span> Config</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1psyGen.html">psyclone.psyGen</a> <span class="keyword">import</span> PSy, Invokes, Invoke, Schedule, Loop, Kern, \</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    Arguments, KernelArgument, NameSpaceFactory, GenerationError, \</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    InternalError, FieldNotFoundError, HaloExchange, GlobalSum, \</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    FORTRAN_INTENT_NAMES, DataAccess</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment"># First section : Parser specialisations and classes</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment"># Function spaces (FS)</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment"># Discontinuous FS</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;DISCONTINUOUS_FUNCTION_SPACES = [<span class="stringliteral">&quot;w3&quot;</span>, <span class="stringliteral">&quot;wtheta&quot;</span>, <span class="stringliteral">&quot;w2v&quot;</span>]</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment"># Continuous FS</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment"># Space any_w2 can be w2, w2h or w2v</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;CONTINUOUS_FUNCTION_SPACES = [<span class="stringliteral">&quot;w0&quot;</span>, <span class="stringliteral">&quot;w1&quot;</span>, <span class="stringliteral">&quot;w2&quot;</span>, <span class="stringliteral">&quot;w2h&quot;</span>, <span class="stringliteral">&quot;any_w2&quot;</span>]</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment"># Valid FS and FS names</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;VALID_FUNCTION_SPACES = DISCONTINUOUS_FUNCTION_SPACES + \</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    CONTINUOUS_FUNCTION_SPACES</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;VALID_ANY_SPACE_NAMES = [<span class="stringliteral">&quot;any_space_1&quot;</span>, <span class="stringliteral">&quot;any_space_2&quot;</span>, <span class="stringliteral">&quot;any_space_3&quot;</span>,</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;                         <span class="stringliteral">&quot;any_space_4&quot;</span>, <span class="stringliteral">&quot;any_space_5&quot;</span>, <span class="stringliteral">&quot;any_space_6&quot;</span>,</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;                         <span class="stringliteral">&quot;any_space_7&quot;</span>, <span class="stringliteral">&quot;any_space_8&quot;</span>, <span class="stringliteral">&quot;any_space_9&quot;</span>]</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;VALID_FUNCTION_SPACE_NAMES = VALID_FUNCTION_SPACES + VALID_ANY_SPACE_NAMES</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment"># Evaluators: basis and differential basis</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;VALID_EVALUATOR_NAMES = [<span class="stringliteral">&quot;gh_basis&quot;</span>, <span class="stringliteral">&quot;gh_diff_basis&quot;</span>]</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment"># Meta functions</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;VALID_METAFUNC_NAMES = VALID_EVALUATOR_NAMES + [<span class="stringliteral">&quot;gh_orientation&quot;</span>]</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment"># Evaluators: quadrature</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;VALID_QUADRATURE_SHAPES = [<span class="stringliteral">&quot;gh_quadrature_xyoz&quot;</span>]</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;VALID_EVALUATOR_SHAPES = VALID_QUADRATURE_SHAPES + [<span class="stringliteral">&quot;gh_evaluator&quot;</span>]</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment"># Dictionary allowing us to look-up the name of the Fortran module, type</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment"># and proxy-type associated with each quadrature shape</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;QUADRATURE_TYPE_MAP = {</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="stringliteral">&quot;gh_quadrature_xyoz&quot;</span>: {<span class="stringliteral">&quot;module&quot;</span>: <span class="stringliteral">&quot;quadrature_xyoz_mod&quot;</span>,</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;                           <span class="stringliteral">&quot;type&quot;</span>: <span class="stringliteral">&quot;quadrature_xyoz_type&quot;</span>,</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                           <span class="stringliteral">&quot;proxy_type&quot;</span>: <span class="stringliteral">&quot;quadrature_xyoz_proxy_type&quot;</span>}}</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment"># Datatypes (scalars, fields, operators)</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;VALID_SCALAR_NAMES = [<span class="stringliteral">&quot;gh_real&quot;</span>, <span class="stringliteral">&quot;gh_integer&quot;</span>]</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;VALID_OPERATOR_NAMES = [<span class="stringliteral">&quot;gh_operator&quot;</span>, <span class="stringliteral">&quot;gh_columnwise_operator&quot;</span>]</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;VALID_ARG_TYPE_NAMES = [<span class="stringliteral">&quot;gh_field&quot;</span>] + VALID_OPERATOR_NAMES + \</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    VALID_SCALAR_NAMES</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment"># Access types</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;VALID_REDUCTION_NAMES = [<span class="stringliteral">&quot;gh_sum&quot;</span>]</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment"># List of all access types that involve writing to an argument</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment"># in some form</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;GH_WRITE_ACCESSES = [<span class="stringliteral">&quot;gh_write&quot;</span>, <span class="stringliteral">&quot;gh_readwrite&quot;</span>, <span class="stringliteral">&quot;gh_inc&quot;</span>] + \</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                     VALID_REDUCTION_NAMES</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment"># List of all access types that involve reading an argument in some</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment"># form</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;GH_READ_ACCESSES = [<span class="stringliteral">&quot;gh_read&quot;</span>, <span class="stringliteral">&quot;gh_readwrite&quot;</span>, <span class="stringliteral">&quot;gh_inc&quot;</span>]</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment"># Access type that is only a read, as a list for convenience</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;GH_READ_ONLY_ACCESS = [<span class="stringliteral">&quot;gh_read&quot;</span>]</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;VALID_ACCESS_DESCRIPTOR_NAMES = GH_READ_ONLY_ACCESS + GH_WRITE_ACCESSES</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment"># Stencils</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;VALID_STENCIL_TYPES = [<span class="stringliteral">&quot;x1d&quot;</span>, <span class="stringliteral">&quot;y1d&quot;</span>, <span class="stringliteral">&quot;xory1d&quot;</span>, <span class="stringliteral">&quot;cross&quot;</span>, <span class="stringliteral">&quot;region&quot;</span>]</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment"># Note, can&#39;t use VALID_STENCIL_DIRECTIONS at all locations in this</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment"># file as it causes failures with py.test 2.8.7. Therefore some parts</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment"># of the code do not use the VALID_STENCIL_DIRECTIONS variable.</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;VALID_STENCIL_DIRECTIONS = [<span class="stringliteral">&quot;x_direction&quot;</span>, <span class="stringliteral">&quot;y_direction&quot;</span>]</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment"># Note, xory1d does not have a direct mapping in STENCIL_MAPPING as it</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment"># indicates either x1d or y1d.</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment"># Note, the LFRic infrastructure currently does not have &#39;region&#39; as</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment"># an option in stencil_dofmap_mod.F90 so it is not included in</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment"># STENCIL_MAPPING.</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;STENCIL_MAPPING = {<span class="stringliteral">&quot;x1d&quot;</span>: <span class="stringliteral">&quot;STENCIL_1DX&quot;</span>, <span class="stringliteral">&quot;y1d&quot;</span>: <span class="stringliteral">&quot;STENCIL_1DY&quot;</span>,</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                   <span class="stringliteral">&quot;cross&quot;</span>: <span class="stringliteral">&quot;STENCIL_CROSS&quot;</span>}</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment"># These are the valid mesh types that may be specified for a field</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment"># using the mesh_arg=... meta-data element (for inter-grid kernels that</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment"># perform prolongation/restriction).</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;VALID_MESH_TYPES = [<span class="stringliteral">&quot;gh_coarse&quot;</span>, <span class="stringliteral">&quot;gh_fine&quot;</span>]</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment"># These are loop bound names which identify positions in a fields</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment"># halo. It is useful to group these together as we often need to</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment"># determine whether an access to a field or other object includes</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment"># access to the halo, or not.</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;HALO_ACCESS_LOOP_BOUNDS = [<span class="stringliteral">&quot;cell_halo&quot;</span>, <span class="stringliteral">&quot;dof_halo&quot;</span>, <span class="stringliteral">&quot;colour_halo&quot;</span>]</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;VALID_LOOP_BOUNDS_NAMES = ([<span class="stringliteral">&quot;start&quot;</span>,     <span class="comment"># the starting</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                                         <span class="comment"># index. Currently this is</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                                         <span class="comment"># always 1</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                            <span class="stringliteral">&quot;inner&quot;</span>,     <span class="comment"># a placeholder for when we</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                                         <span class="comment"># support loop splitting into</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                                         <span class="comment"># work that does not access</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                                         <span class="comment"># the halo and work that does.</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                                         <span class="comment"># This will be used to help</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                                         <span class="comment"># overlap computation and</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                                         <span class="comment"># communication</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                            <span class="stringliteral">&quot;ncolour&quot;</span>,   <span class="comment"># the number of cells with</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                                         <span class="comment"># the current colour</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                            <span class="stringliteral">&quot;ncolours&quot;</span>,  <span class="comment"># the number of colours in a</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                                         <span class="comment"># coloured loop</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                            <span class="stringliteral">&quot;ncells&quot;</span>,    <span class="comment"># the number of owned cells</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                            <span class="stringliteral">&quot;ndofs&quot;</span>,     <span class="comment"># the number of owned dofs</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                            <span class="stringliteral">&quot;nannexed&quot;</span>]  <span class="comment"># the number of owned dofs</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;                                         <span class="comment"># plus the number of annexed</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                                         <span class="comment"># dofs. As the indices of</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;                                         <span class="comment"># dofs are arranged that</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                                         <span class="comment"># owned dofs have lower</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;                                         <span class="comment"># indices than annexed dofs,</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;                                         <span class="comment"># having this value as an</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;                                         <span class="comment"># upper bound will compute</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;                                         <span class="comment"># both owned and annexed</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;                                         <span class="comment"># dofs.</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;                           + HALO_ACCESS_LOOP_BOUNDS)</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment"># The mapping from meta-data strings to field-access types</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment"># used in this API.</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;FIELD_ACCESS_MAP = {<span class="stringliteral">&quot;write&quot;</span>: <span class="stringliteral">&quot;gh_write&quot;</span>, <span class="stringliteral">&quot;read&quot;</span>: <span class="stringliteral">&quot;gh_read&quot;</span>,</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                    <span class="stringliteral">&quot;inc&quot;</span>: <span class="stringliteral">&quot;gh_inc&quot;</span>, <span class="stringliteral">&quot;readwrite&quot;</span>: <span class="stringliteral">&quot;gh_readwrite&quot;</span>}</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment"># Valid Dynamo0.3 loop types. The default is &quot;&quot; which is over cells (in the</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment"># horizontal plane).</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;VALID_LOOP_TYPES = [<span class="stringliteral">&quot;dofs&quot;</span>, <span class="stringliteral">&quot;colours&quot;</span>, <span class="stringliteral">&quot;colour&quot;</span>, <span class="stringliteral">&quot;&quot;</span>]</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment"># Mappings used by non-API-Specific code in psyGen</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;psyGen.MAPPING_REDUCTIONS = {<span class="stringliteral">&quot;sum&quot;</span>: <span class="stringliteral">&quot;gh_sum&quot;</span>}</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;psyGen.MAPPING_SCALARS = {<span class="stringliteral">&quot;iscalar&quot;</span>: <span class="stringliteral">&quot;gh_integer&quot;</span>, <span class="stringliteral">&quot;rscalar&quot;</span>: <span class="stringliteral">&quot;gh_real&quot;</span>}</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;psyGen.MAPPING_ACCESSES = FIELD_ACCESS_MAP</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;psyGen.VALID_ARG_TYPE_NAMES = VALID_ARG_TYPE_NAMES</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;psyGen.VALID_ACCESS_DESCRIPTOR_NAMES = VALID_ACCESS_DESCRIPTOR_NAMES</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment"># Functions</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="keyword">def </span>get_fs_map_name(function_space):</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="stringliteral">&#39;&#39;&#39; Returns a dofmap name for the supplied FunctionSpace. &#39;&#39;&#39;</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;map_&quot;</span> + function_space.mangled_name</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="keyword">def </span>get_cbanded_map_name(function_space):</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="stringliteral">&#39;&#39;&#39; Returns the name of a column-banded dofmap for the supplied</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="stringliteral">    FunctionSpace. &#39;&#39;&#39;</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;cbanded_map_&quot;</span> + function_space.mangled_name</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="keyword">def </span>get_cma_indirection_map_name(function_space):</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="stringliteral">&#39;&#39;&#39; Returns the name of a CMA indirection dofmap for the supplied</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="stringliteral">    FunctionSpace. &#39;&#39;&#39;</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;cma_indirection_map_&quot;</span> + function_space.mangled_name</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="keyword">def </span>get_fs_ndf_name(function_space):</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="stringliteral">&#39;&#39;&#39; Returns a ndf name for this FunctionSpace object. &#39;&#39;&#39;</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;ndf_&quot;</span> + function_space.mangled_name</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="keyword">def </span>get_fs_undf_name(function_space):</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="stringliteral">&#39;&#39;&#39; Returns a undf name for this FunctionSpace object. &#39;&#39;&#39;</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;undf_&quot;</span> + function_space.mangled_name</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="keyword">def </span>get_fs_orientation_name(function_space):</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="stringliteral">&#39;&#39;&#39; Returns an orientation name for a function space with the</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="stringliteral">    supplied name &#39;&#39;&#39;</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;orientation&quot;</span> + <span class="stringliteral">&quot;_&quot;</span> + function_space.mangled_name</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="keyword">def </span>get_fs_basis_name(function_space, qr_var=None, on_space=None):</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="stringliteral">    Returns a name for the basis function on this FunctionSpace. If</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="stringliteral">    the name of an associated quadrature object is supplied then this</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="stringliteral">    is appended to the returned name. Similarly, if the function space</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="stringliteral">    at which the basis is to be evaluated is supplied then this is</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="stringliteral">    also appended to the name.</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="stringliteral">    :param function_space: the function space for which the basis is required</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="stringliteral">    :type function_space: :py:class:`psyclone.dynamo0p3.FunctionSpace`</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="stringliteral">    :param string qr_var: the name of the Quadrature Object for which the</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="stringliteral">                          basis functions are required</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="stringliteral">    :param on_space: the function space at which the basis functions</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="stringliteral">                     will be evaluated</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="stringliteral">    :type on_space: :py:class:`psyclone.dynamo0p3.FunctionSpace`</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="stringliteral">    :return: Name for the Fortran array holding the basis function</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="stringliteral">    :rtype: string</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="stringliteral">    &#39;&#39;&#39;</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    name = <span class="stringliteral">&quot;_&quot;</span>.join([<span class="stringliteral">&quot;basis&quot;</span>, function_space.mangled_name])</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="keywordflow">if</span> qr_var:</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        name += <span class="stringliteral">&quot;_&quot;</span> + qr_var</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="keywordflow">if</span> on_space:</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        name += <span class="stringliteral">&quot;_on_&quot;</span> + on_space.mangled_name</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="keywordflow">return</span> name</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="keyword">def </span>basis_first_dim_name(function_space):</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="stringliteral">    Get the name of the variable holding the first dimension of a</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="stringliteral">    basis function</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="stringliteral">    :param function_space: the function space the basis function is for</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="stringliteral">    :type function_space: :py:class:`psyclone.dynamo0p3.FunctionSpace`</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="stringliteral">    :return: a Fortran variable name</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="stringliteral">    :rtype: string</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="stringliteral">    &#39;&#39;&#39;</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;dim_&quot;</span> + function_space.mangled_name</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="keyword">def </span>get_fs_diff_basis_name(function_space, qr_var=None, on_space=None):</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="stringliteral">    Returns a name for the differential basis function on the</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="stringliteral">    supplied FunctionSpace.  If the name of an associated quadrature</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="stringliteral">    object is supplied then this is appended to the returned name. Similarly,</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="stringliteral">    if the function space at which the basis is to be evaluated is supplied</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="stringliteral">    then this is also appended to the name.</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="stringliteral">    :param function_space: the function space for which the differential basis</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="stringliteral">                           is required</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="stringliteral">    :type function_space: :py:class:`psyclone.dynamo0p3.FunctionSpace`</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="stringliteral">    :param string qr_var: the name of the Quadrature Object for which the</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="stringliteral">                          differential basis functions are required</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="stringliteral">    :param on_space: the function space at which the differential basis</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="stringliteral">                     functions will be evaluated</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="stringliteral">    :type on_space: :py:class:`psyclone.dynamo0p3.FunctionSpace`</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="stringliteral">    :return: Name for the Fortran array holding the differential basis function</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="stringliteral">    :rtype: string</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="stringliteral">    &#39;&#39;&#39;</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    name = <span class="stringliteral">&quot;_&quot;</span>.join([<span class="stringliteral">&quot;diff_basis&quot;</span>, function_space.mangled_name])</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="keywordflow">if</span> qr_var:</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        name += <span class="stringliteral">&quot;_&quot;</span> + qr_var</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <span class="keywordflow">if</span> on_space:</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        name += <span class="stringliteral">&quot;_on_&quot;</span> + on_space.mangled_name</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="keywordflow">return</span> name</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="keyword">def </span>diff_basis_first_dim_name(function_space):</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="stringliteral">    Get the name of the variable holding the first dimension of a</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="stringliteral">    differential basis function</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="stringliteral">    :param function_space: the function space the diff-basis function is for</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="stringliteral">    :type function_space: :py:class:`psyclone.dynamo0p3.FunctionSpace`</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="stringliteral">    :return: a Fortran variable name</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="stringliteral">    :rtype: string</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="stringliteral">    &#39;&#39;&#39;</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;diff_dim_&quot;</span> + function_space.mangled_name</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="keyword">def </span>qr_basis_alloc_args(first_dim, basis_fn):</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="stringliteral">    Generate the list of dimensions required to allocate the</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="stringliteral">    supplied basis/diff-basis function</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="stringliteral">    :param str first_dim: the variable name for the first dimension</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="stringliteral">    :param basis_fn: dict holding details on the basis function</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="stringliteral">                     we want to allocate</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="stringliteral">    :type basis_fn: dict containing &#39;shape&#39;, &#39;fspace&#39; and and &#39;qr_var&#39; keys</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="stringliteral">                    holding the quadrature shape, FunctionSpace and name</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="stringliteral">                    of the associated quadrature variable (as specified in the</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="stringliteral">                    Algorithm layer), respectively</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="stringliteral">    :return: list of dimensions to use to allocate array</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="stringliteral">    :rtype: list of strings</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="stringliteral">    &#39;&#39;&#39;</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="comment"># Dimensionality of the basis arrays depends on the</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="comment"># type of quadrature...</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="comment"># if basis_fn[&quot;shape&quot;] == &quot;gh_quadrature_xyz&quot;:</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <span class="comment">#     alloc_args = [first_dim, get_fs_ndf_name(basis_fn[&quot;fspace&quot;]),</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="comment">#          &quot;np_xyz&quot;+&quot;_&quot;+basis_fn[&quot;qr_var&quot;]]</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="keywordflow">if</span> basis_fn[<span class="stringliteral">&quot;shape&quot;</span>] == <span class="stringliteral">&quot;gh_quadrature_xyoz&quot;</span>:</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        alloc_args = [first_dim, get_fs_ndf_name(basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>]),</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;                      <span class="stringliteral">&quot;np_xy&quot;</span>+<span class="stringliteral">&quot;_&quot;</span>+basis_fn[<span class="stringliteral">&quot;qr_var&quot;</span>],</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;                      <span class="stringliteral">&quot;np_z&quot;</span>+<span class="stringliteral">&quot;_&quot;</span>+basis_fn[<span class="stringliteral">&quot;qr_var&quot;</span>]]</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <span class="comment"># elif basis_fn[&quot;shape&quot;] == &quot;gh_quadrature_xoyoz&quot;:</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="comment">#     alloc_args = [first_dim, get_fs_ndf_name(basis_fn[&quot;fspace&quot;]),</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="comment">#                   &quot;np_x&quot;+&quot;_&quot;+basis_fn[&quot;qr_var&quot;],</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <span class="comment">#                   &quot;np_y&quot;+&quot;_&quot;+basis_fn[&quot;qr_var&quot;],</span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <span class="comment">#                   &quot;np_z&quot;+&quot;_&quot;+basis_fn[&quot;qr_var&quot;]]</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <span class="keywordflow">else</span>:</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;            <span class="stringliteral">&quot;Internal error: unrecognised shape ({0}) specified in &quot;</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;            <span class="stringliteral">&quot;dynamo0p3.qr_basis_alloc_args(). Should be one of: &quot;</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;            <span class="stringliteral">&quot;{1}&quot;</span>.format(basis_fn[<span class="stringliteral">&quot;shape&quot;</span>], VALID_QUADRATURE_SHAPES))</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="keywordflow">return</span> alloc_args</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="keyword">def </span>get_fs_operator_name(operator_name, function_space, qr_var=None,</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                         on_space=<span class="keywordtype">None</span>):</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="stringliteral">    Returns the name of the specified operator (orientation, basis or</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="stringliteral">    differential basis) for the supplied FunctionSpace.</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="stringliteral">    :param string operator_name: Name (type) of the operator</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="stringliteral">    :param function_space: the function space for which the operator is</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="stringliteral">                           required</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="stringliteral">    :type function_space: :py:class:`psyclone.dynamo0p3.FunctionSpace`</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="stringliteral">    :param string qr_var: the name of the Quadrature Object for which the</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="stringliteral">                          operator is required.</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="stringliteral">    :param on_space: the function space at which the operator is required</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="stringliteral">    :type on_space: :py:class:`psyclone.dynamo0p3.FunctionSpace`</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="stringliteral">    :return: Name for the Fortran arry holding the named operator</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="stringliteral">             for the specified function space</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="stringliteral">    :rtype: string</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="stringliteral">    &#39;&#39;&#39;</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="keywordflow">if</span> operator_name == <span class="stringliteral">&quot;gh_orientation&quot;</span>:</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        <span class="keywordflow">return</span> get_fs_orientation_name(function_space)</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="keywordflow">elif</span> operator_name == <span class="stringliteral">&quot;gh_basis&quot;</span>:</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        <span class="keywordflow">return</span> get_fs_basis_name(function_space, qr_var=qr_var,</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                                 on_space=on_space)</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="keywordflow">elif</span> operator_name == <span class="stringliteral">&quot;gh_diff_basis&quot;</span>:</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        <span class="keywordflow">return</span> get_fs_diff_basis_name(function_space, qr_var=qr_var,</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                                      on_space=on_space)</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <span class="keywordflow">else</span>:</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;            <span class="stringliteral">&quot;Unsupported name &#39;{0}&#39; found. Expected one of {1}&quot;</span>.</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;            format(operator_name, VALID_METAFUNC_NAMES))</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="keyword">def </span>mangle_fs_name(args, fs_name):</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="stringliteral">&#39;&#39;&#39; Construct the mangled version of a function-space name given</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="stringliteral">    a list of kernel arguments &#39;&#39;&#39;</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="keywordflow">if</span> fs_name <span class="keywordflow">not</span> <span class="keywordflow">in</span> VALID_ANY_SPACE_NAMES:</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        <span class="comment"># If the supplied function-space name is not any any-space then</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        <span class="comment"># we don&#39;t need to mangle the name</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        <span class="keywordflow">return</span> fs_name</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <span class="keywordflow">for</span> arg <span class="keywordflow">in</span> args:</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        <span class="keywordflow">for</span> fspace <span class="keywordflow">in</span> arg.function_spaces:</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;            <span class="keywordflow">if</span> fspace <span class="keywordflow">and</span> fspace.orig_name.lower() == fs_name.lower():</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                <span class="keywordflow">return</span> fs_name.lower() + <span class="stringliteral">&quot;_&quot;</span> + arg.name</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="keywordflow">raise</span> FieldNotFoundError(<span class="stringliteral">&quot;No kernel argument found for function space &quot;</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                             <span class="stringliteral">&quot;&#39;{0}&#39;&quot;</span>.format(fs_name))</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="keyword">def </span>field_on_space(function_space, arguments):</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="stringliteral">&#39;&#39;&#39; Returns the corresponding argument if the supplied list of arguments</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="stringliteral">    contains a field that exists on the specified space. Otherwise</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="stringliteral">    returns None.&#39;&#39;&#39;</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <span class="keywordflow">if</span> function_space.mangled_name <span class="keywordflow">in</span> arguments.unique_fs_names:</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        <span class="keywordflow">for</span> arg <span class="keywordflow">in</span> arguments.args:</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;            <span class="comment"># First, test that arg is a field as some argument objects won&#39;t</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;            <span class="comment"># have function spaces, e.g. scalars</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;            <span class="keywordflow">if</span> arg.type == <span class="stringliteral">&quot;gh_field&quot;</span> <span class="keywordflow">and</span> \</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;               arg.function_space.orig_name == function_space.orig_name:</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                <span class="keywordflow">return</span> arg</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <span class="keywordflow">return</span> <span class="keywordtype">None</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="keyword">def </span>cma_on_space(function_space, arguments):</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <span class="stringliteral">&#39;&#39;&#39; Returns the corresponding argument if the supplied list of arguments</span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="stringliteral">    contains a cma operator that maps to/from the specified space. Otherwise</span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="stringliteral">    returns None.&#39;&#39;&#39;</span></div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="keywordflow">if</span> function_space.mangled_name <span class="keywordflow">in</span> arguments.unique_fs_names:</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        <span class="keywordflow">for</span> arg <span class="keywordflow">in</span> arguments.args:</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;            <span class="comment"># First, test that arg is a CMA op as some argument objects won&#39;t</span></div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;            <span class="comment"># have function spaces, e.g. scalars</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;            <span class="keywordflow">if</span> arg.type == <span class="stringliteral">&quot;gh_columnwise_operator&quot;</span> <span class="keywordflow">and</span> \</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;               function_space.orig_name <span class="keywordflow">in</span> [arg.function_space_to.orig_name,</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                                            arg.function_space_from.orig_name]:</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                <span class="keywordflow">return</span> arg</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    <span class="keywordflow">return</span> <span class="keywordtype">None</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="comment"># Classes</span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;</div><div class="line"><a name="l00410"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1FunctionSpace.html">  410</a></span>&#160;<span class="keyword">class </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1FunctionSpace.html">FunctionSpace</a>(object):</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <span class="stringliteral">&#39;&#39;&#39; Manages the name of a function space. If it is an any-space</span></div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="stringliteral">    then its name is mangled such that it is unique within the scope</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="stringliteral">    of an Invoke &#39;&#39;&#39;</span></div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    <span class="keyword">def </span>__init__(self, name, kernel_args):</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1FunctionSpace.html#a4758e315e4621500bed3de42267ed8cb">_orig_name</a> = name</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1FunctionSpace.html#a7db82163cd2be436c1aa0a13ab739a84">_kernel_args</a> = kernel_args</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1FunctionSpace.html#a4758e315e4621500bed3de42267ed8cb">_orig_name</a> <span class="keywordflow">not</span> <span class="keywordflow">in</span> VALID_ANY_SPACE_NAMES:</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;            <span class="comment"># We only need to name-mangle any-space spaces</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1FunctionSpace.html#a14fa188b17bf61943b51d743d9dd8892">_mangled_name</a> = self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1FunctionSpace.html#a4758e315e4621500bed3de42267ed8cb">_orig_name</a></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;            <span class="comment"># We do not construct the name-mangled name at this point</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;            <span class="comment"># as the full list of kernel arguments may still be under</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;            <span class="comment"># construction.</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1FunctionSpace.html#a14fa188b17bf61943b51d743d9dd8892">_mangled_name</a> = <span class="keywordtype">None</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    @property</div><div class="line"><a name="l00428"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1FunctionSpace.html#ace99ce48ac57abbf297f9e19ae34fd93">  428</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1FunctionSpace.html#ace99ce48ac57abbf297f9e19ae34fd93">orig_name</a>(self):</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Returns the name of this function space as declared in the</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="stringliteral">        kernel meta-data &#39;&#39;&#39;</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1FunctionSpace.html#a4758e315e4621500bed3de42267ed8cb">_orig_name</a></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    @property</div><div class="line"><a name="l00434"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1FunctionSpace.html#a3447e6e30ef9e53611e7e484ac89b845">  434</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1FunctionSpace.html#a3447e6e30ef9e53611e7e484ac89b845">mangled_name</a>(self):</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Returns the mangled name of this function space such that</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="stringliteral">        it is unique within the scope of an invoke. If the mangled</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="stringliteral">        name has not been generated then we do that the first time we&#39;re</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="stringliteral">        called. &#39;&#39;&#39;</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1FunctionSpace.html#a14fa188b17bf61943b51d743d9dd8892">_mangled_name</a>:</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;            <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1FunctionSpace.html#a14fa188b17bf61943b51d743d9dd8892">_mangled_name</a></div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;            <span class="comment"># Cannot use kernel_args.field_on_space(x) here because that</span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;            <span class="comment"># routine itself requires the mangled name in order to identify</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;            <span class="comment"># whether the space is present in the kernel call.</span></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1FunctionSpace.html#a14fa188b17bf61943b51d743d9dd8892">_mangled_name</a> = mangle_fs_name(self._kernel_args.args,</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                                                self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1FunctionSpace.html#a4758e315e4621500bed3de42267ed8cb">_orig_name</a>)</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;            <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1FunctionSpace.html#a14fa188b17bf61943b51d743d9dd8892">_mangled_name</a></div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;</div><div class="line"><a name="l00450"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynFuncDescriptor03.html">  450</a></span>&#160;<span class="keyword">class </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynFuncDescriptor03.html">DynFuncDescriptor03</a>(object):</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <span class="stringliteral">&#39;&#39;&#39; The Dynamo 0.3 API includes a function-space descriptor as</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;<span class="stringliteral">    well as an argument descriptor which is not supported by the base</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;<span class="stringliteral">    classes. This class captures the information specified in a</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="stringliteral">    function-space descriptor. &#39;&#39;&#39;</span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <span class="keyword">def </span>__init__(self, func_type):</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynFuncDescriptor03.html#abd6203197bc707c597752f2fd5f44678">_func_type</a> = func_type</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        <span class="keywordflow">if</span> func_type.name != <span class="stringliteral">&#39;func_type&#39;</span>:</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;            <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;                <span class="stringliteral">&quot;In the dynamo0.3 API each meta_func entry must be of type &quot;</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                <span class="stringliteral">&quot;&#39;func_type&#39; but found &#39;{0}&#39;&quot;</span>.format(func_type.name))</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        <span class="keywordflow">if</span> len(func_type.args) &lt; 2:</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;            <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;                <span class="stringliteral">&quot;In the dynamo0.3 API each meta_func entry must have at &quot;</span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                <span class="stringliteral">&quot;least 2 args, but found &#39;{0}&#39;&quot;</span>.format(len(func_type.args)))</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynFuncDescriptor03.html#a50d5e442d7161abb9aa9a3307a4ad397">_operator_names</a> = []</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        <span class="keywordflow">for</span> idx, arg <span class="keywordflow">in</span> enumerate(func_type.args):</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;            <span class="keywordflow">if</span> idx == 0:  <span class="comment"># first func_type arg</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                <span class="keywordflow">if</span> arg.name <span class="keywordflow">not</span> <span class="keywordflow">in</span> VALID_FUNCTION_SPACE_NAMES:</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;                    <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;                        <span class="stringliteral">&quot;In the dynamo0p3 API the 1st argument of a &quot;</span></div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                        <span class="stringliteral">&quot;meta_func entry should be a valid function space &quot;</span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;                        <span class="stringliteral">&quot;name (one of {0}), but found &#39;{1}&#39; in &#39;{2}&#39;&quot;</span>.format(</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;                            VALID_FUNCTION_SPACE_NAMES, arg.name, func_type))</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynFuncDescriptor03.html#a2a18e367f444f5f930d6b26181b14f2b">_function_space_name</a> = arg.name</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;            <span class="keywordflow">else</span>:  <span class="comment"># subsequent func_type args</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;                <span class="keywordflow">if</span> arg.name <span class="keywordflow">not</span> <span class="keywordflow">in</span> VALID_METAFUNC_NAMES:</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;                    <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;                        <span class="stringliteral">&quot;In the dynamo0.3 API, the 2nd argument and all &quot;</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                        <span class="stringliteral">&quot;subsequent arguments of a meta_func entry should &quot;</span></div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                        <span class="stringliteral">&quot;be one of {0}, but found &quot;</span></div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;                        <span class="stringliteral">&quot;&#39;{1}&#39; in &#39;{2}&quot;</span>.format(VALID_METAFUNC_NAMES,</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                                               arg.name, func_type))</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                <span class="keywordflow">if</span> arg.name <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynFuncDescriptor03.html#a50d5e442d7161abb9aa9a3307a4ad397">_operator_names</a>:</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                    <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;                        <span class="stringliteral">&quot;In the dynamo0.3 API, it is an error to specify an &quot;</span></div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                        <span class="stringliteral">&quot;operator name more than once in a meta_func entry, &quot;</span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;                        <span class="stringliteral">&quot;but &#39;{0}&#39; is replicated in &#39;{1}&quot;</span>.format(arg.name,</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;                                                                 func_type))</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;                self._operator_names.append(arg.name)</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynFuncDescriptor03.html#a97c43e2cc8489c252eca54155bee6ad7">_name</a> = func_type.name</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    @property</div><div class="line"><a name="l00494"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynFuncDescriptor03.html#aa903cd46cf190e12950e29581c0966ab">  494</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynFuncDescriptor03.html#aa903cd46cf190e12950e29581c0966ab">function_space_name</a>(self):</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Returns the name of the descriptors function space &#39;&#39;&#39;</span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynFuncDescriptor03.html#a2a18e367f444f5f930d6b26181b14f2b">_function_space_name</a></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    @property</div><div class="line"><a name="l00499"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynFuncDescriptor03.html#a1daf8595826f46019f3c885eace814c6">  499</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynFuncDescriptor03.html#a1daf8595826f46019f3c885eace814c6">operator_names</a>(self):</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Returns a list of operators that are associated with this</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;<span class="stringliteral">        descriptors function space &#39;&#39;&#39;</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynFuncDescriptor03.html#a50d5e442d7161abb9aa9a3307a4ad397">_operator_names</a></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <span class="keyword">def </span>__repr__(self):</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;DynFuncDescriptor03({0})&quot;</span>.format(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynFuncDescriptor03.html#abd6203197bc707c597752f2fd5f44678">_func_type</a>)</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <span class="keyword">def </span>__str__(self):</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        res = <span class="stringliteral">&quot;DynFuncDescriptor03 object&quot;</span> + os.linesep</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        res += <span class="stringliteral">&quot;  name=&#39;{0}&#39;&quot;</span>.format(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynFuncDescriptor03.html#a97c43e2cc8489c252eca54155bee6ad7">_name</a>) + os.linesep</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        res += <span class="stringliteral">&quot;  nargs={0}&quot;</span>.format(len(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynFuncDescriptor03.html#a50d5e442d7161abb9aa9a3307a4ad397">_operator_names</a>)+1) + os.linesep</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        res += <span class="stringliteral">&quot;  function_space_name[{0}] = &#39;{1}&#39;&quot;</span>.\</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;               format(0, self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynFuncDescriptor03.html#a2a18e367f444f5f930d6b26181b14f2b">_function_space_name</a>) + os.linesep</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        <span class="keywordflow">for</span> idx, arg <span class="keywordflow">in</span> enumerate(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynFuncDescriptor03.html#a50d5e442d7161abb9aa9a3307a4ad397">_operator_names</a>):</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;            res += <span class="stringliteral">&quot;  operator_name[{0}] = &#39;{1}&#39;&quot;</span>.format(idx+1, arg) + \</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;                   os.linesep</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;        <span class="keywordflow">return</span> res</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;</div><div class="line"><a name="l00519"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html">  519</a></span>&#160;<span class="keyword">class </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html">DynArgDescriptor03</a>(<a class="code" href="classpsyclone_1_1parse_1_1Descriptor.html">Descriptor</a>):</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="stringliteral">&#39;&#39;&#39; This class captures the information specified in an argument</span></div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;<span class="stringliteral">    descriptor.&#39;&#39;&#39;</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;</div><div class="line"><a name="l00523"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#adbc78bd9230775883d0f468777668158">  523</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#adbc78bd9230775883d0f468777668158">__init__</a>(self, arg_type):</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<span class="stringliteral">        :param arg_type: dynamo0.3 argument type (scalar, field or operator)</span></div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="stringliteral">        :type arg_type: :py:class:`psyclone.dynamo0p3.DynKernelArgument`</span></div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#add67578fbd425bd0ab19a196d01e3ff1">_arg_type</a> = arg_type</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        <span class="keywordflow">if</span> arg_type.name != <span class="stringliteral">&#39;arg_type&#39;</span>:</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;            <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                <span class="stringliteral">&quot;In the dynamo0.3 API each meta_arg entry must be of type &quot;</span></div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                <span class="stringliteral">&quot;&#39;arg_type&#39;, but found &#39;{0}&#39;&quot;</span>.format(arg_type.name))</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;        <span class="comment"># We require at least 2 args</span></div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        <span class="keywordflow">if</span> len(arg_type.args) &lt; 2:</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;            <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;                <span class="stringliteral">&quot;In the dynamo0.3 API each meta_arg entry must have at least &quot;</span></div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;                <span class="stringliteral">&quot;2 args, but found &#39;{0}&#39;&quot;</span>.format(len(arg_type.args)))</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;        <span class="comment"># The first arg is the type of field, possibly with a *n appended</span></div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#a0d5ce57c32fbe9646b7a1bb17aa52f8b">_vector_size</a> = 1</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;        <span class="keywordflow">if</span> isinstance(arg_type.args[0], expr.BinaryOperator):</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;            <span class="comment"># We expect &#39;field_type * n&#39; to have been specified</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#ab263d8023f266ba1874c0b116c57697b">_type</a> = arg_type.args[0].toks[0].name</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;            operator = arg_type.args[0].toks[1]</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;            <span class="keywordflow">try</span>:</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;                self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#a0d5ce57c32fbe9646b7a1bb17aa52f8b">_vector_size</a> = int(arg_type.args[0].toks[2])</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;            <span class="keywordflow">except</span> TypeError:</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;                <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;                    <span class="stringliteral">&quot;In the dynamo0.3 API vector notation expects the format &quot;</span></div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;                    <span class="stringliteral">&quot;(field*n) where n is an integer, but the following was &quot;</span></div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;                    <span class="stringliteral">&quot;found &#39;{0}&#39; in &#39;{1}&#39;.&quot;</span>.</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;                    format(str(arg_type.args[0].toks[2]), arg_type))</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#ab263d8023f266ba1874c0b116c57697b">_type</a> <span class="keywordflow">not</span> <span class="keywordflow">in</span> VALID_ARG_TYPE_NAMES:</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;                <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;                    <span class="stringliteral">&quot;In the dynamo0.3 API the 1st argument of a meta_arg &quot;</span></div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;                    <span class="stringliteral">&quot;entry should be a valid argument type (one of {0}), but &quot;</span></div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;                    <span class="stringliteral">&quot;found &#39;{1}&#39; in &#39;{2}&#39;&quot;</span>.format(VALID_ARG_TYPE_NAMES,</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                                                  self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#ab263d8023f266ba1874c0b116c57697b">_type</a>, arg_type))</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#ab263d8023f266ba1874c0b116c57697b">_type</a> <span class="keywordflow">in</span> VALID_SCALAR_NAMES <span class="keywordflow">and</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#a0d5ce57c32fbe9646b7a1bb17aa52f8b">_vector_size</a> &gt; 1:</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;                <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                    <span class="stringliteral">&quot;In the dynamo0.3 API vector notation is not supported &quot;</span></div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                    <span class="stringliteral">&quot;for scalar arguments (found &#39;{0}&#39;)&quot;</span>.</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;                    format(arg_type.args[0]))</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;            <span class="keywordflow">if</span> operator != <span class="stringliteral">&quot;*&quot;</span>:</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;                <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;                    <span class="stringliteral">&quot;In the dynamo0.3 API the 1st argument of a meta_arg &quot;</span></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;                    <span class="stringliteral">&quot;entry may be a vector but if so must use &#39;*&#39; as the &quot;</span></div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;                    <span class="stringliteral">&quot;separator in the format (field*n), but found &#39;{0}&#39; in &quot;</span></div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;                    <span class="stringliteral">&quot;&#39;{1}&#39;&quot;</span>.format(operator, arg_type))</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#a0d5ce57c32fbe9646b7a1bb17aa52f8b">_vector_size</a> &lt;= 1:</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;                <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;                    <span class="stringliteral">&quot;In the dynamo0.3 API the 1st argument of a meta_arg &quot;</span></div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;                    <span class="stringliteral">&quot;entry may be a vector but if so must contain a valid &quot;</span></div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;                    <span class="stringliteral">&quot;integer vector size in the format (field*n where n&gt;1), &quot;</span></div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;                    <span class="stringliteral">&quot;but found &#39;{0}&#39; in &#39;{1}&#39;&quot;</span>.format(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#a0d5ce57c32fbe9646b7a1bb17aa52f8b">_vector_size</a>,</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;                                                      arg_type))</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        <span class="keywordflow">elif</span> isinstance(arg_type.args[0], expr.FunctionVar):</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;            <span class="comment"># We expect &#39;field_type&#39; to have been specified</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;            <span class="keywordflow">if</span> arg_type.args[0].name <span class="keywordflow">not</span> <span class="keywordflow">in</span> VALID_ARG_TYPE_NAMES:</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;                <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;                    <span class="stringliteral">&quot;In the dynamo0.3 API the 1st argument of a &quot;</span></div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;                    <span class="stringliteral">&quot;meta_arg entry should be a valid argument type (one of &quot;</span></div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;                    <span class="stringliteral">&quot;{0}), but found &#39;{1}&#39; in &#39;{2}&#39;&quot;</span>.</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;                    format(VALID_ARG_TYPE_NAMES, arg_type.args[0].name,</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;                           arg_type))</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#ab263d8023f266ba1874c0b116c57697b">_type</a> = arg_type.args[0].name</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;            <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;                <span class="stringliteral">&quot;Internal error in DynArgDescriptor03.__init__, (1) should &quot;</span></div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;                <span class="stringliteral">&quot;not get to here&quot;</span>)</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;        <span class="comment"># The 2nd arg is an access descriptor</span></div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;        <span class="keywordflow">if</span> arg_type.args[1].name <span class="keywordflow">not</span> <span class="keywordflow">in</span> VALID_ACCESS_DESCRIPTOR_NAMES:</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;            <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;                <span class="stringliteral">&quot;In the dynamo0.3 API the 2nd argument of a meta_arg entry &quot;</span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;                <span class="stringliteral">&quot;must be a valid access descriptor (one of {0}), but found &quot;</span></div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;                <span class="stringliteral">&quot;&#39;{1}&#39; in &#39;{2}&#39;&quot;</span>.format(VALID_ACCESS_DESCRIPTOR_NAMES,</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;                                        arg_type.args[1].name, arg_type))</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#aa6d6f4fe9a212eb0cf77abb39df4b9b1">_access_descriptor</a> = arg_type.args[1]</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        <span class="comment"># Reduction access descriptors are only valid for real scalar arguments</span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#ab263d8023f266ba1874c0b116c57697b">_type</a> != <span class="stringliteral">&quot;gh_real&quot;</span> <span class="keywordflow">and</span> \</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;           self._access_descriptor.name <span class="keywordflow">in</span> VALID_REDUCTION_NAMES:</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;            <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;                <span class="stringliteral">&quot;In the dynamo0.3 API a reduction access &#39;{0}&#39; is only valid &quot;</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;                <span class="stringliteral">&quot;with a real scalar argument, but &#39;{1}&#39; was found&quot;</span>.</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;                format(self._access_descriptor.name, self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#ab263d8023f266ba1874c0b116c57697b">_type</a>))</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        <span class="comment"># FIELD, OPERATOR and SCALAR datatypes descriptors and rules</span></div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;        stencil = <span class="keywordtype">None</span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        mesh = <span class="keywordtype">None</span></div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        <span class="comment"># Fields</span></div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#ab263d8023f266ba1874c0b116c57697b">_type</a> == <span class="stringliteral">&quot;gh_field&quot;</span>:</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;            <span class="keywordflow">if</span> len(arg_type.args) &lt; 3:</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;                    <span class="stringliteral">&quot;In the dynamo0.3 API each meta_arg entry must have at &quot;</span></div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;                    <span class="stringliteral">&quot;least 3 arguments if its first argument is gh_field, but &quot;</span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;                    <span class="stringliteral">&quot;found {0} in &#39;{1}&#39;&quot;</span>.format(len(arg_type.args), arg_type)</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;                    )</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;            <span class="comment"># There must be at most 4 arguments.</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;            <span class="keywordflow">if</span> len(arg_type.args) &gt; 4:</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;                <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;                    <span class="stringliteral">&quot;In the dynamo0.3 API each meta_arg entry must have at &quot;</span></div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;                    <span class="stringliteral">&quot;most 4 arguments if its first argument is gh_field, but &quot;</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;                    <span class="stringliteral">&quot;found {0} in &#39;{1}&#39;&quot;</span>.format(len(arg_type.args), arg_type))</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;            <span class="comment"># The 3rd argument must be a function space name</span></div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;            <span class="keywordflow">if</span> arg_type.args[2].name <span class="keywordflow">not</span> <span class="keywordflow">in</span> VALID_FUNCTION_SPACE_NAMES:</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;                <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;                    <span class="stringliteral">&quot;In the dynamo0.3 API the 3rd argument of a meta_arg &quot;</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;                    <span class="stringliteral">&quot;entry must be a valid function space name if its first &quot;</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;                    <span class="stringliteral">&quot;argument is gh_field (one of {0}), but found &#39;{1}&#39; in &quot;</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;                    <span class="stringliteral">&quot;&#39;{2}&quot;</span>.format(VALID_FUNCTION_SPACE_NAMES,</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;                                  arg_type.args[2].name, arg_type))</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#ac6de0a98c4c4968d5ee757a9a1d3b208">_function_space1</a> = arg_type.args[2].name</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;            <span class="comment"># The optional 4th argument is either a stencil specification</span></div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;            <span class="comment"># or a mesh identifier (for inter-grid kernels)</span></div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;            <span class="keywordflow">if</span> len(arg_type.args) == 4:</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;                <span class="keywordflow">try</span>:</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;                    <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1parse.html">psyclone.parse</a> <span class="keyword">import</span> get_stencil, get_mesh</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;                    <span class="keywordflow">if</span> <span class="stringliteral">&quot;stencil&quot;</span> <span class="keywordflow">in</span> str(arg_type.args[3]):</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;                        stencil = get_stencil(arg_type.args[3],</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;                                              VALID_STENCIL_TYPES)</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;                    <span class="keywordflow">elif</span> <span class="stringliteral">&quot;mesh&quot;</span> <span class="keywordflow">in</span> str(arg_type.args[3]):</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;                        mesh = get_mesh(arg_type.args[3], VALID_MESH_TYPES)</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                    <span class="keywordflow">else</span>:</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;                        <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(<span class="stringliteral">&quot;Unrecognised meta-data entry&quot;</span>)</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;                <span class="keywordflow">except</span> ParseError <span class="keyword">as</span> err:</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;                    <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;                        <span class="stringliteral">&quot;In the dynamo0.3 API the 4th argument of a &quot;</span></div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;                        <span class="stringliteral">&quot;meta_arg entry must be either a valid stencil &quot;</span></div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;                        <span class="stringliteral">&quot;specification  or a mesh identifier (for inter-&quot;</span></div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;                        <span class="stringliteral">&quot;grid kernels). However, &quot;</span></div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;                        <span class="stringliteral">&quot;entry {0} raised the following error: {1}&quot;</span>.</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;                        format(arg_type, str(err)))</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;            <span class="comment"># Test allowed accesses for fields</span></div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;            <span class="keywordflow">if</span> self._function_space1.lower() <span class="keywordflow">in</span> DISCONTINUOUS_FUNCTION_SPACES \</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;               <span class="keywordflow">and</span> self._access_descriptor.name.lower() == <span class="stringliteral">&quot;gh_inc&quot;</span>:</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;                <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;                    <span class="stringliteral">&quot;It does not make sense for a field on a discontinuous &quot;</span></div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;                    <span class="stringliteral">&quot;space ({0}) to have a &#39;gh_inc&#39; access&quot;</span>.</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;                    format(self._function_space1.lower()))</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;            <span class="comment"># TODO: extend for &quot;gh_write&quot;</span></div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;            <span class="keywordflow">if</span> self._function_space1.lower() <span class="keywordflow">in</span> CONTINUOUS_FUNCTION_SPACES \</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;               <span class="keywordflow">and</span> self._access_descriptor.name.lower() == <span class="stringliteral">&quot;gh_readwrite&quot;</span>:</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;                <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;                    <span class="stringliteral">&quot;It does not make sense for a field on a continuous &quot;</span></div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;                    <span class="stringliteral">&quot;space ({0}) to have a &#39;gh_readwrite&#39; access&quot;</span>.</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;                    format(self._function_space1.lower()))</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;            <span class="comment"># TODO: extend for &quot;gh_write&quot;</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;            <span class="keywordflow">if</span> self._function_space1.lower() <span class="keywordflow">in</span> VALID_ANY_SPACE_NAMES \</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;               <span class="keywordflow">and</span> self._access_descriptor.name.lower() == <span class="stringliteral">&quot;gh_readwrite&quot;</span>:</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;                <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;                    <span class="stringliteral">&quot;In the dynamo0.3 API a field on any_space cannot &quot;</span></div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;                    <span class="stringliteral">&quot;have &#39;gh_readwrite&#39; access because it is treated &quot;</span></div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;                    <span class="stringliteral">&quot;as continuous&quot;</span>)</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;            <span class="keywordflow">if</span> stencil <span class="keywordflow">and</span> self._access_descriptor.name.lower() != <span class="stringliteral">&quot;gh_read&quot;</span>:</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;                <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(<span class="stringliteral">&quot;a stencil must be read only so its access&quot;</span></div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;                                 <span class="stringliteral">&quot;should be gh_read&quot;</span>)</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;        <span class="comment"># Operators</span></div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;        <span class="keywordflow">elif</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#ab263d8023f266ba1874c0b116c57697b">_type</a> <span class="keywordflow">in</span> VALID_OPERATOR_NAMES:</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;            <span class="comment"># we expect 4 arguments with the 3rd and 4th each being a</span></div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;            <span class="comment"># function space</span></div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;            <span class="keywordflow">if</span> len(arg_type.args) != 4:</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;                <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;                    <span class="stringliteral">&quot;In the dynamo0.3 API each meta_arg entry must have 4 &quot;</span></div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;                    <span class="stringliteral">&quot;arguments if its first argument is gh_operator or &quot;</span></div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;                    <span class="stringliteral">&quot;gh_columnwise_operator, but &quot;</span></div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;                    <span class="stringliteral">&quot;found {0} in &#39;{1}&#39;&quot;</span>.format(len(arg_type.args), arg_type))</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;            <span class="keywordflow">if</span> arg_type.args[2].name <span class="keywordflow">not</span> <span class="keywordflow">in</span> VALID_FUNCTION_SPACE_NAMES:</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;                <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;                    <span class="stringliteral">&quot;In the dynamo0.3 API the 3rd argument of a meta_arg &quot;</span></div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;                    <span class="stringliteral">&quot;entry must be a valid function space name (one of {0}), &quot;</span></div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;                    <span class="stringliteral">&quot;but found &#39;{1}&#39; in &#39;{2}&quot;</span>.</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;                    format(VALID_FUNCTION_SPACE_NAMES, arg_type.args[2].name,</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;                           arg_type))</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#ac6de0a98c4c4968d5ee757a9a1d3b208">_function_space1</a> = arg_type.args[2].name</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;            <span class="keywordflow">if</span> arg_type.args[3].name <span class="keywordflow">not</span> <span class="keywordflow">in</span> VALID_FUNCTION_SPACE_NAMES:</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;                <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;                    <span class="stringliteral">&quot;In the dynamo0.3 API the 4th argument of a meta_arg &quot;</span></div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;                    <span class="stringliteral">&quot;entry must be a valid function space name (one of {0}), &quot;</span></div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;                    <span class="stringliteral">&quot;but found &#39;{1}&#39; in &#39;{2}&quot;</span>.</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;                    format(VALID_FUNCTION_SPACE_NAMES, arg_type.args[2].name,</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;                           arg_type))</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#a8e125b39719a4229126fd74a883c8e7d">_function_space2</a> = arg_type.args[3].name</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;            <span class="comment"># Test allowed accesses for operators</span></div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;            <span class="keywordflow">if</span> self._access_descriptor.name.lower() == <span class="stringliteral">&quot;gh_inc&quot;</span>:</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;                <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;                    <span class="stringliteral">&quot;In the dynamo0.3 API operators cannot have a &#39;gh_inc&#39; &quot;</span></div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;                    <span class="stringliteral">&quot;access because they behave as discontinuous quantities&quot;</span>)</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;        <span class="comment"># Scalars</span></div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;        <span class="keywordflow">elif</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#ab263d8023f266ba1874c0b116c57697b">_type</a> <span class="keywordflow">in</span> VALID_SCALAR_NAMES:</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;            <span class="keywordflow">if</span> len(arg_type.args) != 2:</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;                <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;                    <span class="stringliteral">&quot;In the dynamo0.3 API each meta_arg entry must have 2 &quot;</span></div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;                    <span class="stringliteral">&quot;arguments if its first argument is gh_{{r,i}}scalar, but &quot;</span></div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;                    <span class="stringliteral">&quot;found {0} in &#39;{1}&#39;&quot;</span>.format(len(arg_type.args), arg_type))</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;            <span class="comment"># Test allowed accesses for scalars (read_only or reduction)</span></div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;            <span class="keywordflow">if</span> self._access_descriptor.name <span class="keywordflow">not</span> <span class="keywordflow">in</span> [<span class="stringliteral">&quot;gh_read&quot;</span>] + \</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;               VALID_REDUCTION_NAMES:</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;                <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;                    <span class="stringliteral">&quot;In the dynamo0.3 API scalar arguments must be &quot;</span></div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;                    <span class="stringliteral">&quot;read-only (gh_read) or a reduction ({0}) but found &quot;</span></div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;                    <span class="stringliteral">&quot;&#39;{1}&#39; in &#39;{2}&#39;&quot;</span>.format(VALID_REDUCTION_NAMES,</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;                                            self._access_descriptor.name,</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;                                            arg_type))</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;            <span class="comment"># Scalars don&#39;t have a function space</span></div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#ac6de0a98c4c4968d5ee757a9a1d3b208">_function_space1</a> = <span class="keywordtype">None</span></div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;        <span class="comment"># We should never get to here</span></div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;            <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;                <span class="stringliteral">&quot;Internal error in DynArgDescriptor03.__init__, (2) should &quot;</span></div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;                <span class="stringliteral">&quot;not get to here&quot;</span>)</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;        Descriptor.__init__(self, self._access_descriptor.name,</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;                            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#ac6de0a98c4c4968d5ee757a9a1d3b208">_function_space1</a>, stencil=stencil,</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;                            mesh=mesh)</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;    @property</div><div class="line"><a name="l00743"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#a9c3c4eb63a05289cf6d530eff81b58e7">  743</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#a9c3c4eb63a05289cf6d530eff81b58e7">function_space_to</a>(self):</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Return the &quot;to&quot; function space for a gh_operator. This is</span></div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;<span class="stringliteral">        the first function space specified in the metadata. Raise an</span></div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;<span class="stringliteral">        error if this is not an operator. &#39;&#39;&#39;</span></div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#ab263d8023f266ba1874c0b116c57697b">_type</a> <span class="keywordflow">in</span> VALID_OPERATOR_NAMES:</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;            <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#ac6de0a98c4c4968d5ee757a9a1d3b208">_function_space1</a></div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;            <span class="keywordflow">raise</span> RuntimeError(</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;                <span class="stringliteral">&quot;function_space_to only makes sense for one of {0}, but &quot;</span></div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;                <span class="stringliteral">&quot;this is a &#39;{1}&#39;&quot;</span>.format(VALID_OPERATOR_NAMES, self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#ab263d8023f266ba1874c0b116c57697b">_type</a>))</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    @property</div><div class="line"><a name="l00755"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#a35ac8ccec63526e2192f0d2eb75435e2">  755</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#a35ac8ccec63526e2192f0d2eb75435e2">function_space_from</a>(self):</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Return the &quot;from&quot; function space for a gh_operator. This is</span></div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;<span class="stringliteral">        the second function space specified in the metadata. Raise an</span></div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;<span class="stringliteral">        error if this is not an operator. &#39;&#39;&#39;</span></div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#ab263d8023f266ba1874c0b116c57697b">_type</a> <span class="keywordflow">in</span> VALID_OPERATOR_NAMES:</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;            <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#a8e125b39719a4229126fd74a883c8e7d">_function_space2</a></div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;            <span class="keywordflow">raise</span> RuntimeError(</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;                <span class="stringliteral">&quot;function_space_from only makes sense for one of {0}, but this&quot;</span></div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;                <span class="stringliteral">&quot; is a &#39;{1}&#39;&quot;</span>.format(VALID_OPERATOR_NAMES, self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#ab263d8023f266ba1874c0b116c57697b">_type</a>))</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    @property</div><div class="line"><a name="l00767"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#a0f6d901fc8392c86469112041971154e">  767</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#a0f6d901fc8392c86469112041971154e">function_space</a>(self):</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Return the function space name that this instance operates</span></div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;<span class="stringliteral">        on. In the case of a gh_operator/gh_columnwise_operator, where there</span></div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;<span class="stringliteral">        are 2 function spaces, return function_space_from. &#39;&#39;&#39;</span></div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#ab263d8023f266ba1874c0b116c57697b">_type</a> == <span class="stringliteral">&quot;gh_field&quot;</span>:</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;            <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#ac6de0a98c4c4968d5ee757a9a1d3b208">_function_space1</a></div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;        <span class="keywordflow">elif</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#ab263d8023f266ba1874c0b116c57697b">_type</a> <span class="keywordflow">in</span> VALID_OPERATOR_NAMES:</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;            <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#a8e125b39719a4229126fd74a883c8e7d">_function_space2</a></div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;        <span class="keywordflow">elif</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#ab263d8023f266ba1874c0b116c57697b">_type</a> <span class="keywordflow">in</span> VALID_SCALAR_NAMES:</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;            <span class="keywordflow">return</span> <span class="keywordtype">None</span></div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;            <span class="keywordflow">raise</span> RuntimeError(</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;                <span class="stringliteral">&quot;Internal error, DynArgDescriptor03:function_space(), should &quot;</span></div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;                <span class="stringliteral">&quot;not get to here.&quot;</span>)</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    @property</div><div class="line"><a name="l00783"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#a036f722e3aee79762a82d62fb7a69ec7">  783</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#a036f722e3aee79762a82d62fb7a69ec7">function_spaces</a>(self):</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Return the function space names that this instance operates</span></div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;<span class="stringliteral">        on as a list. In the case of a gh_operator, where there are 2 function</span></div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;<span class="stringliteral">        spaces, we return both. &#39;&#39;&#39;</span></div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#ab263d8023f266ba1874c0b116c57697b">_type</a> == <span class="stringliteral">&quot;gh_field&quot;</span>:</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;            <span class="keywordflow">return</span> [self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#a0f6d901fc8392c86469112041971154e">function_space</a>]</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;        <span class="keywordflow">elif</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#ab263d8023f266ba1874c0b116c57697b">_type</a> <span class="keywordflow">in</span> VALID_OPERATOR_NAMES:</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;            <span class="comment"># return to before from to maintain expected ordering</span></div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;            <span class="keywordflow">return</span> [self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#a9c3c4eb63a05289cf6d530eff81b58e7">function_space_to</a>, self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#a35ac8ccec63526e2192f0d2eb75435e2">function_space_from</a>]</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;        <span class="keywordflow">elif</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#ab263d8023f266ba1874c0b116c57697b">_type</a> <span class="keywordflow">in</span> VALID_SCALAR_NAMES:</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;            <span class="keywordflow">return</span> []</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;            <span class="keywordflow">raise</span> RuntimeError(</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;                <span class="stringliteral">&quot;Internal error, DynArgDescriptor03:function_spaces(), should &quot;</span></div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;                <span class="stringliteral">&quot;not get to here.&quot;</span>)</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    @property</div><div class="line"><a name="l00800"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#a0ffecabdcdb593f2098b024e82a684e9">  800</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#a0ffecabdcdb593f2098b024e82a684e9">vector_size</a>(self):</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Returns the vector size of the argument. This will be 1 if *n</span></div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;<span class="stringliteral">        has not been specified. &#39;&#39;&#39;</span></div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#a0d5ce57c32fbe9646b7a1bb17aa52f8b">_vector_size</a></div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    @property</div><div class="line"><a name="l00806"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#ab8ff6649bcf90fed276bf8ba8c8d87b8">  806</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#ab8ff6649bcf90fed276bf8ba8c8d87b8">type</a>(self):</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; returns the type of the argument (gh_field, gh_operator, ...). &#39;&#39;&#39;</span></div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#ab263d8023f266ba1874c0b116c57697b">_type</a></div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;    <span class="keyword">def </span>__str__(self):</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;        res = <span class="stringliteral">&quot;DynArgDescriptor03 object&quot;</span> + os.linesep</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;        res += <span class="stringliteral">&quot;  argument_type[0]=&#39;{0}&#39;&quot;</span>.format(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#ab263d8023f266ba1874c0b116c57697b">_type</a>)</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#a0d5ce57c32fbe9646b7a1bb17aa52f8b">_vector_size</a> &gt; 1:</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;            res += <span class="stringliteral">&quot;*&quot;</span>+str(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#a0d5ce57c32fbe9646b7a1bb17aa52f8b">_vector_size</a>)</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;        res += os.linesep</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;        res += <span class="stringliteral">&quot;  access_descriptor[1]=&#39;{0}&#39;&quot;</span>.format(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#aa6d6f4fe9a212eb0cf77abb39df4b9b1">_access_descriptor</a>) \</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;               + os.linesep</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#ab263d8023f266ba1874c0b116c57697b">_type</a> == <span class="stringliteral">&quot;gh_field&quot;</span>:</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;            res += <span class="stringliteral">&quot;  function_space[2]=&#39;{0}&#39;&quot;</span>.format(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#ac6de0a98c4c4968d5ee757a9a1d3b208">_function_space1</a>) \</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;                   + os.linesep</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;        <span class="keywordflow">elif</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#ab263d8023f266ba1874c0b116c57697b">_type</a> <span class="keywordflow">in</span> VALID_OPERATOR_NAMES:</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;            res += <span class="stringliteral">&quot;  function_space_to[2]=&#39;{0}&#39;&quot;</span>.\</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;                   format(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#ac6de0a98c4c4968d5ee757a9a1d3b208">_function_space1</a>) + os.linesep</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;            res += <span class="stringliteral">&quot;  function_space_from[3]=&#39;{0}&#39;&quot;</span>.\</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;                   format(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#a8e125b39719a4229126fd74a883c8e7d">_function_space2</a>) + os.linesep</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;        <span class="keywordflow">elif</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#ab263d8023f266ba1874c0b116c57697b">_type</a> <span class="keywordflow">in</span> VALID_SCALAR_NAMES:</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;            <span class="keywordflow">pass</span>  <span class="comment"># we have nothing to add if we&#39;re a scalar</span></div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;        <span class="keywordflow">else</span>:  <span class="comment"># we should never get to here</span></div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;            <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(<span class="stringliteral">&quot;Internal error in DynArgDescriptor03.__str__&quot;</span>)</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;        <span class="keywordflow">return</span> res</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    <span class="keyword">def </span>__repr__(self):</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;DynArgDescriptor03({0})&quot;</span>.format(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#add67578fbd425bd0ab19a196d01e3ff1">_arg_type</a>)</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;</div><div class="line"><a name="l00836"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html">  836</a></span>&#160;<span class="keyword">class </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html">DynKernMetadata</a>(<a class="code" href="classpsyclone_1_1parse_1_1KernelType.html">KernelType</a>):</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    <span class="stringliteral">&#39;&#39;&#39; Captures the Kernel subroutine code and metadata describing</span></div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;<span class="stringliteral">    the subroutine for the Dynamo 0.3 API.</span></div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;<span class="stringliteral">    :param ast: fparser1 AST for the kernel.</span></div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;<span class="stringliteral">    :type ast: :py:class:`fparser.block_statements.BeginSource`</span></div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;<span class="stringliteral">    :param str name: The name of this kernel.</span></div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;<span class="stringliteral">    :raises ParseError: if the meta-data does not conform to the \</span></div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;<span class="stringliteral">                        rules for the Dynamo 0.3 API.</span></div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;<span class="stringliteral">    &#39;&#39;&#39;</span></div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;    <span class="keyword">def </span>__init__(self, ast, name=None):</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;        KernelType.__init__(self, ast, name=name)</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;        <span class="comment"># The type of CMA operation this kernel performs (or None if</span></div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;        <span class="comment"># no CMA operators are involved)</span></div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#a365fb3dafe4977d0aa6af8debd65c545">_cma_operation</a> = <span class="keywordtype">None</span></div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;        <span class="comment"># Query the meta-data for the evaluator shape (only required if</span></div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;        <span class="comment"># kernel uses quadrature or an evaluator). If it is not</span></div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;        <span class="comment"># present then eval_shape will be None.</span></div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#ab8e7f4bbb00609ecddef9c66c1616c21">_eval_shape</a> = self.<a class="code" href="classpsyclone_1_1parse_1_1KernelType.html#a2c3ef6cc8cee5145f97d3d9b60ecf6af">get_integer_variable</a>(<span class="stringliteral">&#39;gh_shape&#39;</span>)</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;        <span class="comment"># The list of function space names for which an evaluator is</span></div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;        <span class="comment"># required. We set this up below once we&#39;ve processed the meta-</span></div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;        <span class="comment"># -data describing the kernel arguments.</span></div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#a29ea450540410a4538c93005389fe7a9">_eval_targets</a> = []</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;        <span class="comment"># Whether or not this is an inter-grid kernel (i.e. has a mesh</span></div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;        <span class="comment"># specified for each [field] argument). This property is</span></div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;        <span class="comment"># set to True if all the checks in _validate_inter_grid() pass.</span></div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#ae0241bdcf34e84b803b2320c0367ce30">_is_intergrid</a> = <span class="keyword">False</span></div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;        <span class="comment"># parse the arg_type metadata</span></div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#aa3c8f683803c32191f7278595cc20e5f">_arg_descriptors</a> = []</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;        <span class="keywordflow">for</span> arg_type <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1parse_1_1KernelType.html#a89c1ed3bea5975b4ae70c01510e8cde6">_inits</a>:</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;            self._arg_descriptors.append(<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html">DynArgDescriptor03</a>(arg_type))</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;        <span class="comment"># parse the func_type metadata if it exists</span></div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;        found = <span class="keyword">False</span></div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;        <span class="keywordflow">for</span> line <span class="keywordflow">in</span> self._ktype.content:</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;            <span class="keywordflow">if</span> isinstance(line, fparser.one.typedecl_statements.Type):</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;                <span class="keywordflow">for</span> entry <span class="keywordflow">in</span> line.selector:</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;                    <span class="keywordflow">if</span> entry == <span class="stringliteral">&quot;func_type&quot;</span>:</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;                        <span class="keywordflow">if</span> line.entity_decls[0].split()[0].split(<span class="stringliteral">&quot;(&quot;</span>)[0] == \</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;                                <span class="stringliteral">&quot;meta_funcs&quot;</span>:</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;                            found = <span class="keyword">True</span></div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;                            <span class="keywordflow">break</span></div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> found:</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;            func_types = []</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;            <span class="comment"># use the base class method to extract the information</span></div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;            func_types = self.<a class="code" href="classpsyclone_1_1parse_1_1KernelType.html#adc72127ce62cac03e022d11735835ce9">getkerneldescriptors</a>(self.<a class="code" href="classpsyclone_1_1parse_1_1KernelType.html#a5cf2320fa76643060debcfc97b83b91b">_ktype</a>,</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;                                                   var_name=<span class="stringliteral">&quot;meta_funcs&quot;</span>)</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#a2d5182c0cdbec8e223f757fe20d00ede">_func_descriptors</a> = []</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;        <span class="comment"># populate a list of function descriptor objects which we</span></div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;        <span class="comment"># return via the func_descriptors method.</span></div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;        arg_fs_names = []</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;        <span class="keywordflow">for</span> descriptor <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#aa3c8f683803c32191f7278595cc20e5f">_arg_descriptors</a>:</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;            arg_fs_names.extend(descriptor.function_spaces)</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;        used_fs_names = []</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;        need_evaluator = <span class="keyword">False</span></div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;        <span class="keywordflow">for</span> func_type <span class="keywordflow">in</span> func_types:</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;            descriptor = <a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynFuncDescriptor03.html">DynFuncDescriptor03</a>(func_type)</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;            fs_name = descriptor.function_space_name</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;            <span class="comment"># check that function space names in meta_funcs are specified in</span></div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;            <span class="comment"># meta_args</span></div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;            <span class="keywordflow">if</span> fs_name <span class="keywordflow">not</span> <span class="keywordflow">in</span> arg_fs_names:</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;                <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;                    <span class="stringliteral">&quot;In the dynamo0.3 API all function spaces specified in &quot;</span></div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;                    <span class="stringliteral">&quot;meta_funcs must exist in meta_args, but &#39;{0}&#39; breaks &quot;</span></div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;                    <span class="stringliteral">&quot;this rule in ...\n&#39;{1}&#39;.&quot;</span>.</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;                    format(fs_name, self._ktype.content))</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;            <span class="keywordflow">if</span> fs_name <span class="keywordflow">not</span> <span class="keywordflow">in</span> used_fs_names:</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;                used_fs_names.append(fs_name)</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;                <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;                    <span class="stringliteral">&quot;In the dynamo0.3 API function spaces specified in &quot;</span></div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;                    <span class="stringliteral">&quot;meta_funcs must be unique, but &#39;{0}&#39; is replicated.&quot;</span></div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;                    .format(fs_name))</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;            <span class="comment"># Check that a valid shape has been specified if</span></div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;            <span class="comment"># this function space requires a basis or differential basis</span></div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;            <span class="keywordflow">for</span> name <span class="keywordflow">in</span> descriptor.operator_names:</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;                <span class="keywordflow">if</span> name <span class="keywordflow">in</span> VALID_EVALUATOR_NAMES:</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;                    need_evaluator = <span class="keyword">True</span></div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;                    <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#ab8e7f4bbb00609ecddef9c66c1616c21">_eval_shape</a>:</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;                        <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;                            <span class="stringliteral">&quot;In the dynamo0.3 API any kernel requiring &quot;</span></div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;                            <span class="stringliteral">&quot;quadrature or an evaluator ({0}) must also &quot;</span></div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;                            <span class="stringliteral">&quot;supply the shape of that evaluator by setting &quot;</span></div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;                            <span class="stringliteral">&quot;&#39;gh_shape&#39; in the kernel meta-data but &quot;</span></div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;                            <span class="stringliteral">&quot;this is missing for kernel &#39;{1}&#39;&quot;</span>.</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;                            format(VALID_EVALUATOR_NAMES, self.<a class="code" href="classpsyclone_1_1parse_1_1KernelType.html#aae575d92f86e6ec52cea59d3861641d4">name</a>))</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;                    <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#ab8e7f4bbb00609ecddef9c66c1616c21">_eval_shape</a> <span class="keywordflow">not</span> <span class="keywordflow">in</span> VALID_EVALUATOR_SHAPES:</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;                        <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;                            <span class="stringliteral">&quot;In the dynamo0.3 API a kernel requiring either &quot;</span></div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;                            <span class="stringliteral">&quot;quadrature or an evaluator must request a valid &quot;</span></div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;                            <span class="stringliteral">&quot;gh_shape (one of {0}) but got &#39;{1}&#39; for &quot;</span></div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;                            <span class="stringliteral">&quot;kernel &#39;{2}&#39;&quot;</span>.</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;                            format(VALID_EVALUATOR_SHAPES, self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#ab8e7f4bbb00609ecddef9c66c1616c21">_eval_shape</a>,</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;                                   self.<a class="code" href="classpsyclone_1_1parse_1_1KernelType.html#aae575d92f86e6ec52cea59d3861641d4">name</a>))</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;            self._func_descriptors.append(descriptor)</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;        <span class="comment"># Check to see whether the optional &#39;gh_evaluator_targets&#39;</span></div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;        <span class="comment"># has been supplied. This lists the function spaces for which</span></div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;        <span class="comment"># any evaluators (gh_shape=gh_evaluator) should be provided.</span></div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;        _targets = self.<a class="code" href="classpsyclone_1_1parse_1_1KernelType.html#a5ede30b40bbcae17632416023e5f75fc">get_integer_array</a>(<span class="stringliteral">&#39;gh_evaluator_targets&#39;</span>)</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> _targets <span class="keywordflow">and</span> \</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;           self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#ab8e7f4bbb00609ecddef9c66c1616c21">_eval_shape</a> <span class="keywordflow">and</span> self._eval_shape.lower() == <span class="stringliteral">&quot;gh_evaluator&quot;</span>:</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;            <span class="comment"># Use the FS of the kernel arguments that are updated</span></div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;            write_args = psyGen.args_filter(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#aa3c8f683803c32191f7278595cc20e5f">_arg_descriptors</a>,</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;                                            arg_accesses=GH_WRITE_ACCESSES)</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;            <span class="comment"># We want the &#39;to&#39; space of any operator arguments so get</span></div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;            <span class="comment"># the first FS associated with the kernel argument.</span></div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;            _targets = [arg.function_spaces[0] <span class="keywordflow">for</span> arg <span class="keywordflow">in</span> write_args]</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;        <span class="comment"># Ensure that _eval_targets entries are not duplicated</span></div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;        <span class="keywordflow">for</span> target <span class="keywordflow">in</span> _targets:</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;            <span class="keywordflow">if</span> target <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#a29ea450540410a4538c93005389fe7a9">_eval_targets</a>:</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;                self._eval_targets.append(target)</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;        <span class="comment"># Perform further checks that the meta-data we&#39;ve parsed</span></div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;        <span class="comment"># conforms to the rules for this API</span></div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#a23e52c1ca8ce0acbfd04b6784efbf5d7">_validate</a>(need_evaluator)</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;    <span class="keyword">def </span>_validate(self, need_evaluator):</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;<span class="stringliteral">        Check that the meta-data conforms to Dynamo 0.3 rules for a</span></div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;<span class="stringliteral">        user-provided kernel or a built-in</span></div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;<span class="stringliteral">        :param bool need_evaluator: whether this kernel requires an</span></div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;<span class="stringliteral">                                    evaluator/quadrature</span></div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;<span class="stringliteral">        :raises: ParseError: if meta-data breaks the Dynamo 0.3 rules</span></div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1dynamo0p3__builtins.html">psyclone.dynamo0p3_builtins</a> <span class="keyword">import</span> BUILTIN_MAP</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;        <span class="comment"># We must have at least one argument that is written to</span></div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;        write_count = 0</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;        <span class="keywordflow">for</span> arg <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#aa3c8f683803c32191f7278595cc20e5f">_arg_descriptors</a>:</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;            <span class="keywordflow">if</span> arg.access != <span class="stringliteral">&quot;gh_read&quot;</span>:</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;                write_count += 1</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;                <span class="comment"># We must not write to scalar arguments if it&#39;s not a</span></div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;                <span class="comment"># built-in</span></div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;                <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1parse_1_1KernelType.html#aae575d92f86e6ec52cea59d3861641d4">name</a> <span class="keywordflow">not</span> <span class="keywordflow">in</span> BUILTIN_MAP <span class="keywordflow">and</span> \</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;                   arg.type <span class="keywordflow">in</span> VALID_SCALAR_NAMES:</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;                    <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;                        <span class="stringliteral">&quot;A user-supplied Dynamo 0.3 kernel must not &quot;</span></div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;                        <span class="stringliteral">&quot;write/update a scalar argument but kernel {0} has &quot;</span></div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;                        <span class="stringliteral">&quot;{1} with {2} access&quot;</span>.format(self.<a class="code" href="classpsyclone_1_1parse_1_1KernelType.html#aae575d92f86e6ec52cea59d3861641d4">name</a>,</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;                                                     arg.type, arg.access))</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;        <span class="keywordflow">if</span> write_count == 0:</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;            <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(<span class="stringliteral">&quot;A Dynamo 0.3 kernel must have at least one &quot;</span></div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;                             <span class="stringliteral">&quot;argument that is updated (written to) but &quot;</span></div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;                             <span class="stringliteral">&quot;found none for kernel {0}&quot;</span>.format(self.<a class="code" href="classpsyclone_1_1parse_1_1KernelType.html#aae575d92f86e6ec52cea59d3861641d4">name</a>))</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;        <span class="comment"># Check that no shape has been supplied if no basis or</span></div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;        <span class="comment"># differential basis functions are required for the kernel</span></div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> need_evaluator <span class="keywordflow">and</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#ab8e7f4bbb00609ecddef9c66c1616c21">_eval_shape</a>:</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;            <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;                <span class="stringliteral">&quot;Kernel &#39;{0}&#39; specifies a gh_shape ({1}) but does not &quot;</span></div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;                <span class="stringliteral">&quot;need an evaluator because no basis or differential basis &quot;</span></div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;                <span class="stringliteral">&quot;functions are required&quot;</span>.format(self.<a class="code" href="classpsyclone_1_1parse_1_1KernelType.html#aae575d92f86e6ec52cea59d3861641d4">name</a>, self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#ab8e7f4bbb00609ecddef9c66c1616c21">_eval_shape</a>))</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;        <span class="comment"># Check that gh_evaluator_targets is only present if required</span></div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#a29ea450540410a4538c93005389fe7a9">_eval_targets</a>:</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> need_evaluator:</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;                <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;                    <span class="stringliteral">&quot;Kernel &#39;{0}&#39; specifies gh_evaluator_targets ({1}) but &quot;</span></div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;                    <span class="stringliteral">&quot;does not need an evaluator because no basis or &quot;</span></div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;                    <span class="stringliteral">&quot;differential basis functions are required&quot;</span>.</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;                    format(self.<a class="code" href="classpsyclone_1_1parse_1_1KernelType.html#aae575d92f86e6ec52cea59d3861641d4">name</a>, self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#a29ea450540410a4538c93005389fe7a9">_eval_targets</a>))</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#ab8e7f4bbb00609ecddef9c66c1616c21">_eval_shape</a> != <span class="stringliteral">&quot;gh_evaluator&quot;</span>:</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;                <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;                    <span class="stringliteral">&quot;Kernel &#39;{0}&#39; specifies gh_evaluator_targets ({1}) but &quot;</span></div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;                    <span class="stringliteral">&quot;does not need an evaluator because gh_shape={2}&quot;</span>.</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;                    format(self.<a class="code" href="classpsyclone_1_1parse_1_1KernelType.html#aae575d92f86e6ec52cea59d3861641d4">name</a>, self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#a29ea450540410a4538c93005389fe7a9">_eval_targets</a>, self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#ab8e7f4bbb00609ecddef9c66c1616c21">_eval_shape</a>))</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;            <span class="comment"># Check that there is a kernel argument on each of the</span></div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;            <span class="comment"># specified spaces...</span></div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;            <span class="comment"># Create a list (set) of the function spaces associated with</span></div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;            <span class="comment"># the kernel arguments</span></div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;            fs_list = set()</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;            <span class="keywordflow">for</span> arg <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#aa3c8f683803c32191f7278595cc20e5f">_arg_descriptors</a>:</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;                fs_list.update(arg.function_spaces)</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;            <span class="comment"># Check each evaluator_target against this list</span></div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;            <span class="keywordflow">for</span> eval_fs <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#a29ea450540410a4538c93005389fe7a9">_eval_targets</a>:</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;                <span class="keywordflow">if</span> eval_fs <span class="keywordflow">not</span> <span class="keywordflow">in</span> fs_list:</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;                    <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;                        <span class="stringliteral">&quot;Kernel &#39;{0}&#39; specifies that an evaluator is required &quot;</span></div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;                        <span class="stringliteral">&quot;on {1} but does not have an argument on this space.&quot;</span></div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;                        .format(self.<a class="code" href="classpsyclone_1_1parse_1_1KernelType.html#aae575d92f86e6ec52cea59d3861641d4">name</a>, eval_fs))</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;        <span class="comment"># If we have a columnwise operator as argument then we need to</span></div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;        <span class="comment"># identify the operation that this kernel performs (one of</span></div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;        <span class="comment"># assemble, apply/apply-inverse and matrix-matrix)</span></div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;        cwise_ops = psyGen.args_filter(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#aa3c8f683803c32191f7278595cc20e5f">_arg_descriptors</a>,</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;                                       arg_types=[<span class="stringliteral">&quot;gh_columnwise_operator&quot;</span>])</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;        <span class="keywordflow">if</span> cwise_ops:</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#a365fb3dafe4977d0aa6af8debd65c545">_cma_operation</a> = self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#a26f6514b3abc8224a0708cdd99cf27aa">_identify_cma_op</a>(cwise_ops)</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;        <span class="comment"># Perform checks for inter-grid kernels</span></div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#a183289eba248b6ade7d1c0abf0cd68c7">_validate_inter_grid</a>()</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;    <span class="keyword">def </span>_validate_inter_grid(self):</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;<span class="stringliteral">        Checks that the kernel meta-data obeys the rules for Dynamo 0.3</span></div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;<span class="stringliteral">        inter-grid kernels. If none of the kernel arguments has a mesh</span></div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;<span class="stringliteral">        associated with it then it is not an inter-grid kernel and this</span></div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;<span class="stringliteral">        routine silently returns.</span></div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;<span class="stringliteral">        :raises: ParseError: if meta-data breaks inter-grid rules</span></div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;        <span class="comment"># Dictionary of meshes associated with arguments (for inter-grid</span></div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;        <span class="comment"># kernels). Keys are the meshes, values are lists of function spaces</span></div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;        <span class="comment"># of the corresponding field arguments.</span></div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;        mesh_dict = OrderedDict()</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;        <span class="comment"># Whether or not any field args are missing the mesh_arg specifier</span></div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;        missing_mesh = <span class="keyword">False</span></div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;        <span class="comment"># If this is an inter-grid kernel then it must only have field</span></div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;        <span class="comment"># arguments. Keep a record of any non-field arguments for the benefit</span></div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;        <span class="comment"># of a verbose error message.</span></div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;        non_field_arg_types = set()</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;        <span class="keywordflow">for</span> arg <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#aa3c8f683803c32191f7278595cc20e5f">_arg_descriptors</a>:</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;            <span class="comment"># Collect info so that we can check inter-grid kernels</span></div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;            <span class="keywordflow">if</span> arg.type == <span class="stringliteral">&quot;gh_field&quot;</span>:</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;                <span class="keywordflow">if</span> arg.mesh:</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;                    <span class="comment"># Argument has a mesh associated with it so this must</span></div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;                    <span class="comment"># be an inter-grid kernel</span></div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;                    <span class="keywordflow">if</span> arg.mesh <span class="keywordflow">in</span> mesh_dict:</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;                        mesh_dict[arg.mesh].append(arg.function_space)</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;                    <span class="keywordflow">else</span>:</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;                        mesh_dict[arg.mesh] = [arg.function_space]</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;                    <span class="comment"># Record the fact that we have a field without a</span></div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;                    <span class="comment"># mesh specifier (in case this is an inter-grid kernel)</span></div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;                    missing_mesh = <span class="keyword">True</span></div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;                <span class="comment"># Inter-grid kernels are only permitted to have field args</span></div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;                <span class="comment"># so collect a list of other types</span></div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;                non_field_arg_types.add(arg.type)</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;        mesh_list = mesh_dict.keys()</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> mesh_list:</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;            <span class="comment"># There are no meshes associated with any of the arguments so</span></div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;            <span class="comment"># this is not an inter-grid kernel</span></div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;            <span class="keywordflow">return</span></div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;        <span class="keywordflow">if</span> len(VALID_MESH_TYPES) != 2:</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;            <span class="comment"># Sanity check that nobody has messed with the number of</span></div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;            <span class="comment"># grid types that we recognise. This is here because the</span></div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;            <span class="comment"># implementation assumes that there are just two grids</span></div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;            <span class="comment"># (coarse and fine).</span></div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;            <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;                <span class="stringliteral">&quot;The implementation of inter-grid support in the Dynamo &quot;</span></div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;                <span class="stringliteral">&quot;0.3 API assumes there are exactly two mesh types but &quot;</span></div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;                <span class="stringliteral">&quot;dynamo0p3.VALID_MESH_TYPES contains {0}: {1}&quot;</span>.</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;                format(len(VALID_MESH_TYPES), VALID_MESH_TYPES))</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;        <span class="keywordflow">if</span> len(mesh_list) != len(VALID_MESH_TYPES):</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;            <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;                <span class="stringliteral">&quot;Inter-grid kernels in the Dynamo 0.3 API must have at least &quot;</span></div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;                <span class="stringliteral">&quot;one field argument on each of the mesh types ({0}). However, &quot;</span></div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;                <span class="stringliteral">&quot;kernel {1} has arguments only on {2}&quot;</span>.format(</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;                    VALID_MESH_TYPES, self.<a class="code" href="classpsyclone_1_1parse_1_1KernelType.html#aae575d92f86e6ec52cea59d3861641d4">name</a>, list(mesh_list)))</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;        <span class="comment"># Inter-grid kernels must only have field arguments</span></div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;        <span class="keywordflow">if</span> non_field_arg_types:</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;            <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;                <span class="stringliteral">&quot;Inter-grid kernels in the Dynamo 0.3 API are only &quot;</span></div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;                <span class="stringliteral">&quot;permitted to have field arguments but kernel {0} also &quot;</span></div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;                <span class="stringliteral">&quot;has arguments of type {1}&quot;</span>.format(</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;                    self.<a class="code" href="classpsyclone_1_1parse_1_1KernelType.html#aae575d92f86e6ec52cea59d3861641d4">name</a>, list(non_field_arg_types)))</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;        <span class="comment"># Check that all arguments have a mesh specified</span></div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;        <span class="keywordflow">if</span> missing_mesh:</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;            <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;                <span class="stringliteral">&quot;Inter-grid kernels in the Dynamo 0.3 API must specify &quot;</span></div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;                <span class="stringliteral">&quot;which mesh each field argument is on but kernel {0} has &quot;</span></div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;                <span class="stringliteral">&quot;at least one field argument for which mesh_arg is &quot;</span></div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;                <span class="stringliteral">&quot;missing.&quot;</span>.format(self.<a class="code" href="classpsyclone_1_1parse_1_1KernelType.html#aae575d92f86e6ec52cea59d3861641d4">name</a>))</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;        <span class="comment"># Check that arguments on different meshes are on different</span></div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;        <span class="comment"># function spaces. We do this by checking that no function space</span></div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;        <span class="comment"># is listed as being associated with (arguments on) both meshes.</span></div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;        fs_sets = []</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;        <span class="keywordflow">for</span> mesh <span class="keywordflow">in</span> mesh_dict:</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;            fs_sets.append(set(mesh_dict[mesh]))</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;        <span class="comment"># Check that the sets of spaces (one for each mesh type) have</span></div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;        <span class="comment"># no intersection</span></div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;        fs_common = fs_sets[0] &amp; fs_sets[1]</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;        <span class="keywordflow">if</span> fs_common:</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;            <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;                <span class="stringliteral">&quot;In the Dynamo 0.3 API field arguments to inter-grid &quot;</span></div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;                <span class="stringliteral">&quot;kernels must be on different function spaces if they are &quot;</span></div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;                <span class="stringliteral">&quot;on different meshes. However kernel {0} has a field on &quot;</span></div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;                <span class="stringliteral">&quot;function space(s) {1} on each of the mesh types {2}.&quot;</span>.</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;                format(self.<a class="code" href="classpsyclone_1_1parse_1_1KernelType.html#aae575d92f86e6ec52cea59d3861641d4">name</a>, list(fs_common), list(mesh_list)))</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;        <span class="comment"># Finally, record that this is a valid inter-grid kernel</span></div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#ae0241bdcf34e84b803b2320c0367ce30">_is_intergrid</a> = <span class="keyword">True</span></div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;    <span class="keyword">def </span>_identify_cma_op(self, cwise_ops):</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;Identify and return the type of CMA-operator-related operation</span></div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;<span class="stringliteral">        this kernel performs (one of &quot;assemble&quot;, &quot;apply&quot; or &quot;matrix-matrix&quot;)&#39;&#39;&#39;</span></div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;        <span class="keywordflow">for</span> arg <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#aa3c8f683803c32191f7278595cc20e5f">_arg_descriptors</a>:</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;            <span class="comment"># No vector arguments are permitted</span></div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;            <span class="keywordflow">if</span> arg.vector_size &gt; 1:</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;                <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;                    <span class="stringliteral">&quot;Kernel {0} takes a CMA operator but has a &quot;</span></div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;                    <span class="stringliteral">&quot;vector argument ({1}). This is forbidden.&quot;</span>.</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;                    format(self.<a class="code" href="classpsyclone_1_1parse_1_1KernelType.html#aae575d92f86e6ec52cea59d3861641d4">name</a>,</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;                           arg.type+<span class="stringliteral">&quot;*&quot;</span>+str(arg.vector_size)))</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;            <span class="comment"># No stencil accesses are permitted</span></div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;            <span class="keywordflow">if</span> arg.stencil:</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;                <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;                    <span class="stringliteral">&quot;Kernel {0} takes a CMA operator but has an argument &quot;</span></div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;                    <span class="stringliteral">&quot;with a stencil access ({1}). This is forbidden.&quot;</span>.</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;                    format(self.<a class="code" href="classpsyclone_1_1parse_1_1KernelType.html#aae575d92f86e6ec52cea59d3861641d4">name</a>, arg.stencil[<span class="stringliteral">&#39;type&#39;</span>]))</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;        <span class="comment"># Count the number of CMA operators that are written to</span></div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;        write_count = 0</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;        <span class="keywordflow">for</span> cop <span class="keywordflow">in</span> cwise_ops:</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;            <span class="keywordflow">if</span> cop.access <span class="keywordflow">in</span> GH_WRITE_ACCESSES:</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;                write_count += 1</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;        <span class="keywordflow">if</span> write_count == 0:</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;            <span class="comment"># This kernel only reads from CMA operators and must</span></div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;            <span class="comment"># therefore be an apply (or apply-inverse). It must</span></div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;            <span class="comment"># have one CMA operator, one read-only field and one</span></div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;            <span class="comment"># written field as arguments</span></div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;            <span class="keywordflow">if</span> len(cwise_ops) != 1:</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;                <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;                    <span class="stringliteral">&quot;In the Dynamo 0.3 API a kernel that applies a CMA &quot;</span></div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;                    <span class="stringliteral">&quot;operator must only have one such operator in its &quot;</span></div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;                    <span class="stringliteral">&quot;list of arguments but found {0} for kernel {1}&quot;</span>.</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;                    format(len(cwise_ops), self.<a class="code" href="classpsyclone_1_1parse_1_1KernelType.html#aae575d92f86e6ec52cea59d3861641d4">name</a>))</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;            cma_op = cwise_ops[0]</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;            <span class="keywordflow">if</span> len(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#aa3c8f683803c32191f7278595cc20e5f">_arg_descriptors</a>) != 3:</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;                <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;                    <span class="stringliteral">&quot;In the Dynamo 0.3 API a kernel that applies a CMA &quot;</span></div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;                    <span class="stringliteral">&quot;operator must have 3 arguments (the operator and &quot;</span></div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;                    <span class="stringliteral">&quot;two fields) but kernel {0} has {1} arguments&quot;</span>.</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;                    format(self.<a class="code" href="classpsyclone_1_1parse_1_1KernelType.html#aae575d92f86e6ec52cea59d3861641d4">name</a>, len(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#aa3c8f683803c32191f7278595cc20e5f">_arg_descriptors</a>)))</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;            <span class="comment"># Check that the other two arguments are fields</span></div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;            farg_read = psyGen.args_filter(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#aa3c8f683803c32191f7278595cc20e5f">_arg_descriptors</a>,</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;                                           arg_types=[<span class="stringliteral">&quot;gh_field&quot;</span>],</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;                                           arg_accesses=GH_READ_ONLY_ACCESS)</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;            farg_write = psyGen.args_filter(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#aa3c8f683803c32191f7278595cc20e5f">_arg_descriptors</a>,</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;                                            arg_types=[<span class="stringliteral">&quot;gh_field&quot;</span>],</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;                                            arg_accesses=GH_WRITE_ACCESSES)</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;            <span class="keywordflow">if</span> len(farg_read) != 1:</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;                <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;                    <span class="stringliteral">&quot;Kernel {0} has a read-only CMA operator. In order &quot;</span></div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;                    <span class="stringliteral">&quot;to apply it the kernel must have one read-only field &quot;</span></div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;                    <span class="stringliteral">&quot;argument.&quot;</span>.format(self.<a class="code" href="classpsyclone_1_1parse_1_1KernelType.html#aae575d92f86e6ec52cea59d3861641d4">name</a>))</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;            <span class="keywordflow">if</span> len(farg_write) != 1:</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;                <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;                    <span class="stringliteral">&quot;Kernel {0} has a read-only CMA operator. In order &quot;</span></div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;                    <span class="stringliteral">&quot;to apply it the kernel must write to one field &quot;</span></div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;                    <span class="stringliteral">&quot;argument.&quot;</span>.format(self.<a class="code" href="classpsyclone_1_1parse_1_1KernelType.html#aae575d92f86e6ec52cea59d3861641d4">name</a>))</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;            <span class="comment"># Check that the function spaces match up</span></div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;            <span class="keywordflow">if</span> farg_read[0].function_space != cma_op.function_space_from:</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;                <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;                    <span class="stringliteral">&quot;Kernel {0} applies a CMA operator but the function &quot;</span></div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;                    <span class="stringliteral">&quot;space of the field argument it reads from ({1}) &quot;</span></div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;                    <span class="stringliteral">&quot;does not match the &#39;from&#39; space of the operator &quot;</span></div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;                    <span class="stringliteral">&quot;({2})&quot;</span>.format(self.<a class="code" href="classpsyclone_1_1parse_1_1KernelType.html#aae575d92f86e6ec52cea59d3861641d4">name</a>, farg_read[0].function_space,</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;                                   cma_op.function_space_from))</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;            <span class="keywordflow">if</span> farg_write[0].function_space != cma_op.function_space_to:</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;                <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;                    <span class="stringliteral">&quot;Kernel {0} applies a CMA operator but the function &quot;</span></div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;                    <span class="stringliteral">&quot;space of the field argument it writes to ({1}) &quot;</span></div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;                    <span class="stringliteral">&quot;does not match the &#39;to&#39; space of the operator &quot;</span></div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;                    <span class="stringliteral">&quot;({2})&quot;</span>.format(self.<a class="code" href="classpsyclone_1_1parse_1_1KernelType.html#aae575d92f86e6ec52cea59d3861641d4">name</a>, farg_write[0].function_space,</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;                                   cma_op.function_space_to))</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;            <span class="comment"># This is a valid CMA-apply or CMA-apply-inverse kernel</span></div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;apply&quot;</span></div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;        <span class="keywordflow">elif</span> write_count == 1:</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;            <span class="comment"># This kernel writes to a single CMA operator and therefore</span></div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;            <span class="comment"># must either be assembling a CMA operator</span></div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;            <span class="comment"># or performing a matrix-matrix operation...</span></div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;            <span class="comment"># The kernel must not write to any args other than the CMA</span></div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;            <span class="comment"># operator</span></div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;            write_args = psyGen.args_filter(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#aa3c8f683803c32191f7278595cc20e5f">_arg_descriptors</a>,</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;                                            arg_accesses=GH_WRITE_ACCESSES)</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;            <span class="keywordflow">if</span> len(write_args) &gt; 1:</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;                <span class="comment"># Remove the one CMA operator from the list of arguments</span></div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;                <span class="comment"># that are written to so that we can produce a nice</span></div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;                <span class="comment"># error message</span></div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;                <span class="keywordflow">for</span> arg <span class="keywordflow">in</span> write_args[:]:</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;                    <span class="keywordflow">if</span> arg.type == <span class="stringliteral">&#39;gh_columnwise_operator&#39;</span>:</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;                        write_args.remove(arg)</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;                        <span class="keywordflow">break</span></div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;                <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;                    <span class="stringliteral">&quot;Kernel {0} writes to a column-wise operator but &quot;</span></div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;                    <span class="stringliteral">&quot;also writes to {1} argument(s). This is not &quot;</span></div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;                    <span class="stringliteral">&quot;allowed.&quot;</span>.format(self.<a class="code" href="classpsyclone_1_1parse_1_1KernelType.html#aae575d92f86e6ec52cea59d3861641d4">name</a>,</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;                                      [arg.type <span class="keywordflow">for</span> arg <span class="keywordflow">in</span> write_args]))</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;            <span class="keywordflow">if</span> len(cwise_ops) == 1:</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;                <span class="comment"># If this is a valid assembly kernel then we need at least one</span></div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;                <span class="comment"># read-only LMA operator</span></div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;                lma_read_ops = psyGen.args_filter(</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;                    self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#aa3c8f683803c32191f7278595cc20e5f">_arg_descriptors</a>,</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;                    arg_types=[<span class="stringliteral">&quot;gh_operator&quot;</span>],</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;                    arg_accesses=GH_READ_ONLY_ACCESS)</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;                <span class="keywordflow">if</span> lma_read_ops:</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;                    <span class="keywordflow">return</span> <span class="stringliteral">&quot;assembly&quot;</span></div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;                    <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;                        <span class="stringliteral">&quot;Kernel {0} has a single column-wise operator &quot;</span></div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;                        <span class="stringliteral">&quot;argument but does not conform to the rules for an &quot;</span></div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;                        <span class="stringliteral">&quot;Assembly kernel because it does not have any read-&quot;</span></div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;                        <span class="stringliteral">&quot;only LMA operator arguments&quot;</span>.format(self.<a class="code" href="classpsyclone_1_1parse_1_1KernelType.html#aae575d92f86e6ec52cea59d3861641d4">name</a>))</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;                <span class="comment"># A valid matrix-matrix kernel must only have CMA operators</span></div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;                <span class="comment"># and scalars as arguments.</span></div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;                scalar_args = psyGen.args_filter(</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;                    self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#aa3c8f683803c32191f7278595cc20e5f">_arg_descriptors</a>, arg_types=VALID_SCALAR_NAMES)</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;                <span class="keywordflow">if</span> (len(scalar_args) + len(cwise_ops)) != \</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;                   len(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#aa3c8f683803c32191f7278595cc20e5f">_arg_descriptors</a>):</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;                    <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;                        <span class="stringliteral">&quot;A column-wise matrix-matrix kernel must have only &quot;</span></div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;                        <span class="stringliteral">&quot;column-wise operators and scalars as arguments but &quot;</span></div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;                        <span class="stringliteral">&quot;kernel {0} has: {1}.&quot;</span>.</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;                        format(self.<a class="code" href="classpsyclone_1_1parse_1_1KernelType.html#aae575d92f86e6ec52cea59d3861641d4">name</a>,</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;                               [arg.type <span class="keywordflow">for</span> arg <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#aa3c8f683803c32191f7278595cc20e5f">_arg_descriptors</a>]))</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;                <span class="keywordflow">return</span> <span class="stringliteral">&quot;matrix-matrix&quot;</span></div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;            <span class="keywordflow">raise</span> <a class="code" href="classpsyclone_1_1parse_1_1ParseError.html">ParseError</a>(</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;                <span class="stringliteral">&quot;A Dynamo 0.3 kernel cannot update more than one CMA &quot;</span></div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;                <span class="stringliteral">&quot;(column-wise) operator but kernel {0} updates {1}&quot;</span>.</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;                format(self.<a class="code" href="classpsyclone_1_1parse_1_1KernelType.html#aae575d92f86e6ec52cea59d3861641d4">name</a>, write_count))</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;    @property</div><div class="line"><a name="l01263"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#ae44a5b914d05da4098f2f8cf164adb44"> 1263</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#ae44a5b914d05da4098f2f8cf164adb44">func_descriptors</a>(self):</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Returns metadata about the function spaces within a</span></div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;<span class="stringliteral">        Kernel. This metadata is provided within Kernel code via the</span></div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;<span class="stringliteral">        meta_funcs variable. Information is returned as a list of</span></div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;<span class="stringliteral">        DynFuncDescriptor03 objects, one for each function space. &#39;&#39;&#39;</span></div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#a2d5182c0cdbec8e223f757fe20d00ede">_func_descriptors</a></div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;    @property</div><div class="line"><a name="l01271"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#acdab09a5c47f751cad71ba7bb245dc68"> 1271</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#acdab09a5c47f751cad71ba7bb245dc68">cma_operation</a>(self):</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Returns the type of CMA operation identified from the kernel</span></div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;<span class="stringliteral">        meta-data (one of &#39;assembly&#39;, &#39;apply&#39; or &#39;matrix-matrix&#39;) or</span></div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;<span class="stringliteral">        None if the kernel does not involve CMA operators &#39;&#39;&#39;</span></div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#a365fb3dafe4977d0aa6af8debd65c545">_cma_operation</a></div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;    @property</div><div class="line"><a name="l01278"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#a517f42b3c2d871cef06619af2e3778ef"> 1278</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#a517f42b3c2d871cef06619af2e3778ef">eval_shape</a>(self):</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;<span class="stringliteral">        Returns the shape of evaluator required by this kernel or an</span></div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;<span class="stringliteral">        empty string if none.</span></div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;<span class="stringliteral">        :return: the shape of the evaluator (one of VALID_EVALUATOR_SHAPES)</span></div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;<span class="stringliteral">                 or an empty string if the kernel does not require one.</span></div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;<span class="stringliteral">        :rtype: string</span></div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#ab8e7f4bbb00609ecddef9c66c1616c21">_eval_shape</a>:</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;            <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#ab8e7f4bbb00609ecddef9c66c1616c21">_eval_shape</a></div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span></div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;    @property</div><div class="line"><a name="l01293"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#a00e7a0376262460a21b8041dad863109"> 1293</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#a00e7a0376262460a21b8041dad863109">eval_targets</a>(self):</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;<span class="stringliteral">        Returns the list of function spaces upon which any evaluator must be</span></div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;<span class="stringliteral">        provided. This list is obtained from the GH_EVALUATOR_TARGETS meta-data</span></div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;<span class="stringliteral">        entry (if present). If this is not specified in the meta-data then</span></div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;<span class="stringliteral">        we default to providing evaluators on all of the function spaces</span></div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;<span class="stringliteral">        associated with the arguments which this kernel updates.</span></div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;<span class="stringliteral">        :return: list of the names of the function spaces (as they appear in \</span></div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;<span class="stringliteral">                 kernel metadata) upon which any evaluator must be provided.</span></div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;<span class="stringliteral">        :rtype: list of str</span></div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#a29ea450540410a4538c93005389fe7a9">_eval_targets</a></div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;    @property</div><div class="line"><a name="l01308"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#a97f319a1a676fc99da2e6733c084de0e"> 1308</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#a97f319a1a676fc99da2e6733c084de0e">is_intergrid</a>(self):</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;<span class="stringliteral">        Returns whether or not this is an inter-grid kernel.</span></div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;<span class="stringliteral">        :return: True if kernel is an inter-grid kernel, False otherwise</span></div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;<span class="stringliteral">        :rtype: bool</span></div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#ae0241bdcf34e84b803b2320c0367ce30">_is_intergrid</a></div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;<span class="comment"># Second section : PSy specialisations</span></div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;<span class="comment"># classes</span></div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;</div><div class="line"><a name="l01322"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynamoPSy.html"> 1322</a></span>&#160;<span class="keyword">class </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynamoPSy.html">DynamoPSy</a>(<a class="code" href="classpsyclone_1_1psyGen_1_1PSy.html">PSy</a>):</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;    <span class="stringliteral">&#39;&#39;&#39; The Dynamo specific PSy class. This creates a Dynamo specific</span></div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;<span class="stringliteral">    invokes object (which controls all the required invocation calls).</span></div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;<span class="stringliteral">    It also overrides the PSy gen method so that we generate dynamo</span></div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;<span class="stringliteral">    specific PSy module code.</span></div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;<span class="stringliteral">    :param invoke_info: object containing the required invocation information \</span></div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;<span class="stringliteral">                        for code optimisation and generation.</span></div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;<span class="stringliteral">    :type invoke_info: :py:class:`psyclone.parse.FileInfo`</span></div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;<span class="stringliteral">    &#39;&#39;&#39;</span></div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;    <span class="keyword">def </span>__init__(self, invoke_info):</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;        PSy.__init__(self, invoke_info)</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynamoPSy.html#a87939573425e9b3bc6c939aeaef4c6e0">_invokes</a> = <a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynamoInvokes.html">DynamoInvokes</a>(invoke_info.calls)</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;    @property</div><div class="line"><a name="l01337"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynamoPSy.html#a141020148f72afddde684416b8dde610"> 1337</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynamoPSy.html#a141020148f72afddde684416b8dde610">name</a>(self):</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;Returns a name for the psy layer. This is used as the psy module</span></div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;<span class="stringliteral">        name. We override the default value as the Met Office prefer</span></div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;<span class="stringliteral">        _psy to be appended, rather than prepended&#39;&#39;&#39;</span></div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1psyGen_1_1PSy.html#afd62d411849a5d84004ed034848fea27">_name</a> + <span class="stringliteral">&quot;_psy&quot;</span></div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;    @property</div><div class="line"><a name="l01344"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynamoPSy.html#a3e6a91f296de55b5643c4ee6fcbb69c1"> 1344</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynamoPSy.html#a3e6a91f296de55b5643c4ee6fcbb69c1">gen</a>(self):</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;<span class="stringliteral">        Generate PSy code for the Dynamo0.3 api.</span></div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;<span class="stringliteral">        :return: Root node of generated Fortran AST</span></div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;<span class="stringliteral">        :rtype: :py:class:`psyGen.Node`</span></div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> ModuleGen, UseGen</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;        <span class="comment"># create an empty PSy layer module</span></div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;        psy_module = ModuleGen(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynamoPSy.html#a141020148f72afddde684416b8dde610">name</a>)</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;        <span class="comment"># include required infrastructure modules</span></div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;        psy_module.add(UseGen(psy_module, name=<span class="stringliteral">&quot;field_mod&quot;</span>, only=<span class="keyword">True</span>,</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;                              funcnames=[<span class="stringliteral">&quot;field_type&quot;</span>, <span class="stringliteral">&quot;field_proxy_type&quot;</span>]))</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;        psy_module.add(UseGen(psy_module, name=<span class="stringliteral">&quot;operator_mod&quot;</span>, only=<span class="keyword">True</span>,</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;                              funcnames=[<span class="stringliteral">&quot;operator_type&quot;</span>,</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;                                         <span class="stringliteral">&quot;operator_proxy_type&quot;</span>,</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;                                         <span class="stringliteral">&quot;columnwise_operator_type&quot;</span>,</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;                                         <span class="stringliteral">&quot;columnwise_operator_proxy_type&quot;</span>]))</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;        psy_module.add(UseGen(psy_module, name=<span class="stringliteral">&quot;constants_mod&quot;</span>, only=<span class="keyword">True</span>,</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;                              funcnames=[<span class="stringliteral">&quot;r_def&quot;</span>]))</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;        <span class="comment"># add all invoke specific information</span></div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;        self.invokes.gen_code(psy_module)</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;        <span class="comment"># inline kernels where requested</span></div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;        self.<a class="code" href="classpsyclone_1_1psyGen_1_1PSy.html#a0685d83599bdd6b4df54b97e450f2f2e">inline</a>(psy_module)</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;        <span class="comment"># Return the root node of the generated code</span></div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;        <span class="keywordflow">return</span> psy_module.root</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;</div><div class="line"><a name="l01373"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynamoInvokes.html"> 1373</a></span>&#160;<span class="keyword">class </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynamoInvokes.html">DynamoInvokes</a>(<a class="code" href="classpsyclone_1_1psyGen_1_1Invokes.html">Invokes</a>):</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;    <span class="stringliteral">&#39;&#39;&#39; The Dynamo specific invokes class. This passes the Dynamo</span></div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;<span class="stringliteral">    specific invoke class to the base class so it creates the one we</span></div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;<span class="stringliteral">    require. &#39;&#39;&#39;</span></div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;    <span class="keyword">def </span>__init__(self, alg_calls):</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynamoInvokes.html#a5d77dc8245c92d54669e826168cdce0f">_name_space_manager</a> = NameSpaceFactory().create()</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;        <span class="keywordflow">if</span> <span class="keyword">False</span>:  <span class="comment"># pylint: disable=using-constant-test</span></div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynamoInvokes.html#a1ef6db5976529f575e98f1fb272a6cd3">_0_to_n</a> = <a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html">DynInvoke</a>(<span class="keywordtype">None</span>, <span class="keywordtype">None</span>)  <span class="comment"># for pyreverse</span></div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;        Invokes.__init__(self, alg_calls, DynInvoke)</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;<span class="keyword">def </span>stencil_extent_value(field):</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;    <span class="stringliteral">&#39;&#39;&#39;Returns the content of the stencil extent. This may be a literal</span></div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;<span class="stringliteral">    value (a number) or a variable name. This function simplifies this</span></div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;<span class="stringliteral">    problem by returning a string in either case&#39;&#39;&#39;</span></div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;    <span class="keywordflow">if</span> field.stencil.extent_arg.is_literal():</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;        extent = field.stencil.extent_arg.text</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;    <span class="keywordflow">else</span>:</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;        extent = field.stencil.extent_arg.varName</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;    <span class="keywordflow">return</span> extent</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;<span class="keyword">def </span>stencil_unique_str(arg, context):</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;    <span class="stringliteral">&#39;&#39;&#39;Returns a string that uniquely identifies a stencil. As a stencil</span></div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;<span class="stringliteral">    differs due to the function space it operates on, type of</span></div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;<span class="stringliteral">    stencil and extent of stencil, we concatenate these things together</span></div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;<span class="stringliteral">    to return a unique string &#39;&#39;&#39;</span></div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;    unique = context</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;    unique += arg.function_space.mangled_name</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;    unique += arg.descriptor.stencil[<span class="stringliteral">&#39;type&#39;</span>]</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;    <span class="keywordflow">if</span> arg.descriptor.stencil[<span class="stringliteral">&#39;extent&#39;</span>]:</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;        <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;            <span class="stringliteral">&quot;found a stencil with an extent specified in the metadata. This &quot;</span></div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;            <span class="stringliteral">&quot;is not coded for.&quot;</span>)</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;    unique += arg.stencil.extent_arg.text.lower()</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;    <span class="keywordflow">if</span> arg.descriptor.stencil[<span class="stringliteral">&#39;type&#39;</span>] == <span class="stringliteral">&#39;xory1d&#39;</span>:</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;        unique += arg.stencil.direction_arg.text.lower()</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;    <span class="keywordflow">return</span> unique</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;<span class="keyword">def </span>stencil_map_name(arg):</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;    <span class="stringliteral">&#39;&#39;&#39; returns a valid unique map name for a stencil in the PSy layer &#39;&#39;&#39;</span></div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;    root_name = arg.name + <span class="stringliteral">&quot;_stencil_map&quot;</span></div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;    unique = stencil_unique_str(arg, <span class="stringliteral">&quot;map&quot;</span>)</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;    name_space_manager = NameSpaceFactory().create()</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;    <span class="keywordflow">return</span> name_space_manager.create_name(</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;        root_name=root_name, context=<span class="stringliteral">&quot;PSyVars&quot;</span>, label=unique)</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;<span class="keyword">def </span>stencil_dofmap_name(arg):</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;    <span class="stringliteral">&#39;&#39;&#39; returns a valid unique dofmap name for a stencil in the PSy layer &#39;&#39;&#39;</span></div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;    root_name = arg.name + <span class="stringliteral">&quot;_stencil_dofmap&quot;</span></div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;    unique = stencil_unique_str(arg, <span class="stringliteral">&quot;dofmap&quot;</span>)</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;    name_space_manager = NameSpaceFactory().create()</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;    <span class="keywordflow">return</span> name_space_manager.create_name(</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;        root_name=root_name, context=<span class="stringliteral">&quot;PSyVars&quot;</span>, label=unique)</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;<span class="keyword">def </span>stencil_size_name(arg):</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;    <span class="stringliteral">&#39;&#39;&#39; returns a valid unique name for the size (in cells) of a stencil</span></div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;<span class="stringliteral">    in the PSy layer &#39;&#39;&#39;</span></div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;    root_name = arg.name + <span class="stringliteral">&quot;_stencil_size&quot;</span></div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;    unique = stencil_unique_str(arg, <span class="stringliteral">&quot;size&quot;</span>)</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;    name_space_manager = NameSpaceFactory().create()</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;    <span class="keywordflow">return</span> name_space_manager.create_name(</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;        root_name=root_name, context=<span class="stringliteral">&quot;PSyVars&quot;</span>, label=unique)</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;</div><div class="line"><a name="l01442"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil.html"> 1442</a></span>&#160;<span class="keyword">class </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil.html">DynInvokeStencil</a>(object):</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;    <span class="stringliteral">&#39;&#39;&#39;stencil information and code generation associated with a</span></div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;<span class="stringliteral">    DynInvoke call&#39;&#39;&#39;</span></div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;    <span class="keyword">def </span>__init__(self, schedule):</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil.html#a1f6794ee325578ecdf6c6d0d968624f5">_name_space_manager</a> = NameSpaceFactory().create()</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;        <span class="comment"># list of arguments which have an extent value passed to this</span></div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;        <span class="comment"># invoke routine from the algorithm layer. Duplicate argument</span></div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;        <span class="comment"># names are removed.</span></div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil.html#a0ee6c78e2401713d08345e64c59400d1">_unique_extent_args</a> = []</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;        extent_names = []</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;        <span class="keywordflow">for</span> call <span class="keywordflow">in</span> schedule.calls():</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;            <span class="keywordflow">for</span> arg <span class="keywordflow">in</span> call.arguments.args:</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;                <span class="keywordflow">if</span> arg.stencil:</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;                    <span class="comment"># check for the existence of arg.extent here as in</span></div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;                    <span class="comment"># the future we plan to support kernels which</span></div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;                    <span class="comment"># specify the value of extent in metadata. If this</span></div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;                    <span class="comment"># is the case then an extent argument is not</span></div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;                    <span class="comment"># required.</span></div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;                    <span class="keywordflow">if</span> <span class="keywordflow">not</span> arg.stencil.extent:</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;                        <span class="keywordflow">if</span> <span class="keywordflow">not</span> arg.stencil.extent_arg.is_literal():</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;                            <span class="keywordflow">if</span> arg.stencil.extent_arg.text <span class="keywordflow">not</span> <span class="keywordflow">in</span> extent_names:</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;                                extent_names.append(</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;                                    arg.stencil.extent_arg.text)</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;                                self._unique_extent_args.append(arg)</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;        <span class="comment"># a list of arguments that have a direction variable passed in</span></div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;        <span class="comment"># to this invoke routine from the algorithm layer. Duplicate</span></div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;        <span class="comment"># argument names are removed.</span></div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil.html#ab3870d8905b66155b3fe7ffddecb2e84">_unique_direction_args</a> = []</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;        direction_names = []</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;        <span class="keywordflow">for</span> call <span class="keywordflow">in</span> schedule.calls():</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;            <span class="keywordflow">for</span> idx, arg <span class="keywordflow">in</span> enumerate(call.arguments.args):</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;                <span class="keywordflow">if</span> arg.stencil <span class="keywordflow">and</span> arg.stencil.direction_arg:</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;                    <span class="keywordflow">if</span> arg.stencil.direction_arg.is_literal():</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;                        <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;                            <span class="stringliteral">&quot;Kernel {0}, metadata arg {1}, a literal is not &quot;</span></div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;                            <span class="stringliteral">&quot;a valid value for a stencil direction&quot;</span>.</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;                            format(call.name, str(idx)))</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;                    <span class="keywordflow">if</span> arg.stencil.direction_arg.text.lower() <span class="keywordflow">not</span> <span class="keywordflow">in</span> \</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;                       [<span class="stringliteral">&quot;x_direction&quot;</span>, <span class="stringliteral">&quot;y_direction&quot;</span>]:</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;                        <span class="keywordflow">if</span> arg.stencil.direction_arg.text <span class="keywordflow">not</span> <span class="keywordflow">in</span> \</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;                           direction_names:</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;                            direction_names.append(</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;                                arg.stencil.direction_arg.text)</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;                            self._unique_direction_args.append(arg)</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;        <span class="comment"># list of stencil args with an extent variable passed in. The same</span></div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;        <span class="comment"># field name may occur more than once here from different kernels.</span></div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil.html#af3e0105fc45b4ae86e2d89e66739531f">_kern_args</a> = []</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;        <span class="keywordflow">for</span> call <span class="keywordflow">in</span> schedule.calls():</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;            <span class="keywordflow">for</span> arg <span class="keywordflow">in</span> call.arguments.args:</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;                <span class="keywordflow">if</span> arg.stencil:</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;                    <span class="keywordflow">if</span> <span class="keywordflow">not</span> arg.stencil.extent:</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;                        self._kern_args.append(arg)</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;    @property</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;    <span class="keyword">def </span>_unique_extent_vars(self):</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;return a list of all the unique extent argument names in this</span></div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;<span class="stringliteral">        invoke call. &#39;&#39;&#39;</span></div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;        names = []</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;        <span class="keywordflow">for</span> arg <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil.html#a0ee6c78e2401713d08345e64c59400d1">_unique_extent_args</a>:</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;            names.append(arg.stencil.extent_arg.varName)</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;        <span class="keywordflow">return</span> names</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;    <span class="keyword">def </span>_declare_unique_extent_vars(self, parent):</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;Declare all unique extent arguments as integers with intent in and</span></div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;<span class="stringliteral">        add the declaration as a child of the parent argument passed</span></div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;<span class="stringliteral">        in. The parent argument should be an appropriate f2pygen</span></div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;<span class="stringliteral">        object. &#39;&#39;&#39;</span></div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> DeclGen</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil.html#a383ed74e23b6462dffa82531f1a2c267">_unique_extent_vars</a>:</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;            parent.add(DeclGen(parent, datatype=<span class="stringliteral">&quot;integer&quot;</span>,</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;                               entity_decls=self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil.html#a383ed74e23b6462dffa82531f1a2c267">_unique_extent_vars</a>,</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;                               intent=<span class="stringliteral">&quot;in&quot;</span>))</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;    @property</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;    <span class="keyword">def </span>_unique_direction_vars(self):</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;return a list of all the unique direction argument names in this</span></div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;<span class="stringliteral">        invoke call.&#39;&#39;&#39;</span></div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;        names = []</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;        <span class="keywordflow">for</span> arg <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil.html#ab3870d8905b66155b3fe7ffddecb2e84">_unique_direction_args</a>:</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;            names.append(arg.stencil.direction_arg.varName)</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;        <span class="keywordflow">return</span> names</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;    <span class="keyword">def </span>_declare_unique_direction_vars(self, parent):</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;Declare all unique direction arguments as integers with intent in</span></div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;<span class="stringliteral">        and add the declaration as a child of the parent argument</span></div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;<span class="stringliteral">        passed in. The parent argument should be an appropriate</span></div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;<span class="stringliteral">        f2pygen object. &#39;&#39;&#39;</span></div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> DeclGen</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil.html#a36f63462adf0926223c40232d38e3ca4">_unique_direction_vars</a>:</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;            parent.add(DeclGen(parent, datatype=<span class="stringliteral">&quot;integer&quot;</span>,</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;                               entity_decls=self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil.html#a36f63462adf0926223c40232d38e3ca4">_unique_direction_vars</a>,</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;                               intent=<span class="stringliteral">&quot;in&quot;</span>))</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;    @property</div><div class="line"><a name="l01540"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil.html#a512854d5de2d73d9f71acedaf3137949"> 1540</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil.html#a512854d5de2d73d9f71acedaf3137949">unique_alg_vars</a>(self):</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;returns a list of the names of the extent and direction arguments</span></div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;<span class="stringliteral">        specified in the algorithm layer&#39;&#39;&#39;</span></div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil.html#a383ed74e23b6462dffa82531f1a2c267">_unique_extent_vars</a> + self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil.html#a36f63462adf0926223c40232d38e3ca4">_unique_direction_vars</a></div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;</div><div class="line"><a name="l01545"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil.html#a67c2b60f0d1019c84ce955f1dd414794"> 1545</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil.html#a67c2b60f0d1019c84ce955f1dd414794">declare_unique_alg_vars</a>(self, parent):</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;declares all extent and direction arguments passed into the PSy</span></div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;<span class="stringliteral">        layer&#39;&#39;&#39;</span></div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil.html#a8d443120cbbfeee482c711482356ebf8">_declare_unique_extent_vars</a>(parent)</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil.html#af25f655ae0737a1ef17b96e8de5314dc">_declare_unique_direction_vars</a>(parent)</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;</div><div class="line"><a name="l01551"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil.html#ab1bbeb53b12715e35d9eebff99b2c9fa"> 1551</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil.html#ab1bbeb53b12715e35d9eebff99b2c9fa">initialise_stencil_maps</a>(self, parent):</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;adds in the required stencil dofmap code to the PSy layer&#39;&#39;&#39;</span></div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> AssignGen, IfThenGen, TypeDeclGen, \</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;            UseGen, CommentGen, DeclGen</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil.html#af3e0105fc45b4ae86e2d89e66739531f">_kern_args</a>:</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;            parent.add(CommentGen(parent, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;            parent.add(CommentGen(parent, <span class="stringliteral">&quot; Initialise stencil dofmaps&quot;</span>))</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;            parent.add(CommentGen(parent, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;            parent.add(UseGen(parent, name=<span class="stringliteral">&quot;stencil_dofmap_mod&quot;</span>, only=<span class="keyword">True</span>,</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;                              funcnames=[<span class="stringliteral">&quot;stencil_dofmap_type&quot;</span>]))</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;            stencil_map_names = []</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;            <span class="keywordflow">for</span> arg <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil.html#af3e0105fc45b4ae86e2d89e66739531f">_kern_args</a>:</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;                map_name = stencil_map_name(arg)</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;                <span class="keywordflow">if</span> map_name <span class="keywordflow">not</span> <span class="keywordflow">in</span> stencil_map_names:</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;                    <span class="comment"># only initialise maps once</span></div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;                    stencil_map_names.append(map_name)</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;                    parent.add(</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;                        TypeDeclGen(parent, pointer=<span class="keyword">True</span>,</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;                                    datatype=<span class="stringliteral">&quot;stencil_dofmap_type&quot;</span>,</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;                                    entity_decls=[map_name+<span class="stringliteral">&quot; =&gt; null()&quot;</span>]))</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;                    stencil_type = arg.descriptor.stencil[<span class="stringliteral">&#39;type&#39;</span>]</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;                    <span class="keywordflow">if</span> stencil_type == <span class="stringliteral">&quot;xory1d&quot;</span>:</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;                        parent.add(UseGen(parent, name=<span class="stringliteral">&quot;flux_direction_mod&quot;</span>,</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;                                          only=<span class="keyword">True</span>,</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;                                          funcnames=[<span class="stringliteral">&quot;x_direction&quot;</span>,</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;                                                     <span class="stringliteral">&quot;y_direction&quot;</span>]))</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;                        parent.add(UseGen(parent, name=<span class="stringliteral">&quot;stencil_dofmap_mod&quot;</span>,</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;                                          only=<span class="keyword">True</span>,</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;                                          funcnames=[<span class="stringliteral">&quot;STENCIL_1DX&quot;</span>,</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;                                                     <span class="stringliteral">&quot;STENCIL_1DY&quot;</span>]))</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;                        direction_name = arg.stencil.direction_arg.varName</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;                        <span class="keywordflow">for</span> direction <span class="keywordflow">in</span> [<span class="stringliteral">&quot;x&quot;</span>, <span class="stringliteral">&quot;y&quot;</span>]:</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;                            if_then = IfThenGen(parent, direction_name +</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;                                                <span class="stringliteral">&quot; .eq. &quot;</span> + direction +</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;                                                <span class="stringliteral">&quot;_direction&quot;</span>)</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;                            if_then.add(</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;                                AssignGen(if_then, pointer=<span class="keyword">True</span>,</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;                                          lhs=map_name, rhs=arg.proxy_name +</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;                                          <span class="stringliteral">&quot;%vspace%get_stencil_dofmap(&quot;</span></div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;                                          <span class="stringliteral">&quot;STENCIL_1D&quot;</span> + direction.upper() +</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;                                          <span class="stringliteral">&quot;,&quot;</span>+stencil_extent_value(arg)+<span class="stringliteral">&quot;)&quot;</span>))</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;                            parent.add(if_then)</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;                    <span class="keywordflow">else</span>:</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;                        <span class="keywordflow">try</span>:</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;                            stencil_name = STENCIL_MAPPING[stencil_type]</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;                        <span class="keywordflow">except</span> KeyError:</div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;                            <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;                                <span class="stringliteral">&quot;Unsupported stencil type &#39;{0}&#39; supplied. &quot;</span></div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;                                <span class="stringliteral">&quot;Supported mappings are {1}&quot;</span>.</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;                                format(arg.descriptor.stencil[<span class="stringliteral">&#39;type&#39;</span>],</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;                                       str(STENCIL_MAPPING)))</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;                        parent.add(UseGen(parent, name=<span class="stringliteral">&quot;stencil_dofmap_mod&quot;</span>,</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;                                          only=<span class="keyword">True</span>,</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;                                          funcnames=[stencil_name]))</div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;                        parent.add(</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;                            AssignGen(parent, pointer=<span class="keyword">True</span>, lhs=map_name,</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;                                      rhs=arg.proxy_name +</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;                                      <span class="stringliteral">&quot;%vspace%get_stencil_dofmap(&quot;</span> +</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;                                      stencil_name + <span class="stringliteral">&quot;,&quot;</span> +</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;                                      stencil_extent_value(arg) + <span class="stringliteral">&quot;)&quot;</span>))</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;                    parent.add(DeclGen(parent, datatype=<span class="stringliteral">&quot;integer&quot;</span>,</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;                                       pointer=<span class="keyword">True</span>,</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;                                       entity_decls=[stencil_dofmap_name(arg) +</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;                                                     <span class="stringliteral">&quot;(:,:,:) =&gt; null()&quot;</span>]))</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;                    parent.add(AssignGen(parent, pointer=<span class="keyword">True</span>,</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;                                         lhs=stencil_dofmap_name(arg),</div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;                                         rhs=map_name + <span class="stringliteral">&quot;%get_whole_dofmap()&quot;</span>))</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;                    <span class="comment"># Add declaration and look-up of stencil size</span></div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;                    parent.add(DeclGen(parent, datatype=<span class="stringliteral">&quot;integer&quot;</span>,</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;                                       entity_decls=[stencil_size_name(arg)]))</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;                    parent.add(AssignGen(parent, lhs=stencil_size_name(arg),</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;                                         rhs=map_name + <span class="stringliteral">&quot;%get_size()&quot;</span>))</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;</div><div class="line"><a name="l01626"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeDofmaps.html"> 1626</a></span>&#160;<span class="keyword">class </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeDofmaps.html">DynInvokeDofmaps</a>(object):</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;    <span class="stringliteral">&#39;&#39;&#39; Holds all information on the dofmaps (including column-banded and</span></div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;<span class="stringliteral">    indirection) required by an invoke &#39;&#39;&#39;</span></div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;    <span class="keyword">def </span>__init__(self, schedule):</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeDofmaps.html#a24664d72760cf4c31c79be51c358839f">_name_space_manager</a> = NameSpaceFactory().create()</div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;        <span class="comment"># Look at every kernel call in this invoke and generate a list</span></div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;        <span class="comment"># of the unique function spaces involved.</span></div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;        <span class="comment"># We create a dictionary whose keys are the map names and entries</span></div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;        <span class="comment"># are the corresponding field objects.</span></div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeDofmaps.html#ac4b7f46884439de3c2a3fae36a59a3c0">_unique_fs_maps</a> = OrderedDict()</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;        <span class="comment"># We also create a dictionary of column-banded dofmaps. Entries</span></div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;        <span class="comment"># in this one are themselves dictionaries containing two entries:</span></div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;        <span class="comment"># &quot;argument&quot; - the object holding information on the CMA kernel</span></div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;        <span class="comment">#              argument</span></div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;        <span class="comment"># &quot;direction&quot; - whether the dofmap is required for the &quot;to&quot; for</span></div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;        <span class="comment">#               &quot;from&quot; function space of the operator.</span></div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeDofmaps.html#a2d30908ffc6b8ca9501f195bfb87ab35">_unique_cbanded_maps</a> = OrderedDict()</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;        <span class="comment"># A dictionary of required CMA indirection dofmaps. As with the</span></div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;        <span class="comment"># column-banded dofmaps, each entry is itself a dictionary with</span></div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;        <span class="comment"># &quot;argument&quot; and &quot;direction&quot; entries.</span></div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeDofmaps.html#a5860687bf8382d8ea83dab3929e2755b">_unique_indirection_maps</a> = OrderedDict()</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;        <span class="keywordflow">for</span> call <span class="keywordflow">in</span> schedule.calls():</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;            <span class="comment"># We only need a dofmap if the kernel iterates over cells</span></div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;            <span class="keywordflow">if</span> call.iterates_over == <span class="stringliteral">&quot;cells&quot;</span>:</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;                <span class="keywordflow">for</span> unique_fs <span class="keywordflow">in</span> call.arguments.unique_fss:</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;                    <span class="comment"># We only need a dofmap if there is a *field* on this</span></div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;                    <span class="comment"># function space. If there is then we use it to look</span></div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;                    <span class="comment"># up the dofmap.</span></div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;                    fld_arg = field_on_space(unique_fs, call.arguments)</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;                    <span class="keywordflow">if</span> fld_arg:</div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;                        map_name = get_fs_map_name(unique_fs)</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;                        <span class="keywordflow">if</span> map_name <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeDofmaps.html#ac4b7f46884439de3c2a3fae36a59a3c0">_unique_fs_maps</a>:</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;                            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeDofmaps.html#ac4b7f46884439de3c2a3fae36a59a3c0">_unique_fs_maps</a>[map_name] = fld_arg</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;                <span class="keywordflow">if</span> call.cma_operation == <span class="stringliteral">&quot;assembly&quot;</span>:</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;                    <span class="comment"># A kernel that assembles a CMA operator requires</span></div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;                    <span class="comment"># column-banded dofmaps for its &#39;to&#39; and &#39;from&#39;</span></div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;                    <span class="comment"># function spaces</span></div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;                    cma_args = psyGen.args_filter(</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;                        call.arguments.args,</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;                        arg_types=[<span class="stringliteral">&quot;gh_columnwise_operator&quot;</span>])</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;                    <span class="comment"># Sanity check - we expect only one CMA argument</span></div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;                    <span class="keywordflow">if</span> len(cma_args) != 1:</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;                        <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;                            <span class="stringliteral">&quot;Internal error: there should only be one CMA &quot;</span></div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;                            <span class="stringliteral">&quot;operator argument for a CMA assembly kernel but &quot;</span></div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;                            <span class="stringliteral">&quot;found {0}&quot;</span>.format(len(cma_args)))</div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;</div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;                    map_name = get_cbanded_map_name(</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;                        cma_args[0].function_space_to)</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;                    <span class="keywordflow">if</span> map_name <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeDofmaps.html#a2d30908ffc6b8ca9501f195bfb87ab35">_unique_cbanded_maps</a>:</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;                        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeDofmaps.html#a2d30908ffc6b8ca9501f195bfb87ab35">_unique_cbanded_maps</a>[map_name] = {</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;                            <span class="stringliteral">&quot;argument&quot;</span>: cma_args[0],</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;                            <span class="stringliteral">&quot;direction&quot;</span>: <span class="stringliteral">&quot;to&quot;</span>}</div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;                    map_name = get_cbanded_map_name(</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;                        cma_args[0].function_space_from)</div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;                    <span class="keywordflow">if</span> map_name <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeDofmaps.html#a2d30908ffc6b8ca9501f195bfb87ab35">_unique_cbanded_maps</a>:</div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;                        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeDofmaps.html#a2d30908ffc6b8ca9501f195bfb87ab35">_unique_cbanded_maps</a>[map_name] = {</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;                            <span class="stringliteral">&quot;argument&quot;</span>: cma_args[0],</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;                            <span class="stringliteral">&quot;direction&quot;</span>: <span class="stringliteral">&quot;from&quot;</span>}</div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;                <span class="keywordflow">elif</span> call.cma_operation == <span class="stringliteral">&quot;apply&quot;</span>:</div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;                    <span class="comment"># A kernel that applies (or applies the inverse of) a</span></div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;                    <span class="comment"># CMA operator requires the indirection dofmaps for the</span></div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;                    <span class="comment"># to- and from-spaces of the operator.</span></div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;                    cma_args = psyGen.args_filter(</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;                        call.arguments.args,</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;                        arg_types=[<span class="stringliteral">&quot;gh_columnwise_operator&quot;</span>])</div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;                    <span class="comment"># Sanity check - we expect only one CMA argument</span></div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;                    <span class="keywordflow">if</span> len(cma_args) != 1:</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;                        <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;                            <span class="stringliteral">&quot;Internal error: there should only be one CMA &quot;</span></div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;                            <span class="stringliteral">&quot;operator argument for a kernel that applies a &quot;</span></div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;                            <span class="stringliteral">&quot;CMA operator but found {0}&quot;</span>.format(len(cma_args)))</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;</div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;                    map_name = get_cma_indirection_map_name(</div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;                        cma_args[0].function_space_to)</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;                    <span class="keywordflow">if</span> map_name <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeDofmaps.html#a5860687bf8382d8ea83dab3929e2755b">_unique_indirection_maps</a>:</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;                        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeDofmaps.html#a5860687bf8382d8ea83dab3929e2755b">_unique_indirection_maps</a>[map_name] = {</div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;                            <span class="stringliteral">&quot;argument&quot;</span>: cma_args[0],</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;                            <span class="stringliteral">&quot;direction&quot;</span>: <span class="stringliteral">&quot;to&quot;</span>}</div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;                    map_name = get_cma_indirection_map_name(</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;                        cma_args[0].function_space_from)</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;                    <span class="keywordflow">if</span> map_name <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeDofmaps.html#a5860687bf8382d8ea83dab3929e2755b">_unique_indirection_maps</a>:</div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;                        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeDofmaps.html#a5860687bf8382d8ea83dab3929e2755b">_unique_indirection_maps</a>[map_name] = {</div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;                            <span class="stringliteral">&quot;argument&quot;</span>: cma_args[0],</div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;                            <span class="stringliteral">&quot;direction&quot;</span>: <span class="stringliteral">&quot;from&quot;</span>}</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;</div><div class="line"><a name="l01717"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeDofmaps.html#a810f7972ce4120ce7943a4641c2b6cba"> 1717</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeDofmaps.html#a810f7972ce4120ce7943a4641c2b6cba">initialise_dofmaps</a>(self, parent):</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Generates the calls to the LFRic infrastructure that</span></div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;<span class="stringliteral">        look-up the necessary dofmaps. Adds these calls as children</span></div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;<span class="stringliteral">        of the supplied parent node. This must be an appropriate</span></div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;<span class="stringliteral">        f2pygen object. &#39;&#39;&#39;</span></div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> CommentGen, AssignGen</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;        <span class="comment"># If we&#39;ve got no dofmaps then we do nothing</span></div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeDofmaps.html#ac4b7f46884439de3c2a3fae36a59a3c0">_unique_fs_maps</a>:</div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;            parent.add(CommentGen(parent, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;            parent.add(CommentGen(parent,</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;                                  <span class="stringliteral">&quot; Look-up dofmaps for each function space&quot;</span>))</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;            parent.add(CommentGen(parent, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;            <span class="keywordflow">for</span> dmap, field <span class="keywordflow">in</span> self._unique_fs_maps.items():</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;                parent.add(AssignGen(parent, pointer=<span class="keyword">True</span>, lhs=dmap,</div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;                                     rhs=field.proxy_name_indexed +</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;                                     <span class="stringliteral">&quot;%&quot;</span> + field.ref_name() +</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;                                     <span class="stringliteral">&quot;%get_whole_dofmap()&quot;</span>))</div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeDofmaps.html#a2d30908ffc6b8ca9501f195bfb87ab35">_unique_cbanded_maps</a>:</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;            parent.add(CommentGen(parent, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;            parent.add(CommentGen(parent,</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;                                  <span class="stringliteral">&quot; Look-up required column-banded dofmaps&quot;</span>))</div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;            parent.add(CommentGen(parent, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;</div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;            <span class="keywordflow">for</span> dmap, cma <span class="keywordflow">in</span> self._unique_cbanded_maps.items():</div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;                parent.add(AssignGen(parent, pointer=<span class="keyword">True</span>, lhs=dmap,</div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;                                     rhs=cma[<span class="stringliteral">&quot;argument&quot;</span>].proxy_name_indexed +</div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;                                     <span class="stringliteral">&quot;%column_banded_dofmap_&quot;</span> +</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;                                     cma[<span class="stringliteral">&quot;direction&quot;</span>]))</div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;</div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeDofmaps.html#a5860687bf8382d8ea83dab3929e2755b">_unique_indirection_maps</a>:</div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;            parent.add(CommentGen(parent, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;            parent.add(CommentGen(parent,</div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;                                  <span class="stringliteral">&quot; Look-up required CMA indirection dofmaps&quot;</span>))</div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;            parent.add(CommentGen(parent, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;</div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;            <span class="keywordflow">for</span> dmap, cma <span class="keywordflow">in</span> self._unique_indirection_maps.items():</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;                parent.add(AssignGen(parent, pointer=<span class="keyword">True</span>, lhs=dmap,</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;                                     rhs=cma[<span class="stringliteral">&quot;argument&quot;</span>].proxy_name_indexed +</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;                                     <span class="stringliteral">&quot;%indirection_dofmap_&quot;</span>+cma[<span class="stringliteral">&quot;direction&quot;</span>]))</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;</div><div class="line"><a name="l01759"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeDofmaps.html#a029dbc8a78a6ab93975f3ab67fc865f3"> 1759</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeDofmaps.html#a029dbc8a78a6ab93975f3ab67fc865f3">declare_dofmaps</a>(self, parent):</div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Declare all unique function space dofmaps as pointers to</span></div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;<span class="stringliteral">        integer arrays of rank 2. The declarations are added as</span></div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;<span class="stringliteral">        children of the supplied parent argument. This must be an</span></div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;<span class="stringliteral">        appropriate f2pygen object. &#39;&#39;&#39;</span></div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> DeclGen</div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;</div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;        <span class="comment"># Function space dofmaps</span></div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;        decl_map_names = \</div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;            [dmap+<span class="stringliteral">&quot;(:,:) =&gt; null()&quot;</span> <span class="keywordflow">for</span> dmap <span class="keywordflow">in</span> sorted(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeDofmaps.html#ac4b7f46884439de3c2a3fae36a59a3c0">_unique_fs_maps</a>)]</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;        <span class="keywordflow">if</span> decl_map_names:</div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;            parent.add(DeclGen(parent, datatype=<span class="stringliteral">&quot;integer&quot;</span>, pointer=<span class="keyword">True</span>,</div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;                               entity_decls=decl_map_names))</div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;</div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;        <span class="comment"># Column-banded dofmaps</span></div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;        decl_bmap_names = \</div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;            [dmap+<span class="stringliteral">&quot;(:,:) =&gt; null()&quot;</span> <span class="keywordflow">for</span> dmap <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeDofmaps.html#a2d30908ffc6b8ca9501f195bfb87ab35">_unique_cbanded_maps</a>]</div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;        <span class="keywordflow">if</span> decl_bmap_names:</div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;            parent.add(DeclGen(parent, datatype=<span class="stringliteral">&quot;integer&quot;</span>, pointer=<span class="keyword">True</span>,</div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;                               entity_decls=decl_bmap_names))</div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;</div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;        <span class="comment"># CMA operator indirection dofmaps</span></div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;        decl_ind_map_names = \</div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;            [dmap+<span class="stringliteral">&quot;(:) =&gt; null()&quot;</span> <span class="keywordflow">for</span> dmap <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeDofmaps.html#a5860687bf8382d8ea83dab3929e2755b">_unique_indirection_maps</a>]</div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;        <span class="keywordflow">if</span> decl_ind_map_names:</div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;            parent.add(DeclGen(parent, datatype=<span class="stringliteral">&quot;integer&quot;</span>, pointer=<span class="keyword">True</span>,</div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;                               entity_decls=decl_ind_map_names))</div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;</div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;</div><div class="line"><a name="l01789"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeCMAOperators.html"> 1789</a></span>&#160;<span class="keyword">class </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeCMAOperators.html">DynInvokeCMAOperators</a>(object):</div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;    <span class="stringliteral">&#39;&#39;&#39; Holds all information on the CMA operators required by an invoke &#39;&#39;&#39;</span></div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;</div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;    <span class="comment"># The scalar parameters that must be passed along with a CMA operator</span></div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;    <span class="comment"># if its &#39;to&#39; and &#39;from&#39; spaces are the same</span></div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;    cma_same_fs_params = [<span class="stringliteral">&quot;nrow&quot;</span>, <span class="stringliteral">&quot;bandwidth&quot;</span>, <span class="stringliteral">&quot;alpha&quot;</span>,</div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;                          <span class="stringliteral">&quot;beta&quot;</span>, <span class="stringliteral">&quot;gamma_m&quot;</span>, <span class="stringliteral">&quot;gamma_p&quot;</span>]</div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;    <span class="comment"># The scalar parameters that must be passed along with a CMA operator</span></div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;    <span class="comment"># if its &#39;to&#39; and &#39;from&#39; spaces are different</span></div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;    cma_diff_fs_params = [<span class="stringliteral">&quot;nrow&quot;</span>, <span class="stringliteral">&quot;ncol&quot;</span>, <span class="stringliteral">&quot;bandwidth&quot;</span>, <span class="stringliteral">&quot;alpha&quot;</span>,</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;                          <span class="stringliteral">&quot;beta&quot;</span>, <span class="stringliteral">&quot;gamma_m&quot;</span>, <span class="stringliteral">&quot;gamma_p&quot;</span>]</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;</div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;    <span class="keyword">def </span>__init__(self, schedule):</div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;</div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeCMAOperators.html#af02a82df5a1bfc3913c95ef0a43e7c73">_name_space_manager</a> = NameSpaceFactory().create()</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;        <span class="comment"># Look at every kernel call in this invoke and generate a set of</span></div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;        <span class="comment"># the unique CMA operators involved. For each one we create a</span></div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;        <span class="comment"># dictionary entry. The key is the name of the CMA argument in the</span></div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;        <span class="comment"># PSy layer and the entry is itself another dictionary containing</span></div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;        <span class="comment"># two entries: the first &#39;arg&#39; is the CMA argument object and the</span></div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;        <span class="comment"># second &#39;params&#39; is the list of integer variables associated with</span></div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;        <span class="comment"># that CMA operator. The contents of this list depend on whether</span></div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;        <span class="comment"># or not the to/from function spaces of the CMA operator are the</span></div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;        <span class="comment"># same.</span></div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeCMAOperators.html#af6a3e7fe5aba5ca2cbbcaf5ddc8c271b">_cma_ops</a> = {}</div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;        <span class="keywordflow">for</span> call <span class="keywordflow">in</span> schedule.calls():</div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;            <span class="keywordflow">if</span> call.cma_operation:</div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;                <span class="comment"># Get a list of all of the CMA arguments to this call</span></div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;                cma_args = psyGen.args_filter(</div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;                    call.arguments.args,</div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;                    arg_types=[<span class="stringliteral">&quot;gh_columnwise_operator&quot;</span>])</div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;                <span class="comment"># Create a dictionary entry for each argument that we</span></div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;                <span class="comment"># have not already seen</span></div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;                <span class="keywordflow">for</span> arg <span class="keywordflow">in</span> cma_args:</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;                    <span class="keywordflow">if</span> arg.name <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeCMAOperators.html#af6a3e7fe5aba5ca2cbbcaf5ddc8c271b">_cma_ops</a>:</div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;                        <span class="keywordflow">if</span> arg.function_space_to.orig_name != \</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;                           arg.function_space_from.orig_name:</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;                            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeCMAOperators.html#af6a3e7fe5aba5ca2cbbcaf5ddc8c271b">_cma_ops</a>[arg.name] = {</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;                                <span class="stringliteral">&quot;arg&quot;</span>: arg,</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;                                <span class="stringliteral">&quot;params&quot;</span>: self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeCMAOperators.html#ae5840373f3d5c66ad7cad0ba9dff0f3d">cma_diff_fs_params</a>}</div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;                        <span class="keywordflow">else</span>:</div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;                            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeCMAOperators.html#af6a3e7fe5aba5ca2cbbcaf5ddc8c271b">_cma_ops</a>[arg.name] = {</div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;                                <span class="stringliteral">&quot;arg&quot;</span>: arg,</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;                                <span class="stringliteral">&quot;params&quot;</span>: self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeCMAOperators.html#a0211499e4a8bdcc6d49e424586da3948">cma_same_fs_params</a>}</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;</div><div class="line"><a name="l01835"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeCMAOperators.html#a7d1ed5548755dcbf33e6c79a460a5f41"> 1835</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeCMAOperators.html#a7d1ed5548755dcbf33e6c79a460a5f41">initialise_cma_ops</a>(self, parent):</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Generates the calls to the LFRic infrastructure that look-up</span></div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;<span class="stringliteral">        the various components of each CMA operator. Adds these as</span></div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;<span class="stringliteral">        children of the supplied parent node. This must be an appropriate</span></div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;<span class="stringliteral">        f2pygen object. &#39;&#39;&#39;</span></div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> CommentGen, AssignGen</div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;</div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;        <span class="comment"># If we have no CMA operators then we do nothing</span></div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeCMAOperators.html#af6a3e7fe5aba5ca2cbbcaf5ddc8c271b">_cma_ops</a>:</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;            <span class="keywordflow">return</span></div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;        parent.add(CommentGen(parent, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;        parent.add(CommentGen(parent,</div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;                              <span class="stringliteral">&quot; Look-up information for each CMA operator&quot;</span>))</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;        parent.add(CommentGen(parent, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;</div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;        <span class="keywordflow">for</span> op_name <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeCMAOperators.html#af6a3e7fe5aba5ca2cbbcaf5ddc8c271b">_cma_ops</a>:</div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;            <span class="comment"># First create a pointer to the array containing the actual</span></div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;            <span class="comment"># matrix</span></div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;            cma_name = self._name_space_manager.create_name(</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;                root_name=op_name+<span class="stringliteral">&quot;_matrix&quot;</span>,</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;                context=<span class="stringliteral">&quot;PSyVars&quot;</span>,</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;                label=op_name+<span class="stringliteral">&quot;_matrix&quot;</span>)</div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;            parent.add(AssignGen(parent, lhs=cma_name, pointer=<span class="keyword">True</span>,</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;                                 rhs=self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeCMAOperators.html#af6a3e7fe5aba5ca2cbbcaf5ddc8c271b">_cma_ops</a>[op_name][<span class="stringliteral">&quot;arg&quot;</span>].</div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;                                 proxy_name_indexed+<span class="stringliteral">&quot;%columnwise_matrix&quot;</span>))</div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;            <span class="comment"># Then make copies of the related integer parameters</span></div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;            <span class="keywordflow">for</span> param <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeCMAOperators.html#af6a3e7fe5aba5ca2cbbcaf5ddc8c271b">_cma_ops</a>[op_name][<span class="stringliteral">&quot;params&quot;</span>]:</div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;                param_name = self._name_space_manager.create_name(</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;                    root_name=op_name+<span class="stringliteral">&quot;_&quot;</span>+param,</div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;                    context=<span class="stringliteral">&quot;PSyVars&quot;</span>,</div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;                    label=op_name+<span class="stringliteral">&quot;_&quot;</span>+param)</div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;                parent.add(AssignGen(parent, lhs=param_name,</div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;                                     rhs=self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeCMAOperators.html#af6a3e7fe5aba5ca2cbbcaf5ddc8c271b">_cma_ops</a>[op_name][<span class="stringliteral">&quot;arg&quot;</span>].</div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;                                     proxy_name_indexed+<span class="stringliteral">&quot;%&quot;</span>+param))</div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;</div><div class="line"><a name="l01871"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeCMAOperators.html#a6b6c4b8dbc8d5f77f3a46c383713b3ab"> 1871</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeCMAOperators.html#a6b6c4b8dbc8d5f77f3a46c383713b3ab">declare_cma_ops</a>(self, parent):</div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Generate the necessary declarations for all column-wise operators</span></div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;<span class="stringliteral">        and their associated parameters &#39;&#39;&#39;</span></div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> DeclGen</div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;</div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;        <span class="comment"># If we have no CMA operators then we do nothing</span></div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeCMAOperators.html#af6a3e7fe5aba5ca2cbbcaf5ddc8c271b">_cma_ops</a>:</div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;            <span class="keywordflow">return</span></div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;</div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;        <span class="keywordflow">for</span> op_name <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeCMAOperators.html#af6a3e7fe5aba5ca2cbbcaf5ddc8c271b">_cma_ops</a>:</div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;            <span class="comment"># Declare the matrix itself</span></div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;            cma_name = self._name_space_manager.create_name(</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;                root_name=op_name+<span class="stringliteral">&quot;_matrix&quot;</span>, context=<span class="stringliteral">&quot;PSyVars&quot;</span>,</div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;                label=op_name+<span class="stringliteral">&quot;_matrix&quot;</span>)</div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;            parent.add(DeclGen(parent, datatype=<span class="stringliteral">&quot;real&quot;</span>, kind=<span class="stringliteral">&quot;r_def&quot;</span>,</div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;                               pointer=<span class="keyword">True</span>,</div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;                               entity_decls=[cma_name+<span class="stringliteral">&quot;(:,:,:) =&gt; null()&quot;</span>]))</div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;            <span class="comment"># Declare the associated integer parameters</span></div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;            param_names = []</div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;            <span class="keywordflow">for</span> param <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeCMAOperators.html#af6a3e7fe5aba5ca2cbbcaf5ddc8c271b">_cma_ops</a>[op_name][<span class="stringliteral">&quot;params&quot;</span>]:</div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;                param_names.append(self._name_space_manager.create_name(</div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;                    root_name=op_name+<span class="stringliteral">&quot;_&quot;</span>+param,</div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;                    context=<span class="stringliteral">&quot;PSyVars&quot;</span>,</div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;                    label=op_name+<span class="stringliteral">&quot;_&quot;</span>+param))</div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;            parent.add(DeclGen(parent, datatype=<span class="stringliteral">&quot;integer&quot;</span>,</div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;                               entity_decls=param_names))</div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;</div><div class="line"><a name="l01899"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html"> 1899</a></span>&#160;<span class="keyword">class </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html">DynMeshes</a>(object):</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;    <span class="stringliteral">&#39;&#39;&#39;Holds all mesh-related information (including colour maps if</span></div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;<span class="stringliteral">    required).  If there are no inter-grid kernels then there is only</span></div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;<span class="stringliteral">    one mesh object required (when colouring or doing distributed memory).</span></div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;<span class="stringliteral">    However, kernels performing inter-grid operations require multiple mesh</span></div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;<span class="stringliteral">    objects as well as mesh maps and other quantities.</span></div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;<span class="stringliteral">    There are two types of inter-grid operation; the first is &quot;prolongation&quot;</span></div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;<span class="stringliteral">    where a field on a coarse mesh is mapped onto a fine mesh. The second</span></div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;<span class="stringliteral">    is &quot;restriction&quot; where a field on a fine mesh is mapped onto a coarse</span></div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;<span class="stringliteral">    mesh.</span></div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;<span class="stringliteral">    :param invoke: the Invoke for which to extract information on all \</span></div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;<span class="stringliteral">                   required inter-grid operations.</span></div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;<span class="stringliteral">    :type invoke: :py:class:`psyclone.dynamo0p3.DynInvoke`</span></div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;<span class="stringliteral">    :param unique_psy_vars: list of arguments to the PSy-layer routine.</span></div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;<span class="stringliteral">    :type unique_psy_vars: list of \</span></div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;<span class="stringliteral">                      :py:class:`psyclone.dynamo0p3.DynKernelArgument` objects.</span></div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;<span class="stringliteral">    &#39;&#39;&#39;</span></div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;</div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;    <span class="keyword">def </span>__init__(self, invoke, unique_psy_vars):</div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html#a91d113792a7629e15784ab37d10ce6d0">_name_space_manager</a> = NameSpaceFactory().create()</div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;        <span class="comment"># Dict of DynInterGrid objects holding information on the mesh-related</span></div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;        <span class="comment"># variables required by each inter-grid kernel. Keys are the kernel</span></div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;        <span class="comment"># names.</span></div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html#af08b7512cf0ecbea909e50ad4d03d0fc">_ig_kernels</a> = OrderedDict()</div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;        <span class="comment"># List of names of unique mesh variables referenced in the Invoke</span></div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html#a533b4c70c754c4bfa8e087a294d42d91">_mesh_names</a> = []</div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;        <span class="comment"># Whether or not the associated Invoke requires colourmap information</span></div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html#ab1f5dea07b94694498f1df053a67f7c5">_needs_colourmap</a> = <span class="keyword">False</span></div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;        <span class="comment"># Keep a reference to the Schedule so we can check for colouring</span></div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;        <span class="comment"># later</span></div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html#a099eea03cfd32e9e6fe4481204451818">_schedule</a> = invoke.schedule</div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;</div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;        <span class="comment"># Set used to generate a list of the unique mesh objects</span></div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;        _name_set = set()</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;</div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;        <span class="comment"># Find the first non-scalar argument to this PSy layer routine. We</span></div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;        <span class="comment"># will use this to look-up the mesh if there are no inter-grid</span></div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;        <span class="comment"># kernels in this invoke.</span></div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html#a9ae5eae307fa92466bf4cc321528d62a">_first_var</a> = <span class="keywordtype">None</span></div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;        <span class="keywordflow">for</span> var <span class="keywordflow">in</span> unique_psy_vars:</div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;            <span class="keywordflow">if</span> var.type <span class="keywordflow">not</span> <span class="keywordflow">in</span> VALID_SCALAR_NAMES:</div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;                self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html#a9ae5eae307fa92466bf4cc321528d62a">_first_var</a> = var</div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;                <span class="keywordflow">break</span></div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;</div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;        <span class="comment"># Loop over all kernel calls in the schedule. Keep a list of</span></div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;        <span class="comment"># any non-intergrid kernels so that we can generate a verbose error</span></div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;        <span class="comment"># message if necessary.</span></div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;        non_intergrid_kernels = []</div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;        <span class="keywordflow">for</span> call <span class="keywordflow">in</span> self._schedule.kern_calls():</div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;</div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> call.is_intergrid:</div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;                non_intergrid_kernels.append(call)</div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;                <span class="comment"># Skip over any non-inter-grid kernels</span></div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;                <span class="keywordflow">continue</span></div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;</div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;            fine_args = psyGen.args_filter(call.arguments.args,</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;                                           arg_meshes=[<span class="stringliteral">&quot;gh_fine&quot;</span>])</div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;            coarse_args = psyGen.args_filter(call.arguments.args,</div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;                                             arg_meshes=[<span class="stringliteral">&quot;gh_coarse&quot;</span>])</div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;            fine_arg = fine_args[0]</div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;            coarse_arg = coarse_args[0]</div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;</div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;            <span class="comment"># Create an object to capture info. on this inter-grid kernel</span></div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;            <span class="comment"># and store in our dictionary</span></div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html#af08b7512cf0ecbea909e50ad4d03d0fc">_ig_kernels</a>[call.name] = <a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInterGrid.html">DynInterGrid</a>(fine_arg, coarse_arg)</div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;</div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;            <span class="comment"># Create and store the names of the associated mesh objects</span></div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;            _name_set.add(</div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;                self._name_space_manager.create_name(</div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;                    root_name=<span class="stringliteral">&quot;mesh_{0}&quot;</span>.format(fine_arg.name),</div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;                    context=<span class="stringliteral">&quot;PSyVars&quot;</span>,</div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;                    label=<span class="stringliteral">&quot;mesh_{0}&quot;</span>.format(fine_arg.name)))</div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;            _name_set.add(</div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;                self._name_space_manager.create_name(</div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;                    root_name=<span class="stringliteral">&quot;mesh_{0}&quot;</span>.format(coarse_arg.name),</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;                    context=<span class="stringliteral">&quot;PSyVars&quot;</span>,</div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;                    label=<span class="stringliteral">&quot;mesh_{0}&quot;</span>.format(coarse_arg.name)))</div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;</div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;        <span class="comment"># If we found a mixture of both inter-grid and non-inter-grid kernels</span></div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;        <span class="comment"># then we reject the invoke()</span></div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;        <span class="keywordflow">if</span> non_intergrid_kernels <span class="keywordflow">and</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html#af08b7512cf0ecbea909e50ad4d03d0fc">_ig_kernels</a>:</div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;            <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;                <span class="stringliteral">&quot;An invoke containing inter-grid kernels must contain no &quot;</span></div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;                <span class="stringliteral">&quot;other kernel types but kernels &#39;{0}&#39; in invoke &#39;{1}&#39; are &quot;</span></div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;                <span class="stringliteral">&quot;not inter-grid kernels.&quot;</span>.format(</div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;                    <span class="stringliteral">&quot;, &quot;</span>.join([call.name <span class="keywordflow">for</span> call <span class="keywordflow">in</span> non_intergrid_kernels]),</div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;                    invoke.name))</div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;</div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;        <span class="comment"># If we didn&#39;t have any inter-grid kernels but distributed memory</span></div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;        <span class="comment"># is enabled then we will still need a mesh object if we have one or</span></div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;        <span class="comment"># more kernels that iterate over cells. (Colourmaps also</span></div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;        <span class="comment"># require a mesh object but that is handled in _colourmap_init().)</span></div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> _name_set <span class="keywordflow">and</span> (Config.get().distributed_memory <span class="keywordflow">and</span></div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;                              <span class="keywordflow">not</span> invoke.iterate_over_dofs_only):</div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;            _name_set.add(self._name_space_manager.create_name(</div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;                root_name=<span class="stringliteral">&quot;mesh&quot;</span>, context=<span class="stringliteral">&quot;PSyVars&quot;</span>, label=<span class="stringliteral">&quot;mesh&quot;</span>))</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;</div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;        <span class="comment"># Convert the set of mesh names to a list and store</span></div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html#a533b4c70c754c4bfa8e087a294d42d91">_mesh_names</a> = sorted(_name_set)</div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;</div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;    <span class="keyword">def </span>_colourmap_init(self):</div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;<span class="stringliteral">        Sets-up information on any required colourmaps. This cannot be done</span></div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;<span class="stringliteral">        in the constructor since colouring is applied by Transformations</span></div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;<span class="stringliteral">        and happens after the Schedule has already been constructed.</span></div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;        <span class="keywordflow">for</span> call <span class="keywordflow">in</span> [call <span class="keywordflow">for</span> call <span class="keywordflow">in</span> self._schedule.kern_calls() <span class="keywordflow">if</span></div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;                     call.is_coloured()]:</div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;            <span class="comment"># Keep a record of whether or not any kernels (loops) in this</span></div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;            <span class="comment"># invoke have been coloured</span></div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html#ab1f5dea07b94694498f1df053a67f7c5">_needs_colourmap</a> = <span class="keyword">True</span></div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;            <span class="keywordflow">if</span> call.is_intergrid:</div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;                <span class="comment"># This is an inter-grid kernel so look-up the names of</span></div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;                <span class="comment"># the colourmap variables associated with the coarse</span></div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;                <span class="comment"># mesh (since that determines the iteration space).</span></div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;                carg_name = self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html#af08b7512cf0ecbea909e50ad4d03d0fc">_ig_kernels</a>[call.name].coarse.name</div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;                <span class="comment"># Colour map</span></div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;                base_name = <span class="stringliteral">&quot;cmap_&quot;</span> + carg_name</div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;                colour_map = self._name_space_manager.create_name(</div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;                    root_name=base_name, context=<span class="stringliteral">&quot;PSyVars&quot;</span>, label=base_name)</div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;                <span class="comment"># No. of colours</span></div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;                base_name = <span class="stringliteral">&quot;ncolour_&quot;</span> + carg_name</div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;                ncolours = self._name_space_manager.create_name(</div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;                    root_name=base_name, context=<span class="stringliteral">&quot;PSyVars&quot;</span>, label=base_name)</div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;                <span class="comment"># Add these names into the dictionary entry for this</span></div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;                <span class="comment"># inter-grid kernel</span></div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;                self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html#af08b7512cf0ecbea909e50ad4d03d0fc">_ig_kernels</a>[call.name].colourmap = colour_map</div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;                self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html#af08b7512cf0ecbea909e50ad4d03d0fc">_ig_kernels</a>[call.name].ncolours_var = ncolours</div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;</div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html#a533b4c70c754c4bfa8e087a294d42d91">_mesh_names</a> <span class="keywordflow">and</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html#ab1f5dea07b94694498f1df053a67f7c5">_needs_colourmap</a>:</div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;            <span class="comment"># There aren&#39;t any inter-grid kernels but we do need colourmap</span></div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;            <span class="comment"># information and that means we&#39;ll need a mesh object</span></div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;            mesh_name = self._name_space_manager.create_name(</div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;                root_name=<span class="stringliteral">&quot;mesh&quot;</span>, context=<span class="stringliteral">&quot;PSyVars&quot;</span>, label=<span class="stringliteral">&quot;mesh&quot;</span>)</div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;            self._mesh_names.append(mesh_name)</div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;</div><div class="line"><a name="l02038"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html#abe3627432efa9e99adf07b6798e8da41"> 2038</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html#abe3627432efa9e99adf07b6798e8da41">declarations</a>(self, parent):</div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;<span class="stringliteral">        Declare variables specific to mesh objects.</span></div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;<span class="stringliteral">        :param parent: the parent node to which to add the declarations</span></div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;<span class="stringliteral">        :type parent: an instance of :py:class:`psyclone.f2pygen.BaseGen`</span></div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> DeclGen, TypeDeclGen, UseGen</div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;</div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;        <span class="comment"># Since we&#39;re now generating code, any transformations must</span></div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;        <span class="comment"># have been applied so we can set-up colourmap information</span></div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html#a387ea40bfd30ca397f70aebb5c71052e">_colourmap_init</a>()</div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;</div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;        <span class="comment"># We&#39;ll need various typedefs from the mesh module</span></div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html#a533b4c70c754c4bfa8e087a294d42d91">_mesh_names</a>:</div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;            parent.add(UseGen(parent, name=<span class="stringliteral">&quot;mesh_mod&quot;</span>, only=<span class="keyword">True</span>,</div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;                              funcnames=[<span class="stringliteral">&quot;mesh_type&quot;</span>]))</div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html#af08b7512cf0ecbea909e50ad4d03d0fc">_ig_kernels</a>:</div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;            parent.add(UseGen(parent, name=<span class="stringliteral">&quot;mesh_map_mod&quot;</span>, only=<span class="keyword">True</span>,</div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;                              funcnames=[<span class="stringliteral">&quot;mesh_map_type&quot;</span>]))</div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;        <span class="comment"># Declare the mesh object(s)</span></div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;        <span class="keywordflow">for</span> name <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html#a533b4c70c754c4bfa8e087a294d42d91">_mesh_names</a>:</div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;            parent.add(TypeDeclGen(parent, pointer=<span class="keyword">True</span>, datatype=<span class="stringliteral">&quot;mesh_type&quot;</span>,</div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;                                   entity_decls=[name + <span class="stringliteral">&quot; =&gt; null()&quot;</span>]))</div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;        <span class="comment"># Declare the inter-mesh map(s) and cell map(s)</span></div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;        <span class="keywordflow">for</span> kern <span class="keywordflow">in</span> self._ig_kernels.values():</div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;            parent.add(TypeDeclGen(parent, pointer=<span class="keyword">True</span>,</div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;                                   datatype=<span class="stringliteral">&quot;mesh_map_type&quot;</span>,</div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;                                   entity_decls=[kern.mmap + <span class="stringliteral">&quot; =&gt; null()&quot;</span>]))</div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;            parent.add(</div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;                DeclGen(parent, pointer=<span class="keyword">True</span>, datatype=<span class="stringliteral">&quot;integer&quot;</span>,</div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;                        entity_decls=[kern.cell_map + <span class="stringliteral">&quot;(:,:) =&gt; null()&quot;</span>]))</div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;</div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;            <span class="comment"># Declare the number of cells in the fine mesh and how many fine</span></div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;            <span class="comment"># cells there are per coarse cell</span></div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;            parent.add(DeclGen(parent, datatype=<span class="stringliteral">&quot;integer&quot;</span>,</div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;                               entity_decls=[kern.ncell_fine,</div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;                                             kern.ncellpercell]))</div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;            <span class="comment"># Declare variables to hold the colourmap information if required</span></div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;            <span class="keywordflow">if</span> kern.colourmap:</div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;                parent.add(DeclGen(parent, datatype=<span class="stringliteral">&quot;integer&quot;</span>,</div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;                                   pointer=<span class="keyword">True</span>,</div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;                                   entity_decls=[kern.colourmap+<span class="stringliteral">&quot;(:,:)&quot;</span>]))</div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;                parent.add(DeclGen(parent, datatype=<span class="stringliteral">&quot;integer&quot;</span>,</div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;                                   entity_decls=[kern.ncolours_var]))</div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;</div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html#af08b7512cf0ecbea909e50ad4d03d0fc">_ig_kernels</a> <span class="keywordflow">and</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html#ab1f5dea07b94694498f1df053a67f7c5">_needs_colourmap</a>:</div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;            <span class="comment"># There aren&#39;t any inter-grid kernels but we do need</span></div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;            <span class="comment"># colourmap information</span></div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;            base_name = <span class="stringliteral">&quot;cmap&quot;</span></div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;            colour_map = self._name_space_manager.create_name(</div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;                root_name=base_name, context=<span class="stringliteral">&quot;PSyVars&quot;</span>, label=base_name)</div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;            <span class="comment"># No. of colours</span></div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;            base_name = <span class="stringliteral">&quot;ncolour&quot;</span></div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;            ncolours = self._name_space_manager.create_name(</div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;                root_name=base_name, context=<span class="stringliteral">&quot;PSyVars&quot;</span>, label=base_name)</div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;            <span class="comment"># Add declarations for these variables</span></div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;            parent.add(DeclGen(parent, datatype=<span class="stringliteral">&quot;integer&quot;</span>,</div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;                               pointer=<span class="keyword">True</span>,</div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;                               entity_decls=[colour_map+<span class="stringliteral">&quot;(:,:)&quot;</span>]))</div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;            parent.add(DeclGen(parent, datatype=<span class="stringliteral">&quot;integer&quot;</span>,</div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;                               entity_decls=[ncolours]))</div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;</div><div class="line"><a name="l02101"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html#a26dbeb0c6c5c382c56fcae0b7da58ae6"> 2101</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html#a26dbeb0c6c5c382c56fcae0b7da58ae6">initialise</a>(self, parent):</div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;<span class="stringliteral">        Initialise parameters specific to inter-grid kernels</span></div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;<span class="stringliteral">        :param parent: the parent node to which to add the initialisations</span></div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;<span class="stringliteral">        :type parent: an instance of :py:class:`psyclone.f2pygen.BaseGen`</span></div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> CommentGen, AssignGen</div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;</div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;        <span class="comment"># If we haven&#39;t got any need for a mesh in this invoke then we</span></div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;        <span class="comment"># don&#39;t do anything</span></div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;        <span class="keywordflow">if</span> len(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html#a533b4c70c754c4bfa8e087a294d42d91">_mesh_names</a>) == 0:</div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;            <span class="keywordflow">return</span></div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;</div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;        parent.add(CommentGen(parent, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;</div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;        <span class="keywordflow">if</span> len(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html#a533b4c70c754c4bfa8e087a294d42d91">_mesh_names</a>) == 1:</div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;            <span class="comment"># We only require one mesh object which means that this invoke</span></div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;            <span class="comment"># contains no inter-grid kernels (which would require at least 2)</span></div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;            parent.add(CommentGen(parent, <span class="stringliteral">&quot; Create a mesh object&quot;</span>))</div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;            parent.add(CommentGen(parent, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;            rhs = self._first_var.name_indexed + <span class="stringliteral">&quot;%get_mesh()&quot;</span></div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;            parent.add(AssignGen(parent, pointer=<span class="keyword">True</span>,</div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;                                 lhs=self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html#a533b4c70c754c4bfa8e087a294d42d91">_mesh_names</a>[0], rhs=rhs))</div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html#ab1f5dea07b94694498f1df053a67f7c5">_needs_colourmap</a>:</div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;                parent.add(CommentGen(parent, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;                parent.add(CommentGen(parent, <span class="stringliteral">&quot; Get the colourmap&quot;</span>))</div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;                parent.add(CommentGen(parent, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;                <span class="comment"># Look-up variable names for colourmap and number of colours</span></div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;                colour_map = self._name_space_manager.create_name(</div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;                    root_name=<span class="stringliteral">&quot;cmap&quot;</span>, context=<span class="stringliteral">&quot;PSyVars&quot;</span>, label=<span class="stringliteral">&quot;cmap&quot;</span>)</div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;                ncolour = self._name_space_manager.create_name(</div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;                    root_name=<span class="stringliteral">&quot;ncolour&quot;</span>, context=<span class="stringliteral">&quot;PSyVars&quot;</span>,</div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;                    label=<span class="stringliteral">&quot;ncolour&quot;</span>)</div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;                <span class="comment"># Get the number of colours</span></div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;                parent.add(AssignGen(</div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;                    parent, lhs=ncolour,</div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;                    rhs=<span class="stringliteral">&quot;{0}%get_ncolours()&quot;</span>.format(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html#a533b4c70c754c4bfa8e087a294d42d91">_mesh_names</a>[0])))</div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;                <span class="comment"># Get the colour map</span></div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;                parent.add(AssignGen(parent, pointer=<span class="keyword">True</span>, lhs=colour_map,</div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;                                     rhs=self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html#a533b4c70c754c4bfa8e087a294d42d91">_mesh_names</a>[0] +</div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;                                     <span class="stringliteral">&quot;%get_colour_map()&quot;</span>))</div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;            <span class="keywordflow">return</span></div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;</div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;        parent.add(CommentGen(</div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;            parent,</div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;            <span class="stringliteral">&quot; Look-up mesh objects and loop limits for inter-grid kernels&quot;</span>))</div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;        parent.add(CommentGen(parent, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;</div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;        <span class="comment"># Keep a list of quantities that we&#39;ve already initialised so</span></div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;        <span class="comment"># that we don&#39;t generate duplicate assignments</span></div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;        initialised = []</div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;</div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;        <span class="comment"># Loop over the DynInterGrid objects in our dictionary</span></div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;        <span class="keywordflow">for</span> dig <span class="keywordflow">in</span> self._ig_kernels.values():</div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;            <span class="comment"># We need pointers to both the coarse and the fine mesh</span></div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;            fine_mesh = self._name_space_manager.create_name(</div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;                root_name=<span class="stringliteral">&quot;mesh_{0}&quot;</span>.format(dig.fine.name),</div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;                context=<span class="stringliteral">&quot;PSyVars&quot;</span>,</div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;                label=<span class="stringliteral">&quot;mesh_{0}&quot;</span>.format(dig.fine.name))</div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;            coarse_mesh = self._name_space_manager.create_name(</div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;                root_name=<span class="stringliteral">&quot;mesh_{0}&quot;</span>.format(dig.coarse.name),</div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;                context=<span class="stringliteral">&quot;PSyVars&quot;</span>,</div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;                label=<span class="stringliteral">&quot;mesh_{0}&quot;</span>.format(dig.coarse.name))</div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;            <span class="keywordflow">if</span> fine_mesh <span class="keywordflow">not</span> <span class="keywordflow">in</span> initialised:</div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;                initialised.append(fine_mesh)</div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;                parent.add(</div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;                    AssignGen(parent, pointer=<span class="keyword">True</span>,</div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;                              lhs=fine_mesh,</div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;                              rhs=dig.fine.name_indexed + <span class="stringliteral">&quot;%get_mesh()&quot;</span>))</div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;            <span class="keywordflow">if</span> coarse_mesh <span class="keywordflow">not</span> <span class="keywordflow">in</span> initialised:</div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;                initialised.append(coarse_mesh)</div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;                parent.add(</div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;                    AssignGen(parent, pointer=<span class="keyword">True</span>,</div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;                              lhs=coarse_mesh,</div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;                              rhs=dig.coarse.name_indexed + <span class="stringliteral">&quot;%get_mesh()&quot;</span>))</div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;            <span class="comment"># We also need a pointer to the mesh map which we get from</span></div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;            <span class="comment"># the coarse mesh</span></div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;            <span class="keywordflow">if</span> dig.mmap <span class="keywordflow">not</span> <span class="keywordflow">in</span> initialised:</div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;                initialised.append(dig.mmap)</div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;                parent.add(</div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;                    AssignGen(parent, pointer=<span class="keyword">True</span>,</div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;                              lhs=dig.mmap,</div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;                              rhs=<span class="stringliteral">&quot;{0}%get_mesh_map({1})&quot;</span>.format(coarse_mesh,</div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;                                                                 fine_mesh)))</div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;</div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;            <span class="comment"># Cell map. This is obtained from the mesh map.</span></div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;            <span class="keywordflow">if</span> dig.cell_map <span class="keywordflow">not</span> <span class="keywordflow">in</span> initialised:</div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;                initialised.append(dig.cell_map)</div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;                parent.add(</div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;                    AssignGen(parent, pointer=<span class="keyword">True</span>, lhs=dig.cell_map,</div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;                              rhs=dig.mmap+<span class="stringliteral">&quot;%get_whole_cell_map()&quot;</span>))</div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;</div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;            <span class="comment"># Number of cells in the fine mesh</span></div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;            <span class="keywordflow">if</span> dig.ncell_fine <span class="keywordflow">not</span> <span class="keywordflow">in</span> initialised:</div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;                initialised.append(dig.ncell_fine)</div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;                <span class="keywordflow">if</span> Config.get().distributed_memory:</div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;                    <span class="comment"># TODO this hardwired depth of 2 will need changing in</span></div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;                    <span class="comment"># order to support redundant computation</span></div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;                    parent.add(</div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;                        AssignGen(parent, lhs=dig.ncell_fine,</div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;                                  rhs=(fine_mesh+<span class="stringliteral">&quot;%get_last_halo_cell&quot;</span></div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;                                       <span class="stringliteral">&quot;(depth=2)&quot;</span>)))</div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;                    parent.add(</div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;                        AssignGen(parent, lhs=dig.ncell_fine,</div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;                                  rhs=<span class="stringliteral">&quot;%&quot;</span>.join([dig.fine.proxy_name,</div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;                                                dig.fine.ref_name(),</div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;                                                <span class="stringliteral">&quot;get_ncell()&quot;</span>])))</div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;</div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;            <span class="comment"># Number of fine cells per coarse cell.</span></div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;            <span class="keywordflow">if</span> dig.ncellpercell <span class="keywordflow">not</span> <span class="keywordflow">in</span> initialised:</div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;                initialised.append(dig.ncellpercell)</div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;                parent.add(</div><div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;                    AssignGen(parent, lhs=dig.ncellpercell,</div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;                              rhs=dig.mmap +</div><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;                              <span class="stringliteral">&quot;%get_ntarget_cells_per_source_cell()&quot;</span>))</div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;</div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;            <span class="comment"># Colour map for the coarse mesh (if required)</span></div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;            <span class="keywordflow">if</span> dig.colourmap:</div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;                <span class="comment"># Number of colours</span></div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;                parent.add(AssignGen(parent, lhs=dig.ncolours_var,</div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;                                     rhs=coarse_mesh + <span class="stringliteral">&quot;%get_ncolours()&quot;</span>))</div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;                <span class="comment"># Colour map itself</span></div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;                parent.add(AssignGen(parent, lhs=dig.colourmap,</div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;                                     pointer=<span class="keyword">True</span>,</div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;                                     rhs=coarse_mesh + <span class="stringliteral">&quot;%get_colour_map()&quot;</span>))</div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;</div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;    @property</div><div class="line"><a name="l02230"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html#a387ced89c120fe1b02e27af4663f8dc7"> 2230</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html#a387ced89c120fe1b02e27af4663f8dc7">intergrid_kernels</a>(self):</div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Getter for the dictionary of intergrid kernels.</span></div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;<span class="stringliteral">        :returns: Dictionary of intergrid kernels, indexed by name.</span></div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;<span class="stringliteral">        :rtype: :py:class:`collections.OrderedDict`</span></div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html#af08b7512cf0ecbea909e50ad4d03d0fc">_ig_kernels</a></div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;</div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;</div><div class="line"><a name="l02239"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynInterGrid.html"> 2239</a></span>&#160;<span class="keyword">class </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInterGrid.html">DynInterGrid</a>(object):</div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;    <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;<span class="stringliteral">    Holds information on quantities required by an inter-grid kernel.</span></div><div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;<span class="stringliteral">    :param fine_arg: Kernel argument on the fine mesh.</span></div><div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;<span class="stringliteral">    :type fine_arg: :py:class:`psyclone.dynamo0p3.DynKernelArgument`</span></div><div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;<span class="stringliteral">    :param coarse_arg: Kernel argument on the coarse mesh.</span></div><div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;<span class="stringliteral">    :type coarse_arg: :py:class:`psyclone.dynamo0p3.DynKernelArgument`</span></div><div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;<span class="stringliteral">    &#39;&#39;&#39;</span></div><div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;    <span class="keyword">def </span>__init__(self, fine_arg, coarse_arg):</div><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInterGrid.html#a298976a70545ca9c9ea9ab81a79a9f74">_name_space_manager</a> = NameSpaceFactory().create()</div><div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;</div><div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;        <span class="comment"># Arguments on the coarse and fine grids</span></div><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInterGrid.html#a9fc797172504e312ded7967867d466b2">coarse</a> = coarse_arg</div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInterGrid.html#ac41e328a128578c277af024299a2c3b9">fine</a> = fine_arg</div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;</div><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;        <span class="comment"># Generate name for inter-mesh map</span></div><div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;        base_mmap_name = <span class="stringliteral">&quot;mmap_{0}_{1}&quot;</span>.format(fine_arg.name,</div><div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;                                               coarse_arg.name)</div><div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInterGrid.html#ae23bff49ea1e37aee3db057616a817a4">mmap</a> = self._name_space_manager.create_name(</div><div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;            root_name=base_mmap_name,</div><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;            context=<span class="stringliteral">&quot;PSyVars&quot;</span>,</div><div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;            label=base_mmap_name)</div><div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;</div><div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;        <span class="comment"># Generate name for ncell variables</span></div><div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInterGrid.html#a471c704742e4f068746ca44e86aa3db0">ncell_fine</a> = self._name_space_manager.create_name(</div><div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;            root_name=<span class="stringliteral">&quot;ncell_{0}&quot;</span>.format(fine_arg.name),</div><div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;            context=<span class="stringliteral">&quot;PSyVars&quot;</span>,</div><div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;            label=<span class="stringliteral">&quot;ncell_{0}&quot;</span>.format(fine_arg.name))</div><div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;        <span class="comment"># No. of fine cells per coarse cell</span></div><div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInterGrid.html#ad41d162562fedb02c35286d1729a98a8">ncellpercell</a> = self._name_space_manager.create_name(</div><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;            root_name=<span class="stringliteral">&quot;ncpc_{0}_{1}&quot;</span>.format(fine_arg.name,</div><div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;                                            coarse_arg.name),</div><div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;            context=<span class="stringliteral">&quot;PSyVars&quot;</span>,</div><div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;            label=<span class="stringliteral">&quot;ncpc_{0}_{1}&quot;</span>.format(fine_arg.name,</div><div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;                                        coarse_arg.name))</div><div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;        <span class="comment"># Name for cell map</span></div><div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;        base_name = <span class="stringliteral">&quot;cell_map_&quot;</span> + coarse_arg.name</div><div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInterGrid.html#aa8e21652a77966b0c789c5c921148a80">cell_map</a> = self._name_space_manager.create_name(</div><div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;            root_name=base_name, context=<span class="stringliteral">&quot;PSyVars&quot;</span>, label=base_name)</div><div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;        <span class="comment"># We have no colourmap information when first created</span></div><div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInterGrid.html#a551b824866740ad2eaec994a642827a6">colourmap</a> = <span class="stringliteral">&quot;&quot;</span></div><div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;        <span class="comment"># Name of the variable holding the number of colours</span></div><div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInterGrid.html#acfd716ab365d9c8065d91e1a1d81ad60">ncolours_var</a> = <span class="stringliteral">&quot;&quot;</span></div><div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;</div><div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;</div><div class="line"><a name="l02285"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html"> 2285</a></span>&#160;<span class="keyword">class </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html">DynInvokeBasisFns</a>(object):</div><div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;    <span class="stringliteral">&#39;&#39;&#39; Holds all information on the basis and differential basis</span></div><div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;<span class="stringliteral">    functions required by an invoke. This covers both those required for</span></div><div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;<span class="stringliteral">    quadrature and for evaluators.</span></div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;<span class="stringliteral">    :param schedule: the schedule of the Invoke for which to extract \</span></div><div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;<span class="stringliteral">                     information on all required basis/diff-basis functions.</span></div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;<span class="stringliteral">    :type schedule: :py:class:`psyclone.dynamo0p3.DynSchedule`</span></div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;<span class="stringliteral">    :raises InternalError: if a call in the supplied Schedule has an \</span></div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;<span class="stringliteral">                           unrecognised evaluator shape.</span></div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;<span class="stringliteral">    &#39;&#39;&#39;</span></div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;    <span class="keyword">def </span>__init__(self, schedule):</div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a8e239708c52ffa287c65464ee77c16aa">_name_space_manager</a> = NameSpaceFactory().create()</div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;        <span class="comment"># Construct a list of all the basis/diff-basis functions required</span></div><div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;        <span class="comment"># by this invoke. Each entry in the list is a dictionary holding</span></div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;        <span class="comment"># the shape, the function space and the &#39;target&#39; function spaces</span></div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;        <span class="comment"># (upon which the basis functions are evaluated).</span></div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a06f089ee8ad2d5770a0db66f36703e24">_basis_fns</a> = []</div><div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;        <span class="comment"># The dictionary of quadrature objects passed to this invoke. Keys</span></div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;        <span class="comment"># are the various VALID_QUADRATURE_SHAPES, values are a list of</span></div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;        <span class="comment"># associated quadrature variables. (i.e. we have a list of</span></div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;        <span class="comment"># quadrature arguments for each shape.)</span></div><div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a8b4af5b307d5584cc3775ed0bd8f93b0">_qr_vars</a> = {}</div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;        <span class="comment"># The dict of target function spaces upon which we must provide</span></div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;        <span class="comment"># evaluators. Keys are the FS names, values are (FunctionSpace,</span></div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;        <span class="comment"># DynKernelArgument) tuples.</span></div><div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#adc23cd19f80124ec95807dc831a95863">_eval_targets</a> = OrderedDict()</div><div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;</div><div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;        <span class="keywordflow">for</span> call <span class="keywordflow">in</span> schedule.kern_calls():</div><div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;</div><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> call.eval_shape:</div><div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;                <span class="comment"># Skip this kernel if it doesn&#39;t require basis/diff basis fns</span></div><div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;                <span class="keywordflow">continue</span></div><div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;</div><div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;            <span class="keywordflow">if</span> call.eval_shape <span class="keywordflow">in</span> VALID_QUADRATURE_SHAPES:</div><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;</div><div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;                <span class="comment"># This kernel requires quadrature</span></div><div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;                <span class="keywordflow">if</span> call.eval_shape <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a8b4af5b307d5584cc3775ed0bd8f93b0">_qr_vars</a>:</div><div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;                    <span class="comment"># We haven&#39;t seen a quadrature arg with this shape</span></div><div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;                    <span class="comment"># before so create a dictionary entry with an</span></div><div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;                    <span class="comment"># empty list</span></div><div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;                    self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a8b4af5b307d5584cc3775ed0bd8f93b0">_qr_vars</a>[call.eval_shape] = []</div><div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;                <span class="keywordflow">if</span> call.qr_name <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a8b4af5b307d5584cc3775ed0bd8f93b0">_qr_vars</a>[call.eval_shape]:</div><div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;                    <span class="comment"># Add this qr argument to the list of those that</span></div><div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;                    <span class="comment"># have this shape</span></div><div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;                    self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a8b4af5b307d5584cc3775ed0bd8f93b0">_qr_vars</a>[call.eval_shape].append(call.qr_name)</div><div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;</div><div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;            <span class="keywordflow">elif</span> call.eval_shape.lower() == <span class="stringliteral">&quot;gh_evaluator&quot;</span>:</div><div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;                <span class="comment"># An evaluator consists of basis or diff basis functions</span></div><div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;                <span class="comment"># for one FS evaluated on the nodes of another &#39;target&#39; FS.</span></div><div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;                <span class="comment"># Make a dict of 2-tuples, each containing the FunctionSpace</span></div><div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;                <span class="comment"># and associated kernel argument for the target FSs.</span></div><div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;</div><div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;                <span class="comment"># Loop over the target FS for evaluators required by this</span></div><div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;                <span class="comment"># kernel</span></div><div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;                <span class="keywordflow">for</span> fs_name <span class="keywordflow">in</span> call.eval_targets:</div><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;                    <span class="keywordflow">if</span> fs_name <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#adc23cd19f80124ec95807dc831a95863">_eval_targets</a>:</div><div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;                        <span class="comment"># We don&#39;t already have this space in our list so</span></div><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;                        <span class="comment"># add it to the list of target spaces</span></div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;                        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#adc23cd19f80124ec95807dc831a95863">_eval_targets</a>[fs_name] = \</div><div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;                            call.eval_targets[fs_name]</div><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;                <span class="keywordflow">raise</span> InternalError(<span class="stringliteral">&quot;Unrecognised evaluator shape: &#39;{0}&#39;. &quot;</span></div><div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;                                    <span class="stringliteral">&quot;Should be one of {1}&quot;</span>.format(</div><div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;                                        call.eval_shape,</div><div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;                                        VALID_EVALUATOR_SHAPES))</div><div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;</div><div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;            <span class="comment"># Both quadrature and evaluators require basis and/or differential</span></div><div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;            <span class="comment"># basis functions. This helper routine populates self._basis_fns</span></div><div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;            <span class="comment"># with entries describing the basis functions required by</span></div><div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;            <span class="comment"># this call.</span></div><div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#abbbb52ab0d348c916e6e195d5928fe0c">_setup_basis_fns_for_call</a>(call)</div><div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;</div><div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;    <span class="keyword">def </span>_setup_basis_fns_for_call(self, call):</div><div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;<span class="stringliteral">        Populates self._basis_fns with entries describing the basis</span></div><div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;<span class="stringliteral">        functions required by the supplied Call.</span></div><div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;<span class="stringliteral">        :param call: the kernel call for which basis functions are required.</span></div><div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;<span class="stringliteral">        :type call: :py:class:`psyclone.dynamo0p3.DynKern`</span></div><div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;<span class="stringliteral">        :raises InternalError: if the supplied call is of incorrect type.</span></div><div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;<span class="stringliteral">        :raises InternalError: if the supplied call has an unrecognised \</span></div><div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;<span class="stringliteral">                               evaluator shape.</span></div><div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> isinstance(call, DynKern):</div><div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;            <span class="keywordflow">raise</span> InternalError(<span class="stringliteral">&quot;Expected a DynKern object but got: &#39;{0}&#39;&quot;</span>.</div><div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;                                format(type(call)))</div><div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;        <span class="comment"># We need a full FunctionSpace object for each function space</span></div><div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;        <span class="comment"># that has basis functions associated with it.</span></div><div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;        <span class="keywordflow">for</span> fsd <span class="keywordflow">in</span> call.fs_descriptors.descriptors:</div><div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;</div><div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;            <span class="comment"># We need the full FS object, not just the name. Therefore</span></div><div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;            <span class="comment"># we first have to get a kernel argument that is on this</span></div><div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;            <span class="comment"># space...</span></div><div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;            arg, fspace = call.arguments.get_arg_on_space_name(fsd.fs_name)</div><div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;</div><div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;            <span class="comment"># Populate a dict with the shape, function space and</span></div><div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;            <span class="comment"># associated kernel argument for this basis/diff-basis f&#39;n.</span></div><div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;            entry = {<span class="stringliteral">&quot;shape&quot;</span>: call.eval_shape,</div><div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;                     <span class="stringliteral">&quot;fspace&quot;</span>: fspace,</div><div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;                     <span class="stringliteral">&quot;arg&quot;</span>: arg}</div><div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;            <span class="keywordflow">if</span> call.eval_shape <span class="keywordflow">in</span> VALID_QUADRATURE_SHAPES:</div><div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;                <span class="comment"># This is for quadrature - store the name of the</span></div><div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;                <span class="comment"># qr variable</span></div><div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;                entry[<span class="stringliteral">&quot;qr_var&quot;</span>] = call.qr_name</div><div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;                <span class="comment"># Quadrature are evaluated at pre-determined</span></div><div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;                <span class="comment"># points rather than at the nodes of another FS.</span></div><div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;                <span class="comment"># We put one entry of None in the list of target</span></div><div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;                <span class="comment"># spaces to facilitate cases where we loop over</span></div><div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;                <span class="comment"># this list.</span></div><div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;                entry[<span class="stringliteral">&quot;nodal_fspaces&quot;</span>] = [<span class="keywordtype">None</span>]</div><div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;            <span class="keywordflow">elif</span> call.eval_shape.lower() == <span class="stringliteral">&quot;gh_evaluator&quot;</span>:</div><div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;                <span class="comment"># This is an evaluator</span></div><div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;                entry[<span class="stringliteral">&quot;qr_var&quot;</span>] = <span class="keywordtype">None</span></div><div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;                <span class="comment"># Store a list of the FunctionSpace objects for which</span></div><div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;                <span class="comment"># these basis functions are to be evaluated</span></div><div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;                entry[<span class="stringliteral">&quot;nodal_fspaces&quot;</span>] = [items[0] <span class="keywordflow">for</span> items <span class="keywordflow">in</span></div><div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;                                          call.eval_targets.values()]</div><div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;                <span class="keywordflow">raise</span> InternalError(<span class="stringliteral">&quot;Unrecognised evaluator shape: &#39;{0}&#39;. &quot;</span></div><div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;                                    <span class="stringliteral">&quot;Should be one of {1}&quot;</span>.format(</div><div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;                                        call.eval_shape,</div><div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;                                        VALID_EVALUATOR_SHAPES))</div><div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;</div><div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;            <span class="comment"># Add our newly-constructed dict object to the list describing</span></div><div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;            <span class="comment"># the required basis and/or differential basis functions for</span></div><div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;            <span class="comment"># this Invoke.</span></div><div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;            <span class="keywordflow">if</span> fsd.requires_basis:</div><div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;                entry[<span class="stringliteral">&quot;type&quot;</span>] = <span class="stringliteral">&quot;basis&quot;</span></div><div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;                self._basis_fns.append(entry)</div><div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;            <span class="keywordflow">if</span> fsd.requires_diff_basis:</div><div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;                <span class="comment"># Take a shallow copy of the dict and just modify the</span></div><div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;                <span class="comment"># &#39;type&#39; of the basis function it describes (this works</span></div><div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;                <span class="comment"># because the &#39;type&#39; entry is a primitive type [str]).</span></div><div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;                diff_entry = entry.copy()</div><div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;                diff_entry[<span class="stringliteral">&quot;type&quot;</span>] = <span class="stringliteral">&quot;diff-basis&quot;</span></div><div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;                self._basis_fns.append(diff_entry)</div><div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;</div><div class="line"><a name="l02425"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a791303926010438cc25ac3aa522d2698"> 2425</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a791303926010438cc25ac3aa522d2698">declare_qr</a>(self, parent):</div><div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;<span class="stringliteral">        Create the declarations for any quadrature objects passed</span></div><div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;<span class="stringliteral">        in to an invoke. These are added as children of the supplied</span></div><div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;<span class="stringliteral">        parent node.</span></div><div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;<span class="stringliteral">        :param parent: the node in the f2pygen AST that will be the</span></div><div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;<span class="stringliteral">                       parent of all of the declarations (i.e. the</span></div><div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;<span class="stringliteral">                       PSy-layer subroutine)</span></div><div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;<span class="stringliteral">        :type parent: :py:class:`psyclone.f2pygen.BaseGen`</span></div><div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> TypeDeclGen</div><div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;        <span class="comment"># Create a single declaration for each quadrature type</span></div><div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;        <span class="keywordflow">for</span> shape <span class="keywordflow">in</span> VALID_QUADRATURE_SHAPES:</div><div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;            <span class="keywordflow">if</span> shape <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a8b4af5b307d5584cc3775ed0bd8f93b0">_qr_vars</a> <span class="keywordflow">and</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a8b4af5b307d5584cc3775ed0bd8f93b0">_qr_vars</a>[shape]:</div><div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;                <span class="comment"># The PSy-layer routine is passed objects of</span></div><div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;                <span class="comment"># quadrature_* type</span></div><div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;                parent.add(</div><div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;                    TypeDeclGen(parent,</div><div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;                                datatype=QUADRATURE_TYPE_MAP[shape][<span class="stringliteral">&quot;type&quot;</span>],</div><div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;                                entity_decls=self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a8b4af5b307d5584cc3775ed0bd8f93b0">_qr_vars</a>[shape],</div><div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;                                intent=<span class="stringliteral">&quot;in&quot;</span>))</div><div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;                <span class="comment"># For each of these we&#39;ll need a corresponding proxy, use</span></div><div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;                <span class="comment"># our namespace manager to avoid clashes...</span></div><div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;                var_names = []</div><div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;                <span class="keywordflow">for</span> var <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a8b4af5b307d5584cc3775ed0bd8f93b0">_qr_vars</a>[shape]:</div><div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;                    var_names.append(</div><div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;                        self._name_space_manager.create_name(</div><div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;                            root_name=var+<span class="stringliteral">&quot;_proxy&quot;</span>, context=<span class="stringliteral">&quot;PSyVars&quot;</span>,</div><div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;                            label=var+<span class="stringliteral">&quot;_proxy&quot;</span>))</div><div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;                parent.add(</div><div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;                    TypeDeclGen(</div><div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;                        parent,</div><div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;                        datatype=QUADRATURE_TYPE_MAP[shape][<span class="stringliteral">&quot;proxy_type&quot;</span>],</div><div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;                        entity_decls=var_names))</div><div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;</div><div class="line"><a name="l02461"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#aa9bc9c611ed3035d6922d41fc069c142"> 2461</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#aa9bc9c611ed3035d6922d41fc069c142">initialise_basis_fns</a>(self, parent):</div><div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;<span class="stringliteral">        Create the declarations and assignments required for the</span></div><div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;<span class="stringliteral">        basis-functions required by an invoke. These are added as children</span></div><div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;<span class="stringliteral">        of the supplied parent node in the AST.</span></div><div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;<span class="stringliteral">        :param parent: the node in the f2pygen AST that will be the</span></div><div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;<span class="stringliteral">                       parent of all of the declarations and assignments.</span></div><div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;<span class="stringliteral">        :type parent: :py:class:`psyclone.f2pygen.SubroutineGen`</span></div><div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;<span class="stringliteral">        :raises InternalError: if an invalid entry is encountered in the \</span></div><div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;<span class="stringliteral">                               self._basis_fns list.</span></div><div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> CommentGen, AssignGen, DeclGen, \</div><div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;            AllocateGen, UseGen</div><div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;        var_dim_list = []</div><div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;        basis_declarations = []</div><div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;        op_name_list = []</div><div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;</div><div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;        <span class="comment"># We need BASIS and/or DIFF_BASIS if any kernel requires quadrature</span></div><div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;        <span class="comment"># or an evaluator</span></div><div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a8b4af5b307d5584cc3775ed0bd8f93b0">_qr_vars</a> <span class="keywordflow">or</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#adc23cd19f80124ec95807dc831a95863">_eval_targets</a>:</div><div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;            parent.add(UseGen(parent, name=<span class="stringliteral">&quot;function_space_mod&quot;</span>,</div><div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;                              only=<span class="keyword">True</span>,</div><div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;                              funcnames=[<span class="stringliteral">&quot;BASIS&quot;</span>, <span class="stringliteral">&quot;DIFF_BASIS&quot;</span>]))</div><div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;</div><div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a8b4af5b307d5584cc3775ed0bd8f93b0">_qr_vars</a>:</div><div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;            parent.add(CommentGen(parent, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;            parent.add(CommentGen(parent, <span class="stringliteral">&quot; Look-up quadrature variables&quot;</span>))</div><div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;            parent.add(CommentGen(parent, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;</div><div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;            <span class="comment"># Look-up the module- and type-names from the QUADRATURE_TYPE_MAP</span></div><div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;            <span class="keywordflow">for</span> shp <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a8b4af5b307d5584cc3775ed0bd8f93b0">_qr_vars</a>:</div><div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;                parent.add(UseGen(parent,</div><div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;                                  name=QUADRATURE_TYPE_MAP[shp][<span class="stringliteral">&quot;module&quot;</span>],</div><div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;                                  only=<span class="keyword">True</span>,</div><div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;                                  funcnames=[</div><div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;                                      QUADRATURE_TYPE_MAP[shp][<span class="stringliteral">&quot;type&quot;</span>],</div><div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;                                      QUADRATURE_TYPE_MAP[shp][<span class="stringliteral">&quot;proxy_type&quot;</span>]]))</div><div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a8f99f6e109a53abede33fdfb25a2eb76">_initialise_xyz_qr</a>(parent)</div><div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#ac43ff1a1fcf0c08d0c2f59a23c8ced5f">_initialise_xyoz_qr</a>(parent)</div><div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#aa66ed0e51d25c095cd5bdcf00f222ba3">_initialise_xoyoz_qr</a>(parent)</div><div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;</div><div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#adc23cd19f80124ec95807dc831a95863">_eval_targets</a>:</div><div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;            parent.add(CommentGen(parent, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;            parent.add(CommentGen(parent,</div><div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;                                  <span class="stringliteral">&quot; Initialise evaluator-related quantities &quot;</span></div><div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;                                  <span class="stringliteral">&quot;for the target function spaces&quot;</span>))</div><div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;            parent.add(CommentGen(parent, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;</div><div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;        <span class="keywordflow">for</span> (fspace, arg) <span class="keywordflow">in</span> self._eval_targets.values():</div><div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;            <span class="comment"># We need the list of nodes for each unique FS upon which we need</span></div><div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;            <span class="comment"># to evaluate basis/diff-basis functions</span></div><div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;            nodes_name = <span class="stringliteral">&quot;nodes_&quot;</span> + fspace.mangled_name</div><div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;            parent.add(AssignGen(</div><div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;                parent, lhs=nodes_name,</div><div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;                rhs=<span class="stringliteral">&quot;%&quot;</span>.join([arg.proxy_name_indexed, arg.ref_name(fspace),</div><div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;                              <span class="stringliteral">&quot;get_nodes()&quot;</span>]),</div><div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;                pointer=<span class="keyword">True</span>))</div><div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;            parent.add(DeclGen(parent, datatype=<span class="stringliteral">&quot;real&quot;</span>, kind=<span class="stringliteral">&quot;r_def&quot;</span>,</div><div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;                               pointer=<span class="keyword">True</span>,</div><div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;                               entity_decls=[nodes_name+<span class="stringliteral">&quot;(:,:) =&gt; null()&quot;</span>]))</div><div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;</div><div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a06f089ee8ad2d5770a0db66f36703e24">_basis_fns</a>:</div><div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;            parent.add(CommentGen(parent, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;            parent.add(CommentGen(parent, <span class="stringliteral">&quot; Allocate basis/diff-basis arrays&quot;</span>))</div><div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;            parent.add(CommentGen(parent, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;</div><div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;        <span class="comment"># Loop over the list of dicts describing each basis function</span></div><div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;        <span class="comment"># required by this Invoke.</span></div><div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;        <span class="keywordflow">for</span> basis_fn <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a06f089ee8ad2d5770a0db66f36703e24">_basis_fns</a>:</div><div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;            <span class="comment"># Get the extent of the first dimension of the basis array and</span></div><div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;            <span class="comment"># store whether we have a basis or a differential basis function.</span></div><div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;            <span class="comment"># Currently there are only those two possible types of basis</span></div><div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;            <span class="comment"># function and we store which we have in is_diff_basis. Should</span></div><div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;            <span class="comment"># further basis-function types be added in the future then the if</span></div><div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;            <span class="comment"># blocks that use if_diff_basis further down must be updated.</span></div><div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;            <span class="keywordflow">if</span> basis_fn[<span class="stringliteral">&#39;type&#39;</span>] == <span class="stringliteral">&quot;basis&quot;</span>:</div><div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;                first_dim = basis_first_dim_name(basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>])</div><div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;                dim_space = <span class="stringliteral">&quot;get_dim_space()&quot;</span></div><div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;                is_diff_basis = <span class="keyword">False</span></div><div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;            <span class="keywordflow">elif</span> basis_fn[<span class="stringliteral">&#39;type&#39;</span>] == <span class="stringliteral">&quot;diff-basis&quot;</span>:</div><div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;                first_dim = diff_basis_first_dim_name(basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>])</div><div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;                dim_space = <span class="stringliteral">&quot;get_dim_space_diff()&quot;</span></div><div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;                is_diff_basis = <span class="keyword">True</span></div><div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;                <span class="keywordflow">raise</span> InternalError(</div><div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;                    <span class="stringliteral">&quot;Unrecognised type of basis function: &#39;{0}&#39;. Should be &quot;</span></div><div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;                    <span class="stringliteral">&quot;either &#39;basis&#39; or &#39;diff-basis&#39;.&quot;</span>.format(basis_fn[<span class="stringliteral">&#39;type&#39;</span>]))</div><div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;</div><div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;            <span class="keywordflow">if</span> first_dim <span class="keywordflow">not</span> <span class="keywordflow">in</span> var_dim_list:</div><div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;                var_dim_list.append(first_dim)</div><div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;                rhs = <span class="stringliteral">&quot;%&quot;</span>.join([basis_fn[<span class="stringliteral">&quot;arg&quot;</span>].proxy_name_indexed,</div><div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;                                basis_fn[<span class="stringliteral">&quot;arg&quot;</span>].ref_name(basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>]),</div><div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;                                dim_space])</div><div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;                parent.add(AssignGen(parent, lhs=first_dim, rhs=rhs))</div><div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;</div><div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;            <span class="keywordflow">if</span> basis_fn[<span class="stringliteral">&quot;shape&quot;</span>] <span class="keywordflow">in</span> VALID_QUADRATURE_SHAPES:</div><div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;</div><div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;                <span class="keywordflow">if</span> is_diff_basis:</div><div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;                    op_name = get_fs_operator_name(<span class="stringliteral">&quot;gh_diff_basis&quot;</span>,</div><div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;                                                   basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>],</div><div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;                                                   qr_var=basis_fn[<span class="stringliteral">&quot;qr_var&quot;</span>])</div><div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;                    op_name = get_fs_operator_name(<span class="stringliteral">&quot;gh_basis&quot;</span>,</div><div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;                                                   basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>],</div><div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;                                                   qr_var=basis_fn[<span class="stringliteral">&quot;qr_var&quot;</span>])</div><div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;                <span class="keywordflow">if</span> op_name <span class="keywordflow">in</span> op_name_list:</div><div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;                    <span class="keywordflow">continue</span></div><div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;                <span class="comment"># We haven&#39;t seen a basis with this name before so</span></div><div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;                <span class="comment"># need to declare it and add allocate statement</span></div><div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;                op_name_list.append(op_name)</div><div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;</div><div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;                <span class="comment"># Dimensionality of the basis arrays depends on the</span></div><div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;                <span class="comment"># type of quadrature...</span></div><div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;                alloc_args = qr_basis_alloc_args(first_dim, basis_fn)</div><div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;                parent.add(</div><div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;                    AllocateGen(parent, op_name+<span class="stringliteral">&quot;(&quot;</span>+<span class="stringliteral">&quot;, &quot;</span>.join(alloc_args)+<span class="stringliteral">&quot;)&quot;</span>))</div><div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;                <span class="comment"># Add basis function variable to list to declare later.</span></div><div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;                <span class="comment"># We use the length of alloc_args to determine how</span></div><div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;                <span class="comment"># many dimensions this array has.</span></div><div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;                basis_declarations.append(</div><div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;                    op_name+<span class="stringliteral">&quot;(&quot;</span>+<span class="stringliteral">&quot;,&quot;</span>.join([<span class="stringliteral">&quot;:&quot;</span>]*len(alloc_args))+<span class="stringliteral">&quot;)&quot;</span>)</div><div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;</div><div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;            <span class="keywordflow">elif</span> basis_fn[<span class="stringliteral">&quot;shape&quot;</span>].lower() == <span class="stringliteral">&quot;gh_evaluator&quot;</span>:</div><div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;                <span class="comment"># This is an evaluator and thus may be required on more than</span></div><div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;                <span class="comment"># one function space</span></div><div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;                <span class="keywordflow">for</span> target_space <span class="keywordflow">in</span> basis_fn[<span class="stringliteral">&quot;nodal_fspaces&quot;</span>]:</div><div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;                    <span class="keywordflow">if</span> is_diff_basis:</div><div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;                        op_name = get_fs_operator_name(</div><div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;                            <span class="stringliteral">&quot;gh_diff_basis&quot;</span>, basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>],</div><div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;                            qr_var=basis_fn[<span class="stringliteral">&quot;qr_var&quot;</span>],</div><div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;                            on_space=target_space)</div><div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;                    <span class="keywordflow">else</span>:</div><div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;                        op_name = get_fs_operator_name(</div><div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;                            <span class="stringliteral">&quot;gh_basis&quot;</span>, basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>],</div><div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;                            qr_var=basis_fn[<span class="stringliteral">&quot;qr_var&quot;</span>],</div><div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;                            on_space=target_space)</div><div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;                    <span class="keywordflow">if</span> op_name <span class="keywordflow">in</span> op_name_list:</div><div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;                        <span class="keywordflow">continue</span></div><div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;                    <span class="comment"># We haven&#39;t seen a basis with this name before so</span></div><div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;                    <span class="comment"># need to declare it and add allocate statement</span></div><div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;                    op_name_list.append(op_name)</div><div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;</div><div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;                    ndf_nodal_name = get_fs_ndf_name(target_space)</div><div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;                    alloc_args_str = <span class="stringliteral">&quot;, &quot;</span>.join(</div><div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;                        [first_dim, get_fs_ndf_name(basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>]),</div><div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;                         ndf_nodal_name])</div><div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;                    parent.add(AllocateGen(parent,</div><div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;                                           op_name+<span class="stringliteral">&quot;(&quot;</span>+alloc_args_str+<span class="stringliteral">&quot;)&quot;</span>))</div><div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;                    <span class="comment"># add basis function variable to list to declare later</span></div><div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;                    basis_declarations.append(op_name+<span class="stringliteral">&quot;(:,:,:)&quot;</span>)</div><div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;                <span class="keywordflow">raise</span> InternalError(</div><div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;                    <span class="stringliteral">&quot;Unrecognised evaluator shape: &#39;{0}&#39;. Should be one of &quot;</span></div><div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;                    <span class="stringliteral">&quot;{1}&quot;</span>.format(basis_fn[<span class="stringliteral">&quot;shape&quot;</span>], VALID_EVALUATOR_SHAPES))</div><div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;</div><div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;        <span class="keywordflow">if</span> var_dim_list:</div><div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;            <span class="comment"># declare dim and diff_dim for all function spaces</span></div><div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;            parent.add(DeclGen(parent, datatype=<span class="stringliteral">&quot;integer&quot;</span>,</div><div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;                               entity_decls=var_dim_list))</div><div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;        <span class="keywordflow">if</span> basis_declarations:</div><div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;            <span class="comment"># declare the basis function arrays</span></div><div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;            parent.add(DeclGen(parent, datatype=<span class="stringliteral">&quot;real&quot;</span>,</div><div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;                               allocatable=<span class="keyword">True</span>,</div><div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;                               kind=<span class="stringliteral">&quot;r_def&quot;</span>,</div><div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;                               entity_decls=basis_declarations))</div><div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;</div><div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;    <span class="keyword">def </span>_initialise_xyz_qr(self, parent):</div><div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;<span class="stringliteral">        Add in the initialisation of variables needed for XYZ</span></div><div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;<span class="stringliteral">        quadrature</span></div><div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;<span class="stringliteral">        :param parent: the node in the AST representing the PSy subroutine</span></div><div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;<span class="stringliteral">                       in which to insert the initialisation</span></div><div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;<span class="stringliteral">        :type parent: :py:class:``psyclone.f2pygen.SubroutineGen`</span></div><div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;        <span class="comment"># This shape is not yet supported so we do nothing</span></div><div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;        <span class="keywordflow">return</span></div><div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;</div><div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;    <span class="keyword">def </span>_initialise_xyoz_qr(self, parent):</div><div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;<span class="stringliteral">        Add in the initialisation of variables needed for XYoZ</span></div><div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;<span class="stringliteral">        quadrature</span></div><div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;<span class="stringliteral">        :param parent: the node in the AST representing the PSy subroutine</span></div><div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;<span class="stringliteral">                       in which to insert the initialisation</span></div><div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;<span class="stringliteral">        :type parent: :py:class:``psyclone.f2pygen.SubroutineGen`</span></div><div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> AssignGen, DeclGen</div><div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;</div><div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;        <span class="keywordflow">if</span> <span class="stringliteral">&quot;gh_quadrature_xyoz&quot;</span> <span class="keywordflow">not</span> <span class="keywordflow">in</span> self._qr_vars:</div><div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;            <span class="keywordflow">return</span></div><div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;</div><div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;        qr_vars = [<span class="stringliteral">&quot;np_xy&quot;</span>, <span class="stringliteral">&quot;np_z&quot;</span>]</div><div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;        qr_ptr_vars = [<span class="stringliteral">&quot;weights_xy&quot;</span>, <span class="stringliteral">&quot;weights_z&quot;</span>]</div><div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;</div><div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;        <span class="keywordflow">for</span> qr_arg_name <span class="keywordflow">in</span> self._qr_vars[<span class="stringliteral">&quot;gh_quadrature_xyoz&quot;</span>]:</div><div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;</div><div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;            <span class="comment"># We generate unique names for the integers holding the numbers</span></div><div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;            <span class="comment"># of quadrature points by appending the name of the quadrature</span></div><div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;            <span class="comment"># argument</span></div><div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;            parent.add(</div><div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;                DeclGen(</div><div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;                    parent, datatype=<span class="stringliteral">&quot;integer&quot;</span>,</div><div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;                    entity_decls=[name+<span class="stringliteral">&quot;_&quot;</span>+qr_arg_name <span class="keywordflow">for</span> name <span class="keywordflow">in</span> qr_vars]))</div><div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;            decl_list = [name+<span class="stringliteral">&quot;_&quot;</span>+qr_arg_name+<span class="stringliteral">&quot;(:) =&gt; null()&quot;</span></div><div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;                         <span class="keywordflow">for</span> name <span class="keywordflow">in</span> qr_ptr_vars]</div><div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;            parent.add(</div><div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;                DeclGen(parent, datatype=<span class="stringliteral">&quot;real&quot;</span>, pointer=<span class="keyword">True</span>,</div><div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;                        kind=<span class="stringliteral">&quot;r_def&quot;</span>, entity_decls=decl_list))</div><div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;            <span class="comment"># Get the quadrature proxy</span></div><div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;            proxy_name = qr_arg_name + <span class="stringliteral">&quot;_proxy&quot;</span></div><div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;            parent.add(</div><div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;                AssignGen(parent, lhs=proxy_name,</div><div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;                          rhs=qr_arg_name+<span class="stringliteral">&quot;%&quot;</span>+<span class="stringliteral">&quot;get_quadrature_proxy()&quot;</span>))</div><div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;            <span class="comment"># Number of points in each dimension</span></div><div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;            <span class="keywordflow">for</span> qr_var <span class="keywordflow">in</span> qr_vars:</div><div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;                parent.add(</div><div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;                    AssignGen(parent, lhs=qr_var+<span class="stringliteral">&quot;_&quot;</span>+qr_arg_name,</div><div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;                              rhs=proxy_name+<span class="stringliteral">&quot;%&quot;</span>+qr_var))</div><div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;            <span class="comment"># Pointers to the weights arrays</span></div><div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;            <span class="keywordflow">for</span> qr_var <span class="keywordflow">in</span> qr_ptr_vars:</div><div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;                parent.add(</div><div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;                    AssignGen(parent, pointer=<span class="keyword">True</span>,</div><div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;                              lhs=qr_var+<span class="stringliteral">&quot;_&quot;</span>+qr_arg_name,</div><div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;                              rhs=proxy_name+<span class="stringliteral">&quot;%&quot;</span>+qr_var))</div><div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;</div><div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;    <span class="keyword">def </span>_initialise_xoyoz_qr(self, parent):</div><div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;<span class="stringliteral">        Add in the initialisation of variables needed for XoYoZ</span></div><div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;<span class="stringliteral">        quadrature</span></div><div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;<span class="stringliteral">        :param parent: the node in the AST representing the PSy subroutine</span></div><div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;<span class="stringliteral">                       in which to insert the initialisation</span></div><div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;<span class="stringliteral">        :type parent: :py:class:``psyclone.f2pygen.SubroutineGen`</span></div><div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;        <span class="comment"># This shape is not yet supported so we do nothing</span></div><div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;        <span class="keywordflow">return</span></div><div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;</div><div class="line"><a name="l02701"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#ad8479e5a39b535cf5d2d30962b138717"> 2701</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#ad8479e5a39b535cf5d2d30962b138717">compute_basis_fns</a>(self, parent):</div><div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;<span class="stringliteral">        Generates the necessary Fortran to compute the values of</span></div><div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;<span class="stringliteral">        any basis/diff-basis arrays required</span></div><div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;<span class="stringliteral">        :param parent: Node in the f2pygen AST which will be the parent</span></div><div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;<span class="stringliteral">                       of the assignments created in this routine</span></div><div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;<span class="stringliteral">        :type parent: :py:class:`psyclone.f2pygen.SubroutineGen`</span></div><div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> CommentGen, AssignGen, CallGen, DoGen, \</div><div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;            DeclGen</div><div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;        loop_var_list = set()</div><div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;        op_name_list = []</div><div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;        <span class="comment"># add calls to compute the values of any basis arrays</span></div><div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;        <span class="keywordflow">if</span> self._basis_fns:</div><div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;            parent.add(CommentGen(parent, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;            parent.add(CommentGen(parent, <span class="stringliteral">&quot; Compute basis/diff-basis arrays&quot;</span>))</div><div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;            parent.add(CommentGen(parent, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;</div><div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;        <span class="keywordflow">for</span> basis_fn <span class="keywordflow">in</span> self._basis_fns:</div><div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;</div><div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;            <span class="comment"># Currently there are only two possible types of basis function</span></div><div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;            <span class="comment"># and we store which we have in is_diff_basis. If support for</span></div><div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;            <span class="comment"># other basis function types is added in future then the if-blocks</span></div><div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;            <span class="comment"># (further down) that use is_diff_basis will have to be changed.</span></div><div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;            <span class="keywordflow">if</span> basis_fn[<span class="stringliteral">&quot;type&quot;</span>] == <span class="stringliteral">&quot;diff-basis&quot;</span>:</div><div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;                is_diff_basis = <span class="keyword">True</span></div><div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;            <span class="keywordflow">elif</span> basis_fn[<span class="stringliteral">&quot;type&quot;</span>] == <span class="stringliteral">&quot;basis&quot;</span>:</div><div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;                is_diff_basis = <span class="keyword">False</span></div><div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;                <span class="keywordflow">raise</span> InternalError(</div><div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;                    <span class="stringliteral">&quot;Unrecognised type of basis function: &#39;{0}&#39;. Expected one &quot;</span></div><div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;                    <span class="stringliteral">&quot;of &#39;basis&#39; or &#39;diff-basis&#39;.&quot;</span>. format(basis_fn[<span class="stringliteral">&quot;type&quot;</span>]))</div><div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;            <span class="keywordflow">if</span> basis_fn[<span class="stringliteral">&quot;shape&quot;</span>] <span class="keywordflow">in</span> VALID_QUADRATURE_SHAPES:</div><div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;                <span class="keywordflow">if</span> is_diff_basis:</div><div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;                    op_name = get_fs_operator_name(<span class="stringliteral">&quot;gh_diff_basis&quot;</span>,</div><div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;                                                   basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>],</div><div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;                                                   qr_var=basis_fn[<span class="stringliteral">&quot;qr_var&quot;</span>])</div><div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;                    op_name = get_fs_operator_name(<span class="stringliteral">&quot;gh_basis&quot;</span>,</div><div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;                                                   basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>],</div><div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;                                                   qr_var=basis_fn[<span class="stringliteral">&quot;qr_var&quot;</span>])</div><div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;                <span class="keywordflow">if</span> op_name <span class="keywordflow">in</span> op_name_list:</div><div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;                    <span class="comment"># Jump over any basis arrays we&#39;ve seen before</span></div><div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;                    <span class="keywordflow">continue</span></div><div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;                op_name_list.append(op_name)</div><div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;</div><div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;                <span class="comment"># Create the argument list</span></div><div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;                <span class="keywordflow">if</span> is_diff_basis:</div><div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;                    args = [<span class="stringliteral">&quot;DIFF_BASIS&quot;</span>,</div><div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;                            basis_fn[<span class="stringliteral">&quot;arg&quot;</span>].proxy_name_indexed + <span class="stringliteral">&quot;%&quot;</span> +</div><div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;                            basis_fn[<span class="stringliteral">&quot;arg&quot;</span>].ref_name(basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>]),</div><div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;                            diff_basis_first_dim_name(basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>]),</div><div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;                            get_fs_ndf_name(basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>]), op_name]</div><div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;                    args = [<span class="stringliteral">&quot;BASIS&quot;</span>,</div><div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;                            basis_fn[<span class="stringliteral">&quot;arg&quot;</span>].proxy_name_indexed + <span class="stringliteral">&quot;%&quot;</span> +</div><div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;                            basis_fn[<span class="stringliteral">&quot;arg&quot;</span>].ref_name(basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>]),</div><div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;                            basis_first_dim_name(basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>]),</div><div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;                            get_fs_ndf_name(basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>]), op_name]</div><div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;                <span class="comment"># insert the basis array call</span></div><div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;                parent.add(</div><div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;                    CallGen(parent,</div><div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;                            name=basis_fn[<span class="stringliteral">&quot;qr_var&quot;</span>]+<span class="stringliteral">&quot;%compute_function&quot;</span>,</div><div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;                            args=args))</div><div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;            <span class="keywordflow">elif</span> basis_fn[<span class="stringliteral">&quot;shape&quot;</span>].lower() == <span class="stringliteral">&quot;gh_evaluator&quot;</span>:</div><div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;                <span class="comment"># We have an evaluator. We may need this on more than one</span></div><div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;                <span class="comment"># function space.</span></div><div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;                <span class="keywordflow">for</span> space <span class="keywordflow">in</span> basis_fn[<span class="stringliteral">&quot;nodal_fspaces&quot;</span>]:</div><div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;                    <span class="keywordflow">if</span> is_diff_basis:</div><div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;                        op_name = get_fs_operator_name(<span class="stringliteral">&quot;gh_diff_basis&quot;</span>,</div><div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;                                                       basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>],</div><div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;                                                       on_space=space)</div><div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;                    <span class="keywordflow">else</span>:</div><div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;                        op_name = get_fs_operator_name(<span class="stringliteral">&quot;gh_basis&quot;</span>,</div><div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;                                                       basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>],</div><div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;                                                       on_space=space)</div><div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;                    <span class="keywordflow">if</span> op_name <span class="keywordflow">in</span> op_name_list:</div><div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;                        <span class="comment"># Jump over any basis arrays we&#39;ve seen before</span></div><div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;                        <span class="keywordflow">continue</span></div><div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;                    op_name_list.append(op_name)</div><div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;</div><div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;                    nodal_loop_var = <span class="stringliteral">&quot;df_nodal&quot;</span></div><div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;                    loop_var_list.add(nodal_loop_var)</div><div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;</div><div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;                    <span class="comment"># Loop over dofs of target function space</span></div><div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;                    nodal_dof_loop = DoGen(</div><div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;                        parent, nodal_loop_var, <span class="stringliteral">&quot;1&quot;</span>, get_fs_ndf_name(space))</div><div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;                    parent.add(nodal_dof_loop)</div><div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;</div><div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;                    dof_loop_var = <span class="stringliteral">&quot;df_&quot;</span> + basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>].mangled_name</div><div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;                    loop_var_list.add(dof_loop_var)</div><div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;</div><div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;                    dof_loop = DoGen(nodal_dof_loop, dof_loop_var,</div><div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;                                     <span class="stringliteral">&quot;1&quot;</span>, get_fs_ndf_name(basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>]))</div><div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;                    nodal_dof_loop.add(dof_loop)</div><div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;                    lhs = op_name + <span class="stringliteral">&quot;(:,&quot;</span> + <span class="stringliteral">&quot;df_&quot;</span> + \</div><div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;                        basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>].mangled_name + <span class="stringliteral">&quot;,&quot;</span> + <span class="stringliteral">&quot;df_nodal)&quot;</span></div><div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;                    <span class="keywordflow">if</span> is_diff_basis:</div><div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;                        rhs = <span class="stringliteral">&quot;%&quot;</span>.join(</div><div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;                            [basis_fn[<span class="stringliteral">&quot;arg&quot;</span>].proxy_name_indexed,</div><div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;                             basis_fn[<span class="stringliteral">&quot;arg&quot;</span>].ref_name(basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>]),</div><div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;                             <span class="stringliteral">&quot;call_function(DIFF_BASIS,&quot;</span> + dof_loop_var +</div><div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;                             <span class="stringliteral">&quot;,nodes_&quot;</span> + space.mangled_name +</div><div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;                             <span class="stringliteral">&quot;(:,&quot;</span> + nodal_loop_var + <span class="stringliteral">&quot;))&quot;</span>])</div><div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;                    <span class="keywordflow">else</span>:</div><div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;                        rhs = <span class="stringliteral">&quot;%&quot;</span>.join(</div><div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;                            [basis_fn[<span class="stringliteral">&quot;arg&quot;</span>].proxy_name_indexed,</div><div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;                             basis_fn[<span class="stringliteral">&quot;arg&quot;</span>].ref_name(basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>]),</div><div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;                             <span class="stringliteral">&quot;call_function(BASIS,&quot;</span> + dof_loop_var +</div><div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;                             <span class="stringliteral">&quot;,nodes_&quot;</span> + space.mangled_name +</div><div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;                             <span class="stringliteral">&quot;(:,&quot;</span> + nodal_loop_var + <span class="stringliteral">&quot;))&quot;</span>])</div><div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;                    dof_loop.add(AssignGen(dof_loop, lhs=lhs, rhs=rhs))</div><div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;                <span class="keywordflow">raise</span> InternalError(</div><div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;                    <span class="stringliteral">&quot;Unrecognised shape &#39;{0}&#39; specified for basis function. &quot;</span></div><div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;                    <span class="stringliteral">&quot;Should be one of: {1}&quot;</span>.format(basis_fn[<span class="stringliteral">&#39;shape&#39;</span>],</div><div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;                                                   VALID_EVALUATOR_SHAPES))</div><div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;        <span class="keywordflow">if</span> loop_var_list:</div><div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;            <span class="comment"># Declare any loop variables</span></div><div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;            parent.add(DeclGen(parent, datatype=<span class="stringliteral">&quot;integer&quot;</span>,</div><div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;                               entity_decls=sorted(loop_var_list)))</div><div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;</div><div class="line"><a name="l02824"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a5bb807a88dfeaa83029dbd46de7ffb9d"> 2824</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a5bb807a88dfeaa83029dbd46de7ffb9d">deallocate</a>(self, parent):</div><div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;<span class="stringliteral">        Add code to deallocate all basis/diff-basis function arrays</span></div><div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;<span class="stringliteral">        :param parent: node in the f2pygen AST to which the deallocate</span></div><div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;<span class="stringliteral">                       calls will be added</span></div><div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;<span class="stringliteral">        :type parent: :py:class:`psyclone.f2pygen.SubroutineGen`</span></div><div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> CommentGen, DeallocateGen</div><div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;</div><div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a06f089ee8ad2d5770a0db66f36703e24">_basis_fns</a>:</div><div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;            <span class="comment"># deallocate all allocated basis function arrays</span></div><div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;            parent.add(CommentGen(parent, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;            parent.add(CommentGen(parent, <span class="stringliteral">&quot; Deallocate basis arrays&quot;</span>))</div><div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;            parent.add(CommentGen(parent, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;</div><div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;        func_space_var_names = set()</div><div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;        <span class="keywordflow">for</span> basis_fn <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a06f089ee8ad2d5770a0db66f36703e24">_basis_fns</a>:</div><div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;            <span class="comment"># add the basis array name to the list to use later</span></div><div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;            <span class="keywordflow">if</span> basis_fn[<span class="stringliteral">&quot;type&quot;</span>] == <span class="stringliteral">&quot;basis&quot;</span>:</div><div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;                <span class="keywordflow">for</span> fspace <span class="keywordflow">in</span> basis_fn[<span class="stringliteral">&quot;nodal_fspaces&quot;</span>]:</div><div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;                    op_name = get_fs_operator_name(<span class="stringliteral">&quot;gh_basis&quot;</span>,</div><div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;                                                   basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>],</div><div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;                                                   qr_var=basis_fn[<span class="stringliteral">&quot;qr_var&quot;</span>],</div><div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;                                                   on_space=fspace)</div><div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;                    func_space_var_names.add(op_name)</div><div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;            <span class="keywordflow">elif</span> basis_fn[<span class="stringliteral">&quot;type&quot;</span>] == <span class="stringliteral">&quot;diff-basis&quot;</span>:</div><div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;                <span class="keywordflow">for</span> fspace <span class="keywordflow">in</span> basis_fn[<span class="stringliteral">&quot;nodal_fspaces&quot;</span>]:</div><div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;                    op_name = get_fs_operator_name(<span class="stringliteral">&quot;gh_diff_basis&quot;</span>,</div><div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;                                                   basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>],</div><div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;                                                   qr_var=basis_fn[<span class="stringliteral">&quot;qr_var&quot;</span>],</div><div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;                                                   on_space=fspace)</div><div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;                    func_space_var_names.add(op_name)</div><div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;                <span class="keywordflow">raise</span> InternalError(</div><div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;                    <span class="stringliteral">&quot;Unrecognised type of basis function: &#39;{0}&#39;. Should be &quot;</span></div><div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;                    <span class="stringliteral">&quot;one of &#39;basis&#39; or &#39;diff-basis&#39;.&quot;</span>.format(basis_fn[<span class="stringliteral">&quot;type&quot;</span>]))</div><div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;        <span class="keywordflow">if</span> func_space_var_names:</div><div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;            <span class="comment"># add the required deallocate call</span></div><div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;            parent.add(DeallocateGen(parent, sorted(func_space_var_names)))</div><div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;</div><div class="line"><a name="l02865"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBoundaryConditions.html"> 2865</a></span>&#160;<span class="keyword">class </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBoundaryConditions.html">DynInvokeBoundaryConditions</a>(object):</div><div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;    <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;<span class="stringliteral">    &#39;&#39;&#39;</span></div><div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;    <span class="keyword">def </span>__init__(self, schedule):</div><div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;        <span class="keywordflow">for</span> call <span class="keywordflow">in</span> schedule.calls():</div><div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;            <span class="keywordflow">if</span> call.name.lower() == <span class="stringliteral">&quot;enforce_bc_code&quot;</span>:</div><div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;                <span class="keywordflow">pass</span></div><div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;            <span class="keywordflow">elif</span> call.name.lower() == <span class="stringliteral">&quot;enforce_operator_bc_code&quot;</span>:</div><div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;                <span class="keywordflow">pass</span></div><div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;</div><div class="line"><a name="l02875"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBoundaryConditions.html#a5ed48f5e975178af2fdd05dc6d661b38"> 2875</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBoundaryConditions.html#a5ed48f5e975178af2fdd05dc6d661b38">declarations</a>(self, parent):</div><div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;<span class="stringliteral">        Add declarations for any boundary-dofs arrays required by an Invoke.</span></div><div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;<span class="stringliteral">        :param parent: node in PSyIR to which to add declarations.</span></div><div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;<span class="stringliteral">        :type parent: :py:class:`psyclone.psyGen.Node`</span></div><div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;</div><div class="line"><a name="l02883"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBoundaryConditions.html#a7608ba98dd9536f5a31265c436bcb2a7"> 2883</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBoundaryConditions.html#a7608ba98dd9536f5a31265c436bcb2a7">initialise</a>(self, parent):</div><div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;<span class="stringliteral">        Initialise any boundary-dofs arrays required by an Invoke.</span></div><div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;<span class="stringliteral">        :param parent: node in PSyIR to which to add declarations.</span></div><div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;<span class="stringliteral">        :type parent: :py:class:`psyclone.psyGen.Node`</span></div><div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;</div><div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;</div><div class="line"><a name="l02892"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html"> 2892</a></span>&#160;<span class="keyword">class </span>DynInvoke(Invoke):</div><div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;    <span class="stringliteral">&#39;&#39;&#39;The Dynamo specific invoke class. This passes the Dynamo</span></div><div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;<span class="stringliteral">    specific schedule class to the base class so it creates the one we</span></div><div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;<span class="stringliteral">    require.  Also overrides the gen_code method so that we generate</span></div><div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;<span class="stringliteral">    dynamo specific invocation code.</span></div><div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;<span class="stringliteral">    &#39;&#39;&#39;</span></div><div class="line"><a name="l02899"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#a97084217eb37cd1528c75dccf23e0042"> 2899</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#a97084217eb37cd1528c75dccf23e0042">__init__</a>(self, alg_invocation, idx):</div><div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;<span class="stringliteral">        :param alg_invocation: node in the AST describing the invoke call</span></div><div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;<span class="stringliteral">        :type alg_invocation: :py:class:`psyclone.parse.InvokeCall`</span></div><div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;<span class="stringliteral">        :param int idx: the position of the invoke in the list of invokes \</span></div><div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;<span class="stringliteral">                        contained in the Algorithm</span></div><div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;<span class="stringliteral">        :raises GenerationError: if integer reductions are required in the \</span></div><div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;<span class="stringliteral">                                 psy-layer</span></div><div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;        <span class="keywordflow">if</span> <span class="keyword">False</span>:  <span class="comment"># pylint: disable=using-constant-test</span></div><div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#a6c94745504665e2cddcf0967b3144305">_schedule</a> = <a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynSchedule.html">DynSchedule</a>(<span class="keywordtype">None</span>)  <span class="comment"># for pyreverse</span></div><div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;        reserved_names_list = []</div><div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;        reserved_names_list.extend(STENCIL_MAPPING.values())</div><div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;        reserved_names_list.extend(VALID_STENCIL_DIRECTIONS)</div><div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;        reserved_names_list.extend([<span class="stringliteral">&quot;omp_get_thread_num&quot;</span>,</div><div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;                                    <span class="stringliteral">&quot;omp_get_max_threads&quot;</span>])</div><div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;        Invoke.__init__(self, alg_invocation, idx, DynSchedule,</div><div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;                        reserved_names=reserved_names_list)</div><div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;</div><div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;        <span class="comment"># The baseclass works out the algorithm code&#39;s unique argument</span></div><div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;        <span class="comment"># list and stores it in the self._alg_unique_args</span></div><div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;        <span class="comment"># list. However, the base class currently ignores any stencil and qr</span></div><div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;        <span class="comment"># arguments so we need to add them in.</span></div><div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;</div><div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;        <span class="comment"># initialise our invoke stencil information</span></div><div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#a8654de66b59a48553c1833ae75383f54">stencil</a> = <a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil.html">DynInvokeStencil</a>(self.<a class="code" href="classpsyclone_1_1psyGen_1_1Invoke.html#afff15d0cfff3adb378deeab161de6875">schedule</a>)</div><div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;</div><div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;        <span class="comment"># Initialise the object holding all information on the dofmaps</span></div><div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;        <span class="comment"># required by this invoke.</span></div><div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#ac9089cde86f6e4a66f225e69a9736908">dofmaps</a> = <a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeDofmaps.html">DynInvokeDofmaps</a>(self.<a class="code" href="classpsyclone_1_1psyGen_1_1Invoke.html#afff15d0cfff3adb378deeab161de6875">schedule</a>)</div><div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;</div><div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;        <span class="comment"># Initialise the object holding all information on the column-</span></div><div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;        <span class="comment"># -matrix assembly operators required by this invoke.</span></div><div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#ae55d826e7486407d39d8a32434bbf07c">cma_ops</a> = <a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeCMAOperators.html">DynInvokeCMAOperators</a>(self.<a class="code" href="classpsyclone_1_1psyGen_1_1Invoke.html#afff15d0cfff3adb378deeab161de6875">schedule</a>)</div><div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;</div><div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;        <span class="comment"># Initialise the object holding all information on the quadrature</span></div><div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;        <span class="comment"># and/or evaluators required by this invoke</span></div><div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#a20571a324859fc91f788347ffcb7330d">evaluators</a> = <a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html">DynInvokeBasisFns</a>(self.<a class="code" href="classpsyclone_1_1psyGen_1_1Invoke.html#afff15d0cfff3adb378deeab161de6875">schedule</a>)</div><div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;</div><div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;        <span class="comment"># Initialise the object holding all information related to meshes</span></div><div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;        <span class="comment"># and inter-grid operations</span></div><div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#ae113c77719050f71e438a6f4015d0b9c">meshes</a> = <a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html">DynMeshes</a>(self, self.<a class="code" href="classpsyclone_1_1psyGen_1_1Invoke.html#a1ec704a73a35f61a2afa53950fc4a66b">psy_unique_vars</a>)</div><div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;</div><div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;        <span class="comment"># Initialise the object holding information on any boundary-condition</span></div><div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;        <span class="comment"># kernel calls</span></div><div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#aad132c0d4e187455c08d35538e78c457">boundary_conditions</a> = <a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBoundaryConditions.html">DynInvokeBoundaryConditions</a>(self.<a class="code" href="classpsyclone_1_1psyGen_1_1Invoke.html#afff15d0cfff3adb378deeab161de6875">schedule</a>)</div><div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;</div><div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;        <span class="comment"># extend arg list</span></div><div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;        self._alg_unique_args.extend(self.stencil.unique_alg_vars)</div><div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;</div><div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;        <span class="comment"># adding in qr arguments</span></div><div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#aef9784711c602aa93b7cd18247d485e3">_alg_unique_qr_args</a> = []</div><div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;        <span class="keywordflow">for</span> call <span class="keywordflow">in</span> self.schedule.calls():</div><div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;            <span class="keywordflow">if</span> call.qr_required:</div><div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;                <span class="keywordflow">if</span> call.qr_text <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#aef9784711c602aa93b7cd18247d485e3">_alg_unique_qr_args</a>:</div><div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;                    self._alg_unique_qr_args.append(call.qr_text)</div><div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;        self._alg_unique_args.extend(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#aef9784711c602aa93b7cd18247d485e3">_alg_unique_qr_args</a>)</div><div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;        <span class="comment"># we also need to work out the names to use for the qr</span></div><div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;        <span class="comment"># arguments within the psy layer. These are stored in the</span></div><div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;        <span class="comment"># _psy_unique_qr_vars list</span></div><div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#a88f97e25ac522f7a8e084c7f278df82b">_psy_unique_qr_vars</a> = []</div><div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;        <span class="keywordflow">for</span> call <span class="keywordflow">in</span> self.schedule.calls():</div><div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;            <span class="keywordflow">if</span> call.qr_required:</div><div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;                <span class="keywordflow">if</span> call.qr_name <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#a88f97e25ac522f7a8e084c7f278df82b">_psy_unique_qr_vars</a>:</div><div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;                    self._psy_unique_qr_vars.append(call.qr_name)</div><div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;</div><div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;        <span class="comment"># lastly, add in halo exchange calls and global sums if</span></div><div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;        <span class="comment"># required. We only need to add halo exchange calls for fields</span></div><div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;        <span class="comment"># since operators are assembled in place and scalars don&#39;t</span></div><div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;        <span class="comment"># have halos. We only need to add global sum calls for scalars</span></div><div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;        <span class="comment"># which have a gh_sum access.</span></div><div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;        <span class="keywordflow">if</span> Config.get().distributed_memory:</div><div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;            <span class="comment"># halo exchange calls</span></div><div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;            <span class="keywordflow">for</span> loop <span class="keywordflow">in</span> self.schedule.loops():</div><div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;                loop.create_halo_exchanges()</div><div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;            <span class="comment"># global sum calls</span></div><div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;            <span class="keywordflow">for</span> loop <span class="keywordflow">in</span> self.schedule.loops():</div><div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;                <span class="keywordflow">for</span> scalar <span class="keywordflow">in</span> loop.args_filter(</div><div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;                        arg_types=VALID_SCALAR_NAMES,</div><div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;                        arg_accesses=VALID_REDUCTION_NAMES, unique=<span class="keyword">True</span>):</div><div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;                    <span class="keywordflow">if</span> scalar.type.lower() == <span class="stringliteral">&quot;gh_integer&quot;</span>:</div><div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;                        <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;                            <span class="stringliteral">&quot;Integer reductions are not currently supported &quot;</span></div><div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;                            <span class="stringliteral">&quot;by the LFRic infrastructure. Error found in &quot;</span></div><div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;                            <span class="stringliteral">&quot;Kernel &#39;{0}&#39;, argument &#39;{1}&#39;&quot;</span>.format(</div><div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;                                scalar.call.name, scalar.name))</div><div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;                    global_sum = <a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynGlobalSum.html">DynGlobalSum</a>(scalar, parent=loop.parent)</div><div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;                    loop.parent.children.insert(loop.position+1, global_sum)</div><div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;</div><div class="line"><a name="l02988"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#ae9c00f3b2e12152ef697bd6c70e89f80"> 2988</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#ae9c00f3b2e12152ef697bd6c70e89f80">unique_proxy_declarations</a>(self, datatype, access=None):</div><div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Returns a list of all required proxy declarations for the</span></div><div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;<span class="stringliteral">        specified datatype.  If access is supplied (e.g. &quot;gh_write&quot;)</span></div><div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;<span class="stringliteral">        then only declarations with that access are returned. &#39;&#39;&#39;</span></div><div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;        <span class="keywordflow">if</span> datatype <span class="keywordflow">not</span> <span class="keywordflow">in</span> VALID_ARG_TYPE_NAMES:</div><div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;            <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;                <span class="stringliteral">&quot;unique_proxy_declarations called with an invalid datatype. &quot;</span></div><div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;                <span class="stringliteral">&quot;Expected one of &#39;{0}&#39; but found &#39;{1}&#39;&quot;</span>.</div><div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;                format(str(VALID_ARG_TYPE_NAMES), datatype))</div><div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;        <span class="keywordflow">if</span> access <span class="keywordflow">and</span> access <span class="keywordflow">not</span> <span class="keywordflow">in</span> VALID_ACCESS_DESCRIPTOR_NAMES:</div><div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;            <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;                <span class="stringliteral">&quot;unique_proxy_declarations called with an invalid access &quot;</span></div><div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;                <span class="stringliteral">&quot;type. Expected one of &#39;{0}&#39; but got &#39;{1}&#39;&quot;</span>.</div><div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;                format(VALID_ACCESS_DESCRIPTOR_NAMES, access))</div><div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;        declarations = []</div><div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;        <span class="keywordflow">for</span> call <span class="keywordflow">in</span> self.schedule.calls():</div><div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;            <span class="keywordflow">for</span> arg <span class="keywordflow">in</span> call.arguments.args:</div><div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;                <span class="keywordflow">if</span> <span class="keywordflow">not</span> access <span class="keywordflow">or</span> arg.access == access:</div><div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;                    <span class="keywordflow">if</span> arg.text <span class="keywordflow">and</span> arg.type == datatype:</div><div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;                        <span class="keywordflow">if</span> arg.proxy_declaration_name <span class="keywordflow">not</span> <span class="keywordflow">in</span> declarations:</div><div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;                            declarations.append(arg.proxy_declaration_name)</div><div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;        <span class="keywordflow">return</span> declarations</div><div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;</div><div class="line"><a name="l03011"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#a4319b398ff9289af1927513ffb4dd892"> 3011</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#a4319b398ff9289af1927513ffb4dd892">arg_for_funcspace</a>(self, fspace):</div><div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Returns an argument object which is on the requested</span></div><div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;<span class="stringliteral">        function space. Searches through all Kernel calls in this</span></div><div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;<span class="stringliteral">        invoke. Currently the first argument object that is found is</span></div><div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;<span class="stringliteral">        used. Throws an exception if no argument exists. &#39;&#39;&#39;</span></div><div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;        <span class="keywordflow">for</span> kern_call <span class="keywordflow">in</span> self.schedule.calls():</div><div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;            <span class="keywordflow">try</span>:</div><div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;                <span class="keywordflow">return</span> kern_call.arguments.get_arg_on_space(fspace)</div><div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;            <span class="keywordflow">except</span> FieldNotFoundError:</div><div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;                <span class="keywordflow">pass</span></div><div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;        <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;            <span class="stringliteral">&quot;No argument found on &#39;{0}&#39; space&quot;</span>.format(fspace.mangled_name))</div><div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;</div><div class="line"><a name="l03024"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#ad7c703b366986387918a888c33f37d34"> 3024</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#ad7c703b366986387918a888c33f37d34">unique_fss</a>(self):</div><div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Returns the unique function space *objects* over all kernel</span></div><div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;<span class="stringliteral">        calls in this invoke. &#39;&#39;&#39;</span></div><div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;        unique_fs = []</div><div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;        unique_fs_names = []</div><div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;        <span class="keywordflow">for</span> kern_call <span class="keywordflow">in</span> self.schedule.calls():</div><div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;            kern_fss = kern_call.arguments.unique_fss</div><div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;            <span class="keywordflow">for</span> fspace <span class="keywordflow">in</span> kern_fss:</div><div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;                <span class="keywordflow">if</span> fspace.mangled_name <span class="keywordflow">not</span> <span class="keywordflow">in</span> unique_fs_names:</div><div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;                    unique_fs.append(fspace)</div><div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;                    unique_fs_names.append(fspace.mangled_name)</div><div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;        <span class="keywordflow">return</span> unique_fs</div><div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;</div><div class="line"><a name="l03037"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#a75572ca91c2786ed836e6657b2cec4b8"> 3037</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#a75572ca91c2786ed836e6657b2cec4b8">is_coloured</a>(self):</div><div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Returns true if at least one of the loops in the</span></div><div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;<span class="stringliteral">        schedule of this invoke has been coloured &#39;&#39;&#39;</span></div><div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;        <span class="keywordflow">for</span> loop <span class="keywordflow">in</span> self.schedule.loops():</div><div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;            <span class="keywordflow">if</span> loop.loop_type == <span class="stringliteral">&quot;colours&quot;</span>:</div><div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">True</span></div><div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">False</span></div><div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;</div><div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;    @property</div><div class="line"><a name="l03046"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#a8e69798a97d7a7e659386a8e6b932080"> 3046</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#a8e69798a97d7a7e659386a8e6b932080">iterate_over_dofs_only</a>(self):</div><div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;<span class="stringliteral">        :returns: whether or not this Invoke consists only of kernels that \</span></div><div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;<span class="stringliteral">                  iterate over DoFs.</span></div><div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;<span class="stringliteral">        :rtype: bool</span></div><div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;        <span class="keywordflow">for</span> kern_call <span class="keywordflow">in</span> self.schedule.calls():</div><div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;            <span class="keywordflow">if</span> kern_call.iterates_over.lower() != <span class="stringliteral">&quot;dofs&quot;</span>:</div><div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">False</span></div><div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">True</span></div><div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;</div><div class="line"><a name="l03057"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#a519fa7f3c8ff4eeee92d13289a3d613a"> 3057</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#a519fa7f3c8ff4eeee92d13289a3d613a">field_on_space</a>(self, func_space):</div><div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; If a field exists on this space for any kernel in this</span></div><div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;<span class="stringliteral">        invoke then return that field. Otherwise return None. &#39;&#39;&#39;</span></div><div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;        <span class="keywordflow">for</span> kern_call <span class="keywordflow">in</span> self.schedule.calls():</div><div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;            field = <a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#a519fa7f3c8ff4eeee92d13289a3d613a">field_on_space</a>(func_space, kern_call.arguments)</div><div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;            <span class="keywordflow">if</span> field:</div><div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;                <span class="keywordflow">return</span> field</div><div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;        <span class="keywordflow">return</span> <span class="keywordtype">None</span></div><div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;</div><div class="line"><a name="l03066"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#a8ec1949a5d9f3852e2f5d65fe344cdc7"> 3066</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#a8ec1949a5d9f3852e2f5d65fe344cdc7">gen_code</a>(self, parent):</div><div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;<span class="stringliteral">        Generates Dynamo specific invocation code (the subroutine</span></div><div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;<span class="stringliteral">        called by the associated invoke call in the algorithm</span></div><div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;<span class="stringliteral">        layer). This consists of the PSy invocation subroutine and the</span></div><div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;<span class="stringliteral">        declaration of its arguments.</span></div><div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;<span class="stringliteral">        :param parent: The parent node in the AST (of the code to be \</span></div><div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;<span class="stringliteral">                       generated) to which the node describing the PSy \</span></div><div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;<span class="stringliteral">                       subroutine will be added</span></div><div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;<span class="stringliteral">        :type parent: :py:class:`psyclone.f2pygen.ModuleGen`</span></div><div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> SubroutineGen, TypeDeclGen, AssignGen, \</div><div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;            DeclGen, CommentGen</div><div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;        <span class="comment"># Does this Invoke contain only kernels that iterate over dofs?</span></div><div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;        dofs_only = self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#a8e69798a97d7a7e659386a8e6b932080">iterate_over_dofs_only</a></div><div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;</div><div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;        <span class="comment"># Create a namespace manager so we can avoid name clashes</span></div><div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#a5049d82b2420303e6a4207b5f15b5413">_name_space_manager</a> = NameSpaceFactory().create()</div><div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;        <span class="comment"># Create the subroutine</span></div><div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;        invoke_sub = SubroutineGen(parent, name=self.<a class="code" href="classpsyclone_1_1psyGen_1_1Invoke.html#ab6699fa93b458cffc4fa3874e0de2e1b">name</a>,</div><div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;                                   args=self.<a class="code" href="classpsyclone_1_1psyGen_1_1Invoke.html#a7e09c41cafa5d17214833dc23aec52cf">psy_unique_var_names</a> +</div><div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;                                   self.stencil.unique_alg_vars +</div><div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;                                   self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#a88f97e25ac522f7a8e084c7f278df82b">_psy_unique_qr_vars</a>)</div><div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;</div><div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;        <span class="comment"># Add the subroutine argument declarations for real scalars</span></div><div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;        scalar_args = self.<a class="code" href="classpsyclone_1_1psyGen_1_1Invoke.html#a21a4142f2b3d5beac3fbc6ee49a18811">unique_declns_by_intent</a>(<span class="stringliteral">&quot;gh_real&quot;</span>)</div><div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;        <span class="keywordflow">for</span> intent <span class="keywordflow">in</span> FORTRAN_INTENT_NAMES:</div><div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;            <span class="keywordflow">if</span> scalar_args[intent]:</div><div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;                invoke_sub.add(DeclGen(invoke_sub, datatype=<span class="stringliteral">&quot;real&quot;</span>,</div><div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;                                       kind=<span class="stringliteral">&quot;r_def&quot;</span>,</div><div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;                                       entity_decls=scalar_args[intent],</div><div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;                                       intent=intent))</div><div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;</div><div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;        <span class="comment"># Add the subroutine argument declarations for integer scalars</span></div><div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;        scalar_args = self.<a class="code" href="classpsyclone_1_1psyGen_1_1Invoke.html#a21a4142f2b3d5beac3fbc6ee49a18811">unique_declns_by_intent</a>(<span class="stringliteral">&quot;gh_integer&quot;</span>)</div><div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;        <span class="keywordflow">for</span> intent <span class="keywordflow">in</span> FORTRAN_INTENT_NAMES:</div><div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;            <span class="keywordflow">if</span> scalar_args[intent]:</div><div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;                invoke_sub.add(DeclGen(invoke_sub, datatype=<span class="stringliteral">&quot;integer&quot;</span>,</div><div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;                                       entity_decls=scalar_args[intent],</div><div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;                                       intent=intent))</div><div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;</div><div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;        <span class="comment"># declare any stencil arguments</span></div><div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;        self.stencil.declare_unique_alg_vars(invoke_sub)</div><div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;</div><div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;        <span class="comment"># Declare any mesh objects (including those for inter-grid kernels)</span></div><div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;        self.meshes.declarations(invoke_sub)</div><div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;</div><div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;        <span class="comment"># Declare any dofmaps</span></div><div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;        self.dofmaps.declare_dofmaps(invoke_sub)</div><div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;</div><div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;        <span class="comment"># Declare any CMA operators and associated parameters</span></div><div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;        self.cma_ops.declare_cma_ops(invoke_sub)</div><div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;</div><div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;        <span class="comment"># Declare any arrays required for boundary conditions</span></div><div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;        self.boundary_conditions.declarations(invoke_sub)</div><div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;</div><div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;        <span class="comment"># Add the subroutine argument declarations for fields</span></div><div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;        fld_args = self.<a class="code" href="classpsyclone_1_1psyGen_1_1Invoke.html#a21a4142f2b3d5beac3fbc6ee49a18811">unique_declns_by_intent</a>(<span class="stringliteral">&quot;gh_field&quot;</span>)</div><div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;        <span class="keywordflow">for</span> intent <span class="keywordflow">in</span> FORTRAN_INTENT_NAMES:</div><div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;            <span class="keywordflow">if</span> fld_args[intent]:</div><div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;                <span class="keywordflow">if</span> intent == <span class="stringliteral">&quot;out&quot;</span>:</div><div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;                    <span class="comment"># The data part of a field might have intent(out) but</span></div><div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;                    <span class="comment"># in order to preserve the state of the whole derived-type</span></div><div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;                    <span class="comment"># object it must be declared as inout.</span></div><div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;                    fort_intent = <span class="stringliteral">&quot;inout&quot;</span></div><div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;                    fort_intent = intent</div><div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;                invoke_sub.add(TypeDeclGen(invoke_sub, datatype=<span class="stringliteral">&quot;field_type&quot;</span>,</div><div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;                                           entity_decls=fld_args[intent],</div><div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;                                           intent=fort_intent))</div><div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;</div><div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;        <span class="comment"># Add the subroutine argument declarations for operators that</span></div><div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;        <span class="comment"># are read or written (operators are always on discontinuous spaces</span></div><div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;        <span class="comment"># and therefore are never &#39;inc&#39;)</span></div><div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;        op_declarations_dict = self.<a class="code" href="classpsyclone_1_1psyGen_1_1Invoke.html#a21a4142f2b3d5beac3fbc6ee49a18811">unique_declns_by_intent</a>(<span class="stringliteral">&quot;gh_operator&quot;</span>)</div><div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;        <span class="keywordflow">for</span> intent <span class="keywordflow">in</span> FORTRAN_INTENT_NAMES:</div><div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;            <span class="keywordflow">if</span> op_declarations_dict[intent]:</div><div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;                <span class="keywordflow">if</span> intent == <span class="stringliteral">&quot;out&quot;</span>:</div><div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;                    <span class="comment"># The data part of an operator might have intent(out) but</span></div><div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;                    <span class="comment"># in order to preserve the state of the whole derived-type</span></div><div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;                    <span class="comment"># object it must be declared as inout.</span></div><div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;                    fort_intent = <span class="stringliteral">&quot;inout&quot;</span></div><div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;                    fort_intent = intent</div><div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;                invoke_sub.add(</div><div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;                    TypeDeclGen(invoke_sub, datatype=<span class="stringliteral">&quot;operator_type&quot;</span>,</div><div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;                                entity_decls=op_declarations_dict[intent],</div><div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;                                intent=fort_intent))</div><div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;</div><div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;        <span class="comment"># Add subroutine argument declarations for CMA operators that are</span></div><div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;        <span class="comment"># read or written (as with normal/LMA operators, they are never &#39;inc&#39;</span></div><div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;        <span class="comment"># because they are discontinuous)</span></div><div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;        cma_op_declarations_dict = self.<a class="code" href="classpsyclone_1_1psyGen_1_1Invoke.html#a21a4142f2b3d5beac3fbc6ee49a18811">unique_declns_by_intent</a>(</div><div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;            <span class="stringliteral">&quot;gh_columnwise_operator&quot;</span>)</div><div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;        <span class="keywordflow">for</span> intent <span class="keywordflow">in</span> FORTRAN_INTENT_NAMES:</div><div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;            <span class="keywordflow">if</span> cma_op_declarations_dict[intent]:</div><div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;                <span class="keywordflow">if</span> intent == <span class="stringliteral">&quot;out&quot;</span>:</div><div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;                    <span class="comment"># The data part of an operator might have intent(out) but</span></div><div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;                    <span class="comment"># in order to preserve the state of the whole derived-type</span></div><div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;                    <span class="comment"># object it must be declared as inout.</span></div><div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;                    fort_intent = <span class="stringliteral">&quot;inout&quot;</span></div><div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;                    fort_intent = intent</div><div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;                invoke_sub.add(</div><div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;                    TypeDeclGen(invoke_sub,</div><div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;                                datatype=<span class="stringliteral">&quot;columnwise_operator_type&quot;</span>,</div><div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;                                entity_decls=cma_op_declarations_dict[intent],</div><div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;                                intent=fort_intent))</div><div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;</div><div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;        <span class="comment"># Add the subroutine argument declarations for qr (quadrature</span></div><div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;        <span class="comment"># rules)</span></div><div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;        self.evaluators.declare_qr(invoke_sub)</div><div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;</div><div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;        <span class="comment"># declare and initialise proxies for each of the (non-scalar)</span></div><div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;        <span class="comment"># arguments</span></div><div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;        invoke_sub.add(CommentGen(invoke_sub, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;        invoke_sub.add(CommentGen(invoke_sub,</div><div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;                                  <span class="stringliteral">&quot; Initialise field and/or operator proxies&quot;</span>))</div><div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;        invoke_sub.add(CommentGen(invoke_sub, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;        <span class="keywordflow">for</span> arg <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1psyGen_1_1Invoke.html#a1ec704a73a35f61a2afa53950fc4a66b">psy_unique_vars</a>:</div><div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;            <span class="comment"># We don&#39;t have proxies for scalars</span></div><div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;            <span class="keywordflow">if</span> arg.type <span class="keywordflow">in</span> VALID_SCALAR_NAMES:</div><div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;                <span class="keywordflow">continue</span></div><div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;            <span class="keywordflow">if</span> arg.vector_size &gt; 1:</div><div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;                <span class="comment"># the range function below returns values from</span></div><div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;                <span class="comment"># 1 to the vector size which is what we</span></div><div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;                <span class="comment"># require in our Fortran code</span></div><div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;                <span class="keywordflow">for</span> idx <span class="keywordflow">in</span> range(1, arg.vector_size+1):</div><div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;                    invoke_sub.add(</div><div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;                        AssignGen(invoke_sub,</div><div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;                                  lhs=arg.proxy_name+<span class="stringliteral">&quot;(&quot;</span>+str(idx)+<span class="stringliteral">&quot;)&quot;</span>,</div><div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;                                  rhs=arg.name+<span class="stringliteral">&quot;(&quot;</span>+str(idx)+<span class="stringliteral">&quot;)%get_proxy()&quot;</span>))</div><div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;                invoke_sub.add(AssignGen(invoke_sub, lhs=arg.proxy_name,</div><div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;                                         rhs=arg.name+<span class="stringliteral">&quot;%get_proxy()&quot;</span>))</div><div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;</div><div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;        field_proxy_decs = self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#ae9c00f3b2e12152ef697bd6c70e89f80">unique_proxy_declarations</a>(<span class="stringliteral">&quot;gh_field&quot;</span>)</div><div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;        <span class="keywordflow">if</span> len(field_proxy_decs) &gt; 0:</div><div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;            invoke_sub.add(</div><div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;                TypeDeclGen(invoke_sub,</div><div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;                            datatype=<span class="stringliteral">&quot;field_proxy_type&quot;</span>,</div><div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;                            entity_decls=field_proxy_decs))</div><div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;        op_proxy_decs = self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#ae9c00f3b2e12152ef697bd6c70e89f80">unique_proxy_declarations</a>(<span class="stringliteral">&quot;gh_operator&quot;</span>)</div><div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;        <span class="keywordflow">if</span> len(op_proxy_decs) &gt; 0:</div><div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;            invoke_sub.add(</div><div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;                TypeDeclGen(invoke_sub,</div><div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;                            datatype=<span class="stringliteral">&quot;operator_proxy_type&quot;</span>,</div><div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;                            entity_decls=op_proxy_decs))</div><div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;        cma_op_proxy_decs = self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#ae9c00f3b2e12152ef697bd6c70e89f80">unique_proxy_declarations</a>(</div><div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;            <span class="stringliteral">&quot;gh_columnwise_operator&quot;</span>)</div><div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;        <span class="keywordflow">if</span> cma_op_proxy_decs:</div><div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;            invoke_sub.add(</div><div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;                TypeDeclGen(invoke_sub,</div><div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;                            datatype=<span class="stringliteral">&quot;columnwise_operator_proxy_type&quot;</span>,</div><div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;                            entity_decls=cma_op_proxy_decs))</div><div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;</div><div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;        <span class="comment"># Initialise the number of layers (if we are calling one or more</span></div><div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;        <span class="comment"># kernels that iterate over cells)</span></div><div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> dofs_only:</div><div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;            invoke_sub.add(CommentGen(invoke_sub, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;            invoke_sub.add(CommentGen(invoke_sub,</div><div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;                                      <span class="stringliteral">&quot; Initialise number of layers&quot;</span>))</div><div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;            invoke_sub.add(CommentGen(invoke_sub, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;</div><div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;        <span class="comment"># Find the first argument that is not a scalar. Also, if there</span></div><div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;        <span class="comment"># any CMA operators as arguments then keep a reference to one</span></div><div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;        <span class="comment"># of them so that we can look-up the number of columns in the</span></div><div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;        <span class="comment"># mesh using its proxy</span></div><div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;        first_var = <span class="keywordtype">None</span></div><div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;        cma_op = <span class="keywordtype">None</span></div><div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;        <span class="keywordflow">for</span> var <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1psyGen_1_1Invoke.html#a1ec704a73a35f61a2afa53950fc4a66b">psy_unique_vars</a>:</div><div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> first_var <span class="keywordflow">and</span> var.type <span class="keywordflow">not</span> <span class="keywordflow">in</span> VALID_SCALAR_NAMES:</div><div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;                first_var = var</div><div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;            <span class="keywordflow">if</span> var.type == <span class="stringliteral">&quot;gh_columnwise_operator&quot;</span>:</div><div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;                cma_op = var</div><div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> first_var:</div><div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;            <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;                <span class="stringliteral">&quot;Cannot create an Invoke with no field/operator arguments&quot;</span>)</div><div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;</div><div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;        <span class="comment"># We only need the number of layers in the mesh if we are calling</span></div><div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;        <span class="comment"># one or more kernels that iterate over cells</span></div><div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> dofs_only:</div><div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;            <span class="comment"># Use our namespace manager to create a unique name unless</span></div><div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;            <span class="comment"># the context and label match and in this case return the</span></div><div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;            <span class="comment"># previous name</span></div><div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;            nlayers_name = self._name_space_manager.create_name(</div><div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;                root_name=<span class="stringliteral">&quot;nlayers&quot;</span>, context=<span class="stringliteral">&quot;PSyVars&quot;</span>, label=<span class="stringliteral">&quot;nlayers&quot;</span>)</div><div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;            invoke_sub.add(</div><div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;                AssignGen(invoke_sub, lhs=nlayers_name,</div><div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;                          rhs=first_var.proxy_name_indexed + <span class="stringliteral">&quot;%&quot;</span> +</div><div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;                          first_var.ref_name() + <span class="stringliteral">&quot;%get_nlayers()&quot;</span>))</div><div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;            invoke_sub.add(DeclGen(invoke_sub, datatype=<span class="stringliteral">&quot;integer&quot;</span>,</div><div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;                                   entity_decls=[nlayers_name]))</div><div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;</div><div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;        <span class="comment"># Initialise mesh object(s) and all related quantities for any</span></div><div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;        <span class="comment"># inter-grid kernels (number of fine cells per coarse cell etc.)</span></div><div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;        self.meshes.initialise(invoke_sub)</div><div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;</div><div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;        <span class="comment"># If we have one or more CMA operators then we will need the number</span></div><div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;        <span class="comment"># of columns in the mesh</span></div><div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;        <span class="keywordflow">if</span> cma_op:</div><div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;            invoke_sub.add(CommentGen(invoke_sub, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;            invoke_sub.add(CommentGen(invoke_sub,</div><div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;                                      <span class="stringliteral">&quot; Initialise number of cols&quot;</span>))</div><div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;            invoke_sub.add(CommentGen(invoke_sub, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;            ncol_name = self._name_space_manager.create_name(</div><div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;                root_name=<span class="stringliteral">&quot;ncell_2d&quot;</span>, context=<span class="stringliteral">&quot;PSyVars&quot;</span>, label=<span class="stringliteral">&quot;ncell_2d&quot;</span>)</div><div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160;            invoke_sub.add(</div><div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;                AssignGen(invoke_sub, lhs=ncol_name,</div><div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;                          rhs=cma_op.proxy_name_indexed + <span class="stringliteral">&quot;%ncell_2d&quot;</span>))</div><div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;            invoke_sub.add(DeclGen(invoke_sub, datatype=<span class="stringliteral">&quot;integer&quot;</span>,</div><div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;                                   entity_decls=[ncol_name]))</div><div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;</div><div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;        <span class="keywordflow">if</span> self.schedule.reductions(reprod=<span class="keyword">True</span>):</div><div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;            <span class="comment"># we have at least one reproducible reduction so we need</span></div><div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;            <span class="comment"># to know the number of OpenMP threads</span></div><div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;            <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> UseGen</div><div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;            omp_function_name = <span class="stringliteral">&quot;omp_get_max_threads&quot;</span></div><div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;            nthreads_name = self._name_space_manager.create_name(</div><div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;                root_name=<span class="stringliteral">&quot;nthreads&quot;</span>, context=<span class="stringliteral">&quot;PSyVars&quot;</span>, label=<span class="stringliteral">&quot;nthreads&quot;</span>)</div><div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;            invoke_sub.add(UseGen(invoke_sub, name=<span class="stringliteral">&quot;omp_lib&quot;</span>, only=<span class="keyword">True</span>,</div><div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;                                  funcnames=[omp_function_name]))</div><div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;            invoke_sub.add(DeclGen(invoke_sub, datatype=<span class="stringliteral">&quot;integer&quot;</span>,</div><div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;                                   entity_decls=[nthreads_name]))</div><div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;            invoke_sub.add(CommentGen(invoke_sub, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;            invoke_sub.add(CommentGen(</div><div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;                invoke_sub, <span class="stringliteral">&quot; Determine the number of OpenMP threads&quot;</span>))</div><div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;            invoke_sub.add(CommentGen(invoke_sub, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;            invoke_sub.add(AssignGen(invoke_sub, lhs=nthreads_name,</div><div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;                                     rhs=omp_function_name+<span class="stringliteral">&quot;()&quot;</span>))</div><div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;</div><div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;        <span class="comment"># Initialise any stencil maps</span></div><div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;        self.stencil.initialise_stencil_maps(invoke_sub)</div><div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;</div><div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;        <span class="comment"># Initialise dofmaps (one for each function space that is used</span></div><div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;        <span class="comment"># in this invoke)</span></div><div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;        self.dofmaps.initialise_dofmaps(invoke_sub)</div><div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;</div><div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;        <span class="comment"># Initialise CMA operators and associated parameters</span></div><div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;        self.cma_ops.initialise_cma_ops(invoke_sub)</div><div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;</div><div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;        <span class="comment"># Initialise any boundary-condition arrays</span></div><div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;        self.boundary_conditions.initialise(invoke_sub)</div><div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;</div><div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;        var_list = []</div><div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;        <span class="comment"># loop over all unique function spaces used by the kernels in</span></div><div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;        <span class="comment"># this invoke</span></div><div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;        <span class="keywordflow">for</span> function_space <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#ad7c703b366986387918a888c33f37d34">unique_fss</a>():</div><div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;            <span class="comment"># Initialise information associated with this function space.</span></div><div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;            <span class="comment"># If we have 1+ kernels that iterate over cells then we</span></div><div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;            <span class="comment"># will need ndf and undf. If we don&#39;t then we only need undf</span></div><div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;            <span class="comment"># (for the upper bound of the loop over dofs) if we&#39;re not</span></div><div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;            <span class="comment"># doing DM.</span></div><div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> (dofs_only <span class="keywordflow">and</span> Config.get().distributed_memory):</div><div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;                invoke_sub.add(CommentGen(invoke_sub, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;                invoke_sub.add(</div><div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;                    CommentGen(invoke_sub, <span class="stringliteral">&quot; Initialise number of DoFs for &quot;</span> +</div><div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;                               function_space.mangled_name))</div><div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;                invoke_sub.add(CommentGen(invoke_sub, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;            <span class="comment"># Find an argument on this space to use to dereference</span></div><div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;            arg = self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#a4319b398ff9289af1927513ffb4dd892">arg_for_funcspace</a>(function_space)</div><div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;            name = arg.proxy_name_indexed</div><div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;            <span class="comment"># Initialise ndf for this function space and add name to</span></div><div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;            <span class="comment"># list to declare later.</span></div><div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> dofs_only:</div><div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;                ndf_name = get_fs_ndf_name(function_space)</div><div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;                var_list.append(ndf_name)</div><div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;                invoke_sub.add(AssignGen(invoke_sub, lhs=ndf_name,</div><div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;                                         rhs=name +</div><div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;                                         <span class="stringliteral">&quot;%&quot;</span> + arg.ref_name(function_space) +</div><div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;                                         <span class="stringliteral">&quot;%get_ndf()&quot;</span>))</div><div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;            <span class="comment"># If there is a field on this space then initialise undf</span></div><div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;            <span class="comment"># for this function space and add name to list to declare</span></div><div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;            <span class="comment"># later. However, if the invoke contains only kernels that iterate</span></div><div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;            <span class="comment"># over dofs and distributed memory is enabled then the</span></div><div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;            <span class="comment"># number of dofs is obtained from the field proxy and undf is</span></div><div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;            <span class="comment"># not required.</span></div><div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> (dofs_only <span class="keywordflow">and</span> Config.get().distributed_memory):</div><div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;                <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#a519fa7f3c8ff4eeee92d13289a3d613a">field_on_space</a>(function_space):</div><div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;                    undf_name = get_fs_undf_name(function_space)</div><div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;                    var_list.append(undf_name)</div><div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;                    invoke_sub.add(AssignGen(invoke_sub, lhs=undf_name,</div><div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;                                             rhs=name + <span class="stringliteral">&quot;%&quot;</span> +</div><div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;                                             arg.ref_name(function_space) +</div><div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;                                             <span class="stringliteral">&quot;%get_undf()&quot;</span>))</div><div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;        <span class="keywordflow">if</span> var_list:</div><div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;            <span class="comment"># declare ndf and undf for all function spaces</span></div><div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;            invoke_sub.add(DeclGen(invoke_sub, datatype=<span class="stringliteral">&quot;integer&quot;</span>,</div><div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;                                   entity_decls=var_list))</div><div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;</div><div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;        <span class="comment"># Initialise basis and/or differential-basis functions</span></div><div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;        self.evaluators.initialise_basis_fns(invoke_sub)</div><div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;</div><div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;        <span class="comment"># add calls to compute the values of any basis arrays</span></div><div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;        self.evaluators.compute_basis_fns(invoke_sub)</div><div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;</div><div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;        invoke_sub.add(CommentGen(invoke_sub, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;        <span class="keywordflow">if</span> Config.get().distributed_memory:</div><div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;            invoke_sub.add(CommentGen(invoke_sub, <span class="stringliteral">&quot; Call kernels and &quot;</span></div><div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;                                      <span class="stringliteral">&quot;communication routines&quot;</span>))</div><div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;            invoke_sub.add(CommentGen(invoke_sub, <span class="stringliteral">&quot; Call our kernels&quot;</span>))</div><div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;        invoke_sub.add(CommentGen(invoke_sub, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;</div><div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;        <span class="comment"># add content from the schedule</span></div><div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;        self.schedule.gen_code(invoke_sub)</div><div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;</div><div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;        <span class="comment"># Deallocate any basis arrays</span></div><div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;        self.evaluators.deallocate(invoke_sub)</div><div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;</div><div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;        invoke_sub.add(CommentGen(invoke_sub, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;</div><div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;        <span class="comment"># finally, add me to my parent</span></div><div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;        parent.add(invoke_sub)</div><div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;</div><div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;</div><div class="line"><a name="l03382"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynSchedule.html"> 3382</a></span>&#160;<span class="keyword">class </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynSchedule.html">DynSchedule</a>(<a class="code" href="classpsyclone_1_1psyGen_1_1Schedule.html">Schedule</a>):</div><div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;    <span class="stringliteral">&#39;&#39;&#39; The Dynamo specific schedule class. This passes the Dynamo-</span></div><div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;<span class="stringliteral">    specific factories for creating kernel and infrastructure calls</span></div><div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;<span class="stringliteral">    to the base class so it creates the ones we require. &#39;&#39;&#39;</span></div><div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;</div><div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;    <span class="keyword">def </span>__init__(self, arg):</div><div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1dynamo0p3__builtins.html">psyclone.dynamo0p3_builtins</a> <span class="keyword">import</span> DynBuiltInCallFactory</div><div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;        Schedule.__init__(self, DynKernCallFactory, DynBuiltInCallFactory, arg)</div><div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;</div><div class="line"><a name="l03391"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynSchedule.html#acd4461bf90951df030ab017b4ed6a4f3"> 3391</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynSchedule.html#acd4461bf90951df030ab017b4ed6a4f3">view</a>(self, indent=0):</div><div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;<span class="stringliteral">        A method implemented by all classes in a schedule which display the</span></div><div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;<span class="stringliteral">        tree in a textual form. This method overrides the default view</span></div><div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;<span class="stringliteral">        method to include distributed memory information.</span></div><div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;<span class="stringliteral">        :param int indent: the amount by which to indent the output.</span></div><div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;        print(self.<a class="code" href="classpsyclone_1_1psyGen_1_1Node.html#a26c38a98f54211eb80dae3fe07d64d30">indent</a>(indent) + self.<a class="code" href="classpsyclone_1_1psyGen_1_1Schedule.html#a4c980b1e53473d1fa3cbe245a9ba975a">coloured_text</a> + <span class="stringliteral">&quot;[invoke=&#39;&quot;</span> +</div><div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;              self.invoke.name + <span class="stringliteral">&quot;&#39; dm=&quot;</span> +</div><div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;              str(Config.get().distributed_memory)+<span class="stringliteral">&quot;]&quot;</span>)</div><div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;        <span class="keywordflow">for</span> entity <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1psyGen_1_1Node.html#a785ad9bd632033c16273bcfae09e28d8">_children</a>:</div><div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;            entity.view(indent=indent + 1)</div><div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;</div><div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;</div><div class="line"><a name="l03405"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynGlobalSum.html"> 3405</a></span>&#160;<span class="keyword">class </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynGlobalSum.html">DynGlobalSum</a>(GlobalSum):</div><div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;    <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;<span class="stringliteral">    Dynamo specific global sum class which can be added to and</span></div><div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;<span class="stringliteral">    manipulated in, a schedule.</span></div><div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;<span class="stringliteral">    :param scalar: the kernel argument for which to perform a global sum</span></div><div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;<span class="stringliteral">    :type scalar: :py:class:`psyclone.dynamo0p3.DynKernelArgument`</span></div><div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;<span class="stringliteral">    :param parent: the parent node of this node in the Schedule</span></div><div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;<span class="stringliteral">    :type parent: :py:class:`psyclone.psyGen.Node`</span></div><div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;<span class="stringliteral">    &#39;&#39;&#39;</span></div><div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;    <span class="keyword">def </span>__init__(self, scalar, parent=None):</div><div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> Config.get().distributed_memory:</div><div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;            <span class="keywordflow">raise</span> GenerationError(<span class="stringliteral">&quot;It makes no sense to create a DynGlobalSum &quot;</span></div><div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;                                  <span class="stringliteral">&quot;object when dm=False&quot;</span>)</div><div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;        <span class="comment"># a list of scalar types that this class supports</span></div><div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynGlobalSum.html#adb95915042af0293c5320527a5b2ac96">_supported_scalars</a> = [<span class="stringliteral">&quot;gh_real&quot;</span>]</div><div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;        <span class="keywordflow">if</span> scalar.type <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynGlobalSum.html#adb95915042af0293c5320527a5b2ac96">_supported_scalars</a>:</div><div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;            <span class="keywordflow">raise</span> GenerationError(<span class="stringliteral">&quot;DynGlobalSum currently only supports &quot;</span></div><div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;                                  <span class="stringliteral">&quot;&#39;{0}&#39;, but found &#39;{1}&#39;.&quot;</span>.</div><div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;                                  format(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynGlobalSum.html#adb95915042af0293c5320527a5b2ac96">_supported_scalars</a>, scalar.type))</div><div class="line"><a name="l03425"></a><span class="lineno"> 3425</span>&#160;        GlobalSum.__init__(self, scalar, parent=parent)</div><div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;</div><div class="line"><a name="l03427"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynGlobalSum.html#ab850352ac5a8b53740d2f9ebb7c3f82f"> 3427</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynGlobalSum.html#ab850352ac5a8b53740d2f9ebb7c3f82f">gen_code</a>(self, parent):</div><div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Dynamo specific code generation for this class &#39;&#39;&#39;</span></div><div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> AssignGen, TypeDeclGen, UseGen</div><div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;        name = self._scalar.name</div><div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;        name_space_manager = NameSpaceFactory().create()</div><div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;        sum_name = name_space_manager.create_name(</div><div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;            root_name=<span class="stringliteral">&quot;global_sum&quot;</span>, context=<span class="stringliteral">&quot;PSyVars&quot;</span>, label=<span class="stringliteral">&quot;global_sum&quot;</span>)</div><div class="line"><a name="l03434"></a><span class="lineno"> 3434</span>&#160;        parent.add(UseGen(parent, name=<span class="stringliteral">&quot;scalar_mod&quot;</span>, only=<span class="keyword">True</span>,</div><div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160;                          funcnames=[<span class="stringliteral">&quot;scalar_type&quot;</span>]))</div><div class="line"><a name="l03436"></a><span class="lineno"> 3436</span>&#160;        parent.add(TypeDeclGen(parent, datatype=<span class="stringliteral">&quot;scalar_type&quot;</span>,</div><div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160;                               entity_decls=[sum_name]))</div><div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;        parent.add(AssignGen(parent, lhs=sum_name+<span class="stringliteral">&quot;%value&quot;</span>, rhs=name))</div><div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;        parent.add(AssignGen(parent, lhs=name, rhs=sum_name+<span class="stringliteral">&quot;%get_sum()&quot;</span>))</div><div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160;</div><div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;</div><div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;<span class="keyword">def </span>_create_depth_list(halo_info_list):</div><div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;    <span class="stringliteral">&#39;&#39;&#39;Halo exchanges may have more than one dependency. This method</span></div><div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;<span class="stringliteral">    simplifies multiple dependencies to remove duplicates and any</span></div><div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;<span class="stringliteral">    obvious redundancy. For example, if one dependency is for depth=1</span></div><div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160;<span class="stringliteral">    and another for depth=2 then we do not need the former as it is</span></div><div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;<span class="stringliteral">    covered by the latter. Similarly, if we have a depth=extent+1 and</span></div><div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;<span class="stringliteral">    another for depth=extent+2 then we do not need the former as it is</span></div><div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;<span class="stringliteral">    covered by the latter. It also takes into account</span></div><div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;<span class="stringliteral">    needs_clean_outer, which indicates whether the outermost halo</span></div><div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;<span class="stringliteral">    needs to be clean (and therefore whether there is a dependence).</span></div><div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;<span class="stringliteral">    :param: a list containing halo access information derived from</span></div><div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;<span class="stringliteral">    all read fields dependent on this halo exchange</span></div><div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;<span class="stringliteral">    :type: :func:`list` of :py:class:`psyclone.dynamo0p3.HaloReadAccess`</span></div><div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;<span class="stringliteral">    :return: a list containing halo depth information derived from</span></div><div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;<span class="stringliteral">    the halo access information</span></div><div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;<span class="stringliteral">    :rtype: :func:`list` of :py:class:`psyclone.dynamo0p3.HaloDepth`</span></div><div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;<span class="stringliteral">    &#39;&#39;&#39;</span></div><div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;    depth_info_list = []</div><div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;    <span class="comment"># first look to see if all field dependencies are</span></div><div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;    <span class="comment"># annexed_only. If so we only care about annexed dofs</span></div><div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;    annexed_only = <span class="keyword">True</span></div><div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;    <span class="keywordflow">for</span> halo_info <span class="keywordflow">in</span> halo_info_list:</div><div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> (halo_info.annexed_only <span class="keywordflow">or</span></div><div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;                (halo_info.literal_depth == 1</div><div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;                 <span class="keywordflow">and</span> <span class="keywordflow">not</span> halo_info.needs_clean_outer)):</div><div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;            <span class="comment"># There are two cases when we only care about accesses to</span></div><div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;            <span class="comment"># annexed dofs. 1) when annexed_only is set and 2) when</span></div><div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;            <span class="comment"># the halo depth is 1 but we only depend on annexed dofs</span></div><div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;            <span class="comment"># being up-to-date (needs_clean_outer is False)</span></div><div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;            annexed_only = <span class="keyword">False</span></div><div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;            <span class="keywordflow">break</span></div><div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;    <span class="keywordflow">if</span> annexed_only:</div><div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;        depth_info = <a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html">HaloDepth</a>()</div><div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;        depth_info.set_by_value(max_depth=<span class="keyword">False</span>, var_depth=<span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;                                literal_depth=1, annexed_only=<span class="keyword">True</span>,</div><div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;                                max_depth_m1=<span class="keyword">False</span>)</div><div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;        <span class="keywordflow">return</span> [depth_info]</div><div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;    <span class="comment"># next look to see if one of the field dependencies specifies</span></div><div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;    <span class="comment"># a max_depth access. If so the whole halo region is accessed</span></div><div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;    <span class="comment"># so we do not need to be concerned with other accesses.</span></div><div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;    max_depth_m1 = <span class="keyword">False</span></div><div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;    <span class="keywordflow">for</span> halo_info <span class="keywordflow">in</span> halo_info_list:</div><div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;        <span class="keywordflow">if</span> halo_info.max_depth:</div><div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;            <span class="keywordflow">if</span> halo_info.needs_clean_outer:</div><div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;                <span class="comment"># found a max_depth access so we only need one</span></div><div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;                <span class="comment"># HaloDepth entry</span></div><div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;                depth_info = <a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html">HaloDepth</a>()</div><div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;                depth_info.set_by_value(max_depth=<span class="keyword">True</span>, var_depth=<span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l03492"></a><span class="lineno"> 3492</span>&#160;                                        literal_depth=0, annexed_only=<span class="keyword">False</span>,</div><div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;                                        max_depth_m1=<span class="keyword">False</span>)</div><div class="line"><a name="l03494"></a><span class="lineno"> 3494</span>&#160;                <span class="keywordflow">return</span> [depth_info]</div><div class="line"><a name="l03495"></a><span class="lineno"> 3495</span>&#160;            <span class="comment"># remember that we found a max_depth-1 access</span></div><div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;            max_depth_m1 = <span class="keyword">True</span></div><div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;</div><div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;    <span class="keywordflow">if</span> max_depth_m1:</div><div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;        <span class="comment"># we have at least one max_depth-1 access.</span></div><div class="line"><a name="l03500"></a><span class="lineno"> 3500</span>&#160;        depth_info = <a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html">HaloDepth</a>()</div><div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;        depth_info.set_by_value(max_depth=<span class="keyword">False</span>, var_depth=<span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;                                literal_depth=0, annexed_only=<span class="keyword">False</span>,</div><div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;                                max_depth_m1=<span class="keyword">True</span>)</div><div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;        depth_info_list.append(depth_info)</div><div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160;</div><div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160;    <span class="keywordflow">for</span> halo_info <span class="keywordflow">in</span> halo_info_list:</div><div class="line"><a name="l03507"></a><span class="lineno"> 3507</span>&#160;        <span class="comment"># go through the halo information associated with each</span></div><div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;        <span class="comment"># read dependency, skipping any max_depth-1 accesses</span></div><div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;        <span class="keywordflow">if</span> halo_info.max_depth <span class="keywordflow">and</span> <span class="keywordflow">not</span> halo_info.needs_clean_outer:</div><div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;            <span class="keywordflow">continue</span></div><div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;        var_depth = halo_info.var_depth</div><div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;        literal_depth = halo_info.literal_depth</div><div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;        <span class="keywordflow">if</span> literal_depth <span class="keywordflow">and</span> <span class="keywordflow">not</span> halo_info.needs_clean_outer:</div><div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160;            <span class="comment"># decrease depth by 1 if we don&#39;t care about the outermost</span></div><div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;            <span class="comment"># access</span></div><div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;            literal_depth -= 1</div><div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160;        match = <span class="keyword">False</span></div><div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160;        <span class="comment"># check whether we match with existing depth information</span></div><div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;        <span class="keywordflow">for</span> depth_info <span class="keywordflow">in</span> depth_info_list:</div><div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160;            <span class="keywordflow">if</span> depth_info.var_depth == var_depth <span class="keywordflow">and</span> <span class="keywordflow">not</span> match:</div><div class="line"><a name="l03521"></a><span class="lineno"> 3521</span>&#160;                <span class="comment"># this dependence uses the same variable to</span></div><div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160;                <span class="comment"># specify its depth as an existing one, or both do</span></div><div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160;                <span class="comment"># not have a variable so we only have a</span></div><div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;                <span class="comment"># literal. Therefore we only need to update the</span></div><div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;                <span class="comment"># literal value with the maximum of the two</span></div><div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;                <span class="comment"># (e.g. var_name,1 and var_name,2 =&gt; var_name,2)</span></div><div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;                depth_info.literal_depth = max(</div><div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;                    depth_info.literal_depth, literal_depth)</div><div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;                match = <span class="keyword">True</span></div><div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;                <span class="keywordflow">break</span></div><div class="line"><a name="l03531"></a><span class="lineno"> 3531</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> match:</div><div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160;            <span class="comment"># no matches were found with existing entries so</span></div><div class="line"><a name="l03533"></a><span class="lineno"> 3533</span>&#160;            <span class="comment"># create a new one</span></div><div class="line"><a name="l03534"></a><span class="lineno"> 3534</span>&#160;            depth_info = <a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html">HaloDepth</a>()</div><div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160;            depth_info.set_by_value(max_depth=<span class="keyword">False</span>, var_depth=var_depth,</div><div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;                                    literal_depth=literal_depth,</div><div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;                                    annexed_only=<span class="keyword">False</span>, max_depth_m1=<span class="keyword">False</span>)</div><div class="line"><a name="l03538"></a><span class="lineno"> 3538</span>&#160;            depth_info_list.append(depth_info)</div><div class="line"><a name="l03539"></a><span class="lineno"> 3539</span>&#160;    <span class="keywordflow">return</span> depth_info_list</div><div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;</div><div class="line"><a name="l03541"></a><span class="lineno"> 3541</span>&#160;</div><div class="line"><a name="l03542"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchange.html"> 3542</a></span>&#160;<span class="keyword">class </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchange.html">DynHaloExchange</a>(HaloExchange):</div><div class="line"><a name="l03543"></a><span class="lineno"> 3543</span>&#160;</div><div class="line"><a name="l03544"></a><span class="lineno"> 3544</span>&#160;    <span class="stringliteral">&#39;&#39;&#39;Dynamo specific halo exchange class which can be added to and</span></div><div class="line"><a name="l03545"></a><span class="lineno"> 3545</span>&#160;<span class="stringliteral">    manipulated in, a schedule</span></div><div class="line"><a name="l03546"></a><span class="lineno"> 3546</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160;<span class="stringliteral">    :param field: the field that this halo exchange will act on</span></div><div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160;<span class="stringliteral">    :type field: :py:class:`psyclone.dynamo0p3.DynKernelArgument`</span></div><div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160;<span class="stringliteral">    :param check_dirty: optional argument default True indicating \</span></div><div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;<span class="stringliteral">    whether this halo exchange should be subject to a run-time check \</span></div><div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160;<span class="stringliteral">    for clean/dirty halos.</span></div><div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;<span class="stringliteral">    :type check_dirty: bool</span></div><div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;<span class="stringliteral">    :param vector_index: optional vector index (default None) to \</span></div><div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;<span class="stringliteral">    identify which index of a vector field this halo exchange is \</span></div><div class="line"><a name="l03555"></a><span class="lineno"> 3555</span>&#160;<span class="stringliteral">    responsible for</span></div><div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160;<span class="stringliteral">    :type vector_index: int</span></div><div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;<span class="stringliteral">    :param parent: optional PSyIRe parent node (default None) of this \</span></div><div class="line"><a name="l03558"></a><span class="lineno"> 3558</span>&#160;<span class="stringliteral">    object</span></div><div class="line"><a name="l03559"></a><span class="lineno"> 3559</span>&#160;<span class="stringliteral">    :type parent: :py:class:`psyclone.psyGen.node`</span></div><div class="line"><a name="l03560"></a><span class="lineno"> 3560</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03561"></a><span class="lineno"> 3561</span>&#160;<span class="stringliteral">    &#39;&#39;&#39;</span></div><div class="line"><a name="l03562"></a><span class="lineno"> 3562</span>&#160;    <span class="keyword">def </span>__init__(self, field, check_dirty=True,</div><div class="line"><a name="l03563"></a><span class="lineno"> 3563</span>&#160;                 vector_index=<span class="keywordtype">None</span>, parent=<span class="keywordtype">None</span>):</div><div class="line"><a name="l03564"></a><span class="lineno"> 3564</span>&#160;        HaloExchange.__init__(self, field, check_dirty=check_dirty,</div><div class="line"><a name="l03565"></a><span class="lineno"> 3565</span>&#160;                              vector_index=vector_index, parent=parent)</div><div class="line"><a name="l03566"></a><span class="lineno"> 3566</span>&#160;        <span class="comment"># set up some defaults for this class</span></div><div class="line"><a name="l03567"></a><span class="lineno"> 3567</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchange.html#a0afb6ca563169f95acdba0f8a94ef06c">_halo_exchange_name</a> = <span class="stringliteral">&quot;halo_exchange&quot;</span></div><div class="line"><a name="l03568"></a><span class="lineno"> 3568</span>&#160;</div><div class="line"><a name="l03569"></a><span class="lineno"> 3569</span>&#160;    <span class="keyword">def </span>_compute_stencil_type(self):</div><div class="line"><a name="l03570"></a><span class="lineno"> 3570</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;Dynamically work out the type of stencil required for this halo</span></div><div class="line"><a name="l03571"></a><span class="lineno"> 3571</span>&#160;<span class="stringliteral">        exchange as it could change as transformations are applied to</span></div><div class="line"><a name="l03572"></a><span class="lineno"> 3572</span>&#160;<span class="stringliteral">        the schedule. If all stencil accesses are of the same type then we</span></div><div class="line"><a name="l03573"></a><span class="lineno"> 3573</span>&#160;<span class="stringliteral">        return that stencil, otherwise we return the &quot;region&quot; stencil</span></div><div class="line"><a name="l03574"></a><span class="lineno"> 3574</span>&#160;<span class="stringliteral">        type (as it is safe for all stencils).</span></div><div class="line"><a name="l03575"></a><span class="lineno"> 3575</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03576"></a><span class="lineno"> 3576</span>&#160;<span class="stringliteral">        :return: the type of stencil required for this halo exchange</span></div><div class="line"><a name="l03577"></a><span class="lineno"> 3577</span>&#160;<span class="stringliteral">        :rtype: str</span></div><div class="line"><a name="l03578"></a><span class="lineno"> 3578</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03579"></a><span class="lineno"> 3579</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l03580"></a><span class="lineno"> 3580</span>&#160;        <span class="comment"># get information about stencil accesses from all read fields</span></div><div class="line"><a name="l03581"></a><span class="lineno"> 3581</span>&#160;        <span class="comment"># dependendent on this halo exchange</span></div><div class="line"><a name="l03582"></a><span class="lineno"> 3582</span>&#160;        halo_info_list = self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchange.html#a43880413955768473a8478e17f1982dc">_compute_halo_read_info</a>()</div><div class="line"><a name="l03583"></a><span class="lineno"> 3583</span>&#160;</div><div class="line"><a name="l03584"></a><span class="lineno"> 3584</span>&#160;        trial_stencil = halo_info_list[0].stencil_type</div><div class="line"><a name="l03585"></a><span class="lineno"> 3585</span>&#160;        <span class="keywordflow">for</span> halo_info <span class="keywordflow">in</span> halo_info_list:</div><div class="line"><a name="l03586"></a><span class="lineno"> 3586</span>&#160;            <span class="comment"># assume that if stencil accesses are different that we</span></div><div class="line"><a name="l03587"></a><span class="lineno"> 3587</span>&#160;            <span class="comment"># simply revert to region. We could be more clever in the</span></div><div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>&#160;            <span class="comment"># future e.g. x and y implies cross.</span></div><div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>&#160;            <span class="keywordflow">if</span> halo_info.stencil_type != trial_stencil:</div><div class="line"><a name="l03590"></a><span class="lineno"> 3590</span>&#160;                <span class="keywordflow">return</span> <span class="stringliteral">&quot;region&quot;</span></div><div class="line"><a name="l03591"></a><span class="lineno"> 3591</span>&#160;        <span class="keywordflow">return</span> trial_stencil</div><div class="line"><a name="l03592"></a><span class="lineno"> 3592</span>&#160;</div><div class="line"><a name="l03593"></a><span class="lineno"> 3593</span>&#160;    <span class="keyword">def </span>_compute_halo_depth(self):</div><div class="line"><a name="l03594"></a><span class="lineno"> 3594</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;Dynamically determine the depth of the halo for this halo exchange,</span></div><div class="line"><a name="l03595"></a><span class="lineno"> 3595</span>&#160;<span class="stringliteral">        as the depth can change as transformations are applied to the</span></div><div class="line"><a name="l03596"></a><span class="lineno"> 3596</span>&#160;<span class="stringliteral">        schedule</span></div><div class="line"><a name="l03597"></a><span class="lineno"> 3597</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03598"></a><span class="lineno"> 3598</span>&#160;<span class="stringliteral">        :return: the halo exchange depth as a Fortran string</span></div><div class="line"><a name="l03599"></a><span class="lineno"> 3599</span>&#160;<span class="stringliteral">        :rtype: str</span></div><div class="line"><a name="l03600"></a><span class="lineno"> 3600</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03601"></a><span class="lineno"> 3601</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l03602"></a><span class="lineno"> 3602</span>&#160;        <span class="comment"># get information about reading from the halo from all read fields</span></div><div class="line"><a name="l03603"></a><span class="lineno"> 3603</span>&#160;        <span class="comment"># dependendent on this halo exchange</span></div><div class="line"><a name="l03604"></a><span class="lineno"> 3604</span>&#160;        depth_info_list = self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchange.html#ae39dd06329262fd85c329c304155b141">_compute_halo_read_depth_info</a>()</div><div class="line"><a name="l03605"></a><span class="lineno"> 3605</span>&#160;</div><div class="line"><a name="l03606"></a><span class="lineno"> 3606</span>&#160;        <span class="comment"># if there is only one entry in the list we can just return</span></div><div class="line"><a name="l03607"></a><span class="lineno"> 3607</span>&#160;        <span class="comment"># the depth</span></div><div class="line"><a name="l03608"></a><span class="lineno"> 3608</span>&#160;        <span class="keywordflow">if</span> len(depth_info_list) == 1:</div><div class="line"><a name="l03609"></a><span class="lineno"> 3609</span>&#160;            <span class="keywordflow">return</span> str(depth_info_list[0])</div><div class="line"><a name="l03610"></a><span class="lineno"> 3610</span>&#160;        <span class="comment"># the depth information can&#39;t be reduced to a single</span></div><div class="line"><a name="l03611"></a><span class="lineno"> 3611</span>&#160;        <span class="comment"># expression, therefore we need to determine the maximum</span></div><div class="line"><a name="l03612"></a><span class="lineno"> 3612</span>&#160;        <span class="comment"># of all expresssions</span></div><div class="line"><a name="l03613"></a><span class="lineno"> 3613</span>&#160;        depth_str_list = [str(depth_info) <span class="keywordflow">for</span> depth_info <span class="keywordflow">in</span></div><div class="line"><a name="l03614"></a><span class="lineno"> 3614</span>&#160;                          depth_info_list]</div><div class="line"><a name="l03615"></a><span class="lineno"> 3615</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;max(&quot;</span>+<span class="stringliteral">&quot;,&quot;</span>.join(depth_str_list)+<span class="stringliteral">&quot;)&quot;</span></div><div class="line"><a name="l03616"></a><span class="lineno"> 3616</span>&#160;</div><div class="line"><a name="l03617"></a><span class="lineno"> 3617</span>&#160;    <span class="keyword">def </span>_compute_halo_read_depth_info(self):</div><div class="line"><a name="l03618"></a><span class="lineno"> 3618</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;Take a list of `psyclone.dynamo0p3.HaloReadAccess` objects and</span></div><div class="line"><a name="l03619"></a><span class="lineno"> 3619</span>&#160;<span class="stringliteral">        create an equivalent list of `psyclone.dynamo0p3.HaloDepth`</span></div><div class="line"><a name="l03620"></a><span class="lineno"> 3620</span>&#160;<span class="stringliteral">        objects. Whilst doing this we simplify the</span></div><div class="line"><a name="l03621"></a><span class="lineno"> 3621</span>&#160;<span class="stringliteral">        `psyclone.dynamo0p3.HaloDepth` list to remove redundant depth</span></div><div class="line"><a name="l03622"></a><span class="lineno"> 3622</span>&#160;<span class="stringliteral">        information e.g. depth=1 is not required if we have a depth=2</span></div><div class="line"><a name="l03623"></a><span class="lineno"> 3623</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03624"></a><span class="lineno"> 3624</span>&#160;<span class="stringliteral">        :return: a list containing halo depth information derived from \</span></div><div class="line"><a name="l03625"></a><span class="lineno"> 3625</span>&#160;<span class="stringliteral">        all fields dependent on this halo exchange</span></div><div class="line"><a name="l03626"></a><span class="lineno"> 3626</span>&#160;<span class="stringliteral">        :rtype: :func:`list` of :py:class:`psyclone.dynamo0p3.HaloDepth`</span></div><div class="line"><a name="l03627"></a><span class="lineno"> 3627</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03628"></a><span class="lineno"> 3628</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l03629"></a><span class="lineno"> 3629</span>&#160;        <span class="comment"># get our halo information</span></div><div class="line"><a name="l03630"></a><span class="lineno"> 3630</span>&#160;        halo_info_list = self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchange.html#a43880413955768473a8478e17f1982dc">_compute_halo_read_info</a>()</div><div class="line"><a name="l03631"></a><span class="lineno"> 3631</span>&#160;        <span class="comment"># use the halo information to generate depth information</span></div><div class="line"><a name="l03632"></a><span class="lineno"> 3632</span>&#160;        depth_info_list = _create_depth_list(halo_info_list)</div><div class="line"><a name="l03633"></a><span class="lineno"> 3633</span>&#160;        <span class="keywordflow">return</span> depth_info_list</div><div class="line"><a name="l03634"></a><span class="lineno"> 3634</span>&#160;</div><div class="line"><a name="l03635"></a><span class="lineno"> 3635</span>&#160;    <span class="keyword">def </span>_compute_halo_read_info(self):</div><div class="line"><a name="l03636"></a><span class="lineno"> 3636</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;Dynamically computes all halo read dependencies and returns the</span></div><div class="line"><a name="l03637"></a><span class="lineno"> 3637</span>&#160;<span class="stringliteral">        required halo information (i.e. halo depth and stencil type) in a</span></div><div class="line"><a name="l03638"></a><span class="lineno"> 3638</span>&#160;<span class="stringliteral">        list of HaloReadAccess objects</span></div><div class="line"><a name="l03639"></a><span class="lineno"> 3639</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03640"></a><span class="lineno"> 3640</span>&#160;<span class="stringliteral">        :return: a list containing halo information for each read dependency</span></div><div class="line"><a name="l03641"></a><span class="lineno"> 3641</span>&#160;<span class="stringliteral">        :rtype: :func:`list` of :py:class:`psyclone.dynamo0p3.HaloReadAccess`</span></div><div class="line"><a name="l03642"></a><span class="lineno"> 3642</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03643"></a><span class="lineno"> 3643</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l03644"></a><span class="lineno"> 3644</span>&#160;        read_dependencies = self.field.forward_read_dependencies()</div><div class="line"><a name="l03645"></a><span class="lineno"> 3645</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> read_dependencies:</div><div class="line"><a name="l03646"></a><span class="lineno"> 3646</span>&#160;            <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l03647"></a><span class="lineno"> 3647</span>&#160;                <span class="stringliteral">&quot;Internal logic error. There should be at least one read &quot;</span></div><div class="line"><a name="l03648"></a><span class="lineno"> 3648</span>&#160;                <span class="stringliteral">&quot;dependence for a halo exchange&quot;</span>)</div><div class="line"><a name="l03649"></a><span class="lineno"> 3649</span>&#160;        <span class="keywordflow">return</span> [<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloReadAccess.html">HaloReadAccess</a>(read_dependency) <span class="keywordflow">for</span> read_dependency</div><div class="line"><a name="l03650"></a><span class="lineno"> 3650</span>&#160;                <span class="keywordflow">in</span> read_dependencies]</div><div class="line"><a name="l03651"></a><span class="lineno"> 3651</span>&#160;</div><div class="line"><a name="l03652"></a><span class="lineno"> 3652</span>&#160;    <span class="keyword">def </span>_compute_halo_write_info(self):</div><div class="line"><a name="l03653"></a><span class="lineno"> 3653</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;Determines how much of the halo has been cleaned from any previous</span></div><div class="line"><a name="l03654"></a><span class="lineno"> 3654</span>&#160;<span class="stringliteral">        redundant computation</span></div><div class="line"><a name="l03655"></a><span class="lineno"> 3655</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03656"></a><span class="lineno"> 3656</span>&#160;<span class="stringliteral">        :return: a HaloWriteAccess object containing the required \</span></div><div class="line"><a name="l03657"></a><span class="lineno"> 3657</span>&#160;<span class="stringliteral">        information, or None if no dependence information is found.</span></div><div class="line"><a name="l03658"></a><span class="lineno"> 3658</span>&#160;<span class="stringliteral">        :rtype: :py:class:`psyclone.dynamo0p3.HaloWriteAccess` or None</span></div><div class="line"><a name="l03659"></a><span class="lineno"> 3659</span>&#160;<span class="stringliteral">        :raises GenerationError: if more than one write dependence is \</span></div><div class="line"><a name="l03660"></a><span class="lineno"> 3660</span>&#160;<span class="stringliteral">        found for this halo exchange as this should not be possible</span></div><div class="line"><a name="l03661"></a><span class="lineno"> 3661</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03662"></a><span class="lineno"> 3662</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l03663"></a><span class="lineno"> 3663</span>&#160;        write_dependencies = self.field.backward_write_dependencies()</div><div class="line"><a name="l03664"></a><span class="lineno"> 3664</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> write_dependencies:</div><div class="line"><a name="l03665"></a><span class="lineno"> 3665</span>&#160;            <span class="comment"># no write dependence information</span></div><div class="line"><a name="l03666"></a><span class="lineno"> 3666</span>&#160;            <span class="keywordflow">return</span> <span class="keywordtype">None</span></div><div class="line"><a name="l03667"></a><span class="lineno"> 3667</span>&#160;        <span class="keywordflow">if</span> len(write_dependencies) &gt; 1:</div><div class="line"><a name="l03668"></a><span class="lineno"> 3668</span>&#160;            <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l03669"></a><span class="lineno"> 3669</span>&#160;                <span class="stringliteral">&quot;Internal logic error. There should be at most one write &quot;</span></div><div class="line"><a name="l03670"></a><span class="lineno"> 3670</span>&#160;                <span class="stringliteral">&quot;dependence for a halo exchange. Found &quot;</span></div><div class="line"><a name="l03671"></a><span class="lineno"> 3671</span>&#160;                <span class="stringliteral">&quot;&#39;{0}&#39;&quot;</span>.format(str(len(write_dependencies))))</div><div class="line"><a name="l03672"></a><span class="lineno"> 3672</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloWriteAccess.html">HaloWriteAccess</a>(write_dependencies[0])</div><div class="line"><a name="l03673"></a><span class="lineno"> 3673</span>&#160;</div><div class="line"><a name="l03674"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchange.html#ab6e8d1f34c19cd0694cb1babdf070735"> 3674</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchange.html#ab6e8d1f34c19cd0694cb1babdf070735">required</a>(self):</div><div class="line"><a name="l03675"></a><span class="lineno"> 3675</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;Determines whether this halo exchange is definitely required (True,</span></div><div class="line"><a name="l03676"></a><span class="lineno"> 3676</span>&#160;<span class="stringliteral">        True), might be required (True, False) or is definitely not</span></div><div class="line"><a name="l03677"></a><span class="lineno"> 3677</span>&#160;<span class="stringliteral">        required (False, *). The first return argument is used to</span></div><div class="line"><a name="l03678"></a><span class="lineno"> 3678</span>&#160;<span class="stringliteral">        decide whether a halo exchange should exist. If it is True</span></div><div class="line"><a name="l03679"></a><span class="lineno"> 3679</span>&#160;<span class="stringliteral">        then the halo is required or might be required. If it is False</span></div><div class="line"><a name="l03680"></a><span class="lineno"> 3680</span>&#160;<span class="stringliteral">        then the halo exchange is definitely not required. The second</span></div><div class="line"><a name="l03681"></a><span class="lineno"> 3681</span>&#160;<span class="stringliteral">        argument is used to specify whether we definitely know that it</span></div><div class="line"><a name="l03682"></a><span class="lineno"> 3682</span>&#160;<span class="stringliteral">        is required or are not sure.</span></div><div class="line"><a name="l03683"></a><span class="lineno"> 3683</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03684"></a><span class="lineno"> 3684</span>&#160;<span class="stringliteral">        Whilst a halo exchange is generally only ever added if it is</span></div><div class="line"><a name="l03685"></a><span class="lineno"> 3685</span>&#160;<span class="stringliteral">        required, or if it may be required, this situation can change</span></div><div class="line"><a name="l03686"></a><span class="lineno"> 3686</span>&#160;<span class="stringliteral">        if redundant computation transformations are applied. The</span></div><div class="line"><a name="l03687"></a><span class="lineno"> 3687</span>&#160;<span class="stringliteral">        first argument can be used to remove such halo exchanges if</span></div><div class="line"><a name="l03688"></a><span class="lineno"> 3688</span>&#160;<span class="stringliteral">        required.</span></div><div class="line"><a name="l03689"></a><span class="lineno"> 3689</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03690"></a><span class="lineno"> 3690</span>&#160;<span class="stringliteral">        When the first argument is True, the second argument can be</span></div><div class="line"><a name="l03691"></a><span class="lineno"> 3691</span>&#160;<span class="stringliteral">        used to see if we need to rely on the runtime (set_dirty and</span></div><div class="line"><a name="l03692"></a><span class="lineno"> 3692</span>&#160;<span class="stringliteral">        set_clean calls) and therefore add a check_dirty() call around</span></div><div class="line"><a name="l03693"></a><span class="lineno"> 3693</span>&#160;<span class="stringliteral">        the halo exchange or whether we definitely know that this halo</span></div><div class="line"><a name="l03694"></a><span class="lineno"> 3694</span>&#160;<span class="stringliteral">        exchange is required.</span></div><div class="line"><a name="l03695"></a><span class="lineno"> 3695</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03696"></a><span class="lineno"> 3696</span>&#160;<span class="stringliteral">        This routine assumes that a stencil size provided via a</span></div><div class="line"><a name="l03697"></a><span class="lineno"> 3697</span>&#160;<span class="stringliteral">        variable may take the value 0. If a variables value is</span></div><div class="line"><a name="l03698"></a><span class="lineno"> 3698</span>&#160;<span class="stringliteral">        constrained to be 1, or more, then the logic for deciding</span></div><div class="line"><a name="l03699"></a><span class="lineno"> 3699</span>&#160;<span class="stringliteral">        whether a halo exchange is definitely required should be</span></div><div class="line"><a name="l03700"></a><span class="lineno"> 3700</span>&#160;<span class="stringliteral">        updated. Note, the routine would still be correct as is, it</span></div><div class="line"><a name="l03701"></a><span class="lineno"> 3701</span>&#160;<span class="stringliteral">        would just return more unknown results than it should).</span></div><div class="line"><a name="l03702"></a><span class="lineno"> 3702</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03703"></a><span class="lineno"> 3703</span>&#160;<span class="stringliteral">        :return: Returns (x, y) where x specifies whether this halo \</span></div><div class="line"><a name="l03704"></a><span class="lineno"> 3704</span>&#160;<span class="stringliteral">        exchange is (or might be) required - True, or is not required \</span></div><div class="line"><a name="l03705"></a><span class="lineno"> 3705</span>&#160;<span class="stringliteral">        - False. If the first tuple item is True then the second \</span></div><div class="line"><a name="l03706"></a><span class="lineno"> 3706</span>&#160;<span class="stringliteral">        argument specifies whether we definitely know that we need the \</span></div><div class="line"><a name="l03707"></a><span class="lineno"> 3707</span>&#160;<span class="stringliteral">        HaloExchange - True, or are not sure - False.</span></div><div class="line"><a name="l03708"></a><span class="lineno"> 3708</span>&#160;<span class="stringliteral">        :rtype: (bool, bool)</span></div><div class="line"><a name="l03709"></a><span class="lineno"> 3709</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03710"></a><span class="lineno"> 3710</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l03711"></a><span class="lineno"> 3711</span>&#160;        <span class="comment"># get *aggregated* information about halo reads</span></div><div class="line"><a name="l03712"></a><span class="lineno"> 3712</span>&#160;        required_clean_info = self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchange.html#ae39dd06329262fd85c329c304155b141">_compute_halo_read_depth_info</a>()</div><div class="line"><a name="l03713"></a><span class="lineno"> 3713</span>&#160;        <span class="comment"># get information about the halo write</span></div><div class="line"><a name="l03714"></a><span class="lineno"> 3714</span>&#160;        clean_info = self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchange.html#a6ca702fbdfcd162db042388a043bcc7d">_compute_halo_write_info</a>()</div><div class="line"><a name="l03715"></a><span class="lineno"> 3715</span>&#160;</div><div class="line"><a name="l03716"></a><span class="lineno"> 3716</span>&#160;        <span class="comment"># no need to test whether we return at least one read</span></div><div class="line"><a name="l03717"></a><span class="lineno"> 3717</span>&#160;        <span class="comment"># dependency as _compute_halo_read_depth_info() raises an</span></div><div class="line"><a name="l03718"></a><span class="lineno"> 3718</span>&#160;        <span class="comment"># exception if none are found</span></div><div class="line"><a name="l03719"></a><span class="lineno"> 3719</span>&#160;</div><div class="line"><a name="l03720"></a><span class="lineno"> 3720</span>&#160;        <span class="keywordflow">if</span> Config.get().api_conf(<span class="stringliteral">&quot;dynamo0.3&quot;</span>).compute_annexed_dofs <span class="keywordflow">and</span> \</div><div class="line"><a name="l03721"></a><span class="lineno"> 3721</span>&#160;           len(required_clean_info) == 1 <span class="keywordflow">and</span> \</div><div class="line"><a name="l03722"></a><span class="lineno"> 3722</span>&#160;           required_clean_info[0].annexed_only:</div><div class="line"><a name="l03723"></a><span class="lineno"> 3723</span>&#160;            <span class="comment"># We definitely don&#39;t need the halo exchange as we</span></div><div class="line"><a name="l03724"></a><span class="lineno"> 3724</span>&#160;            <span class="comment"># only read annexed dofs and these are always clean as</span></div><div class="line"><a name="l03725"></a><span class="lineno"> 3725</span>&#160;            <span class="comment"># they are computed by default when iterating over</span></div><div class="line"><a name="l03726"></a><span class="lineno"> 3726</span>&#160;            <span class="comment"># dofs and kept up-to-date by redundant computation</span></div><div class="line"><a name="l03727"></a><span class="lineno"> 3727</span>&#160;            <span class="comment"># when iterating over cells.</span></div><div class="line"><a name="l03728"></a><span class="lineno"> 3728</span>&#160;            required = <span class="keyword">False</span></div><div class="line"><a name="l03729"></a><span class="lineno"> 3729</span>&#160;            known = <span class="keyword">True</span>  <span class="comment"># redundant information as it is always known</span></div><div class="line"><a name="l03730"></a><span class="lineno"> 3730</span>&#160;            <span class="keywordflow">return</span> required, known</div><div class="line"><a name="l03731"></a><span class="lineno"> 3731</span>&#160;</div><div class="line"><a name="l03732"></a><span class="lineno"> 3732</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> clean_info:</div><div class="line"><a name="l03733"></a><span class="lineno"> 3733</span>&#160;            <span class="comment"># this halo exchange has no previous write dependencies so</span></div><div class="line"><a name="l03734"></a><span class="lineno"> 3734</span>&#160;            <span class="comment"># we do not know the initial state of the halo. This means</span></div><div class="line"><a name="l03735"></a><span class="lineno"> 3735</span>&#160;            <span class="comment"># that we do not know if we need a halo exchange or not</span></div><div class="line"><a name="l03736"></a><span class="lineno"> 3736</span>&#160;            required = <span class="keyword">True</span></div><div class="line"><a name="l03737"></a><span class="lineno"> 3737</span>&#160;            known = <span class="keyword">False</span></div><div class="line"><a name="l03738"></a><span class="lineno"> 3738</span>&#160;            <span class="keywordflow">return</span> required, known</div><div class="line"><a name="l03739"></a><span class="lineno"> 3739</span>&#160;</div><div class="line"><a name="l03740"></a><span class="lineno"> 3740</span>&#160;        <span class="keywordflow">if</span> clean_info.max_depth:</div><div class="line"><a name="l03741"></a><span class="lineno"> 3741</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> clean_info.dirty_outer:</div><div class="line"><a name="l03742"></a><span class="lineno"> 3742</span>&#160;                <span class="comment"># all of the halo is cleaned by redundant computation</span></div><div class="line"><a name="l03743"></a><span class="lineno"> 3743</span>&#160;                <span class="comment"># so halo exchange is not required</span></div><div class="line"><a name="l03744"></a><span class="lineno"> 3744</span>&#160;                required = <span class="keyword">False</span></div><div class="line"><a name="l03745"></a><span class="lineno"> 3745</span>&#160;                known = <span class="keyword">True</span>  <span class="comment"># redundant information as it is always known</span></div><div class="line"><a name="l03746"></a><span class="lineno"> 3746</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l03747"></a><span class="lineno"> 3747</span>&#160;                <span class="comment"># the last level halo is dirty</span></div><div class="line"><a name="l03748"></a><span class="lineno"> 3748</span>&#160;                <span class="keywordflow">if</span> required_clean_info[0].max_depth:</div><div class="line"><a name="l03749"></a><span class="lineno"> 3749</span>&#160;                    <span class="comment"># we know that we need to clean the outermost halo level</span></div><div class="line"><a name="l03750"></a><span class="lineno"> 3750</span>&#160;                    required = <span class="keyword">True</span></div><div class="line"><a name="l03751"></a><span class="lineno"> 3751</span>&#160;                    known = <span class="keyword">True</span></div><div class="line"><a name="l03752"></a><span class="lineno"> 3752</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l03753"></a><span class="lineno"> 3753</span>&#160;                    <span class="comment"># we don&#39;t know whether the halo exchange is</span></div><div class="line"><a name="l03754"></a><span class="lineno"> 3754</span>&#160;                    <span class="comment"># required or not as the reader reads the halo to</span></div><div class="line"><a name="l03755"></a><span class="lineno"> 3755</span>&#160;                    <span class="comment"># a specified depth but we don&#39;t know the depth</span></div><div class="line"><a name="l03756"></a><span class="lineno"> 3756</span>&#160;                    <span class="comment"># of the halo</span></div><div class="line"><a name="l03757"></a><span class="lineno"> 3757</span>&#160;                    required = <span class="keyword">True</span></div><div class="line"><a name="l03758"></a><span class="lineno"> 3758</span>&#160;                    known = <span class="keyword">False</span></div><div class="line"><a name="l03759"></a><span class="lineno"> 3759</span>&#160;            <span class="keywordflow">return</span> required, known</div><div class="line"><a name="l03760"></a><span class="lineno"> 3760</span>&#160;</div><div class="line"><a name="l03761"></a><span class="lineno"> 3761</span>&#160;        <span class="comment"># at this point we know that clean_info.max_depth is False</span></div><div class="line"><a name="l03762"></a><span class="lineno"> 3762</span>&#160;</div><div class="line"><a name="l03763"></a><span class="lineno"> 3763</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> clean_info.literal_depth:</div><div class="line"><a name="l03764"></a><span class="lineno"> 3764</span>&#160;            <span class="comment"># if literal_depth is 0 then the writer does not</span></div><div class="line"><a name="l03765"></a><span class="lineno"> 3765</span>&#160;            <span class="comment"># redundantly compute so we definitely need the halo</span></div><div class="line"><a name="l03766"></a><span class="lineno"> 3766</span>&#160;            <span class="comment"># exchange</span></div><div class="line"><a name="l03767"></a><span class="lineno"> 3767</span>&#160;            required = <span class="keyword">True</span></div><div class="line"><a name="l03768"></a><span class="lineno"> 3768</span>&#160;            known = <span class="keyword">True</span></div><div class="line"><a name="l03769"></a><span class="lineno"> 3769</span>&#160;            <span class="keywordflow">return</span> required, known</div><div class="line"><a name="l03770"></a><span class="lineno"> 3770</span>&#160;</div><div class="line"><a name="l03771"></a><span class="lineno"> 3771</span>&#160;        <span class="keywordflow">if</span> clean_info.literal_depth == 1 <span class="keywordflow">and</span> clean_info.dirty_outer:</div><div class="line"><a name="l03772"></a><span class="lineno"> 3772</span>&#160;            <span class="comment"># the writer redundantly computes in the level 1 halo but</span></div><div class="line"><a name="l03773"></a><span class="lineno"> 3773</span>&#160;            <span class="comment"># leaves it dirty (although annexed dofs are now clean).</span></div><div class="line"><a name="l03774"></a><span class="lineno"> 3774</span>&#160;            <span class="keywordflow">if</span> len(required_clean_info) == 1 <span class="keywordflow">and</span> \</div><div class="line"><a name="l03775"></a><span class="lineno"> 3775</span>&#160;               required_clean_info[0].annexed_only:</div><div class="line"><a name="l03776"></a><span class="lineno"> 3776</span>&#160;                <span class="comment"># we definitely don&#39;t need the halo exchange as we</span></div><div class="line"><a name="l03777"></a><span class="lineno"> 3777</span>&#160;                <span class="comment"># only read annexed dofs and these have been made</span></div><div class="line"><a name="l03778"></a><span class="lineno"> 3778</span>&#160;                <span class="comment"># clean by the redundant computation</span></div><div class="line"><a name="l03779"></a><span class="lineno"> 3779</span>&#160;                required = <span class="keyword">False</span></div><div class="line"><a name="l03780"></a><span class="lineno"> 3780</span>&#160;                known = <span class="keyword">True</span>  <span class="comment"># redundant information as it is always known</span></div><div class="line"><a name="l03781"></a><span class="lineno"> 3781</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l03782"></a><span class="lineno"> 3782</span>&#160;                <span class="comment"># we definitely need the halo exchange as the reader(s)</span></div><div class="line"><a name="l03783"></a><span class="lineno"> 3783</span>&#160;                <span class="comment"># require the halo to be clean</span></div><div class="line"><a name="l03784"></a><span class="lineno"> 3784</span>&#160;                required = <span class="keyword">True</span></div><div class="line"><a name="l03785"></a><span class="lineno"> 3785</span>&#160;                known = <span class="keyword">True</span></div><div class="line"><a name="l03786"></a><span class="lineno"> 3786</span>&#160;            <span class="keywordflow">return</span> required, known</div><div class="line"><a name="l03787"></a><span class="lineno"> 3787</span>&#160;</div><div class="line"><a name="l03788"></a><span class="lineno"> 3788</span>&#160;        <span class="comment"># At this point we know that the writer cleans the halo to a</span></div><div class="line"><a name="l03789"></a><span class="lineno"> 3789</span>&#160;        <span class="comment"># known (literal) depth through redundant computation. We now</span></div><div class="line"><a name="l03790"></a><span class="lineno"> 3790</span>&#160;        <span class="comment"># compute this value for use by the logic in the rest of the</span></div><div class="line"><a name="l03791"></a><span class="lineno"> 3791</span>&#160;        <span class="comment"># routine.</span></div><div class="line"><a name="l03792"></a><span class="lineno"> 3792</span>&#160;        clean_depth = clean_info.literal_depth</div><div class="line"><a name="l03793"></a><span class="lineno"> 3793</span>&#160;        <span class="keywordflow">if</span> clean_info.dirty_outer:</div><div class="line"><a name="l03794"></a><span class="lineno"> 3794</span>&#160;            <span class="comment"># outer layer stays dirty</span></div><div class="line"><a name="l03795"></a><span class="lineno"> 3795</span>&#160;            clean_depth -= 1</div><div class="line"><a name="l03796"></a><span class="lineno"> 3796</span>&#160;</div><div class="line"><a name="l03797"></a><span class="lineno"> 3797</span>&#160;        <span class="comment"># If a literal value in any of the required clean halo depths</span></div><div class="line"><a name="l03798"></a><span class="lineno"> 3798</span>&#160;        <span class="comment"># is greater than the cleaned depth then we definitely need</span></div><div class="line"><a name="l03799"></a><span class="lineno"> 3799</span>&#160;        <span class="comment"># the halo exchange (as any additional variable depth would</span></div><div class="line"><a name="l03800"></a><span class="lineno"> 3800</span>&#160;        <span class="comment"># increase the required depth value). We only look at the case</span></div><div class="line"><a name="l03801"></a><span class="lineno"> 3801</span>&#160;        <span class="comment"># where we have multiple entries as the single entry case is</span></div><div class="line"><a name="l03802"></a><span class="lineno"> 3802</span>&#160;        <span class="comment"># dealt with separately</span></div><div class="line"><a name="l03803"></a><span class="lineno"> 3803</span>&#160;        <span class="keywordflow">if</span> len(required_clean_info) &gt; 1:</div><div class="line"><a name="l03804"></a><span class="lineno"> 3804</span>&#160;            <span class="keywordflow">for</span> required_clean <span class="keywordflow">in</span> required_clean_info:</div><div class="line"><a name="l03805"></a><span class="lineno"> 3805</span>&#160;                <span class="keywordflow">if</span> required_clean.literal_depth &gt; clean_depth:</div><div class="line"><a name="l03806"></a><span class="lineno"> 3806</span>&#160;                    required = <span class="keyword">True</span></div><div class="line"><a name="l03807"></a><span class="lineno"> 3807</span>&#160;                    known = <span class="keyword">True</span></div><div class="line"><a name="l03808"></a><span class="lineno"> 3808</span>&#160;                    <span class="keywordflow">return</span> required, known</div><div class="line"><a name="l03809"></a><span class="lineno"> 3809</span>&#160;</div><div class="line"><a name="l03810"></a><span class="lineno"> 3810</span>&#160;        <span class="comment"># The only other case where we know that a halo exchange is</span></div><div class="line"><a name="l03811"></a><span class="lineno"> 3811</span>&#160;        <span class="comment"># required (or not) is where we read the halo to a known</span></div><div class="line"><a name="l03812"></a><span class="lineno"> 3812</span>&#160;        <span class="comment"># literal depth. As the read inforation is aggregated, a known</span></div><div class="line"><a name="l03813"></a><span class="lineno"> 3813</span>&#160;        <span class="comment"># literal depth will mean that there is only one</span></div><div class="line"><a name="l03814"></a><span class="lineno"> 3814</span>&#160;        <span class="comment"># required_clean_info entry</span></div><div class="line"><a name="l03815"></a><span class="lineno"> 3815</span>&#160;        <span class="keywordflow">if</span> len(required_clean_info) == 1:</div><div class="line"><a name="l03816"></a><span class="lineno"> 3816</span>&#160;            <span class="comment"># the halo might be read to a fixed literal depth</span></div><div class="line"><a name="l03817"></a><span class="lineno"> 3817</span>&#160;            <span class="keywordflow">if</span> required_clean_info[0].var_depth <span class="keywordflow">or</span> \</div><div class="line"><a name="l03818"></a><span class="lineno"> 3818</span>&#160;               required_clean_info[0].max_depth:</div><div class="line"><a name="l03819"></a><span class="lineno"> 3819</span>&#160;                <span class="comment"># no it isn&#39;t so we might need the halo exchange</span></div><div class="line"><a name="l03820"></a><span class="lineno"> 3820</span>&#160;                required = <span class="keyword">True</span></div><div class="line"><a name="l03821"></a><span class="lineno"> 3821</span>&#160;                known = <span class="keyword">False</span></div><div class="line"><a name="l03822"></a><span class="lineno"> 3822</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l03823"></a><span class="lineno"> 3823</span>&#160;                <span class="comment"># the halo is read to a fixed literal depth.</span></div><div class="line"><a name="l03824"></a><span class="lineno"> 3824</span>&#160;                required_clean_depth = required_clean_info[0].literal_depth</div><div class="line"><a name="l03825"></a><span class="lineno"> 3825</span>&#160;                <span class="keywordflow">if</span> clean_depth &lt; required_clean_depth:</div><div class="line"><a name="l03826"></a><span class="lineno"> 3826</span>&#160;                    <span class="comment"># we definitely need this halo exchange</span></div><div class="line"><a name="l03827"></a><span class="lineno"> 3827</span>&#160;                    required = <span class="keyword">True</span></div><div class="line"><a name="l03828"></a><span class="lineno"> 3828</span>&#160;                    known = <span class="keyword">True</span></div><div class="line"><a name="l03829"></a><span class="lineno"> 3829</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l03830"></a><span class="lineno"> 3830</span>&#160;                    <span class="comment"># we definitely don&#39;t need this halo exchange</span></div><div class="line"><a name="l03831"></a><span class="lineno"> 3831</span>&#160;                    required = <span class="keyword">False</span></div><div class="line"><a name="l03832"></a><span class="lineno"> 3832</span>&#160;                    known = <span class="keyword">True</span>  <span class="comment"># redundant information as it is always known</span></div><div class="line"><a name="l03833"></a><span class="lineno"> 3833</span>&#160;            <span class="keywordflow">return</span> required, known</div><div class="line"><a name="l03834"></a><span class="lineno"> 3834</span>&#160;</div><div class="line"><a name="l03835"></a><span class="lineno"> 3835</span>&#160;        <span class="comment"># We now know that at least one required_clean entry has a</span></div><div class="line"><a name="l03836"></a><span class="lineno"> 3836</span>&#160;        <span class="comment"># variable depth and any required_clean fixed depths are less</span></div><div class="line"><a name="l03837"></a><span class="lineno"> 3837</span>&#160;        <span class="comment"># than the cleaned depth so we may need a halo exchange.</span></div><div class="line"><a name="l03838"></a><span class="lineno"> 3838</span>&#160;        required = <span class="keyword">True</span></div><div class="line"><a name="l03839"></a><span class="lineno"> 3839</span>&#160;        known = <span class="keyword">False</span></div><div class="line"><a name="l03840"></a><span class="lineno"> 3840</span>&#160;        <span class="keywordflow">return</span> required, known</div><div class="line"><a name="l03841"></a><span class="lineno"> 3841</span>&#160;</div><div class="line"><a name="l03842"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchange.html#a9198f4c1fc7512950865f03951c2a0ca"> 3842</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchange.html#a9198f4c1fc7512950865f03951c2a0ca">view</a>(self, indent=0):</div><div class="line"><a name="l03843"></a><span class="lineno"> 3843</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Class specific view  &#39;&#39;&#39;</span></div><div class="line"><a name="l03844"></a><span class="lineno"> 3844</span>&#160;        _, known = self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchange.html#ab6e8d1f34c19cd0694cb1babdf070735">required</a>()</div><div class="line"><a name="l03845"></a><span class="lineno"> 3845</span>&#160;        runtime_check = <span class="keywordflow">not</span> known</div><div class="line"><a name="l03846"></a><span class="lineno"> 3846</span>&#160;        field_id = self._field.name</div><div class="line"><a name="l03847"></a><span class="lineno"> 3847</span>&#160;        <span class="keywordflow">if</span> self.vector_index:</div><div class="line"><a name="l03848"></a><span class="lineno"> 3848</span>&#160;            field_id += <span class="stringliteral">&quot;({0})&quot;</span>.format(self.vector_index)</div><div class="line"><a name="l03849"></a><span class="lineno"> 3849</span>&#160;        print(self.indent(indent) + (</div><div class="line"><a name="l03850"></a><span class="lineno"> 3850</span>&#160;            <span class="stringliteral">&quot;{0}[field=&#39;{1}&#39;, type=&#39;{2}&#39;, depth={3}, &quot;</span></div><div class="line"><a name="l03851"></a><span class="lineno"> 3851</span>&#160;            <span class="stringliteral">&quot;check_dirty={4}]&quot;</span>.format(self.coloured_text, field_id,</div><div class="line"><a name="l03852"></a><span class="lineno"> 3852</span>&#160;                                      self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchange.html#aaa9f46bc95abf267d196c8e5a1adce17">_compute_stencil_type</a>(),</div><div class="line"><a name="l03853"></a><span class="lineno"> 3853</span>&#160;                                      self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchange.html#a68f0bca70ce833d95b3388a7dd1377e5">_compute_halo_depth</a>(),</div><div class="line"><a name="l03854"></a><span class="lineno"> 3854</span>&#160;                                      runtime_check)))</div><div class="line"><a name="l03855"></a><span class="lineno"> 3855</span>&#160;</div><div class="line"><a name="l03856"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchange.html#ae6f375e975078097400e91c61c82cecf"> 3856</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchange.html#ae6f375e975078097400e91c61c82cecf">gen_code</a>(self, parent):</div><div class="line"><a name="l03857"></a><span class="lineno"> 3857</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;Dynamo specific code generation for this class.</span></div><div class="line"><a name="l03858"></a><span class="lineno"> 3858</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03859"></a><span class="lineno"> 3859</span>&#160;<span class="stringliteral">        :param parent: an f2pygen object that will be the parent of \</span></div><div class="line"><a name="l03860"></a><span class="lineno"> 3860</span>&#160;<span class="stringliteral">        f2pygen objects created in this method</span></div><div class="line"><a name="l03861"></a><span class="lineno"> 3861</span>&#160;<span class="stringliteral">        :type parent: :py:class:`psyclone.f2pygen.BaseGen`</span></div><div class="line"><a name="l03862"></a><span class="lineno"> 3862</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03863"></a><span class="lineno"> 3863</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l03864"></a><span class="lineno"> 3864</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> IfThenGen, CallGen, CommentGen</div><div class="line"><a name="l03865"></a><span class="lineno"> 3865</span>&#160;        <span class="keywordflow">if</span> self.vector_index:</div><div class="line"><a name="l03866"></a><span class="lineno"> 3866</span>&#160;            ref = <span class="stringliteral">&quot;(&quot;</span> + str(self.vector_index) + <span class="stringliteral">&quot;)&quot;</span></div><div class="line"><a name="l03867"></a><span class="lineno"> 3867</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l03868"></a><span class="lineno"> 3868</span>&#160;            ref = <span class="stringliteral">&quot;&quot;</span></div><div class="line"><a name="l03869"></a><span class="lineno"> 3869</span>&#160;        _, known = self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchange.html#ab6e8d1f34c19cd0694cb1babdf070735">required</a>()</div><div class="line"><a name="l03870"></a><span class="lineno"> 3870</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> known:</div><div class="line"><a name="l03871"></a><span class="lineno"> 3871</span>&#160;            if_then = IfThenGen(parent, self._field.proxy_name + ref +</div><div class="line"><a name="l03872"></a><span class="lineno"> 3872</span>&#160;                                <span class="stringliteral">&quot;%is_dirty(depth=&quot;</span> +</div><div class="line"><a name="l03873"></a><span class="lineno"> 3873</span>&#160;                                self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchange.html#a68f0bca70ce833d95b3388a7dd1377e5">_compute_halo_depth</a>() + <span class="stringliteral">&quot;)&quot;</span>)</div><div class="line"><a name="l03874"></a><span class="lineno"> 3874</span>&#160;            parent.add(if_then)</div><div class="line"><a name="l03875"></a><span class="lineno"> 3875</span>&#160;            halo_parent = if_then</div><div class="line"><a name="l03876"></a><span class="lineno"> 3876</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l03877"></a><span class="lineno"> 3877</span>&#160;            halo_parent = parent</div><div class="line"><a name="l03878"></a><span class="lineno"> 3878</span>&#160;        halo_parent.add(</div><div class="line"><a name="l03879"></a><span class="lineno"> 3879</span>&#160;            CallGen(</div><div class="line"><a name="l03880"></a><span class="lineno"> 3880</span>&#160;                halo_parent, name=self._field.proxy_name + ref +</div><div class="line"><a name="l03881"></a><span class="lineno"> 3881</span>&#160;                <span class="stringliteral">&quot;%&quot;</span> + self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchange.html#a0afb6ca563169f95acdba0f8a94ef06c">_halo_exchange_name</a> +</div><div class="line"><a name="l03882"></a><span class="lineno"> 3882</span>&#160;                <span class="stringliteral">&quot;(depth=&quot;</span> + self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchange.html#a68f0bca70ce833d95b3388a7dd1377e5">_compute_halo_depth</a>() + <span class="stringliteral">&quot;)&quot;</span>))</div><div class="line"><a name="l03883"></a><span class="lineno"> 3883</span>&#160;        parent.add(CommentGen(parent, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l03884"></a><span class="lineno"> 3884</span>&#160;</div><div class="line"><a name="l03885"></a><span class="lineno"> 3885</span>&#160;</div><div class="line"><a name="l03886"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchangeStart.html"> 3886</a></span>&#160;<span class="keyword">class </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchangeStart.html">DynHaloExchangeStart</a>(<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchange.html">DynHaloExchange</a>):</div><div class="line"><a name="l03887"></a><span class="lineno"> 3887</span>&#160;    <span class="stringliteral">&#39;&#39;&#39;The start of an asynchronous halo exchange. This is similar to a</span></div><div class="line"><a name="l03888"></a><span class="lineno"> 3888</span>&#160;<span class="stringliteral">    regular halo exchange except that the Fortran name of the call is</span></div><div class="line"><a name="l03889"></a><span class="lineno"> 3889</span>&#160;<span class="stringliteral">    different and the routine only reads the data being transferred</span></div><div class="line"><a name="l03890"></a><span class="lineno"> 3890</span>&#160;<span class="stringliteral">    (the associated field is specified as having a read access). As a</span></div><div class="line"><a name="l03891"></a><span class="lineno"> 3891</span>&#160;<span class="stringliteral">    result this class is not able to determine some important</span></div><div class="line"><a name="l03892"></a><span class="lineno"> 3892</span>&#160;<span class="stringliteral">    properties (such as whether the halo exchange is known to be</span></div><div class="line"><a name="l03893"></a><span class="lineno"> 3893</span>&#160;<span class="stringliteral">    required or not). This is solved by finding the corresponding</span></div><div class="line"><a name="l03894"></a><span class="lineno"> 3894</span>&#160;<span class="stringliteral">    asynchronous halo exchange end (a halo exchange start always has a</span></div><div class="line"><a name="l03895"></a><span class="lineno"> 3895</span>&#160;<span class="stringliteral">    corresponding halo exchange end and vice versa) and calling its</span></div><div class="line"><a name="l03896"></a><span class="lineno"> 3896</span>&#160;<span class="stringliteral">    methods (a halo exchange end is specified as having readwrite</span></div><div class="line"><a name="l03897"></a><span class="lineno"> 3897</span>&#160;<span class="stringliteral">    access to its associated field and therefore is able to determine</span></div><div class="line"><a name="l03898"></a><span class="lineno"> 3898</span>&#160;<span class="stringliteral">    the required properties).</span></div><div class="line"><a name="l03899"></a><span class="lineno"> 3899</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03900"></a><span class="lineno"> 3900</span>&#160;<span class="stringliteral">    :param field: the field that this halo exchange will act on</span></div><div class="line"><a name="l03901"></a><span class="lineno"> 3901</span>&#160;<span class="stringliteral">    :type field: :py:class:`psyclone.dynamo0p3.DynKernelArgument`</span></div><div class="line"><a name="l03902"></a><span class="lineno"> 3902</span>&#160;<span class="stringliteral">    :param check_dirty: optional argument (default True) indicating \</span></div><div class="line"><a name="l03903"></a><span class="lineno"> 3903</span>&#160;<span class="stringliteral">    whether this halo exchange should be subject to a run-time check \</span></div><div class="line"><a name="l03904"></a><span class="lineno"> 3904</span>&#160;<span class="stringliteral">    for clean/dirty halos.</span></div><div class="line"><a name="l03905"></a><span class="lineno"> 3905</span>&#160;<span class="stringliteral">    :type check_dirty: bool</span></div><div class="line"><a name="l03906"></a><span class="lineno"> 3906</span>&#160;<span class="stringliteral">    :param vector_index: optional vector index (default None) to \</span></div><div class="line"><a name="l03907"></a><span class="lineno"> 3907</span>&#160;<span class="stringliteral">    identify which component of a vector field this halo exchange is \</span></div><div class="line"><a name="l03908"></a><span class="lineno"> 3908</span>&#160;<span class="stringliteral">    responsible for</span></div><div class="line"><a name="l03909"></a><span class="lineno"> 3909</span>&#160;<span class="stringliteral">    :type vector_index: int</span></div><div class="line"><a name="l03910"></a><span class="lineno"> 3910</span>&#160;<span class="stringliteral">    :param parent: optional PSyIRe parent node (default None) of this \</span></div><div class="line"><a name="l03911"></a><span class="lineno"> 3911</span>&#160;<span class="stringliteral">    object</span></div><div class="line"><a name="l03912"></a><span class="lineno"> 3912</span>&#160;<span class="stringliteral">    :type parent: :py:class:`psyclone.psyGen.node`</span></div><div class="line"><a name="l03913"></a><span class="lineno"> 3913</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03914"></a><span class="lineno"> 3914</span>&#160;<span class="stringliteral">    &#39;&#39;&#39;</span></div><div class="line"><a name="l03915"></a><span class="lineno"> 3915</span>&#160;    <span class="keyword">def </span>__init__(self, field, check_dirty=True,</div><div class="line"><a name="l03916"></a><span class="lineno"> 3916</span>&#160;                 vector_index=<span class="keywordtype">None</span>, parent=<span class="keywordtype">None</span>):</div><div class="line"><a name="l03917"></a><span class="lineno"> 3917</span>&#160;        DynHaloExchange.__init__(self, field, check_dirty=check_dirty,</div><div class="line"><a name="l03918"></a><span class="lineno"> 3918</span>&#160;                                 vector_index=vector_index, parent=parent)</div><div class="line"><a name="l03919"></a><span class="lineno"> 3919</span>&#160;        <span class="comment"># Update the field&#39;s access appropriately. Here &quot;gh_read&quot;</span></div><div class="line"><a name="l03920"></a><span class="lineno"> 3920</span>&#160;        <span class="comment"># specifies that the start of a halo exchange only reads</span></div><div class="line"><a name="l03921"></a><span class="lineno"> 3921</span>&#160;        <span class="comment"># the field&#39;s data.</span></div><div class="line"><a name="l03922"></a><span class="lineno"> 3922</span>&#160;        self._field.access = <span class="stringliteral">&quot;gh_read&quot;</span></div><div class="line"><a name="l03923"></a><span class="lineno"> 3923</span>&#160;        <span class="comment"># override appropriate parent class names</span></div><div class="line"><a name="l03924"></a><span class="lineno"> 3924</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchange.html#a0afb6ca563169f95acdba0f8a94ef06c">_halo_exchange_name</a> = <span class="stringliteral">&quot;halo_exchange_start&quot;</span></div><div class="line"><a name="l03925"></a><span class="lineno"> 3925</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchangeStart.html#a3e828f2a888258edcb855d7b8a2a9c36">_text_name</a> = <span class="stringliteral">&quot;HaloExchangeStart&quot;</span></div><div class="line"><a name="l03926"></a><span class="lineno"> 3926</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchangeStart.html#a2069c1041b9650e0d02733f02727da4f">_colour_map_name</a> = <span class="stringliteral">&quot;HaloExchangeStart&quot;</span></div><div class="line"><a name="l03927"></a><span class="lineno"> 3927</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchangeStart.html#aa966b6c2e80fe7e524844319ac67716c">_dag_name</a> = <span class="stringliteral">&quot;haloexchangestart&quot;</span></div><div class="line"><a name="l03928"></a><span class="lineno"> 3928</span>&#160;</div><div class="line"><a name="l03929"></a><span class="lineno"> 3929</span>&#160;    <span class="keyword">def </span>_compute_stencil_type(self):</div><div class="line"><a name="l03930"></a><span class="lineno"> 3930</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;Call the required method in the corresponding halo exchange end</span></div><div class="line"><a name="l03931"></a><span class="lineno"> 3931</span>&#160;<span class="stringliteral">        object. This is done as the field in halo exchange start is</span></div><div class="line"><a name="l03932"></a><span class="lineno"> 3932</span>&#160;<span class="stringliteral">        only read and the dependence analysis beneath this call</span></div><div class="line"><a name="l03933"></a><span class="lineno"> 3933</span>&#160;<span class="stringliteral">        requires the field to be modified.</span></div><div class="line"><a name="l03934"></a><span class="lineno"> 3934</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03935"></a><span class="lineno"> 3935</span>&#160;<span class="stringliteral">        :return: Return the type of stencil required for this pair of \</span></div><div class="line"><a name="l03936"></a><span class="lineno"> 3936</span>&#160;<span class="stringliteral">        halo exchanges</span></div><div class="line"><a name="l03937"></a><span class="lineno"> 3937</span>&#160;<span class="stringliteral">        :rtype: str</span></div><div class="line"><a name="l03938"></a><span class="lineno"> 3938</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03939"></a><span class="lineno"> 3939</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l03940"></a><span class="lineno"> 3940</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchangeStart.html#ab36d0b93ada041cf787b3aabf68bb42a">_get_hex_end</a>()._compute_stencil_type()</div><div class="line"><a name="l03941"></a><span class="lineno"> 3941</span>&#160;</div><div class="line"><a name="l03942"></a><span class="lineno"> 3942</span>&#160;    <span class="keyword">def </span>_compute_halo_depth(self):</div><div class="line"><a name="l03943"></a><span class="lineno"> 3943</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;Call the required method in the corresponding halo exchange end</span></div><div class="line"><a name="l03944"></a><span class="lineno"> 3944</span>&#160;<span class="stringliteral">        object. This is done as the field in halo exchange start is</span></div><div class="line"><a name="l03945"></a><span class="lineno"> 3945</span>&#160;<span class="stringliteral">        only read and the dependence analysis beneath this call</span></div><div class="line"><a name="l03946"></a><span class="lineno"> 3946</span>&#160;<span class="stringliteral">        requires the field to be modified.</span></div><div class="line"><a name="l03947"></a><span class="lineno"> 3947</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03948"></a><span class="lineno"> 3948</span>&#160;<span class="stringliteral">        :return: Return the halo exchange depth as a Fortran string</span></div><div class="line"><a name="l03949"></a><span class="lineno"> 3949</span>&#160;<span class="stringliteral">        :rtype: str</span></div><div class="line"><a name="l03950"></a><span class="lineno"> 3950</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03951"></a><span class="lineno"> 3951</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l03952"></a><span class="lineno"> 3952</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchangeStart.html#ab36d0b93ada041cf787b3aabf68bb42a">_get_hex_end</a>()._compute_halo_depth()</div><div class="line"><a name="l03953"></a><span class="lineno"> 3953</span>&#160;</div><div class="line"><a name="l03954"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchangeStart.html#a236038487501eea4285b63c119846ec4"> 3954</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchangeStart.html#a236038487501eea4285b63c119846ec4">required</a>(self):</div><div class="line"><a name="l03955"></a><span class="lineno"> 3955</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;Call the required method in the corresponding halo exchange end</span></div><div class="line"><a name="l03956"></a><span class="lineno"> 3956</span>&#160;<span class="stringliteral">        object. This is done as the field in halo exchange start is</span></div><div class="line"><a name="l03957"></a><span class="lineno"> 3957</span>&#160;<span class="stringliteral">        only read and the dependence analysis beneath this call</span></div><div class="line"><a name="l03958"></a><span class="lineno"> 3958</span>&#160;<span class="stringliteral">        requires the field to be modified.</span></div><div class="line"><a name="l03959"></a><span class="lineno"> 3959</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03960"></a><span class="lineno"> 3960</span>&#160;<span class="stringliteral">        :return: Returns (x, y) where x specifies whether this halo \</span></div><div class="line"><a name="l03961"></a><span class="lineno"> 3961</span>&#160;<span class="stringliteral">        exchange is (or might be) required - True, or is not required \</span></div><div class="line"><a name="l03962"></a><span class="lineno"> 3962</span>&#160;<span class="stringliteral">        - False. If the first tuple item is True then the second \</span></div><div class="line"><a name="l03963"></a><span class="lineno"> 3963</span>&#160;<span class="stringliteral">        argument specifies whether we definitely know that we need the \</span></div><div class="line"><a name="l03964"></a><span class="lineno"> 3964</span>&#160;<span class="stringliteral">        HaloExchange - True, or are not sure - False.</span></div><div class="line"><a name="l03965"></a><span class="lineno"> 3965</span>&#160;<span class="stringliteral">        :rtype: (bool, bool)</span></div><div class="line"><a name="l03966"></a><span class="lineno"> 3966</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03967"></a><span class="lineno"> 3967</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l03968"></a><span class="lineno"> 3968</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchangeStart.html#ab36d0b93ada041cf787b3aabf68bb42a">_get_hex_end</a>().<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchangeStart.html#a236038487501eea4285b63c119846ec4">required</a>()</div><div class="line"><a name="l03969"></a><span class="lineno"> 3969</span>&#160;</div><div class="line"><a name="l03970"></a><span class="lineno"> 3970</span>&#160;    <span class="keyword">def </span>_get_hex_end(self):</div><div class="line"><a name="l03971"></a><span class="lineno"> 3971</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;An internal helper routine for this class which finds the halo</span></div><div class="line"><a name="l03972"></a><span class="lineno"> 3972</span>&#160;<span class="stringliteral">        exchange end object corresponding to this halo exchange start</span></div><div class="line"><a name="l03973"></a><span class="lineno"> 3973</span>&#160;<span class="stringliteral">        object or raises an exception if one is not found.</span></div><div class="line"><a name="l03974"></a><span class="lineno"> 3974</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03975"></a><span class="lineno"> 3975</span>&#160;<span class="stringliteral">        :return: The corresponding halo exchange end object</span></div><div class="line"><a name="l03976"></a><span class="lineno"> 3976</span>&#160;<span class="stringliteral">        :rtype: :py:class:`psyclone.dynamo0p3.DynHaloExchangeEnd`</span></div><div class="line"><a name="l03977"></a><span class="lineno"> 3977</span>&#160;<span class="stringliteral">        :raises GenerationError: If no matching HaloExchangeEnd is \</span></div><div class="line"><a name="l03978"></a><span class="lineno"> 3978</span>&#160;<span class="stringliteral">        found, or if the first matching haloexchange that is found is \</span></div><div class="line"><a name="l03979"></a><span class="lineno"> 3979</span>&#160;<span class="stringliteral">        not a HaloExchangeEnd</span></div><div class="line"><a name="l03980"></a><span class="lineno"> 3980</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l03981"></a><span class="lineno"> 3981</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l03982"></a><span class="lineno"> 3982</span>&#160;        <span class="comment"># Look at all nodes following this one in schedule order</span></div><div class="line"><a name="l03983"></a><span class="lineno"> 3983</span>&#160;        <span class="comment"># (which is PSyIRe node order)</span></div><div class="line"><a name="l03984"></a><span class="lineno"> 3984</span>&#160;        <span class="keywordflow">for</span> node <span class="keywordflow">in</span> self.following():</div><div class="line"><a name="l03985"></a><span class="lineno"> 3985</span>&#160;            <span class="keywordflow">if</span> self.sameParent(node) <span class="keywordflow">and</span> isinstance(node, DynHaloExchange):</div><div class="line"><a name="l03986"></a><span class="lineno"> 3986</span>&#160;                <span class="comment"># Found a following `haloexchange`,</span></div><div class="line"><a name="l03987"></a><span class="lineno"> 3987</span>&#160;                <span class="comment"># `haloexchangestart` or `haloexchangeend` PSyIRe node</span></div><div class="line"><a name="l03988"></a><span class="lineno"> 3988</span>&#160;                <span class="comment"># that is at the same calling hierarchy level as this</span></div><div class="line"><a name="l03989"></a><span class="lineno"> 3989</span>&#160;                <span class="comment"># haloexchangestart</span></div><div class="line"><a name="l03990"></a><span class="lineno"> 3990</span>&#160;                access = DataAccess(self.field)</div><div class="line"><a name="l03991"></a><span class="lineno"> 3991</span>&#160;                <span class="keywordflow">if</span> access.overlaps(node.field):</div><div class="line"><a name="l03992"></a><span class="lineno"> 3992</span>&#160;                    <span class="keywordflow">if</span> isinstance(node, DynHaloExchangeEnd):</div><div class="line"><a name="l03993"></a><span class="lineno"> 3993</span>&#160;                        <span class="keywordflow">return</span> node</div><div class="line"><a name="l03994"></a><span class="lineno"> 3994</span>&#160;                    <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l03995"></a><span class="lineno"> 3995</span>&#160;                        <span class="stringliteral">&quot;Halo exchange start for field &#39;{0}&#39; should match &quot;</span></div><div class="line"><a name="l03996"></a><span class="lineno"> 3996</span>&#160;                        <span class="stringliteral">&quot;with a halo exchange end, but found {1}&quot;</span>.format(</div><div class="line"><a name="l03997"></a><span class="lineno"> 3997</span>&#160;                            self.field.name, type(node)))</div><div class="line"><a name="l03998"></a><span class="lineno"> 3998</span>&#160;        <span class="comment"># no match has been found which is an error as a halo exchange</span></div><div class="line"><a name="l03999"></a><span class="lineno"> 3999</span>&#160;        <span class="comment"># start should always have a matching halo exchange end that</span></div><div class="line"><a name="l04000"></a><span class="lineno"> 4000</span>&#160;        <span class="comment"># follows it in schedule (PSyIRe sibling) order</span></div><div class="line"><a name="l04001"></a><span class="lineno"> 4001</span>&#160;        <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l04002"></a><span class="lineno"> 4002</span>&#160;            <span class="stringliteral">&quot;Halo exchange start for field &#39;{0}&#39; has no matching halo &quot;</span></div><div class="line"><a name="l04003"></a><span class="lineno"> 4003</span>&#160;            <span class="stringliteral">&quot;exchange end&quot;</span>.format(self.field.name))</div><div class="line"><a name="l04004"></a><span class="lineno"> 4004</span>&#160;</div><div class="line"><a name="l04005"></a><span class="lineno"> 4005</span>&#160;</div><div class="line"><a name="l04006"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchangeEnd.html"> 4006</a></span>&#160;<span class="keyword">class </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchangeEnd.html">DynHaloExchangeEnd</a>(<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchange.html">DynHaloExchange</a>):</div><div class="line"><a name="l04007"></a><span class="lineno"> 4007</span>&#160;    <span class="stringliteral">&#39;&#39;&#39;The end of an asynchronous halo exchange. This is similar to a</span></div><div class="line"><a name="l04008"></a><span class="lineno"> 4008</span>&#160;<span class="stringliteral">    regular halo exchange except that the Fortran name of the call is</span></div><div class="line"><a name="l04009"></a><span class="lineno"> 4009</span>&#160;<span class="stringliteral">    different and the routine only writes to the data being</span></div><div class="line"><a name="l04010"></a><span class="lineno"> 4010</span>&#160;<span class="stringliteral">    transferred.</span></div><div class="line"><a name="l04011"></a><span class="lineno"> 4011</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04012"></a><span class="lineno"> 4012</span>&#160;<span class="stringliteral">    :param field: the field that this halo exchange will act on</span></div><div class="line"><a name="l04013"></a><span class="lineno"> 4013</span>&#160;<span class="stringliteral">    :type field: :py:class:`psyclone.dynamo0p3.DynKernelArgument`</span></div><div class="line"><a name="l04014"></a><span class="lineno"> 4014</span>&#160;<span class="stringliteral">    :param check_dirty: optional argument (default True) indicating \</span></div><div class="line"><a name="l04015"></a><span class="lineno"> 4015</span>&#160;<span class="stringliteral">    whether this halo exchange should be subject to a run-time check \</span></div><div class="line"><a name="l04016"></a><span class="lineno"> 4016</span>&#160;<span class="stringliteral">    for clean/dirty halos.</span></div><div class="line"><a name="l04017"></a><span class="lineno"> 4017</span>&#160;<span class="stringliteral">    :type check_dirty: bool</span></div><div class="line"><a name="l04018"></a><span class="lineno"> 4018</span>&#160;<span class="stringliteral">    :param vector_index: optional vector index (default None) to \</span></div><div class="line"><a name="l04019"></a><span class="lineno"> 4019</span>&#160;<span class="stringliteral">    identify which index of a vector field this halo exchange is \</span></div><div class="line"><a name="l04020"></a><span class="lineno"> 4020</span>&#160;<span class="stringliteral">    responsible for</span></div><div class="line"><a name="l04021"></a><span class="lineno"> 4021</span>&#160;<span class="stringliteral">    :type vector_index: int</span></div><div class="line"><a name="l04022"></a><span class="lineno"> 4022</span>&#160;<span class="stringliteral">    :param parent: optional PSyIRe parent node (default None) of this \</span></div><div class="line"><a name="l04023"></a><span class="lineno"> 4023</span>&#160;<span class="stringliteral">    object</span></div><div class="line"><a name="l04024"></a><span class="lineno"> 4024</span>&#160;<span class="stringliteral">    :type parent: :py:class:`psyclone.psyGen.node`</span></div><div class="line"><a name="l04025"></a><span class="lineno"> 4025</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04026"></a><span class="lineno"> 4026</span>&#160;<span class="stringliteral">    &#39;&#39;&#39;</span></div><div class="line"><a name="l04027"></a><span class="lineno"> 4027</span>&#160;    <span class="keyword">def </span>__init__(self, field, check_dirty=True,</div><div class="line"><a name="l04028"></a><span class="lineno"> 4028</span>&#160;                 vector_index=<span class="keywordtype">None</span>, parent=<span class="keywordtype">None</span>):</div><div class="line"><a name="l04029"></a><span class="lineno"> 4029</span>&#160;        DynHaloExchange.__init__(self, field, check_dirty=check_dirty,</div><div class="line"><a name="l04030"></a><span class="lineno"> 4030</span>&#160;                                 vector_index=vector_index, parent=parent)</div><div class="line"><a name="l04031"></a><span class="lineno"> 4031</span>&#160;        <span class="comment"># Update field properties appropriately. The associated field is</span></div><div class="line"><a name="l04032"></a><span class="lineno"> 4032</span>&#160;        <span class="comment"># written to. However, a readwrite field access needs to be</span></div><div class="line"><a name="l04033"></a><span class="lineno"> 4033</span>&#160;        <span class="comment"># specified as this is required for the halo exchange logic to</span></div><div class="line"><a name="l04034"></a><span class="lineno"> 4034</span>&#160;        <span class="comment"># work correctly.</span></div><div class="line"><a name="l04035"></a><span class="lineno"> 4035</span>&#160;        self._field.access = <span class="stringliteral">&quot;gh_readwrite&quot;</span></div><div class="line"><a name="l04036"></a><span class="lineno"> 4036</span>&#160;        <span class="comment"># override appropriate parent class names</span></div><div class="line"><a name="l04037"></a><span class="lineno"> 4037</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchange.html#a0afb6ca563169f95acdba0f8a94ef06c">_halo_exchange_name</a> = <span class="stringliteral">&quot;halo_exchange_finish&quot;</span></div><div class="line"><a name="l04038"></a><span class="lineno"> 4038</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchangeEnd.html#ad505c6feed09f84f04343c7fbf85c91a">_text_name</a> = <span class="stringliteral">&quot;HaloExchangeEnd&quot;</span></div><div class="line"><a name="l04039"></a><span class="lineno"> 4039</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchangeEnd.html#a159052ea44a656c92c7af2d31b4d1fd8">_colour_map_name</a> = <span class="stringliteral">&quot;HaloExchangeEnd&quot;</span></div><div class="line"><a name="l04040"></a><span class="lineno"> 4040</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchangeEnd.html#a03600c23d33bb4ae40f90ab5ae23d1a1">_dag_name</a> = <span class="stringliteral">&quot;haloexchangeend&quot;</span></div><div class="line"><a name="l04041"></a><span class="lineno"> 4041</span>&#160;</div><div class="line"><a name="l04042"></a><span class="lineno"> 4042</span>&#160;</div><div class="line"><a name="l04043"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html"> 4043</a></span>&#160;<span class="keyword">class </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html">HaloDepth</a>(object):</div><div class="line"><a name="l04044"></a><span class="lineno"> 4044</span>&#160;    <span class="stringliteral">&#39;&#39;&#39;Determines how much of the halo a read to a field accesses (the</span></div><div class="line"><a name="l04045"></a><span class="lineno"> 4045</span>&#160;<span class="stringliteral">    halo depth)</span></div><div class="line"><a name="l04046"></a><span class="lineno"> 4046</span>&#160;<span class="stringliteral">    &#39;&#39;&#39;</span></div><div class="line"><a name="l04047"></a><span class="lineno"> 4047</span>&#160;    <span class="keyword">def </span>__init__(self):</div><div class="line"><a name="l04048"></a><span class="lineno"> 4048</span>&#160;        <span class="comment"># literal_depth is used to store any known (literal) component</span></div><div class="line"><a name="l04049"></a><span class="lineno"> 4049</span>&#160;        <span class="comment"># of the depth of halo that is accessed. It may not be the</span></div><div class="line"><a name="l04050"></a><span class="lineno"> 4050</span>&#160;        <span class="comment"># full depth as there may also be an additional var_depth</span></div><div class="line"><a name="l04051"></a><span class="lineno"> 4051</span>&#160;        <span class="comment"># specified.</span></div><div class="line"><a name="l04052"></a><span class="lineno"> 4052</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#a9ec284ef4c9e724a2559ef6ec796df7c">_literal_depth</a> = 0</div><div class="line"><a name="l04053"></a><span class="lineno"> 4053</span>&#160;        <span class="comment"># var_depth is used to store any variable component of the</span></div><div class="line"><a name="l04054"></a><span class="lineno"> 4054</span>&#160;        <span class="comment"># depth of halo that is accessed. It may not be the full depth</span></div><div class="line"><a name="l04055"></a><span class="lineno"> 4055</span>&#160;        <span class="comment"># as there may also be an additional literal_depth specified.</span></div><div class="line"><a name="l04056"></a><span class="lineno"> 4056</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#acead237039ac82e5535c17be35c9b7e5">_var_depth</a> = <span class="keywordtype">None</span></div><div class="line"><a name="l04057"></a><span class="lineno"> 4057</span>&#160;        <span class="comment"># max_depth specifies whether the full depth of halo (whatever</span></div><div class="line"><a name="l04058"></a><span class="lineno"> 4058</span>&#160;        <span class="comment"># that might be) is accessed. If this is set then</span></div><div class="line"><a name="l04059"></a><span class="lineno"> 4059</span>&#160;        <span class="comment"># literal_depth, var_depth and max_depth_m1 have no</span></div><div class="line"><a name="l04060"></a><span class="lineno"> 4060</span>&#160;        <span class="comment"># meaning. max_depth being False does not necessarily mean the</span></div><div class="line"><a name="l04061"></a><span class="lineno"> 4061</span>&#160;        <span class="comment"># full halo depth is not accessed, rather it means that we do</span></div><div class="line"><a name="l04062"></a><span class="lineno"> 4062</span>&#160;        <span class="comment"># not know.</span></div><div class="line"><a name="l04063"></a><span class="lineno"> 4063</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#aa22905dcd5f158b9d0e7266ec0219cee">_max_depth</a> = <span class="keyword">False</span></div><div class="line"><a name="l04064"></a><span class="lineno"> 4064</span>&#160;        <span class="comment"># max_depth_m1 specifies whether the full depth of halo</span></div><div class="line"><a name="l04065"></a><span class="lineno"> 4065</span>&#160;        <span class="comment"># (whatever that might be) apart from the outermost level is</span></div><div class="line"><a name="l04066"></a><span class="lineno"> 4066</span>&#160;        <span class="comment"># accessed. If this is set then literal_depth, var_depth and</span></div><div class="line"><a name="l04067"></a><span class="lineno"> 4067</span>&#160;        <span class="comment"># max_depth have no meaning.</span></div><div class="line"><a name="l04068"></a><span class="lineno"> 4068</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#a28f57642fb50e76f572a8b9c03206296">_max_depth_m1</a> = <span class="keyword">False</span></div><div class="line"><a name="l04069"></a><span class="lineno"> 4069</span>&#160;        <span class="comment"># annexed only is True if the only access in the halo is for</span></div><div class="line"><a name="l04070"></a><span class="lineno"> 4070</span>&#160;        <span class="comment"># annexed dofs</span></div><div class="line"><a name="l04071"></a><span class="lineno"> 4071</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#a0d88a9597dfafaa51d993aa5b598a1d9">_annexed_only</a> = <span class="keyword">False</span></div><div class="line"><a name="l04072"></a><span class="lineno"> 4072</span>&#160;</div><div class="line"><a name="l04073"></a><span class="lineno"> 4073</span>&#160;    @property</div><div class="line"><a name="l04074"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#a6b1d9b5dea66bcb74c8f0ed5863b48bd"> 4074</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#a6b1d9b5dea66bcb74c8f0ed5863b48bd">annexed_only</a>(self):</div><div class="line"><a name="l04075"></a><span class="lineno"> 4075</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;Returns whether the access to the halo is solely to annexed dofs,</span></div><div class="line"><a name="l04076"></a><span class="lineno"> 4076</span>&#160;<span class="stringliteral">        or not</span></div><div class="line"><a name="l04077"></a><span class="lineno"> 4077</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04078"></a><span class="lineno"> 4078</span>&#160;<span class="stringliteral">        :return: Return True if only annexed dofs are accessed in the</span></div><div class="line"><a name="l04079"></a><span class="lineno"> 4079</span>&#160;<span class="stringliteral">        halo and False otherwise</span></div><div class="line"><a name="l04080"></a><span class="lineno"> 4080</span>&#160;<span class="stringliteral">        :rtype: bool</span></div><div class="line"><a name="l04081"></a><span class="lineno"> 4081</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04082"></a><span class="lineno"> 4082</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l04083"></a><span class="lineno"> 4083</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#a0d88a9597dfafaa51d993aa5b598a1d9">_annexed_only</a></div><div class="line"><a name="l04084"></a><span class="lineno"> 4084</span>&#160;</div><div class="line"><a name="l04085"></a><span class="lineno"> 4085</span>&#160;    @property</div><div class="line"><a name="l04086"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#ac74d5d72d6cc19ef8fd1bbbdd0b85f27"> 4086</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#ac74d5d72d6cc19ef8fd1bbbdd0b85f27">max_depth</a>(self):</div><div class="line"><a name="l04087"></a><span class="lineno"> 4087</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;Returns whether the read to the field is known to access all of the</span></div><div class="line"><a name="l04088"></a><span class="lineno"> 4088</span>&#160;<span class="stringliteral">        halo or not</span></div><div class="line"><a name="l04089"></a><span class="lineno"> 4089</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04090"></a><span class="lineno"> 4090</span>&#160;<span class="stringliteral">        :return: Return True if the read to the field is known to</span></div><div class="line"><a name="l04091"></a><span class="lineno"> 4091</span>&#160;<span class="stringliteral">        access all of the halo and False otherwise</span></div><div class="line"><a name="l04092"></a><span class="lineno"> 4092</span>&#160;<span class="stringliteral">        :rtype: bool</span></div><div class="line"><a name="l04093"></a><span class="lineno"> 4093</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04094"></a><span class="lineno"> 4094</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l04095"></a><span class="lineno"> 4095</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#aa22905dcd5f158b9d0e7266ec0219cee">_max_depth</a></div><div class="line"><a name="l04096"></a><span class="lineno"> 4096</span>&#160;</div><div class="line"><a name="l04097"></a><span class="lineno"> 4097</span>&#160;    @property</div><div class="line"><a name="l04098"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#a09d622939f894cc8a6093a2b52877d68"> 4098</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#a09d622939f894cc8a6093a2b52877d68">max_depth_m1</a>(self):</div><div class="line"><a name="l04099"></a><span class="lineno"> 4099</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;Returns whether the read to the field is known to access all of the</span></div><div class="line"><a name="l04100"></a><span class="lineno"> 4100</span>&#160;<span class="stringliteral">        halo except the outermost level or not.</span></div><div class="line"><a name="l04101"></a><span class="lineno"> 4101</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04102"></a><span class="lineno"> 4102</span>&#160;<span class="stringliteral">        :return: Return True if the read to the field is known to</span></div><div class="line"><a name="l04103"></a><span class="lineno"> 4103</span>&#160;<span class="stringliteral">        access all of the halo except the outermost and False otherwise</span></div><div class="line"><a name="l04104"></a><span class="lineno"> 4104</span>&#160;<span class="stringliteral">        :rtype: bool</span></div><div class="line"><a name="l04105"></a><span class="lineno"> 4105</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04106"></a><span class="lineno"> 4106</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l04107"></a><span class="lineno"> 4107</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#a28f57642fb50e76f572a8b9c03206296">_max_depth_m1</a></div><div class="line"><a name="l04108"></a><span class="lineno"> 4108</span>&#160;</div><div class="line"><a name="l04109"></a><span class="lineno"> 4109</span>&#160;    @property</div><div class="line"><a name="l04110"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#afbc641943077a044897b0260b9f301b3"> 4110</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#afbc641943077a044897b0260b9f301b3">var_depth</a>(self):</div><div class="line"><a name="l04111"></a><span class="lineno"> 4111</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;Returns the name of the variable specifying the depth of halo</span></div><div class="line"><a name="l04112"></a><span class="lineno"> 4112</span>&#160;<span class="stringliteral">        access if one is provided. Note, a variable will only be provided for</span></div><div class="line"><a name="l04113"></a><span class="lineno"> 4113</span>&#160;<span class="stringliteral">        stencil accesses. Also note, this depth should be added to the</span></div><div class="line"><a name="l04114"></a><span class="lineno"> 4114</span>&#160;<span class="stringliteral">        literal_depth to find the total depth.</span></div><div class="line"><a name="l04115"></a><span class="lineno"> 4115</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04116"></a><span class="lineno"> 4116</span>&#160;<span class="stringliteral">        :return: Return a variable name specifying the halo</span></div><div class="line"><a name="l04117"></a><span class="lineno"> 4117</span>&#160;<span class="stringliteral">        access depth, if one exists, and None if not</span></div><div class="line"><a name="l04118"></a><span class="lineno"> 4118</span>&#160;<span class="stringliteral">        :rtype: String</span></div><div class="line"><a name="l04119"></a><span class="lineno"> 4119</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04120"></a><span class="lineno"> 4120</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l04121"></a><span class="lineno"> 4121</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#acead237039ac82e5535c17be35c9b7e5">_var_depth</a></div><div class="line"><a name="l04122"></a><span class="lineno"> 4122</span>&#160;</div><div class="line"><a name="l04123"></a><span class="lineno"> 4123</span>&#160;    @property</div><div class="line"><a name="l04124"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#a9b79c4954987bd96d0eaa5c44cade64d"> 4124</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#a9b79c4954987bd96d0eaa5c44cade64d">literal_depth</a>(self):</div><div class="line"><a name="l04125"></a><span class="lineno"> 4125</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;Returns the known fixed (literal) depth of halo access. Note, this</span></div><div class="line"><a name="l04126"></a><span class="lineno"> 4126</span>&#160;<span class="stringliteral">        depth should be added to the var_depth to find the total</span></div><div class="line"><a name="l04127"></a><span class="lineno"> 4127</span>&#160;<span class="stringliteral">        depth.</span></div><div class="line"><a name="l04128"></a><span class="lineno"> 4128</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04129"></a><span class="lineno"> 4129</span>&#160;<span class="stringliteral">        :return: Return the known fixed (literal) halo</span></div><div class="line"><a name="l04130"></a><span class="lineno"> 4130</span>&#160;<span class="stringliteral">        access depth</span></div><div class="line"><a name="l04131"></a><span class="lineno"> 4131</span>&#160;<span class="stringliteral">        :rtype: integer</span></div><div class="line"><a name="l04132"></a><span class="lineno"> 4132</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04133"></a><span class="lineno"> 4133</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l04134"></a><span class="lineno"> 4134</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#a9ec284ef4c9e724a2559ef6ec796df7c">_literal_depth</a></div><div class="line"><a name="l04135"></a><span class="lineno"> 4135</span>&#160;</div><div class="line"><a name="l04136"></a><span class="lineno"> 4136</span>&#160;    @literal_depth.setter</div><div class="line"><a name="l04137"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#aa199fb120bb396cc91b0435643a19b90"> 4137</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#a9b79c4954987bd96d0eaa5c44cade64d">literal_depth</a>(self, value):</div><div class="line"><a name="l04138"></a><span class="lineno"> 4138</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Set the known fixed (literal) depth of halo access.</span></div><div class="line"><a name="l04139"></a><span class="lineno"> 4139</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04140"></a><span class="lineno"> 4140</span>&#160;<span class="stringliteral">        :parameter value: Set the known fixed (literal) halo</span></div><div class="line"><a name="l04141"></a><span class="lineno"> 4141</span>&#160;<span class="stringliteral">        access depth</span></div><div class="line"><a name="l04142"></a><span class="lineno"> 4142</span>&#160;<span class="stringliteral">        :type value: integer</span></div><div class="line"><a name="l04143"></a><span class="lineno"> 4143</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04144"></a><span class="lineno"> 4144</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l04145"></a><span class="lineno"> 4145</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#a9ec284ef4c9e724a2559ef6ec796df7c">_literal_depth</a> = value</div><div class="line"><a name="l04146"></a><span class="lineno"> 4146</span>&#160;</div><div class="line"><a name="l04147"></a><span class="lineno"> 4147</span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#a98e2bcdad2d36e7f819b07fb3c4b054a">set_by_value</a>(self, max_depth, var_depth, literal_depth, annexed_only,</div><div class="line"><a name="l04148"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#a98e2bcdad2d36e7f819b07fb3c4b054a"> 4148</a></span>&#160;                     max_depth_m1):</div><div class="line"><a name="l04149"></a><span class="lineno"> 4149</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;Set halo depth information directly</span></div><div class="line"><a name="l04150"></a><span class="lineno"> 4150</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04151"></a><span class="lineno"> 4151</span>&#160;<span class="stringliteral">        :param bool max_depth: True if the field accesses all of the \</span></div><div class="line"><a name="l04152"></a><span class="lineno"> 4152</span>&#160;<span class="stringliteral">        halo and False otherwise</span></div><div class="line"><a name="l04153"></a><span class="lineno"> 4153</span>&#160;<span class="stringliteral">        :param str var_depth: A variable name specifying the halo \</span></div><div class="line"><a name="l04154"></a><span class="lineno"> 4154</span>&#160;<span class="stringliteral">        access depth, if one exists, and None if not</span></div><div class="line"><a name="l04155"></a><span class="lineno"> 4155</span>&#160;<span class="stringliteral">        :param int literal_depth: The known fixed (literal) halo \</span></div><div class="line"><a name="l04156"></a><span class="lineno"> 4156</span>&#160;<span class="stringliteral">        access depth</span></div><div class="line"><a name="l04157"></a><span class="lineno"> 4157</span>&#160;<span class="stringliteral">        :param bool annexed_only: True if only the halo&#39;s annexed dofs \</span></div><div class="line"><a name="l04158"></a><span class="lineno"> 4158</span>&#160;<span class="stringliteral">        are accessed and False otherwise</span></div><div class="line"><a name="l04159"></a><span class="lineno"> 4159</span>&#160;<span class="stringliteral">        :param bool max_depth_m1: True if the field accesses all of \</span></div><div class="line"><a name="l04160"></a><span class="lineno"> 4160</span>&#160;<span class="stringliteral">        the halo but does not require the outermost halo to be correct \</span></div><div class="line"><a name="l04161"></a><span class="lineno"> 4161</span>&#160;<span class="stringliteral">        and False otherwise</span></div><div class="line"><a name="l04162"></a><span class="lineno"> 4162</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04163"></a><span class="lineno"> 4163</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l04164"></a><span class="lineno"> 4164</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#aa22905dcd5f158b9d0e7266ec0219cee">_max_depth</a> = max_depth</div><div class="line"><a name="l04165"></a><span class="lineno"> 4165</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#acead237039ac82e5535c17be35c9b7e5">_var_depth</a> = var_depth</div><div class="line"><a name="l04166"></a><span class="lineno"> 4166</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#a9ec284ef4c9e724a2559ef6ec796df7c">_literal_depth</a> = literal_depth</div><div class="line"><a name="l04167"></a><span class="lineno"> 4167</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#a0d88a9597dfafaa51d993aa5b598a1d9">_annexed_only</a> = annexed_only</div><div class="line"><a name="l04168"></a><span class="lineno"> 4168</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#a28f57642fb50e76f572a8b9c03206296">_max_depth_m1</a> = max_depth_m1</div><div class="line"><a name="l04169"></a><span class="lineno"> 4169</span>&#160;</div><div class="line"><a name="l04170"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#a752e3a171a3e70f00d52b5985c175716"> 4170</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#a752e3a171a3e70f00d52b5985c175716">__str__</a>(self):</div><div class="line"><a name="l04171"></a><span class="lineno"> 4171</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;return the depth of a halo dependency</span></div><div class="line"><a name="l04172"></a><span class="lineno"> 4172</span>&#160;<span class="stringliteral">        as a string&#39;&#39;&#39;</span></div><div class="line"><a name="l04173"></a><span class="lineno"> 4173</span>&#160;        depth_str = <span class="stringliteral">&quot;&quot;</span></div><div class="line"><a name="l04174"></a><span class="lineno"> 4174</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#ac74d5d72d6cc19ef8fd1bbbdd0b85f27">max_depth</a>:</div><div class="line"><a name="l04175"></a><span class="lineno"> 4175</span>&#160;            depth_str += <span class="stringliteral">&quot;mesh%get_halo_depth()&quot;</span></div><div class="line"><a name="l04176"></a><span class="lineno"> 4176</span>&#160;        <span class="keywordflow">elif</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#a09d622939f894cc8a6093a2b52877d68">max_depth_m1</a>:</div><div class="line"><a name="l04177"></a><span class="lineno"> 4177</span>&#160;            depth_str += <span class="stringliteral">&quot;mesh%get_halo_depth()-1&quot;</span></div><div class="line"><a name="l04178"></a><span class="lineno"> 4178</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l04179"></a><span class="lineno"> 4179</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#afbc641943077a044897b0260b9f301b3">var_depth</a>:</div><div class="line"><a name="l04180"></a><span class="lineno"> 4180</span>&#160;                depth_str += self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#afbc641943077a044897b0260b9f301b3">var_depth</a></div><div class="line"><a name="l04181"></a><span class="lineno"> 4181</span>&#160;                <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#a9b79c4954987bd96d0eaa5c44cade64d">literal_depth</a>:</div><div class="line"><a name="l04182"></a><span class="lineno"> 4182</span>&#160;                    depth_str += <span class="stringliteral">&quot;+&quot;</span></div><div class="line"><a name="l04183"></a><span class="lineno"> 4183</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#a9b79c4954987bd96d0eaa5c44cade64d">literal_depth</a>:</div><div class="line"><a name="l04184"></a><span class="lineno"> 4184</span>&#160;                depth_str += str(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#a9b79c4954987bd96d0eaa5c44cade64d">literal_depth</a>)</div><div class="line"><a name="l04185"></a><span class="lineno"> 4185</span>&#160;        <span class="keywordflow">return</span> depth_str</div><div class="line"><a name="l04186"></a><span class="lineno"> 4186</span>&#160;</div><div class="line"><a name="l04187"></a><span class="lineno"> 4187</span>&#160;</div><div class="line"><a name="l04188"></a><span class="lineno"> 4188</span>&#160;<span class="keyword">def </span>halo_check_arg(field, access_types):</div><div class="line"><a name="l04189"></a><span class="lineno"> 4189</span>&#160;    <span class="stringliteral">&#39;&#39;&#39;Support function which performs checks to ensure the first argument</span></div><div class="line"><a name="l04190"></a><span class="lineno"> 4190</span>&#160;<span class="stringliteral">    is a field, that the field is contained within Kernel or Builtin</span></div><div class="line"><a name="l04191"></a><span class="lineno"> 4191</span>&#160;<span class="stringliteral">    call and that the field is accessed in one of the ways specified</span></div><div class="line"><a name="l04192"></a><span class="lineno"> 4192</span>&#160;<span class="stringliteral">    by the second argument. If no error is reported it returns the</span></div><div class="line"><a name="l04193"></a><span class="lineno"> 4193</span>&#160;<span class="stringliteral">    call object containing this argument</span></div><div class="line"><a name="l04194"></a><span class="lineno"> 4194</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04195"></a><span class="lineno"> 4195</span>&#160;<span class="stringliteral">    :param field: the argument object we are checking</span></div><div class="line"><a name="l04196"></a><span class="lineno"> 4196</span>&#160;<span class="stringliteral">    :type field: :py:class:`psyclone.dynamo0p3.DynArgument`</span></div><div class="line"><a name="l04197"></a><span class="lineno"> 4197</span>&#160;<span class="stringliteral">    :param access_types: list of access types that the field access</span></div><div class="line"><a name="l04198"></a><span class="lineno"> 4198</span>&#160;<span class="stringliteral">    must be one of</span></div><div class="line"><a name="l04199"></a><span class="lineno"> 4199</span>&#160;<span class="stringliteral">    :type access_types: :func:`list` of String</span></div><div class="line"><a name="l04200"></a><span class="lineno"> 4200</span>&#160;<span class="stringliteral">    :return: the call containing the argument object</span></div><div class="line"><a name="l04201"></a><span class="lineno"> 4201</span>&#160;<span class="stringliteral">    :rtype: :py:class:`psyclone.psyGen.Call`</span></div><div class="line"><a name="l04202"></a><span class="lineno"> 4202</span>&#160;<span class="stringliteral">    :raises GenerationError: if the first argument to this function is</span></div><div class="line"><a name="l04203"></a><span class="lineno"> 4203</span>&#160;<span class="stringliteral">    the wrong type</span></div><div class="line"><a name="l04204"></a><span class="lineno"> 4204</span>&#160;<span class="stringliteral">    :raises GenerationError: if the first argument is not accessed in</span></div><div class="line"><a name="l04205"></a><span class="lineno"> 4205</span>&#160;<span class="stringliteral">    one of the ways specified by the second argument to the function</span></div><div class="line"><a name="l04206"></a><span class="lineno"> 4206</span>&#160;<span class="stringliteral">    :raises GenerationError: if the first argument is not contained</span></div><div class="line"><a name="l04207"></a><span class="lineno"> 4207</span>&#160;<span class="stringliteral">    within a call object</span></div><div class="line"><a name="l04208"></a><span class="lineno"> 4208</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04209"></a><span class="lineno"> 4209</span>&#160;<span class="stringliteral">    &#39;&#39;&#39;</span></div><div class="line"><a name="l04210"></a><span class="lineno"> 4210</span>&#160;    <span class="keywordflow">try</span>:</div><div class="line"><a name="l04211"></a><span class="lineno"> 4211</span>&#160;        <span class="comment"># get the kernel/builtin call associated with this field</span></div><div class="line"><a name="l04212"></a><span class="lineno"> 4212</span>&#160;        call = field.call</div><div class="line"><a name="l04213"></a><span class="lineno"> 4213</span>&#160;    <span class="keywordflow">except</span> AttributeError:</div><div class="line"><a name="l04214"></a><span class="lineno"> 4214</span>&#160;        <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l04215"></a><span class="lineno"> 4215</span>&#160;            <span class="stringliteral">&quot;HaloInfo class expects an argument of type DynArgument, or &quot;</span></div><div class="line"><a name="l04216"></a><span class="lineno"> 4216</span>&#160;            <span class="stringliteral">&quot;equivalent, on initialisation, but found, &quot;</span></div><div class="line"><a name="l04217"></a><span class="lineno"> 4217</span>&#160;            <span class="stringliteral">&quot;&#39;{0}&#39;&quot;</span>.format(type(field)))</div><div class="line"><a name="l04218"></a><span class="lineno"> 4218</span>&#160;    <span class="keywordflow">if</span> field.access <span class="keywordflow">not</span> <span class="keywordflow">in</span> access_types:</div><div class="line"><a name="l04219"></a><span class="lineno"> 4219</span>&#160;        <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l04220"></a><span class="lineno"> 4220</span>&#160;            <span class="stringliteral">&quot;In HaloInfo class, field &#39;{0}&#39; should be one of {1}, but found &quot;</span></div><div class="line"><a name="l04221"></a><span class="lineno"> 4221</span>&#160;            <span class="stringliteral">&quot;&#39;{2}&#39;&quot;</span>.format(field.name, access_types, field.access))</div><div class="line"><a name="l04222"></a><span class="lineno"> 4222</span>&#160;    <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1dynamo0p3__builtins.html">psyclone.dynamo0p3_builtins</a> <span class="keyword">import</span> DynBuiltIn</div><div class="line"><a name="l04223"></a><span class="lineno"> 4223</span>&#160;    <span class="keywordflow">if</span> <span class="keywordflow">not</span> (isinstance(call, DynKern) <span class="keywordflow">or</span> isinstance(call, DynBuiltIn)):</div><div class="line"><a name="l04224"></a><span class="lineno"> 4224</span>&#160;        <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l04225"></a><span class="lineno"> 4225</span>&#160;            <span class="stringliteral">&quot;In HaloInfo class, field &#39;{0}&#39; should be from a call but &quot;</span></div><div class="line"><a name="l04226"></a><span class="lineno"> 4226</span>&#160;            <span class="stringliteral">&quot;found {1}&quot;</span>.format(field.name, type(call)))</div><div class="line"><a name="l04227"></a><span class="lineno"> 4227</span>&#160;    <span class="keywordflow">return</span> call</div><div class="line"><a name="l04228"></a><span class="lineno"> 4228</span>&#160;</div><div class="line"><a name="l04229"></a><span class="lineno"> 4229</span>&#160;</div><div class="line"><a name="l04230"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1HaloWriteAccess.html"> 4230</a></span>&#160;<span class="keyword">class </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloWriteAccess.html">HaloWriteAccess</a>(<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html">HaloDepth</a>):</div><div class="line"><a name="l04231"></a><span class="lineno"> 4231</span>&#160;    <span class="stringliteral">&#39;&#39;&#39;Determines how much of a field&#39;s halo is written to (the halo depth)</span></div><div class="line"><a name="l04232"></a><span class="lineno"> 4232</span>&#160;<span class="stringliteral">    when a field is accessed in a particular kernel within a</span></div><div class="line"><a name="l04233"></a><span class="lineno"> 4233</span>&#160;<span class="stringliteral">    particular loop nest</span></div><div class="line"><a name="l04234"></a><span class="lineno"> 4234</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04235"></a><span class="lineno"> 4235</span>&#160;<span class="stringliteral">    &#39;&#39;&#39;</span></div><div class="line"><a name="l04236"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1HaloWriteAccess.html#aa749ce094789a63b46b186a85cb91705"> 4236</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloWriteAccess.html#aa749ce094789a63b46b186a85cb91705">__init__</a>(self, field):</div><div class="line"><a name="l04237"></a><span class="lineno"> 4237</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l04238"></a><span class="lineno"> 4238</span>&#160;<span class="stringliteral">        :param field: the field that we are concerned with</span></div><div class="line"><a name="l04239"></a><span class="lineno"> 4239</span>&#160;<span class="stringliteral">        :type field: :py:class:`psyclone.dynamo0p3.DynArgument`</span></div><div class="line"><a name="l04240"></a><span class="lineno"> 4240</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04241"></a><span class="lineno"> 4241</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l04242"></a><span class="lineno"> 4242</span>&#160;</div><div class="line"><a name="l04243"></a><span class="lineno"> 4243</span>&#160;        HaloDepth.__init__(self)</div><div class="line"><a name="l04244"></a><span class="lineno"> 4244</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloWriteAccess.html#a84b4381357c5de55645e59273aa90181">_compute_from_field</a>(field)</div><div class="line"><a name="l04245"></a><span class="lineno"> 4245</span>&#160;</div><div class="line"><a name="l04246"></a><span class="lineno"> 4246</span>&#160;    @property</div><div class="line"><a name="l04247"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1HaloWriteAccess.html#a87e4f90d63fa2104e001f2c6428c3fe1"> 4247</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloWriteAccess.html#a87e4f90d63fa2104e001f2c6428c3fe1">dirty_outer</a>(self):</div><div class="line"><a name="l04248"></a><span class="lineno"> 4248</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;Returns True if the writer is continuous and accesses the halo and</span></div><div class="line"><a name="l04249"></a><span class="lineno"> 4249</span>&#160;<span class="stringliteral">        False otherwise. It indicates that the outer level of halo that has</span></div><div class="line"><a name="l04250"></a><span class="lineno"> 4250</span>&#160;<span class="stringliteral">        been written to is actually dirty (well to be precise it is a partial</span></div><div class="line"><a name="l04251"></a><span class="lineno"> 4251</span>&#160;<span class="stringliteral">        sum).</span></div><div class="line"><a name="l04252"></a><span class="lineno"> 4252</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04253"></a><span class="lineno"> 4253</span>&#160;<span class="stringliteral">        :return: Return True if the outer layer of halo</span></div><div class="line"><a name="l04254"></a><span class="lineno"> 4254</span>&#160;<span class="stringliteral">        that is written to remains dirty and False otherwise.</span></div><div class="line"><a name="l04255"></a><span class="lineno"> 4255</span>&#160;<span class="stringliteral">        :rtype: bool</span></div><div class="line"><a name="l04256"></a><span class="lineno"> 4256</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04257"></a><span class="lineno"> 4257</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l04258"></a><span class="lineno"> 4258</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloWriteAccess.html#ad7a6eff277e9869a066e218341b163f0">_dirty_outer</a></div><div class="line"><a name="l04259"></a><span class="lineno"> 4259</span>&#160;</div><div class="line"><a name="l04260"></a><span class="lineno"> 4260</span>&#160;    <span class="keyword">def </span>_compute_from_field(self, field):</div><div class="line"><a name="l04261"></a><span class="lineno"> 4261</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;Internal method to compute what parts of a field&#39;s halo are written</span></div><div class="line"><a name="l04262"></a><span class="lineno"> 4262</span>&#160;<span class="stringliteral">        to in a certain kernel and loop. The information computed is</span></div><div class="line"><a name="l04263"></a><span class="lineno"> 4263</span>&#160;<span class="stringliteral">        the depth of access and validity of the data after</span></div><div class="line"><a name="l04264"></a><span class="lineno"> 4264</span>&#160;<span class="stringliteral">        writing. The depth of access can be the maximum halo depth or</span></div><div class="line"><a name="l04265"></a><span class="lineno"> 4265</span>&#160;<span class="stringliteral">        a literal depth and the outer halo layer that is written to</span></div><div class="line"><a name="l04266"></a><span class="lineno"> 4266</span>&#160;<span class="stringliteral">        may be dirty or clean.</span></div><div class="line"><a name="l04267"></a><span class="lineno"> 4267</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04268"></a><span class="lineno"> 4268</span>&#160;<span class="stringliteral">        :param field: the field that we are concerned with</span></div><div class="line"><a name="l04269"></a><span class="lineno"> 4269</span>&#160;<span class="stringliteral">        :type field: :py:class:`psyclone.dynamo0p3.DynArgument`</span></div><div class="line"><a name="l04270"></a><span class="lineno"> 4270</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04271"></a><span class="lineno"> 4271</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l04272"></a><span class="lineno"> 4272</span>&#160;        call = halo_check_arg(field, GH_WRITE_ACCESSES)</div><div class="line"><a name="l04273"></a><span class="lineno"> 4273</span>&#160;        <span class="comment"># no test required here as all calls exist within a loop</span></div><div class="line"><a name="l04274"></a><span class="lineno"> 4274</span>&#160;        loop = call.parent</div><div class="line"><a name="l04275"></a><span class="lineno"> 4275</span>&#160;        <span class="comment"># The outermost halo level that is written to is dirty if it</span></div><div class="line"><a name="l04276"></a><span class="lineno"> 4276</span>&#160;        <span class="comment"># is a continuous field which writes into the halo in a loop</span></div><div class="line"><a name="l04277"></a><span class="lineno"> 4277</span>&#160;        <span class="comment"># over cells</span></div><div class="line"><a name="l04278"></a><span class="lineno"> 4278</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloWriteAccess.html#ad7a6eff277e9869a066e218341b163f0">_dirty_outer</a> = (</div><div class="line"><a name="l04279"></a><span class="lineno"> 4279</span>&#160;            <span class="keywordflow">not</span> field.discontinuous <span class="keywordflow">and</span></div><div class="line"><a name="l04280"></a><span class="lineno"> 4280</span>&#160;            loop.iteration_space == <span class="stringliteral">&quot;cells&quot;</span> <span class="keywordflow">and</span></div><div class="line"><a name="l04281"></a><span class="lineno"> 4281</span>&#160;            loop.upper_bound_name <span class="keywordflow">in</span> HALO_ACCESS_LOOP_BOUNDS)</div><div class="line"><a name="l04282"></a><span class="lineno"> 4282</span>&#160;        depth = 0</div><div class="line"><a name="l04283"></a><span class="lineno"> 4283</span>&#160;        max_depth = <span class="keyword">False</span></div><div class="line"><a name="l04284"></a><span class="lineno"> 4284</span>&#160;        <span class="keywordflow">if</span> loop.upper_bound_name <span class="keywordflow">in</span> HALO_ACCESS_LOOP_BOUNDS:</div><div class="line"><a name="l04285"></a><span class="lineno"> 4285</span>&#160;            <span class="comment"># loop does redundant computation</span></div><div class="line"><a name="l04286"></a><span class="lineno"> 4286</span>&#160;            <span class="keywordflow">if</span> loop.upper_bound_halo_depth:</div><div class="line"><a name="l04287"></a><span class="lineno"> 4287</span>&#160;                <span class="comment"># loop redundant computation is to a fixed literal depth</span></div><div class="line"><a name="l04288"></a><span class="lineno"> 4288</span>&#160;                depth = loop.upper_bound_halo_depth</div><div class="line"><a name="l04289"></a><span class="lineno"> 4289</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l04290"></a><span class="lineno"> 4290</span>&#160;                <span class="comment"># loop redundant computation is to the maximum depth</span></div><div class="line"><a name="l04291"></a><span class="lineno"> 4291</span>&#160;                max_depth = <span class="keyword">True</span></div><div class="line"><a name="l04292"></a><span class="lineno"> 4292</span>&#160;        <span class="comment"># If this is an inter-grid kernel and we&#39;re writing to the</span></div><div class="line"><a name="l04293"></a><span class="lineno"> 4293</span>&#160;        <span class="comment"># field on the fine mesh then the halo depth is effectively</span></div><div class="line"><a name="l04294"></a><span class="lineno"> 4294</span>&#160;        <span class="comment"># doubled</span></div><div class="line"><a name="l04295"></a><span class="lineno"> 4295</span>&#160;        <span class="keywordflow">if</span> call.is_intergrid <span class="keywordflow">and</span> field.mesh == <span class="stringliteral">&quot;gh_fine&quot;</span>:</div><div class="line"><a name="l04296"></a><span class="lineno"> 4296</span>&#160;            depth *= 2</div><div class="line"><a name="l04297"></a><span class="lineno"> 4297</span>&#160;        <span class="comment"># The third argument for set_by_value specifies the name of a</span></div><div class="line"><a name="l04298"></a><span class="lineno"> 4298</span>&#160;        <span class="comment"># variable used to specify the depth. Variables are currently</span></div><div class="line"><a name="l04299"></a><span class="lineno"> 4299</span>&#160;        <span class="comment"># not used when a halo is written to, so we pass None which</span></div><div class="line"><a name="l04300"></a><span class="lineno"> 4300</span>&#160;        <span class="comment"># indicates there is no variable.  the fifth argument for</span></div><div class="line"><a name="l04301"></a><span class="lineno"> 4301</span>&#160;        <span class="comment"># set_by_value indicates whether we only access</span></div><div class="line"><a name="l04302"></a><span class="lineno"> 4302</span>&#160;        <span class="comment"># annexed_dofs. At the moment this is not possible when</span></div><div class="line"><a name="l04303"></a><span class="lineno"> 4303</span>&#160;        <span class="comment"># modifying a field so we always return False. The sixth</span></div><div class="line"><a name="l04304"></a><span class="lineno"> 4304</span>&#160;        <span class="comment"># argument indicates if the depth of access is the</span></div><div class="line"><a name="l04305"></a><span class="lineno"> 4305</span>&#160;        <span class="comment"># maximum-1. This is not possible here so we return False.</span></div><div class="line"><a name="l04306"></a><span class="lineno"> 4306</span>&#160;        HaloDepth.set_by_value(self, max_depth, <span class="keywordtype">None</span>, depth, <span class="keyword">False</span>, <span class="keyword">False</span>)</div><div class="line"><a name="l04307"></a><span class="lineno"> 4307</span>&#160;</div><div class="line"><a name="l04308"></a><span class="lineno"> 4308</span>&#160;</div><div class="line"><a name="l04309"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1HaloReadAccess.html"> 4309</a></span>&#160;<span class="keyword">class </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloReadAccess.html">HaloReadAccess</a>(<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html">HaloDepth</a>):</div><div class="line"><a name="l04310"></a><span class="lineno"> 4310</span>&#160;    <span class="stringliteral">&#39;&#39;&#39;Determines how much of a field&#39;s halo is read (the halo depth) and</span></div><div class="line"><a name="l04311"></a><span class="lineno"> 4311</span>&#160;<span class="stringliteral">    additionally the access pattern (the stencil) when a field is</span></div><div class="line"><a name="l04312"></a><span class="lineno"> 4312</span>&#160;<span class="stringliteral">    accessed in a particular kernel within a particular loop nest</span></div><div class="line"><a name="l04313"></a><span class="lineno"> 4313</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04314"></a><span class="lineno"> 4314</span>&#160;<span class="stringliteral">    &#39;&#39;&#39;</span></div><div class="line"><a name="l04315"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1HaloReadAccess.html#ad904f710d3138d18313a002293a88a26"> 4315</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloReadAccess.html#ad904f710d3138d18313a002293a88a26">__init__</a>(self, field):</div><div class="line"><a name="l04316"></a><span class="lineno"> 4316</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l04317"></a><span class="lineno"> 4317</span>&#160;<span class="stringliteral">        :param field: the field that we want to get information on</span></div><div class="line"><a name="l04318"></a><span class="lineno"> 4318</span>&#160;<span class="stringliteral">        :type field: :py:class:`psyclone.dynamo0p3.DynKernelArgument`</span></div><div class="line"><a name="l04319"></a><span class="lineno"> 4319</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04320"></a><span class="lineno"> 4320</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l04321"></a><span class="lineno"> 4321</span>&#160;        HaloDepth.__init__(self)</div><div class="line"><a name="l04322"></a><span class="lineno"> 4322</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloReadAccess.html#ab589e42ff99d8dafd8d7a243231348f8">_stencil_type</a> = <span class="keywordtype">None</span></div><div class="line"><a name="l04323"></a><span class="lineno"> 4323</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloReadAccess.html#aed231a71f7792fb688d9bc12ea382d6c">_needs_clean_outer</a> = <span class="keywordtype">None</span></div><div class="line"><a name="l04324"></a><span class="lineno"> 4324</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloReadAccess.html#a03ecbb9ede3a67f885cb2bb1bcd5565a">_compute_from_field</a>(field)</div><div class="line"><a name="l04325"></a><span class="lineno"> 4325</span>&#160;</div><div class="line"><a name="l04326"></a><span class="lineno"> 4326</span>&#160;    @property</div><div class="line"><a name="l04327"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1HaloReadAccess.html#a768473832b2570ccb2020ea8f5779570"> 4327</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloReadAccess.html#a768473832b2570ccb2020ea8f5779570">needs_clean_outer</a>(self):</div><div class="line"><a name="l04328"></a><span class="lineno"> 4328</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;Returns False if the reader has a gh_inc access and accesses the</span></div><div class="line"><a name="l04329"></a><span class="lineno"> 4329</span>&#160;<span class="stringliteral">        halo. Otherwise returns True.  Indicates that the outer level</span></div><div class="line"><a name="l04330"></a><span class="lineno"> 4330</span>&#160;<span class="stringliteral">        of halo that has been read does not need to be clean (although</span></div><div class="line"><a name="l04331"></a><span class="lineno"> 4331</span>&#160;<span class="stringliteral">        any annexed dofs do).</span></div><div class="line"><a name="l04332"></a><span class="lineno"> 4332</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04333"></a><span class="lineno"> 4333</span>&#160;<span class="stringliteral">        :return: Returns False if the outer layer of halo that is read \</span></div><div class="line"><a name="l04334"></a><span class="lineno"> 4334</span>&#160;<span class="stringliteral">        does not need to be clean and True otherwise.</span></div><div class="line"><a name="l04335"></a><span class="lineno"> 4335</span>&#160;<span class="stringliteral">        :rtype: bool</span></div><div class="line"><a name="l04336"></a><span class="lineno"> 4336</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04337"></a><span class="lineno"> 4337</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l04338"></a><span class="lineno"> 4338</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloReadAccess.html#aed231a71f7792fb688d9bc12ea382d6c">_needs_clean_outer</a></div><div class="line"><a name="l04339"></a><span class="lineno"> 4339</span>&#160;</div><div class="line"><a name="l04340"></a><span class="lineno"> 4340</span>&#160;    @property</div><div class="line"><a name="l04341"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1HaloReadAccess.html#a6997b1406bbac705a15999f07342371c"> 4341</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloReadAccess.html#a6997b1406bbac705a15999f07342371c">stencil_type</a>(self):</div><div class="line"><a name="l04342"></a><span class="lineno"> 4342</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;Returns the type of stencil access used by the field(s) in the halo</span></div><div class="line"><a name="l04343"></a><span class="lineno"> 4343</span>&#160;<span class="stringliteral">        if one exists. If redundant computation (accessing the full</span></div><div class="line"><a name="l04344"></a><span class="lineno"> 4344</span>&#160;<span class="stringliteral">        halo) is combined with a stencil access (potentially accessing</span></div><div class="line"><a name="l04345"></a><span class="lineno"> 4345</span>&#160;<span class="stringliteral">        a subset of the halo) then the access is assumed to be full</span></div><div class="line"><a name="l04346"></a><span class="lineno"> 4346</span>&#160;<span class="stringliteral">        access (region) for all depths.</span></div><div class="line"><a name="l04347"></a><span class="lineno"> 4347</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04348"></a><span class="lineno"> 4348</span>&#160;<span class="stringliteral">        :return: Return the type of stencil access used</span></div><div class="line"><a name="l04349"></a><span class="lineno"> 4349</span>&#160;<span class="stringliteral">        or None if there is no stencil.</span></div><div class="line"><a name="l04350"></a><span class="lineno"> 4350</span>&#160;<span class="stringliteral">        :rtype: String</span></div><div class="line"><a name="l04351"></a><span class="lineno"> 4351</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04352"></a><span class="lineno"> 4352</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l04353"></a><span class="lineno"> 4353</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloReadAccess.html#ab589e42ff99d8dafd8d7a243231348f8">_stencil_type</a></div><div class="line"><a name="l04354"></a><span class="lineno"> 4354</span>&#160;</div><div class="line"><a name="l04355"></a><span class="lineno"> 4355</span>&#160;    <span class="keyword">def </span>_compute_from_field(self, field):</div><div class="line"><a name="l04356"></a><span class="lineno"> 4356</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;Internal method to compute which parts of a field&#39;s halo are read</span></div><div class="line"><a name="l04357"></a><span class="lineno"> 4357</span>&#160;<span class="stringliteral">        in a certain kernel and loop. The information computed is the</span></div><div class="line"><a name="l04358"></a><span class="lineno"> 4358</span>&#160;<span class="stringliteral">        depth of access and the access pattern. The depth of access</span></div><div class="line"><a name="l04359"></a><span class="lineno"> 4359</span>&#160;<span class="stringliteral">        can be the maximum halo depth, a variable specifying the depth</span></div><div class="line"><a name="l04360"></a><span class="lineno"> 4360</span>&#160;<span class="stringliteral">        and/or a literal depth. The access pattern will only be</span></div><div class="line"><a name="l04361"></a><span class="lineno"> 4361</span>&#160;<span class="stringliteral">        specified if the kernel code performs a stencil access on the</span></div><div class="line"><a name="l04362"></a><span class="lineno"> 4362</span>&#160;<span class="stringliteral">        field.</span></div><div class="line"><a name="l04363"></a><span class="lineno"> 4363</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04364"></a><span class="lineno"> 4364</span>&#160;<span class="stringliteral">        :param field: the field that we are concerned with</span></div><div class="line"><a name="l04365"></a><span class="lineno"> 4365</span>&#160;<span class="stringliteral">        :type field: :py:class:`psyclone.dynamo0p3.DynArgument`</span></div><div class="line"><a name="l04366"></a><span class="lineno"> 4366</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04367"></a><span class="lineno"> 4367</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l04368"></a><span class="lineno"> 4368</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#a0d88a9597dfafaa51d993aa5b598a1d9">_annexed_only</a> = <span class="keyword">False</span></div><div class="line"><a name="l04369"></a><span class="lineno"> 4369</span>&#160;        call = halo_check_arg(field, GH_READ_ACCESSES)</div><div class="line"><a name="l04370"></a><span class="lineno"> 4370</span>&#160;        <span class="comment"># no test required here as all calls exist within a loop</span></div><div class="line"><a name="l04371"></a><span class="lineno"> 4371</span>&#160;        loop = call.parent</div><div class="line"><a name="l04372"></a><span class="lineno"> 4372</span>&#160;</div><div class="line"><a name="l04373"></a><span class="lineno"> 4373</span>&#160;        <span class="comment"># For GH_INC we accumulate contributions into the field being</span></div><div class="line"><a name="l04374"></a><span class="lineno"> 4374</span>&#160;        <span class="comment"># modified. In order to get correct results for owned and</span></div><div class="line"><a name="l04375"></a><span class="lineno"> 4375</span>&#160;        <span class="comment"># annexed dofs, this requires that the fields we are</span></div><div class="line"><a name="l04376"></a><span class="lineno"> 4376</span>&#160;        <span class="comment"># accumulating contributions from have up-to-date values in</span></div><div class="line"><a name="l04377"></a><span class="lineno"> 4377</span>&#160;        <span class="comment"># the halo cell(s). However, we do not need to be concerned</span></div><div class="line"><a name="l04378"></a><span class="lineno"> 4378</span>&#160;        <span class="comment"># with the values of the modified field in the last-level of</span></div><div class="line"><a name="l04379"></a><span class="lineno"> 4379</span>&#160;        <span class="comment"># the halo. This is because we only have enough information to</span></div><div class="line"><a name="l04380"></a><span class="lineno"> 4380</span>&#160;        <span class="comment"># partially compute the contributions in those cells</span></div><div class="line"><a name="l04381"></a><span class="lineno"> 4381</span>&#160;        <span class="comment"># anyway. (If the values of the field being modified are</span></div><div class="line"><a name="l04382"></a><span class="lineno"> 4382</span>&#160;        <span class="comment"># required, at some later point, in that level of the halo</span></div><div class="line"><a name="l04383"></a><span class="lineno"> 4383</span>&#160;        <span class="comment"># then we do a halo swap.)</span></div><div class="line"><a name="l04384"></a><span class="lineno"> 4384</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloReadAccess.html#aed231a71f7792fb688d9bc12ea382d6c">_needs_clean_outer</a> = (</div><div class="line"><a name="l04385"></a><span class="lineno"> 4385</span>&#160;            <span class="keywordflow">not</span> (field.access.lower() == <span class="stringliteral">&quot;gh_inc&quot;</span></div><div class="line"><a name="l04386"></a><span class="lineno"> 4386</span>&#160;                 <span class="keywordflow">and</span> loop.upper_bound_name <span class="keywordflow">in</span> [<span class="stringliteral">&quot;cell_halo&quot;</span>,</div><div class="line"><a name="l04387"></a><span class="lineno"> 4387</span>&#160;                                               <span class="stringliteral">&quot;colour_halo&quot;</span>]))</div><div class="line"><a name="l04388"></a><span class="lineno"> 4388</span>&#160;        <span class="comment"># now we have the parent loop we can work out what part of the</span></div><div class="line"><a name="l04389"></a><span class="lineno"> 4389</span>&#160;        <span class="comment"># halo this field accesses</span></div><div class="line"><a name="l04390"></a><span class="lineno"> 4390</span>&#160;        <span class="keywordflow">if</span> loop.upper_bound_name <span class="keywordflow">in</span> HALO_ACCESS_LOOP_BOUNDS:</div><div class="line"><a name="l04391"></a><span class="lineno"> 4391</span>&#160;            <span class="comment"># this loop performs redundant computation</span></div><div class="line"><a name="l04392"></a><span class="lineno"> 4392</span>&#160;            <span class="keywordflow">if</span> loop.upper_bound_halo_depth:</div><div class="line"><a name="l04393"></a><span class="lineno"> 4393</span>&#160;                <span class="comment"># loop redundant computation is to a fixed literal depth</span></div><div class="line"><a name="l04394"></a><span class="lineno"> 4394</span>&#160;                self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#a9ec284ef4c9e724a2559ef6ec796df7c">_literal_depth</a> = loop.upper_bound_halo_depth</div><div class="line"><a name="l04395"></a><span class="lineno"> 4395</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l04396"></a><span class="lineno"> 4396</span>&#160;                <span class="comment"># loop redundant computation is to the maximum depth</span></div><div class="line"><a name="l04397"></a><span class="lineno"> 4397</span>&#160;                self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#aa22905dcd5f158b9d0e7266ec0219cee">_max_depth</a> = <span class="keyword">True</span></div><div class="line"><a name="l04398"></a><span class="lineno"> 4398</span>&#160;        <span class="keywordflow">elif</span> loop.upper_bound_name == <span class="stringliteral">&quot;ncolour&quot;</span>:</div><div class="line"><a name="l04399"></a><span class="lineno"> 4399</span>&#160;            <span class="comment"># currenty coloured loops are always transformed from</span></div><div class="line"><a name="l04400"></a><span class="lineno"> 4400</span>&#160;            <span class="comment"># cell_halo depth 1 loops</span></div><div class="line"><a name="l04401"></a><span class="lineno"> 4401</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#a9ec284ef4c9e724a2559ef6ec796df7c">_literal_depth</a> = 1</div><div class="line"><a name="l04402"></a><span class="lineno"> 4402</span>&#160;        <span class="keywordflow">elif</span> loop.upper_bound_name <span class="keywordflow">in</span> [<span class="stringliteral">&quot;ncells&quot;</span>, <span class="stringliteral">&quot;nannexed&quot;</span>]:</div><div class="line"><a name="l04403"></a><span class="lineno"> 4403</span>&#160;            <span class="keywordflow">if</span> field.descriptor.stencil:</div><div class="line"><a name="l04404"></a><span class="lineno"> 4404</span>&#160;                <span class="comment"># no need to worry about annexed dofs (if they exist)</span></div><div class="line"><a name="l04405"></a><span class="lineno"> 4405</span>&#160;                <span class="comment"># as the stencil will cover these (this is currently</span></div><div class="line"><a name="l04406"></a><span class="lineno"> 4406</span>&#160;                <span class="comment"># guaranteed as halo exchanges only exchange full</span></div><div class="line"><a name="l04407"></a><span class="lineno"> 4407</span>&#160;                <span class="comment"># halos)</span></div><div class="line"><a name="l04408"></a><span class="lineno"> 4408</span>&#160;                <span class="keywordflow">pass</span></div><div class="line"><a name="l04409"></a><span class="lineno"> 4409</span>&#160;            <span class="keywordflow">else</span>:  <span class="comment"># there is no stencil</span></div><div class="line"><a name="l04410"></a><span class="lineno"> 4410</span>&#160;                <span class="keywordflow">if</span> field.discontinuous:</div><div class="line"><a name="l04411"></a><span class="lineno"> 4411</span>&#160;                    <span class="comment"># There are only local accesses</span></div><div class="line"><a name="l04412"></a><span class="lineno"> 4412</span>&#160;                    <span class="keywordflow">pass</span></div><div class="line"><a name="l04413"></a><span class="lineno"> 4413</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l04414"></a><span class="lineno"> 4414</span>&#160;                    <span class="comment"># This is a continuous field which therefore</span></div><div class="line"><a name="l04415"></a><span class="lineno"> 4415</span>&#160;                    <span class="comment"># accesses annexed dofs. We set access to the</span></div><div class="line"><a name="l04416"></a><span class="lineno"> 4416</span>&#160;                    <span class="comment"># level 1 halo here as there is currently no</span></div><div class="line"><a name="l04417"></a><span class="lineno"> 4417</span>&#160;                    <span class="comment"># mechanism to perform a halo exchange solely on</span></div><div class="line"><a name="l04418"></a><span class="lineno"> 4418</span>&#160;                    <span class="comment"># annexed dofs.</span></div><div class="line"><a name="l04419"></a><span class="lineno"> 4419</span>&#160;                    self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#a9ec284ef4c9e724a2559ef6ec796df7c">_literal_depth</a> = 1</div><div class="line"><a name="l04420"></a><span class="lineno"> 4420</span>&#160;                    self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#a0d88a9597dfafaa51d993aa5b598a1d9">_annexed_only</a> = <span class="keyword">True</span></div><div class="line"><a name="l04421"></a><span class="lineno"> 4421</span>&#160;        <span class="keywordflow">elif</span> loop.upper_bound_name == <span class="stringliteral">&quot;ndofs&quot;</span>:</div><div class="line"><a name="l04422"></a><span class="lineno"> 4422</span>&#160;            <span class="comment"># we only access owned dofs so there is no access to the</span></div><div class="line"><a name="l04423"></a><span class="lineno"> 4423</span>&#160;            <span class="comment"># halo</span></div><div class="line"><a name="l04424"></a><span class="lineno"> 4424</span>&#160;            <span class="keywordflow">pass</span></div><div class="line"><a name="l04425"></a><span class="lineno"> 4425</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l04426"></a><span class="lineno"> 4426</span>&#160;            <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l04427"></a><span class="lineno"> 4427</span>&#160;                <span class="stringliteral">&quot;Internal error in HaloReadAccess._compute_from_field. Found &quot;</span></div><div class="line"><a name="l04428"></a><span class="lineno"> 4428</span>&#160;                <span class="stringliteral">&quot;unexpected loop upper bound name &#39;{0}&#39;&quot;</span>.</div><div class="line"><a name="l04429"></a><span class="lineno"> 4429</span>&#160;                format(loop.upper_bound_name))</div><div class="line"><a name="l04430"></a><span class="lineno"> 4430</span>&#160;</div><div class="line"><a name="l04431"></a><span class="lineno"> 4431</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#aa22905dcd5f158b9d0e7266ec0219cee">_max_depth</a> <span class="keywordflow">or</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#acead237039ac82e5535c17be35c9b7e5">_var_depth</a> <span class="keywordflow">or</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#a9ec284ef4c9e724a2559ef6ec796df7c">_literal_depth</a>:</div><div class="line"><a name="l04432"></a><span class="lineno"> 4432</span>&#160;            <span class="comment"># Whilst stencil type has no real meaning when there is no</span></div><div class="line"><a name="l04433"></a><span class="lineno"> 4433</span>&#160;            <span class="comment"># stencil it is convenient to set it to &quot;region&quot; when</span></div><div class="line"><a name="l04434"></a><span class="lineno"> 4434</span>&#160;            <span class="comment"># there is redundant computation as the halo exchange</span></div><div class="line"><a name="l04435"></a><span class="lineno"> 4435</span>&#160;            <span class="comment"># logic is interested in the access pattern irrespective</span></div><div class="line"><a name="l04436"></a><span class="lineno"> 4436</span>&#160;            <span class="comment"># of whether there is a stencil access or not. We use</span></div><div class="line"><a name="l04437"></a><span class="lineno"> 4437</span>&#160;            <span class="comment"># &quot;region&quot; as it means access all of the halo data which</span></div><div class="line"><a name="l04438"></a><span class="lineno"> 4438</span>&#160;            <span class="comment"># is what is done when performing redundant computation</span></div><div class="line"><a name="l04439"></a><span class="lineno"> 4439</span>&#160;            <span class="comment"># with no stencil.</span></div><div class="line"><a name="l04440"></a><span class="lineno"> 4440</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloReadAccess.html#ab589e42ff99d8dafd8d7a243231348f8">_stencil_type</a> = <span class="stringliteral">&quot;region&quot;</span></div><div class="line"><a name="l04441"></a><span class="lineno"> 4441</span>&#160;        <span class="keywordflow">if</span> field.descriptor.stencil:</div><div class="line"><a name="l04442"></a><span class="lineno"> 4442</span>&#160;            <span class="comment"># field has a stencil access</span></div><div class="line"><a name="l04443"></a><span class="lineno"> 4443</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#aa22905dcd5f158b9d0e7266ec0219cee">_max_depth</a>:</div><div class="line"><a name="l04444"></a><span class="lineno"> 4444</span>&#160;                <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l04445"></a><span class="lineno"> 4445</span>&#160;                    <span class="stringliteral">&quot;redundant computation to max depth with a stencil is &quot;</span></div><div class="line"><a name="l04446"></a><span class="lineno"> 4446</span>&#160;                    <span class="stringliteral">&quot;invalid&quot;</span>)</div><div class="line"><a name="l04447"></a><span class="lineno"> 4447</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l04448"></a><span class="lineno"> 4448</span>&#160;                self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloReadAccess.html#ab589e42ff99d8dafd8d7a243231348f8">_stencil_type</a> = field.descriptor.stencil[<span class="stringliteral">&#39;type&#39;</span>]</div><div class="line"><a name="l04449"></a><span class="lineno"> 4449</span>&#160;                <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#a9ec284ef4c9e724a2559ef6ec796df7c">_literal_depth</a>:</div><div class="line"><a name="l04450"></a><span class="lineno"> 4450</span>&#160;                    <span class="comment"># halo exchange does not support mixed accesses to the halo</span></div><div class="line"><a name="l04451"></a><span class="lineno"> 4451</span>&#160;                    self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloReadAccess.html#ab589e42ff99d8dafd8d7a243231348f8">_stencil_type</a> = <span class="stringliteral">&quot;region&quot;</span></div><div class="line"><a name="l04452"></a><span class="lineno"> 4452</span>&#160;                stencil_depth = field.descriptor.stencil[<span class="stringliteral">&#39;extent&#39;</span>]</div><div class="line"><a name="l04453"></a><span class="lineno"> 4453</span>&#160;                <span class="keywordflow">if</span> stencil_depth:</div><div class="line"><a name="l04454"></a><span class="lineno"> 4454</span>&#160;                    <span class="comment"># stencil_depth is provided in the kernel metadata</span></div><div class="line"><a name="l04455"></a><span class="lineno"> 4455</span>&#160;                    self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#a9ec284ef4c9e724a2559ef6ec796df7c">_literal_depth</a> += stencil_depth</div><div class="line"><a name="l04456"></a><span class="lineno"> 4456</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l04457"></a><span class="lineno"> 4457</span>&#160;                    <span class="comment"># stencil_depth is provided by the algorithm layer</span></div><div class="line"><a name="l04458"></a><span class="lineno"> 4458</span>&#160;                    <span class="keywordflow">if</span> field.stencil.extent_arg.is_literal():</div><div class="line"><a name="l04459"></a><span class="lineno"> 4459</span>&#160;                        <span class="comment"># a literal is specified</span></div><div class="line"><a name="l04460"></a><span class="lineno"> 4460</span>&#160;                        value_str = field.stencil.extent_arg.text</div><div class="line"><a name="l04461"></a><span class="lineno"> 4461</span>&#160;                        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#a9ec284ef4c9e724a2559ef6ec796df7c">_literal_depth</a> += int(value_str)</div><div class="line"><a name="l04462"></a><span class="lineno"> 4462</span>&#160;                    <span class="keywordflow">else</span>:</div><div class="line"><a name="l04463"></a><span class="lineno"> 4463</span>&#160;                        <span class="comment"># a variable is specified</span></div><div class="line"><a name="l04464"></a><span class="lineno"> 4464</span>&#160;                        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#acead237039ac82e5535c17be35c9b7e5">_var_depth</a> = field.stencil.extent_arg.varName</div><div class="line"><a name="l04465"></a><span class="lineno"> 4465</span>&#160;        <span class="comment"># If this is an intergrid kernel and the field in question is on</span></div><div class="line"><a name="l04466"></a><span class="lineno"> 4466</span>&#160;        <span class="comment"># the fine mesh then we must double the halo depth</span></div><div class="line"><a name="l04467"></a><span class="lineno"> 4467</span>&#160;        <span class="keywordflow">if</span> call.is_intergrid <span class="keywordflow">and</span> field.mesh == <span class="stringliteral">&quot;gh_fine&quot;</span>:</div><div class="line"><a name="l04468"></a><span class="lineno"> 4468</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#a9ec284ef4c9e724a2559ef6ec796df7c">_literal_depth</a>:</div><div class="line"><a name="l04469"></a><span class="lineno"> 4469</span>&#160;                self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#a9ec284ef4c9e724a2559ef6ec796df7c">_literal_depth</a> *= 2</div><div class="line"><a name="l04470"></a><span class="lineno"> 4470</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#acead237039ac82e5535c17be35c9b7e5">_var_depth</a>:</div><div class="line"><a name="l04471"></a><span class="lineno"> 4471</span>&#160;                self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#acead237039ac82e5535c17be35c9b7e5">_var_depth</a> = <span class="stringliteral">&quot;2*&quot;</span> + self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#acead237039ac82e5535c17be35c9b7e5">_var_depth</a></div><div class="line"><a name="l04472"></a><span class="lineno"> 4472</span>&#160;</div><div class="line"><a name="l04473"></a><span class="lineno"> 4473</span>&#160;</div><div class="line"><a name="l04474"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html"> 4474</a></span>&#160;<span class="keyword">class </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html">DynLoop</a>(<a class="code" href="classpsyclone_1_1psyGen_1_1Loop.html">Loop</a>):</div><div class="line"><a name="l04475"></a><span class="lineno"> 4475</span>&#160;    <span class="stringliteral">&#39;&#39;&#39; The Dynamo specific Loop class. This passes the Dynamo</span></div><div class="line"><a name="l04476"></a><span class="lineno"> 4476</span>&#160;<span class="stringliteral">    specific loop information to the base class so it creates the one</span></div><div class="line"><a name="l04477"></a><span class="lineno"> 4477</span>&#160;<span class="stringliteral">    we require.  Creates Dynamo specific loop bounds when the code is</span></div><div class="line"><a name="l04478"></a><span class="lineno"> 4478</span>&#160;<span class="stringliteral">    being generated. &#39;&#39;&#39;</span></div><div class="line"><a name="l04479"></a><span class="lineno"> 4479</span>&#160;</div><div class="line"><a name="l04480"></a><span class="lineno"> 4480</span>&#160;    <span class="keyword">def </span>__init__(self, parent=None, loop_type=&quot;&quot;):</div><div class="line"><a name="l04481"></a><span class="lineno"> 4481</span>&#160;        Loop.__init__(self, parent=parent,</div><div class="line"><a name="l04482"></a><span class="lineno"> 4482</span>&#160;                      valid_loop_types=VALID_LOOP_TYPES)</div><div class="line"><a name="l04483"></a><span class="lineno"> 4483</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#ab6e98882a59da51132a4a938eb897f48">loop_type</a> = loop_type</div><div class="line"><a name="l04484"></a><span class="lineno"> 4484</span>&#160;</div><div class="line"><a name="l04485"></a><span class="lineno"> 4485</span>&#160;        <span class="comment"># Get the namespace manager instance so we can look-up</span></div><div class="line"><a name="l04486"></a><span class="lineno"> 4486</span>&#160;        <span class="comment"># the name of the nlayers and ndf variables</span></div><div class="line"><a name="l04487"></a><span class="lineno"> 4487</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a8375c9c467fb25eefdd8ab348ae4a45b">_name_space_manager</a> = NameSpaceFactory().create()</div><div class="line"><a name="l04488"></a><span class="lineno"> 4488</span>&#160;</div><div class="line"><a name="l04489"></a><span class="lineno"> 4489</span>&#160;        <span class="comment"># set our variable name at initialisation as it might be</span></div><div class="line"><a name="l04490"></a><span class="lineno"> 4490</span>&#160;        <span class="comment"># required by other classes before code generation</span></div><div class="line"><a name="l04491"></a><span class="lineno"> 4491</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a1ff44a76dff13cfb47c2d0fa65923451">_loop_type</a> == <span class="stringliteral">&quot;colours&quot;</span>:</div><div class="line"><a name="l04492"></a><span class="lineno"> 4492</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a78f6b013a7ce8269108b6b582e4ba998">_variable_name</a> = <span class="stringliteral">&quot;colour&quot;</span></div><div class="line"><a name="l04493"></a><span class="lineno"> 4493</span>&#160;        <span class="keywordflow">elif</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a1ff44a76dff13cfb47c2d0fa65923451">_loop_type</a> == <span class="stringliteral">&quot;colour&quot;</span>:</div><div class="line"><a name="l04494"></a><span class="lineno"> 4494</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a78f6b013a7ce8269108b6b582e4ba998">_variable_name</a> = <span class="stringliteral">&quot;cell&quot;</span></div><div class="line"><a name="l04495"></a><span class="lineno"> 4495</span>&#160;        <span class="keywordflow">elif</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a1ff44a76dff13cfb47c2d0fa65923451">_loop_type</a> == <span class="stringliteral">&quot;dofs&quot;</span>:</div><div class="line"><a name="l04496"></a><span class="lineno"> 4496</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a78f6b013a7ce8269108b6b582e4ba998">_variable_name</a> = self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a8375c9c467fb25eefdd8ab348ae4a45b">_name_space_manager</a>.\</div><div class="line"><a name="l04497"></a><span class="lineno"> 4497</span>&#160;                create_name(root_name=<span class="stringliteral">&quot;df&quot;</span>,</div><div class="line"><a name="l04498"></a><span class="lineno"> 4498</span>&#160;                            context=<span class="stringliteral">&quot;PSyVars&quot;</span>,</div><div class="line"><a name="l04499"></a><span class="lineno"> 4499</span>&#160;                            label=<span class="stringliteral">&quot;dof_loop_idx&quot;</span>)</div><div class="line"><a name="l04500"></a><span class="lineno"> 4500</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l04501"></a><span class="lineno"> 4501</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a78f6b013a7ce8269108b6b582e4ba998">_variable_name</a> = <span class="stringliteral">&quot;cell&quot;</span></div><div class="line"><a name="l04502"></a><span class="lineno"> 4502</span>&#160;</div><div class="line"><a name="l04503"></a><span class="lineno"> 4503</span>&#160;        <span class="comment"># At this stage we don&#39;t know what our loop bounds are</span></div><div class="line"><a name="l04504"></a><span class="lineno"> 4504</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a81e2099aca2c5bd2dc020658e0e94db4">_lower_bound_name</a> = <span class="keywordtype">None</span></div><div class="line"><a name="l04505"></a><span class="lineno"> 4505</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#aa11190fd2caa3cb687b7b4e061186175">_lower_bound_index</a> = <span class="keywordtype">None</span></div><div class="line"><a name="l04506"></a><span class="lineno"> 4506</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#af1f264ad7e26981899729d37e867aee6">_upper_bound_name</a> = <span class="keywordtype">None</span></div><div class="line"><a name="l04507"></a><span class="lineno"> 4507</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a91980de066f60536e247ba1b736eeafc">_upper_bound_halo_depth</a> = <span class="keywordtype">None</span></div><div class="line"><a name="l04508"></a><span class="lineno"> 4508</span>&#160;</div><div class="line"><a name="l04509"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a33c63569db9441249d5b9faf6299a9fc"> 4509</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a33c63569db9441249d5b9faf6299a9fc">view</a>(self, indent=0):</div><div class="line"><a name="l04510"></a><span class="lineno"> 4510</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;Print out a textual representation of this loop. We override this</span></div><div class="line"><a name="l04511"></a><span class="lineno"> 4511</span>&#160;<span class="stringliteral">        method from the Loop class because, in Dynamo0.3, the function</span></div><div class="line"><a name="l04512"></a><span class="lineno"> 4512</span>&#160;<span class="stringliteral">        space is now an object and we need to call orig_name on it. We</span></div><div class="line"><a name="l04513"></a><span class="lineno"> 4513</span>&#160;<span class="stringliteral">        also output the upper loop bound as this can now be</span></div><div class="line"><a name="l04514"></a><span class="lineno"> 4514</span>&#160;<span class="stringliteral">        modified.</span></div><div class="line"><a name="l04515"></a><span class="lineno"> 4515</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04516"></a><span class="lineno"> 4516</span>&#160;<span class="stringliteral">        :param indent: optional argument indicating the level of</span></div><div class="line"><a name="l04517"></a><span class="lineno"> 4517</span>&#160;<span class="stringliteral">        indentation to add before outputting the class information</span></div><div class="line"><a name="l04518"></a><span class="lineno"> 4518</span>&#160;<span class="stringliteral">        :type indent: integer</span></div><div class="line"><a name="l04519"></a><span class="lineno"> 4519</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04520"></a><span class="lineno"> 4520</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l04521"></a><span class="lineno"> 4521</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a91980de066f60536e247ba1b736eeafc">_upper_bound_halo_depth</a>:</div><div class="line"><a name="l04522"></a><span class="lineno"> 4522</span>&#160;            upper_bound = <span class="stringliteral">&quot;{0}({1})&quot;</span>.format(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#af1f264ad7e26981899729d37e867aee6">_upper_bound_name</a>,</div><div class="line"><a name="l04523"></a><span class="lineno"> 4523</span>&#160;                                            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a91980de066f60536e247ba1b736eeafc">_upper_bound_halo_depth</a>)</div><div class="line"><a name="l04524"></a><span class="lineno"> 4524</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l04525"></a><span class="lineno"> 4525</span>&#160;            upper_bound = self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#af1f264ad7e26981899729d37e867aee6">_upper_bound_name</a></div><div class="line"><a name="l04526"></a><span class="lineno"> 4526</span>&#160;        print(self.<a class="code" href="classpsyclone_1_1psyGen_1_1Node.html#a26c38a98f54211eb80dae3fe07d64d30">indent</a>(indent) + self.<a class="code" href="classpsyclone_1_1psyGen_1_1Loop.html#ac2b3ff6efe721114be68b57c3249a0e3">coloured_text</a> +</div><div class="line"><a name="l04527"></a><span class="lineno"> 4527</span>&#160;              <span class="stringliteral">&quot;[type=&#39;{0}&#39;,field_space=&#39;{1}&#39;,it_space=&#39;{2}&#39;, &quot;</span></div><div class="line"><a name="l04528"></a><span class="lineno"> 4528</span>&#160;              <span class="stringliteral">&quot;upper_bound=&#39;{3}&#39;]&quot;</span>.format(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a1ff44a76dff13cfb47c2d0fa65923451">_loop_type</a>,</div><div class="line"><a name="l04529"></a><span class="lineno"> 4529</span>&#160;                                          self._field_space.orig_name,</div><div class="line"><a name="l04530"></a><span class="lineno"> 4530</span>&#160;                                          self.<a class="code" href="classpsyclone_1_1psyGen_1_1Loop.html#a2106cb58bfb0cb510984e46302c831de">iteration_space</a>, upper_bound))</div><div class="line"><a name="l04531"></a><span class="lineno"> 4531</span>&#160;        <span class="keywordflow">for</span> entity <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1psyGen_1_1Node.html#a785ad9bd632033c16273bcfae09e28d8">_children</a>:</div><div class="line"><a name="l04532"></a><span class="lineno"> 4532</span>&#160;            entity.view(indent=indent + 1)</div><div class="line"><a name="l04533"></a><span class="lineno"> 4533</span>&#160;</div><div class="line"><a name="l04534"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a12bf269a633324a36d7f32bd06248b19"> 4534</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a12bf269a633324a36d7f32bd06248b19">load</a>(self, kern):</div><div class="line"><a name="l04535"></a><span class="lineno"> 4535</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l04536"></a><span class="lineno"> 4536</span>&#160;<span class="stringliteral">        Load the state of this Loop using the supplied Kernel</span></div><div class="line"><a name="l04537"></a><span class="lineno"> 4537</span>&#160;<span class="stringliteral">        object. This method is provided so that we can individually</span></div><div class="line"><a name="l04538"></a><span class="lineno"> 4538</span>&#160;<span class="stringliteral">        construct Loop objects for a given kernel call.</span></div><div class="line"><a name="l04539"></a><span class="lineno"> 4539</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04540"></a><span class="lineno"> 4540</span>&#160;<span class="stringliteral">        :param kern: Kernel object to use to populate state of Loop</span></div><div class="line"><a name="l04541"></a><span class="lineno"> 4541</span>&#160;<span class="stringliteral">        :type kern: :py:class:`psyclone.dynamo0p3.DynKern`</span></div><div class="line"><a name="l04542"></a><span class="lineno"> 4542</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l04543"></a><span class="lineno"> 4543</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#ad9bb1df68d49c54206fd30e72cad1c52">_kern</a> = kern</div><div class="line"><a name="l04544"></a><span class="lineno"> 4544</span>&#160;</div><div class="line"><a name="l04545"></a><span class="lineno"> 4545</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a3ba8465c0dc3bc7ba76d7002fc2ed367">_field</a> = kern.arguments.iteration_space_arg()</div><div class="line"><a name="l04546"></a><span class="lineno"> 4546</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a6ed04440794b00c560157275ce070704">_field_name</a> = self._field.name</div><div class="line"><a name="l04547"></a><span class="lineno"> 4547</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a88c09bdca492ff43269fbae64e06c6ae">_field_space</a> = self._field.function_space</div><div class="line"><a name="l04548"></a><span class="lineno"> 4548</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#acd859d639f8850d3049e34e9d23a4caa">_iteration_space</a> = kern.iterates_over  <span class="comment"># cells etc.</span></div><div class="line"><a name="l04549"></a><span class="lineno"> 4549</span>&#160;</div><div class="line"><a name="l04550"></a><span class="lineno"> 4550</span>&#160;        <span class="comment"># Loop bounds</span></div><div class="line"><a name="l04551"></a><span class="lineno"> 4551</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#afd1dbf56877ef2af98d9eba782404a26">set_lower_bound</a>(<span class="stringliteral">&quot;start&quot;</span>)</div><div class="line"><a name="l04552"></a><span class="lineno"> 4552</span>&#160;</div><div class="line"><a name="l04553"></a><span class="lineno"> 4553</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1dynamo0p3__builtins.html">psyclone.dynamo0p3_builtins</a> <span class="keyword">import</span> DynBuiltIn</div><div class="line"><a name="l04554"></a><span class="lineno"> 4554</span>&#160;        <span class="keywordflow">if</span> isinstance(kern, DynBuiltIn):</div><div class="line"><a name="l04555"></a><span class="lineno"> 4555</span>&#160;            <span class="comment"># If the kernel is a built-in/pointwise operation</span></div><div class="line"><a name="l04556"></a><span class="lineno"> 4556</span>&#160;            <span class="comment"># then this loop must be over DoFs</span></div><div class="line"><a name="l04557"></a><span class="lineno"> 4557</span>&#160;            <span class="keywordflow">if</span> Config.get().api_conf(<span class="stringliteral">&quot;dynamo0.3&quot;</span>).compute_annexed_dofs \</div><div class="line"><a name="l04558"></a><span class="lineno"> 4558</span>&#160;               <span class="keywordflow">and</span> Config.get().distributed_memory \</div><div class="line"><a name="l04559"></a><span class="lineno"> 4559</span>&#160;               <span class="keywordflow">and</span> <span class="keywordflow">not</span> kern.is_reduction:</div><div class="line"><a name="l04560"></a><span class="lineno"> 4560</span>&#160;                self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a362c02a6327448029d8cc8c6a0351418">set_upper_bound</a>(<span class="stringliteral">&quot;nannexed&quot;</span>)</div><div class="line"><a name="l04561"></a><span class="lineno"> 4561</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l04562"></a><span class="lineno"> 4562</span>&#160;                self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a362c02a6327448029d8cc8c6a0351418">set_upper_bound</a>(<span class="stringliteral">&quot;ndofs&quot;</span>)</div><div class="line"><a name="l04563"></a><span class="lineno"> 4563</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l04564"></a><span class="lineno"> 4564</span>&#160;            <span class="keywordflow">if</span> Config.get().distributed_memory:</div><div class="line"><a name="l04565"></a><span class="lineno"> 4565</span>&#160;                <span class="keywordflow">if</span> self._field.type <span class="keywordflow">in</span> VALID_OPERATOR_NAMES:</div><div class="line"><a name="l04566"></a><span class="lineno"> 4566</span>&#160;                    <span class="comment"># We always compute operators redundantly out to the L1</span></div><div class="line"><a name="l04567"></a><span class="lineno"> 4567</span>&#160;                    <span class="comment"># halo</span></div><div class="line"><a name="l04568"></a><span class="lineno"> 4568</span>&#160;                    self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a362c02a6327448029d8cc8c6a0351418">set_upper_bound</a>(<span class="stringliteral">&quot;cell_halo&quot;</span>, index=1)</div><div class="line"><a name="l04569"></a><span class="lineno"> 4569</span>&#160;                <span class="keywordflow">elif</span> (self.field_space.orig_name <span class="keywordflow">in</span></div><div class="line"><a name="l04570"></a><span class="lineno"> 4570</span>&#160;                      DISCONTINUOUS_FUNCTION_SPACES):</div><div class="line"><a name="l04571"></a><span class="lineno"> 4571</span>&#160;                    self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a362c02a6327448029d8cc8c6a0351418">set_upper_bound</a>(<span class="stringliteral">&quot;ncells&quot;</span>)</div><div class="line"><a name="l04572"></a><span class="lineno"> 4572</span>&#160;                <span class="keywordflow">elif</span> self.field_space.orig_name <span class="keywordflow">in</span> CONTINUOUS_FUNCTION_SPACES:</div><div class="line"><a name="l04573"></a><span class="lineno"> 4573</span>&#160;                    <span class="comment"># Must iterate out to L1 halo for continuous quantities</span></div><div class="line"><a name="l04574"></a><span class="lineno"> 4574</span>&#160;                    self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a362c02a6327448029d8cc8c6a0351418">set_upper_bound</a>(<span class="stringliteral">&quot;cell_halo&quot;</span>, index=1)</div><div class="line"><a name="l04575"></a><span class="lineno"> 4575</span>&#160;                <span class="keywordflow">elif</span> self.field_space.orig_name <span class="keywordflow">in</span> VALID_ANY_SPACE_NAMES:</div><div class="line"><a name="l04576"></a><span class="lineno"> 4576</span>&#160;                    <span class="comment"># We don&#39;t know whether any-space is continuous or not</span></div><div class="line"><a name="l04577"></a><span class="lineno"> 4577</span>&#160;                    <span class="comment"># so we have to err on the side of caution and assume that</span></div><div class="line"><a name="l04578"></a><span class="lineno"> 4578</span>&#160;                    <span class="comment"># it is.</span></div><div class="line"><a name="l04579"></a><span class="lineno"> 4579</span>&#160;                    self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a362c02a6327448029d8cc8c6a0351418">set_upper_bound</a>(<span class="stringliteral">&quot;cell_halo&quot;</span>, index=1)</div><div class="line"><a name="l04580"></a><span class="lineno"> 4580</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l04581"></a><span class="lineno"> 4581</span>&#160;                    <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l04582"></a><span class="lineno"> 4582</span>&#160;                        <span class="stringliteral">&quot;Unexpected function space found. Expecting one of &quot;</span></div><div class="line"><a name="l04583"></a><span class="lineno"> 4583</span>&#160;                        <span class="stringliteral">&quot;{0} but found &#39;{1}&#39;&quot;</span>.format(</div><div class="line"><a name="l04584"></a><span class="lineno"> 4584</span>&#160;                            str(VALID_FUNCTION_SPACES),</div><div class="line"><a name="l04585"></a><span class="lineno"> 4585</span>&#160;                            self.field_space.orig_name))</div><div class="line"><a name="l04586"></a><span class="lineno"> 4586</span>&#160;            <span class="keywordflow">else</span>:  <span class="comment"># sequential</span></div><div class="line"><a name="l04587"></a><span class="lineno"> 4587</span>&#160;                self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a362c02a6327448029d8cc8c6a0351418">set_upper_bound</a>(<span class="stringliteral">&quot;ncells&quot;</span>)</div><div class="line"><a name="l04588"></a><span class="lineno"> 4588</span>&#160;</div><div class="line"><a name="l04589"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#afd1dbf56877ef2af98d9eba782404a26"> 4589</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#afd1dbf56877ef2af98d9eba782404a26">set_lower_bound</a>(self, name, index=None):</div><div class="line"><a name="l04590"></a><span class="lineno"> 4590</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Set the lower bounds of this loop &#39;&#39;&#39;</span></div><div class="line"><a name="l04591"></a><span class="lineno"> 4591</span>&#160;        <span class="keywordflow">if</span> name <span class="keywordflow">not</span> <span class="keywordflow">in</span> VALID_LOOP_BOUNDS_NAMES:</div><div class="line"><a name="l04592"></a><span class="lineno"> 4592</span>&#160;            <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l04593"></a><span class="lineno"> 4593</span>&#160;                <span class="stringliteral">&quot;The specified lower bound loop name is invalid&quot;</span>)</div><div class="line"><a name="l04594"></a><span class="lineno"> 4594</span>&#160;        <span class="keywordflow">if</span> name <span class="keywordflow">in</span> [<span class="stringliteral">&quot;inner&quot;</span>] + HALO_ACCESS_LOOP_BOUNDS <span class="keywordflow">and</span> index &lt; 1:</div><div class="line"><a name="l04595"></a><span class="lineno"> 4595</span>&#160;            <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l04596"></a><span class="lineno"> 4596</span>&#160;                <span class="stringliteral">&quot;The specified index &#39;{0}&#39; for this lower loop bound is &quot;</span></div><div class="line"><a name="l04597"></a><span class="lineno"> 4597</span>&#160;                <span class="stringliteral">&quot;invalid&quot;</span>.format(str(index)))</div><div class="line"><a name="l04598"></a><span class="lineno"> 4598</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a81e2099aca2c5bd2dc020658e0e94db4">_lower_bound_name</a> = name</div><div class="line"><a name="l04599"></a><span class="lineno"> 4599</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#aa11190fd2caa3cb687b7b4e061186175">_lower_bound_index</a> = index</div><div class="line"><a name="l04600"></a><span class="lineno"> 4600</span>&#160;</div><div class="line"><a name="l04601"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a362c02a6327448029d8cc8c6a0351418"> 4601</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a362c02a6327448029d8cc8c6a0351418">set_upper_bound</a>(self, name, index=None):</div><div class="line"><a name="l04602"></a><span class="lineno"> 4602</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;Set the upper bound of this loop</span></div><div class="line"><a name="l04603"></a><span class="lineno"> 4603</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04604"></a><span class="lineno"> 4604</span>&#160;<span class="stringliteral">        :param name: A loop upper bound name. This should be a supported name.</span></div><div class="line"><a name="l04605"></a><span class="lineno"> 4605</span>&#160;<span class="stringliteral">        :type name: String</span></div><div class="line"><a name="l04606"></a><span class="lineno"> 4606</span>&#160;<span class="stringliteral">        :param index: An optional argument indicating the depth of halo</span></div><div class="line"><a name="l04607"></a><span class="lineno"> 4607</span>&#160;<span class="stringliteral">        :type index: int</span></div><div class="line"><a name="l04608"></a><span class="lineno"> 4608</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04609"></a><span class="lineno"> 4609</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l04610"></a><span class="lineno"> 4610</span>&#160;        <span class="keywordflow">if</span> name <span class="keywordflow">not</span> <span class="keywordflow">in</span> VALID_LOOP_BOUNDS_NAMES:</div><div class="line"><a name="l04611"></a><span class="lineno"> 4611</span>&#160;            <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l04612"></a><span class="lineno"> 4612</span>&#160;                <span class="stringliteral">&quot;The specified upper loop bound name is invalid. Expected one &quot;</span></div><div class="line"><a name="l04613"></a><span class="lineno"> 4613</span>&#160;                <span class="stringliteral">&quot;of {0} but found &#39;{1}&#39;&quot;</span>.format(VALID_LOOP_BOUNDS_NAMES, name))</div><div class="line"><a name="l04614"></a><span class="lineno"> 4614</span>&#160;        <span class="keywordflow">if</span> name == <span class="stringliteral">&quot;start&quot;</span>:</div><div class="line"><a name="l04615"></a><span class="lineno"> 4615</span>&#160;            <span class="keywordflow">raise</span> GenerationError(<span class="stringliteral">&quot;&#39;start&#39; is not a valid upper bound&quot;</span>)</div><div class="line"><a name="l04616"></a><span class="lineno"> 4616</span>&#160;        <span class="comment"># Only halo bounds and inner may have an index. We could just</span></div><div class="line"><a name="l04617"></a><span class="lineno"> 4617</span>&#160;        <span class="comment"># test for index here and assume that index is None for other</span></div><div class="line"><a name="l04618"></a><span class="lineno"> 4618</span>&#160;        <span class="comment"># types of bounds, but checking the type of bound as well is a</span></div><div class="line"><a name="l04619"></a><span class="lineno"> 4619</span>&#160;        <span class="comment"># safer option.</span></div><div class="line"><a name="l04620"></a><span class="lineno"> 4620</span>&#160;        <span class="keywordflow">if</span> name <span class="keywordflow">in</span> ([<span class="stringliteral">&quot;inner&quot;</span>] + HALO_ACCESS_LOOP_BOUNDS) <span class="keywordflow">and</span> \</div><div class="line"><a name="l04621"></a><span class="lineno"> 4621</span>&#160;           index <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l04622"></a><span class="lineno"> 4622</span>&#160;            <span class="keywordflow">if</span> index &lt; 1:</div><div class="line"><a name="l04623"></a><span class="lineno"> 4623</span>&#160;                <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l04624"></a><span class="lineno"> 4624</span>&#160;                    <span class="stringliteral">&quot;The specified index &#39;{0}&#39; for this upper loop bound is &quot;</span></div><div class="line"><a name="l04625"></a><span class="lineno"> 4625</span>&#160;                    <span class="stringliteral">&quot;invalid&quot;</span>.format(str(index)))</div><div class="line"><a name="l04626"></a><span class="lineno"> 4626</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#af1f264ad7e26981899729d37e867aee6">_upper_bound_name</a> = name</div><div class="line"><a name="l04627"></a><span class="lineno"> 4627</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a91980de066f60536e247ba1b736eeafc">_upper_bound_halo_depth</a> = index</div><div class="line"><a name="l04628"></a><span class="lineno"> 4628</span>&#160;</div><div class="line"><a name="l04629"></a><span class="lineno"> 4629</span>&#160;    @property</div><div class="line"><a name="l04630"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#aca4d102832dff707693443021b645a58"> 4630</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#aca4d102832dff707693443021b645a58">upper_bound_name</a>(self):</div><div class="line"><a name="l04631"></a><span class="lineno"> 4631</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Returns the name of the upper loop bound &#39;&#39;&#39;</span></div><div class="line"><a name="l04632"></a><span class="lineno"> 4632</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#af1f264ad7e26981899729d37e867aee6">_upper_bound_name</a></div><div class="line"><a name="l04633"></a><span class="lineno"> 4633</span>&#160;</div><div class="line"><a name="l04634"></a><span class="lineno"> 4634</span>&#160;    @property</div><div class="line"><a name="l04635"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a1535492551f0316ab3236a7d59726bba"> 4635</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a1535492551f0316ab3236a7d59726bba">upper_bound_halo_depth</a>(self):</div><div class="line"><a name="l04636"></a><span class="lineno"> 4636</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;Returns the index of the upper loop bound. This is None if the upper</span></div><div class="line"><a name="l04637"></a><span class="lineno"> 4637</span>&#160;<span class="stringliteral">        bound name is not in HALO_ACCESS_LOOP_BOUNDS</span></div><div class="line"><a name="l04638"></a><span class="lineno"> 4638</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04639"></a><span class="lineno"> 4639</span>&#160;<span class="stringliteral">        :return: the depth of the halo for a loops upper bound. If it</span></div><div class="line"><a name="l04640"></a><span class="lineno"> 4640</span>&#160;<span class="stringliteral">        is None then a depth has not been provided. The depth value is only</span></div><div class="line"><a name="l04641"></a><span class="lineno"> 4641</span>&#160;<span class="stringliteral">        valid when the upper-bound name is associated with a halo</span></div><div class="line"><a name="l04642"></a><span class="lineno"> 4642</span>&#160;<span class="stringliteral">        e.g. &#39;cell_halo&#39;</span></div><div class="line"><a name="l04643"></a><span class="lineno"> 4643</span>&#160;<span class="stringliteral">        :rtype: int</span></div><div class="line"><a name="l04644"></a><span class="lineno"> 4644</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04645"></a><span class="lineno"> 4645</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l04646"></a><span class="lineno"> 4646</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a91980de066f60536e247ba1b736eeafc">_upper_bound_halo_depth</a></div><div class="line"><a name="l04647"></a><span class="lineno"> 4647</span>&#160;</div><div class="line"><a name="l04648"></a><span class="lineno"> 4648</span>&#160;    <span class="keyword">def </span>_lower_bound_fortran(self):</div><div class="line"><a name="l04649"></a><span class="lineno"> 4649</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l04650"></a><span class="lineno"> 4650</span>&#160;<span class="stringliteral">        Create the associated Fortran code for the type of lower bound.</span></div><div class="line"><a name="l04651"></a><span class="lineno"> 4651</span>&#160;<span class="stringliteral">        :returns: the Fortran code for the lower bound</span></div><div class="line"><a name="l04652"></a><span class="lineno"> 4652</span>&#160;<span class="stringliteral">        :rtype: str</span></div><div class="line"><a name="l04653"></a><span class="lineno"> 4653</span>&#160;<span class="stringliteral">        :raises GenerationError: if self._lower_bound_name is not &quot;start&quot;</span></div><div class="line"><a name="l04654"></a><span class="lineno"> 4654</span>&#160;<span class="stringliteral">                                 for sequential code.</span></div><div class="line"><a name="l04655"></a><span class="lineno"> 4655</span>&#160;<span class="stringliteral">        :raises GenerationError: if self._lower_bound_name is unrecognised</span></div><div class="line"><a name="l04656"></a><span class="lineno"> 4656</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l04657"></a><span class="lineno"> 4657</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> Config.get().distributed_memory <span class="keywordflow">and</span> \</div><div class="line"><a name="l04658"></a><span class="lineno"> 4658</span>&#160;           self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a81e2099aca2c5bd2dc020658e0e94db4">_lower_bound_name</a> != <span class="stringliteral">&quot;start&quot;</span>:</div><div class="line"><a name="l04659"></a><span class="lineno"> 4659</span>&#160;            <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l04660"></a><span class="lineno"> 4660</span>&#160;                <span class="stringliteral">&quot;The lower bound must be &#39;start&#39; if we are sequential but &quot;</span></div><div class="line"><a name="l04661"></a><span class="lineno"> 4661</span>&#160;                <span class="stringliteral">&quot;found &#39;{0}&#39;&quot;</span>.format(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#af1f264ad7e26981899729d37e867aee6">_upper_bound_name</a>))</div><div class="line"><a name="l04662"></a><span class="lineno"> 4662</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a81e2099aca2c5bd2dc020658e0e94db4">_lower_bound_name</a> == <span class="stringliteral">&quot;start&quot;</span>:</div><div class="line"><a name="l04663"></a><span class="lineno"> 4663</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;1&quot;</span></div><div class="line"><a name="l04664"></a><span class="lineno"> 4664</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l04665"></a><span class="lineno"> 4665</span>&#160;            <span class="comment"># the start of our space is the end of the previous space +1</span></div><div class="line"><a name="l04666"></a><span class="lineno"> 4666</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a81e2099aca2c5bd2dc020658e0e94db4">_lower_bound_name</a> == <span class="stringliteral">&quot;inner&quot;</span>:</div><div class="line"><a name="l04667"></a><span class="lineno"> 4667</span>&#160;                prev_space_name = self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a81e2099aca2c5bd2dc020658e0e94db4">_lower_bound_name</a></div><div class="line"><a name="l04668"></a><span class="lineno"> 4668</span>&#160;                prev_space_index_str = str(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#aa11190fd2caa3cb687b7b4e061186175">_lower_bound_index</a> + 1)</div><div class="line"><a name="l04669"></a><span class="lineno"> 4669</span>&#160;            <span class="keywordflow">elif</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a81e2099aca2c5bd2dc020658e0e94db4">_lower_bound_name</a> == <span class="stringliteral">&quot;ncells&quot;</span>:</div><div class="line"><a name="l04670"></a><span class="lineno"> 4670</span>&#160;                prev_space_name = <span class="stringliteral">&quot;inner&quot;</span></div><div class="line"><a name="l04671"></a><span class="lineno"> 4671</span>&#160;                prev_space_index_str = <span class="stringliteral">&quot;1&quot;</span></div><div class="line"><a name="l04672"></a><span class="lineno"> 4672</span>&#160;            <span class="keywordflow">elif</span> (self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a81e2099aca2c5bd2dc020658e0e94db4">_lower_bound_name</a> == <span class="stringliteral">&quot;cell_halo&quot;</span> <span class="keywordflow">and</span></div><div class="line"><a name="l04673"></a><span class="lineno"> 4673</span>&#160;                  self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#aa11190fd2caa3cb687b7b4e061186175">_lower_bound_index</a> == 1):</div><div class="line"><a name="l04674"></a><span class="lineno"> 4674</span>&#160;                prev_space_name = <span class="stringliteral">&quot;ncells&quot;</span></div><div class="line"><a name="l04675"></a><span class="lineno"> 4675</span>&#160;                prev_space_index_str = <span class="stringliteral">&quot;&quot;</span></div><div class="line"><a name="l04676"></a><span class="lineno"> 4676</span>&#160;            <span class="keywordflow">elif</span> (self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a81e2099aca2c5bd2dc020658e0e94db4">_lower_bound_name</a> == <span class="stringliteral">&quot;cell_halo&quot;</span> <span class="keywordflow">and</span></div><div class="line"><a name="l04677"></a><span class="lineno"> 4677</span>&#160;                  self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#aa11190fd2caa3cb687b7b4e061186175">_lower_bound_index</a> &gt; 1):</div><div class="line"><a name="l04678"></a><span class="lineno"> 4678</span>&#160;                prev_space_name = self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a81e2099aca2c5bd2dc020658e0e94db4">_lower_bound_name</a></div><div class="line"><a name="l04679"></a><span class="lineno"> 4679</span>&#160;                prev_space_index_str = str(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#aa11190fd2caa3cb687b7b4e061186175">_lower_bound_index</a> - 1)</div><div class="line"><a name="l04680"></a><span class="lineno"> 4680</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l04681"></a><span class="lineno"> 4681</span>&#160;                <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l04682"></a><span class="lineno"> 4682</span>&#160;                    <span class="stringliteral">&quot;Unsupported lower bound name &#39;{0}&#39; &quot;</span></div><div class="line"><a name="l04683"></a><span class="lineno"> 4683</span>&#160;                    <span class="stringliteral">&quot;found&quot;</span>.format(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a81e2099aca2c5bd2dc020658e0e94db4">_lower_bound_name</a>))</div><div class="line"><a name="l04684"></a><span class="lineno"> 4684</span>&#160;            mesh_obj_name = self._name_space_manager.create_name(</div><div class="line"><a name="l04685"></a><span class="lineno"> 4685</span>&#160;                root_name=<span class="stringliteral">&quot;mesh&quot;</span>, context=<span class="stringliteral">&quot;PSyVars&quot;</span>, label=<span class="stringliteral">&quot;mesh&quot;</span>)</div><div class="line"><a name="l04686"></a><span class="lineno"> 4686</span>&#160;            <span class="keywordflow">return</span> mesh_obj_name + <span class="stringliteral">&quot;%get_last_&quot;</span> + prev_space_name + <span class="stringliteral">&quot;_cell(&quot;</span> \</div><div class="line"><a name="l04687"></a><span class="lineno"> 4687</span>&#160;                + prev_space_index_str + <span class="stringliteral">&quot;)+1&quot;</span></div><div class="line"><a name="l04688"></a><span class="lineno"> 4688</span>&#160;</div><div class="line"><a name="l04689"></a><span class="lineno"> 4689</span>&#160;    <span class="keyword">def </span>_upper_bound_fortran(self):</div><div class="line"><a name="l04690"></a><span class="lineno"> 4690</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Create the associated fortran code for the type of upper bound</span></div><div class="line"><a name="l04691"></a><span class="lineno"> 4691</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04692"></a><span class="lineno"> 4692</span>&#160;<span class="stringliteral">        :return: Fortran code for the upper bound of this loop</span></div><div class="line"><a name="l04693"></a><span class="lineno"> 4693</span>&#160;<span class="stringliteral">        :rtype: String</span></div><div class="line"><a name="l04694"></a><span class="lineno"> 4694</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04695"></a><span class="lineno"> 4695</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l04696"></a><span class="lineno"> 4696</span>&#160;        <span class="comment"># precompute halo_index as a string as we use it in more than</span></div><div class="line"><a name="l04697"></a><span class="lineno"> 4697</span>&#160;        <span class="comment"># one of the if clauses</span></div><div class="line"><a name="l04698"></a><span class="lineno"> 4698</span>&#160;        halo_index = <span class="stringliteral">&quot;&quot;</span></div><div class="line"><a name="l04699"></a><span class="lineno"> 4699</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a91980de066f60536e247ba1b736eeafc">_upper_bound_halo_depth</a>:</div><div class="line"><a name="l04700"></a><span class="lineno"> 4700</span>&#160;            halo_index = str(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a91980de066f60536e247ba1b736eeafc">_upper_bound_halo_depth</a>)</div><div class="line"><a name="l04701"></a><span class="lineno"> 4701</span>&#160;</div><div class="line"><a name="l04702"></a><span class="lineno"> 4702</span>&#160;        <span class="comment"># We must allow for self._kern being None (as it will be for</span></div><div class="line"><a name="l04703"></a><span class="lineno"> 4703</span>&#160;        <span class="comment"># a built-in).</span></div><div class="line"><a name="l04704"></a><span class="lineno"> 4704</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#ad9bb1df68d49c54206fd30e72cad1c52">_kern</a> <span class="keywordflow">and</span> self._kern.is_intergrid:</div><div class="line"><a name="l04705"></a><span class="lineno"> 4705</span>&#160;            <span class="comment"># We have more than one mesh object to choose from and we</span></div><div class="line"><a name="l04706"></a><span class="lineno"> 4706</span>&#160;            <span class="comment"># want the coarse one because that determines the iteration</span></div><div class="line"><a name="l04707"></a><span class="lineno"> 4707</span>&#160;            <span class="comment"># space. _field_name holds the name of the argument that</span></div><div class="line"><a name="l04708"></a><span class="lineno"> 4708</span>&#160;            <span class="comment"># determines the iteration space of this kernel and that</span></div><div class="line"><a name="l04709"></a><span class="lineno"> 4709</span>&#160;            <span class="comment"># is set-up to be the one on the coarse mesh (in</span></div><div class="line"><a name="l04710"></a><span class="lineno"> 4710</span>&#160;            <span class="comment"># DynKerelArguments.iteration_space_arg()).</span></div><div class="line"><a name="l04711"></a><span class="lineno"> 4711</span>&#160;            mesh_name = <span class="stringliteral">&quot;mesh_&quot;</span> + self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a6ed04440794b00c560157275ce070704">_field_name</a></div><div class="line"><a name="l04712"></a><span class="lineno"> 4712</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l04713"></a><span class="lineno"> 4713</span>&#160;            <span class="comment"># It&#39;s not an inter-grid kernel so there&#39;s only one mesh</span></div><div class="line"><a name="l04714"></a><span class="lineno"> 4714</span>&#160;            mesh_name = <span class="stringliteral">&quot;mesh&quot;</span></div><div class="line"><a name="l04715"></a><span class="lineno"> 4715</span>&#160;        mesh = self._name_space_manager.create_name(</div><div class="line"><a name="l04716"></a><span class="lineno"> 4716</span>&#160;            root_name=mesh_name, context=<span class="stringliteral">&quot;PSyVars&quot;</span>, label=mesh_name)</div><div class="line"><a name="l04717"></a><span class="lineno"> 4717</span>&#160;</div><div class="line"><a name="l04718"></a><span class="lineno"> 4718</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#af1f264ad7e26981899729d37e867aee6">_upper_bound_name</a> == <span class="stringliteral">&quot;ncolours&quot;</span>:</div><div class="line"><a name="l04719"></a><span class="lineno"> 4719</span>&#160;            <span class="comment"># Loop over colours</span></div><div class="line"><a name="l04720"></a><span class="lineno"> 4720</span>&#160;            kernels = self.<a class="code" href="classpsyclone_1_1psyGen_1_1Node.html#a681c8ae703092153cdd1cd1b2eb82e9e">walk</a>(self.<a class="code" href="classpsyclone_1_1psyGen_1_1Node.html#a16164b7e18b21e72a94cd5da552b58a2">children</a>, DynKern)</div><div class="line"><a name="l04721"></a><span class="lineno"> 4721</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> kernels:</div><div class="line"><a name="l04722"></a><span class="lineno"> 4722</span>&#160;                <span class="keywordflow">raise</span> InternalError(</div><div class="line"><a name="l04723"></a><span class="lineno"> 4723</span>&#160;                    <span class="stringliteral">&quot;Failed to find a kernel within a loop over colours.&quot;</span>)</div><div class="line"><a name="l04724"></a><span class="lineno"> 4724</span>&#160;            <span class="comment"># Check that all kernels have been coloured. We can&#39;t check the</span></div><div class="line"><a name="l04725"></a><span class="lineno"> 4725</span>&#160;            <span class="comment"># number of colours since that is only known at runtime.</span></div><div class="line"><a name="l04726"></a><span class="lineno"> 4726</span>&#160;            ncolours = kernels[0].ncolours_var</div><div class="line"><a name="l04727"></a><span class="lineno"> 4727</span>&#160;            <span class="keywordflow">for</span> kern <span class="keywordflow">in</span> kernels:</div><div class="line"><a name="l04728"></a><span class="lineno"> 4728</span>&#160;                <span class="keywordflow">if</span> <span class="keywordflow">not</span> kern.ncolours_var:</div><div class="line"><a name="l04729"></a><span class="lineno"> 4729</span>&#160;                    <span class="keywordflow">raise</span> InternalError(</div><div class="line"><a name="l04730"></a><span class="lineno"> 4730</span>&#160;                        <span class="stringliteral">&quot;All kernels within a loop over colours must have been&quot;</span></div><div class="line"><a name="l04731"></a><span class="lineno"> 4731</span>&#160;                        <span class="stringliteral">&quot; coloured but kernel &#39;{0}&#39; has not&quot;</span>.format(kern.name))</div><div class="line"><a name="l04732"></a><span class="lineno"> 4732</span>&#160;            <span class="keywordflow">return</span> ncolours</div><div class="line"><a name="l04733"></a><span class="lineno"> 4733</span>&#160;        <span class="keywordflow">elif</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#af1f264ad7e26981899729d37e867aee6">_upper_bound_name</a> == <span class="stringliteral">&quot;ncolour&quot;</span>:</div><div class="line"><a name="l04734"></a><span class="lineno"> 4734</span>&#160;            <span class="comment"># Loop over cells of a particular colour when DM is disabled.</span></div><div class="line"><a name="l04735"></a><span class="lineno"> 4735</span>&#160;            <span class="comment"># We use the same, DM API as that returns sensible values even</span></div><div class="line"><a name="l04736"></a><span class="lineno"> 4736</span>&#160;            <span class="comment"># when running without MPI.</span></div><div class="line"><a name="l04737"></a><span class="lineno"> 4737</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;{0}%get_last_edge_cell_per_colour(colour)&quot;</span>.format(mesh)</div><div class="line"><a name="l04738"></a><span class="lineno"> 4738</span>&#160;        <span class="keywordflow">elif</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#af1f264ad7e26981899729d37e867aee6">_upper_bound_name</a> == <span class="stringliteral">&quot;colour_halo&quot;</span>:</div><div class="line"><a name="l04739"></a><span class="lineno"> 4739</span>&#160;            <span class="comment"># Loop over cells of a particular colour when DM is enabled. The</span></div><div class="line"><a name="l04740"></a><span class="lineno"> 4740</span>&#160;            <span class="comment"># LFRic API used here allows for colouring with redundant</span></div><div class="line"><a name="l04741"></a><span class="lineno"> 4741</span>&#160;            <span class="comment"># computation.</span></div><div class="line"><a name="l04742"></a><span class="lineno"> 4742</span>&#160;            append = <span class="stringliteral">&quot;&quot;</span></div><div class="line"><a name="l04743"></a><span class="lineno"> 4743</span>&#160;            <span class="keywordflow">if</span> halo_index:</div><div class="line"><a name="l04744"></a><span class="lineno"> 4744</span>&#160;                <span class="comment"># The colouring API support an additional optional</span></div><div class="line"><a name="l04745"></a><span class="lineno"> 4745</span>&#160;                <span class="comment"># argument which specifies the depth of the halo to</span></div><div class="line"><a name="l04746"></a><span class="lineno"> 4746</span>&#160;                <span class="comment"># which the coloured loop computes. If no argument is</span></div><div class="line"><a name="l04747"></a><span class="lineno"> 4747</span>&#160;                <span class="comment"># supplied it is assumed that the coloured loop</span></div><div class="line"><a name="l04748"></a><span class="lineno"> 4748</span>&#160;                <span class="comment"># computes to the full depth of the halo (whatever that</span></div><div class="line"><a name="l04749"></a><span class="lineno"> 4749</span>&#160;                <span class="comment"># may be).</span></div><div class="line"><a name="l04750"></a><span class="lineno"> 4750</span>&#160;                append = <span class="stringliteral">&quot;,&quot;</span>+halo_index</div><div class="line"><a name="l04751"></a><span class="lineno"> 4751</span>&#160;            <span class="keywordflow">return</span> (<span class="stringliteral">&quot;{0}%get_last_halo_cell_per_colour(colour&quot;</span></div><div class="line"><a name="l04752"></a><span class="lineno"> 4752</span>&#160;                    <span class="stringliteral">&quot;{1})&quot;</span>.format(mesh, append))</div><div class="line"><a name="l04753"></a><span class="lineno"> 4753</span>&#160;        <span class="keywordflow">elif</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#af1f264ad7e26981899729d37e867aee6">_upper_bound_name</a> <span class="keywordflow">in</span> [<span class="stringliteral">&quot;ndofs&quot;</span>, <span class="stringliteral">&quot;nannexed&quot;</span>]:</div><div class="line"><a name="l04754"></a><span class="lineno"> 4754</span>&#160;            <span class="keywordflow">if</span> Config.get().distributed_memory:</div><div class="line"><a name="l04755"></a><span class="lineno"> 4755</span>&#160;                <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#af1f264ad7e26981899729d37e867aee6">_upper_bound_name</a> == <span class="stringliteral">&quot;ndofs&quot;</span>:</div><div class="line"><a name="l04756"></a><span class="lineno"> 4756</span>&#160;                    result = self.field.proxy_name_indexed + <span class="stringliteral">&quot;%&quot;</span> + \</div><div class="line"><a name="l04757"></a><span class="lineno"> 4757</span>&#160;                             self.field.ref_name() + <span class="stringliteral">&quot;%get_last_dof_owned()&quot;</span></div><div class="line"><a name="l04758"></a><span class="lineno"> 4758</span>&#160;                <span class="keywordflow">else</span>:  <span class="comment"># nannexed</span></div><div class="line"><a name="l04759"></a><span class="lineno"> 4759</span>&#160;                    result = self.field.proxy_name_indexed + <span class="stringliteral">&quot;%&quot;</span> + \</div><div class="line"><a name="l04760"></a><span class="lineno"> 4760</span>&#160;                             self.field.ref_name() + <span class="stringliteral">&quot;%get_last_dof_annexed()&quot;</span></div><div class="line"><a name="l04761"></a><span class="lineno"> 4761</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l04762"></a><span class="lineno"> 4762</span>&#160;                result = self._kern.undf_name</div><div class="line"><a name="l04763"></a><span class="lineno"> 4763</span>&#160;            <span class="keywordflow">return</span> result</div><div class="line"><a name="l04764"></a><span class="lineno"> 4764</span>&#160;        <span class="keywordflow">elif</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#af1f264ad7e26981899729d37e867aee6">_upper_bound_name</a> == <span class="stringliteral">&quot;ncells&quot;</span>:</div><div class="line"><a name="l04765"></a><span class="lineno"> 4765</span>&#160;            <span class="keywordflow">if</span> Config.get().distributed_memory:</div><div class="line"><a name="l04766"></a><span class="lineno"> 4766</span>&#160;                result = mesh + <span class="stringliteral">&quot;%get_last_edge_cell()&quot;</span></div><div class="line"><a name="l04767"></a><span class="lineno"> 4767</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l04768"></a><span class="lineno"> 4768</span>&#160;                result = self.field.proxy_name_indexed + <span class="stringliteral">&quot;%&quot;</span> + \</div><div class="line"><a name="l04769"></a><span class="lineno"> 4769</span>&#160;                    self.field.ref_name() + <span class="stringliteral">&quot;%get_ncell()&quot;</span></div><div class="line"><a name="l04770"></a><span class="lineno"> 4770</span>&#160;            <span class="keywordflow">return</span> result</div><div class="line"><a name="l04771"></a><span class="lineno"> 4771</span>&#160;        <span class="keywordflow">elif</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#af1f264ad7e26981899729d37e867aee6">_upper_bound_name</a> == <span class="stringliteral">&quot;cell_halo&quot;</span>:</div><div class="line"><a name="l04772"></a><span class="lineno"> 4772</span>&#160;            <span class="keywordflow">if</span> Config.get().distributed_memory:</div><div class="line"><a name="l04773"></a><span class="lineno"> 4773</span>&#160;                <span class="keywordflow">return</span> <span class="stringliteral">&quot;{0}%get_last_halo_cell({1})&quot;</span>.format(mesh,</div><div class="line"><a name="l04774"></a><span class="lineno"> 4774</span>&#160;                                                            halo_index)</div><div class="line"><a name="l04775"></a><span class="lineno"> 4775</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l04776"></a><span class="lineno"> 4776</span>&#160;                <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l04777"></a><span class="lineno"> 4777</span>&#160;                    <span class="stringliteral">&quot;&#39;cell_halo&#39; is not a valid loop upper bound for &quot;</span></div><div class="line"><a name="l04778"></a><span class="lineno"> 4778</span>&#160;                    <span class="stringliteral">&quot;sequential/shared-memory code&quot;</span>)</div><div class="line"><a name="l04779"></a><span class="lineno"> 4779</span>&#160;        <span class="keywordflow">elif</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#af1f264ad7e26981899729d37e867aee6">_upper_bound_name</a> == <span class="stringliteral">&quot;dof_halo&quot;</span>:</div><div class="line"><a name="l04780"></a><span class="lineno"> 4780</span>&#160;            <span class="keywordflow">if</span> Config.get().distributed_memory:</div><div class="line"><a name="l04781"></a><span class="lineno"> 4781</span>&#160;                <span class="keywordflow">return</span> <span class="stringliteral">&quot;{0}%{1}%get_last_dof_halo({2})&quot;</span>.format(</div><div class="line"><a name="l04782"></a><span class="lineno"> 4782</span>&#160;                    self.field.proxy_name_indexed, self.field.ref_name(),</div><div class="line"><a name="l04783"></a><span class="lineno"> 4783</span>&#160;                    halo_index)</div><div class="line"><a name="l04784"></a><span class="lineno"> 4784</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l04785"></a><span class="lineno"> 4785</span>&#160;                <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l04786"></a><span class="lineno"> 4786</span>&#160;                    <span class="stringliteral">&quot;&#39;dof_halo&#39; is not a valid loop upper bound for &quot;</span></div><div class="line"><a name="l04787"></a><span class="lineno"> 4787</span>&#160;                    <span class="stringliteral">&quot;sequential/shared-memory code&quot;</span>)</div><div class="line"><a name="l04788"></a><span class="lineno"> 4788</span>&#160;        <span class="keywordflow">elif</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#af1f264ad7e26981899729d37e867aee6">_upper_bound_name</a> == <span class="stringliteral">&quot;inner&quot;</span>:</div><div class="line"><a name="l04789"></a><span class="lineno"> 4789</span>&#160;            <span class="keywordflow">if</span> Config.get().distributed_memory:</div><div class="line"><a name="l04790"></a><span class="lineno"> 4790</span>&#160;                <span class="keywordflow">return</span> <span class="stringliteral">&quot;{0}%get_last_inner_cell({1})&quot;</span>.format(mesh,</div><div class="line"><a name="l04791"></a><span class="lineno"> 4791</span>&#160;                                                             halo_index)</div><div class="line"><a name="l04792"></a><span class="lineno"> 4792</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l04793"></a><span class="lineno"> 4793</span>&#160;                <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l04794"></a><span class="lineno"> 4794</span>&#160;                    <span class="stringliteral">&quot;&#39;inner&#39; is not a valid loop upper bound for &quot;</span></div><div class="line"><a name="l04795"></a><span class="lineno"> 4795</span>&#160;                    <span class="stringliteral">&quot;sequential/shared-memory code&quot;</span>)</div><div class="line"><a name="l04796"></a><span class="lineno"> 4796</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l04797"></a><span class="lineno"> 4797</span>&#160;            <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l04798"></a><span class="lineno"> 4798</span>&#160;                <span class="stringliteral">&quot;Unsupported upper bound name &#39;{0}&#39; found in dynloop.upper_&quot;</span></div><div class="line"><a name="l04799"></a><span class="lineno"> 4799</span>&#160;                <span class="stringliteral">&quot;bound_fortran()&quot;</span>.format(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#af1f264ad7e26981899729d37e867aee6">_upper_bound_name</a>))</div><div class="line"><a name="l04800"></a><span class="lineno"> 4800</span>&#160;</div><div class="line"><a name="l04801"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a2646ac6016870a47c86c3b537b40daa6"> 4801</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a2646ac6016870a47c86c3b537b40daa6">has_inc_arg</a>(self, mapping=None):</div><div class="line"><a name="l04802"></a><span class="lineno"> 4802</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Returns True if any of the Kernels called within this loop</span></div><div class="line"><a name="l04803"></a><span class="lineno"> 4803</span>&#160;<span class="stringliteral">        have an argument with INC access. Returns False otherwise. &#39;&#39;&#39;</span></div><div class="line"><a name="l04804"></a><span class="lineno"> 4804</span>&#160;        <span class="keywordflow">if</span> mapping <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l04805"></a><span class="lineno"> 4805</span>&#160;            my_mapping = mapping</div><div class="line"><a name="l04806"></a><span class="lineno"> 4806</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l04807"></a><span class="lineno"> 4807</span>&#160;            my_mapping = FIELD_ACCESS_MAP</div><div class="line"><a name="l04808"></a><span class="lineno"> 4808</span>&#160;        <span class="keywordflow">return</span> Loop.has_inc_arg(self, my_mapping)</div><div class="line"><a name="l04809"></a><span class="lineno"> 4809</span>&#160;</div><div class="line"><a name="l04810"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#aa6a96950d9bc282abc4505cdc7363ede"> 4810</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#aa6a96950d9bc282abc4505cdc7363ede">unique_fields_with_halo_reads</a>(self):</div><div class="line"><a name="l04811"></a><span class="lineno"> 4811</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Returns all fields in this loop that require at least some</span></div><div class="line"><a name="l04812"></a><span class="lineno"> 4812</span>&#160;<span class="stringliteral">        of their halo to be clean to work correctly. &#39;&#39;&#39;</span></div><div class="line"><a name="l04813"></a><span class="lineno"> 4813</span>&#160;</div><div class="line"><a name="l04814"></a><span class="lineno"> 4814</span>&#160;        unique_fields = []</div><div class="line"><a name="l04815"></a><span class="lineno"> 4815</span>&#160;        unique_field_names = []</div><div class="line"><a name="l04816"></a><span class="lineno"> 4816</span>&#160;</div><div class="line"><a name="l04817"></a><span class="lineno"> 4817</span>&#160;        <span class="keywordflow">for</span> call <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1psyGen_1_1Node.html#a42ca6fa079802bdbcd72d3deff79d0fc">calls</a>():</div><div class="line"><a name="l04818"></a><span class="lineno"> 4818</span>&#160;            <span class="keywordflow">for</span> arg <span class="keywordflow">in</span> call.arguments.args:</div><div class="line"><a name="l04819"></a><span class="lineno"> 4819</span>&#160;                <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a354c164f6362c43df7abb49e145dc698">_halo_read_access</a>(arg):</div><div class="line"><a name="l04820"></a><span class="lineno"> 4820</span>&#160;                    <span class="keywordflow">if</span> arg.name <span class="keywordflow">not</span> <span class="keywordflow">in</span> unique_field_names:</div><div class="line"><a name="l04821"></a><span class="lineno"> 4821</span>&#160;                        unique_field_names.append(arg.name)</div><div class="line"><a name="l04822"></a><span class="lineno"> 4822</span>&#160;                        unique_fields.append(arg)</div><div class="line"><a name="l04823"></a><span class="lineno"> 4823</span>&#160;        <span class="keywordflow">return</span> unique_fields</div><div class="line"><a name="l04824"></a><span class="lineno"> 4824</span>&#160;</div><div class="line"><a name="l04825"></a><span class="lineno"> 4825</span>&#160;    <span class="keyword">def </span>_halo_read_access(self, arg):</div><div class="line"><a name="l04826"></a><span class="lineno"> 4826</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;Determines whether the supplied argument has (or might have) its</span></div><div class="line"><a name="l04827"></a><span class="lineno"> 4827</span>&#160;<span class="stringliteral">        halo data read within this loop. Returns True if it does, or if</span></div><div class="line"><a name="l04828"></a><span class="lineno"> 4828</span>&#160;<span class="stringliteral">        it might and False if it definitely does not.</span></div><div class="line"><a name="l04829"></a><span class="lineno"> 4829</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04830"></a><span class="lineno"> 4830</span>&#160;<span class="stringliteral">        :param arg: an argument contained within this loop</span></div><div class="line"><a name="l04831"></a><span class="lineno"> 4831</span>&#160;<span class="stringliteral">        :type arg: :py:class:`psyclone.dynamo0p3.DynArgument`</span></div><div class="line"><a name="l04832"></a><span class="lineno"> 4832</span>&#160;<span class="stringliteral">        :return: True if the argument reads, or might read from the \</span></div><div class="line"><a name="l04833"></a><span class="lineno"> 4833</span>&#160;<span class="stringliteral">                 halo and False otherwise.</span></div><div class="line"><a name="l04834"></a><span class="lineno"> 4834</span>&#160;<span class="stringliteral">        :rtype: bool</span></div><div class="line"><a name="l04835"></a><span class="lineno"> 4835</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04836"></a><span class="lineno"> 4836</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l04837"></a><span class="lineno"> 4837</span>&#160;        <span class="keywordflow">if</span> arg.descriptor.stencil:</div><div class="line"><a name="l04838"></a><span class="lineno"> 4838</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#af1f264ad7e26981899729d37e867aee6">_upper_bound_name</a> <span class="keywordflow">not</span> <span class="keywordflow">in</span> [<span class="stringliteral">&quot;cell_halo&quot;</span>, <span class="stringliteral">&quot;ncells&quot;</span>]:</div><div class="line"><a name="l04839"></a><span class="lineno"> 4839</span>&#160;                <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l04840"></a><span class="lineno"> 4840</span>&#160;                    <span class="stringliteral">&quot;Loop bounds other than cell_halo and ncells are &quot;</span></div><div class="line"><a name="l04841"></a><span class="lineno"> 4841</span>&#160;                    <span class="stringliteral">&quot;currently unsupported for kernels with stencil &quot;</span></div><div class="line"><a name="l04842"></a><span class="lineno"> 4842</span>&#160;                    <span class="stringliteral">&quot;accesses. Found &#39;{0}&#39;.&quot;</span>.format(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#af1f264ad7e26981899729d37e867aee6">_upper_bound_name</a>))</div><div class="line"><a name="l04843"></a><span class="lineno"> 4843</span>&#160;            <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#af1f264ad7e26981899729d37e867aee6">_upper_bound_name</a> <span class="keywordflow">in</span> [<span class="stringliteral">&quot;cell_halo&quot;</span>, <span class="stringliteral">&quot;ncells&quot;</span>]</div><div class="line"><a name="l04844"></a><span class="lineno"> 4844</span>&#160;        <span class="keywordflow">if</span> arg.type <span class="keywordflow">in</span> VALID_SCALAR_NAMES:</div><div class="line"><a name="l04845"></a><span class="lineno"> 4845</span>&#160;            <span class="comment"># scalars do not have halos</span></div><div class="line"><a name="l04846"></a><span class="lineno"> 4846</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">False</span></div><div class="line"><a name="l04847"></a><span class="lineno"> 4847</span>&#160;        <span class="keywordflow">elif</span> arg.is_operator:</div><div class="line"><a name="l04848"></a><span class="lineno"> 4848</span>&#160;            <span class="comment"># operators do not have halos</span></div><div class="line"><a name="l04849"></a><span class="lineno"> 4849</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">False</span></div><div class="line"><a name="l04850"></a><span class="lineno"> 4850</span>&#160;        <span class="keywordflow">elif</span> arg.discontinuous <span class="keywordflow">and</span> arg.access.lower() <span class="keywordflow">in</span> \</div><div class="line"><a name="l04851"></a><span class="lineno"> 4851</span>&#160;                [<span class="stringliteral">&quot;gh_read&quot;</span>, <span class="stringliteral">&quot;gh_readwrite&quot;</span>]:</div><div class="line"><a name="l04852"></a><span class="lineno"> 4852</span>&#160;            <span class="comment"># there are no shared dofs so access to inner and ncells are</span></div><div class="line"><a name="l04853"></a><span class="lineno"> 4853</span>&#160;            <span class="comment"># local so we only care about reads in the halo</span></div><div class="line"><a name="l04854"></a><span class="lineno"> 4854</span>&#160;            <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#af1f264ad7e26981899729d37e867aee6">_upper_bound_name</a> <span class="keywordflow">in</span> HALO_ACCESS_LOOP_BOUNDS</div><div class="line"><a name="l04855"></a><span class="lineno"> 4855</span>&#160;        <span class="keywordflow">elif</span> arg.access.lower() <span class="keywordflow">in</span> [<span class="stringliteral">&quot;gh_read&quot;</span>, <span class="stringliteral">&quot;gh_inc&quot;</span>]:</div><div class="line"><a name="l04856"></a><span class="lineno"> 4856</span>&#160;            <span class="comment"># arg is either continuous or we don&#39;t know (any_space_x)</span></div><div class="line"><a name="l04857"></a><span class="lineno"> 4857</span>&#160;            <span class="comment"># and we need to assume it may be continuous for</span></div><div class="line"><a name="l04858"></a><span class="lineno"> 4858</span>&#160;            <span class="comment"># correctness</span></div><div class="line"><a name="l04859"></a><span class="lineno"> 4859</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#af1f264ad7e26981899729d37e867aee6">_upper_bound_name</a> <span class="keywordflow">in</span> HALO_ACCESS_LOOP_BOUNDS:</div><div class="line"><a name="l04860"></a><span class="lineno"> 4860</span>&#160;                <span class="comment"># we read in the halo</span></div><div class="line"><a name="l04861"></a><span class="lineno"> 4861</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">True</span></div><div class="line"><a name="l04862"></a><span class="lineno"> 4862</span>&#160;            <span class="keywordflow">elif</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#af1f264ad7e26981899729d37e867aee6">_upper_bound_name</a> <span class="keywordflow">in</span> [<span class="stringliteral">&quot;ncells&quot;</span>, <span class="stringliteral">&quot;nannexed&quot;</span>]:</div><div class="line"><a name="l04863"></a><span class="lineno"> 4863</span>&#160;                <span class="comment"># we read annexed dofs. Return False if we always</span></div><div class="line"><a name="l04864"></a><span class="lineno"> 4864</span>&#160;                <span class="comment"># compute annexed dofs and True if we don&#39;t (as</span></div><div class="line"><a name="l04865"></a><span class="lineno"> 4865</span>&#160;                <span class="comment"># annexed dofs are part of the level 1 halo).</span></div><div class="line"><a name="l04866"></a><span class="lineno"> 4866</span>&#160;                <span class="keywordflow">return</span> <span class="keywordflow">not</span> Config.get()\</div><div class="line"><a name="l04867"></a><span class="lineno"> 4867</span>&#160;                                 .api_conf(<span class="stringliteral">&quot;dynamo0.3&quot;</span>).compute_annexed_dofs</div><div class="line"><a name="l04868"></a><span class="lineno"> 4868</span>&#160;            <span class="keywordflow">elif</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#af1f264ad7e26981899729d37e867aee6">_upper_bound_name</a> <span class="keywordflow">in</span> [<span class="stringliteral">&quot;ndofs&quot;</span>]:</div><div class="line"><a name="l04869"></a><span class="lineno"> 4869</span>&#160;                <span class="comment"># argument does not read from the halo</span></div><div class="line"><a name="l04870"></a><span class="lineno"> 4870</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">False</span></div><div class="line"><a name="l04871"></a><span class="lineno"> 4871</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l04872"></a><span class="lineno"> 4872</span>&#160;                <span class="comment"># nothing should get to here so raise an exception</span></div><div class="line"><a name="l04873"></a><span class="lineno"> 4873</span>&#160;                <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l04874"></a><span class="lineno"> 4874</span>&#160;                    <span class="stringliteral">&quot;Internal error in _halo_read_access. It should not be &quot;</span></div><div class="line"><a name="l04875"></a><span class="lineno"> 4875</span>&#160;                    <span class="stringliteral">&quot;possible to get to here. loop upper bound name is &#39;{0}&#39; &quot;</span></div><div class="line"><a name="l04876"></a><span class="lineno"> 4876</span>&#160;                    <span class="stringliteral">&quot;and arg &#39;{1}&#39; access is &#39;{2}&#39;.&quot;</span>.format(</div><div class="line"><a name="l04877"></a><span class="lineno"> 4877</span>&#160;                        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#af1f264ad7e26981899729d37e867aee6">_upper_bound_name</a>, arg.name, arg.access))</div><div class="line"><a name="l04878"></a><span class="lineno"> 4878</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l04879"></a><span class="lineno"> 4879</span>&#160;            <span class="comment"># access is neither a read nor an inc so does not need halo</span></div><div class="line"><a name="l04880"></a><span class="lineno"> 4880</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">False</span></div><div class="line"><a name="l04881"></a><span class="lineno"> 4881</span>&#160;</div><div class="line"><a name="l04882"></a><span class="lineno"> 4882</span>&#160;    <span class="keyword">def </span>_add_halo_exchange_code(self, halo_field, idx=None):</div><div class="line"><a name="l04883"></a><span class="lineno"> 4883</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;An internal helper method to add the halo exchange call immediately</span></div><div class="line"><a name="l04884"></a><span class="lineno"> 4884</span>&#160;<span class="stringliteral">        before this loop using the halo_field argument for the</span></div><div class="line"><a name="l04885"></a><span class="lineno"> 4885</span>&#160;<span class="stringliteral">        associated field information and the optional idx argument if</span></div><div class="line"><a name="l04886"></a><span class="lineno"> 4886</span>&#160;<span class="stringliteral">        the field is a vector field.</span></div><div class="line"><a name="l04887"></a><span class="lineno"> 4887</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04888"></a><span class="lineno"> 4888</span>&#160;<span class="stringliteral">        In certain situations the halo exchange will not be</span></div><div class="line"><a name="l04889"></a><span class="lineno"> 4889</span>&#160;<span class="stringliteral">        required. This is dealt with by adding the halo exchange,</span></div><div class="line"><a name="l04890"></a><span class="lineno"> 4890</span>&#160;<span class="stringliteral">        asking it if it is required and then removing it if it is</span></div><div class="line"><a name="l04891"></a><span class="lineno"> 4891</span>&#160;<span class="stringliteral">        not. This may seem strange but the logic for determining</span></div><div class="line"><a name="l04892"></a><span class="lineno"> 4892</span>&#160;<span class="stringliteral">        whether a halo exchange is required is within the halo</span></div><div class="line"><a name="l04893"></a><span class="lineno"> 4893</span>&#160;<span class="stringliteral">        exchange class so it is simplest to do it this way</span></div><div class="line"><a name="l04894"></a><span class="lineno"> 4894</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04895"></a><span class="lineno"> 4895</span>&#160;<span class="stringliteral">        :param halo_field: the argument requiring a halo exchange</span></div><div class="line"><a name="l04896"></a><span class="lineno"> 4896</span>&#160;<span class="stringliteral">        :type halo_field: :py:class:`psyclone.dynamo0p3.DynArgument`</span></div><div class="line"><a name="l04897"></a><span class="lineno"> 4897</span>&#160;<span class="stringliteral">        :param index: optional argument providing the vector index if</span></div><div class="line"><a name="l04898"></a><span class="lineno"> 4898</span>&#160;<span class="stringliteral">        there is one and None if not. Defaults to None.</span></div><div class="line"><a name="l04899"></a><span class="lineno"> 4899</span>&#160;<span class="stringliteral">        :type index: int or None</span></div><div class="line"><a name="l04900"></a><span class="lineno"> 4900</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04901"></a><span class="lineno"> 4901</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l04902"></a><span class="lineno"> 4902</span>&#160;        exchange = <a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchange.html">DynHaloExchange</a>(halo_field,</div><div class="line"><a name="l04903"></a><span class="lineno"> 4903</span>&#160;                                   parent=self.<a class="code" href="classpsyclone_1_1psyGen_1_1Node.html#a3e33fe0cdcff6e22a388b89476017700">parent</a>,</div><div class="line"><a name="l04904"></a><span class="lineno"> 4904</span>&#160;                                   vector_index=idx)</div><div class="line"><a name="l04905"></a><span class="lineno"> 4905</span>&#160;        self.parent.children.insert(self.<a class="code" href="classpsyclone_1_1psyGen_1_1Node.html#a68bdd2c9de759ce07262566af9f9f949">position</a>,</div><div class="line"><a name="l04906"></a><span class="lineno"> 4906</span>&#160;                                    exchange)</div><div class="line"><a name="l04907"></a><span class="lineno"> 4907</span>&#160;        <span class="comment"># check whether this halo exchange has been placed</span></div><div class="line"><a name="l04908"></a><span class="lineno"> 4908</span>&#160;        <span class="comment"># here correctly and if not, remove it.</span></div><div class="line"><a name="l04909"></a><span class="lineno"> 4909</span>&#160;        required, _ = exchange.required()</div><div class="line"><a name="l04910"></a><span class="lineno"> 4910</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> required:</div><div class="line"><a name="l04911"></a><span class="lineno"> 4911</span>&#160;            exchange.parent.children.remove(exchange)</div><div class="line"><a name="l04912"></a><span class="lineno"> 4912</span>&#160;</div><div class="line"><a name="l04913"></a><span class="lineno"> 4913</span>&#160;    <span class="keyword">def </span>_add_halo_exchange(self, halo_field):</div><div class="line"><a name="l04914"></a><span class="lineno"> 4914</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;Internal helper method to add (a) halo exchange call(s) immediately</span></div><div class="line"><a name="l04915"></a><span class="lineno"> 4915</span>&#160;<span class="stringliteral">        before this loop using the halo_field argument for the</span></div><div class="line"><a name="l04916"></a><span class="lineno"> 4916</span>&#160;<span class="stringliteral">        associated field information. If the field is a vector then</span></div><div class="line"><a name="l04917"></a><span class="lineno"> 4917</span>&#160;<span class="stringliteral">        add the appropriate number of halo exchange calls.</span></div><div class="line"><a name="l04918"></a><span class="lineno"> 4918</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04919"></a><span class="lineno"> 4919</span>&#160;<span class="stringliteral">        :param halo_field: the argument requiring a halo exchange</span></div><div class="line"><a name="l04920"></a><span class="lineno"> 4920</span>&#160;<span class="stringliteral">        :type halo_field: :py:class:`psyclone.dynamo0p3.DynArgument`</span></div><div class="line"><a name="l04921"></a><span class="lineno"> 4921</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l04922"></a><span class="lineno"> 4922</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l04923"></a><span class="lineno"> 4923</span>&#160;        <span class="keywordflow">if</span> halo_field.vector_size &gt; 1:</div><div class="line"><a name="l04924"></a><span class="lineno"> 4924</span>&#160;            <span class="comment"># the range function below returns values from</span></div><div class="line"><a name="l04925"></a><span class="lineno"> 4925</span>&#160;            <span class="comment"># 1 to the vector size which is what we</span></div><div class="line"><a name="l04926"></a><span class="lineno"> 4926</span>&#160;            <span class="comment"># require in our Fortran code</span></div><div class="line"><a name="l04927"></a><span class="lineno"> 4927</span>&#160;            <span class="keywordflow">for</span> idx <span class="keywordflow">in</span> range(1, halo_field.vector_size+1):</div><div class="line"><a name="l04928"></a><span class="lineno"> 4928</span>&#160;                self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#ab328ffed47890eb3bebc88aa5998fc53">_add_halo_exchange_code</a>(halo_field, idx)</div><div class="line"><a name="l04929"></a><span class="lineno"> 4929</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l04930"></a><span class="lineno"> 4930</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#ab328ffed47890eb3bebc88aa5998fc53">_add_halo_exchange_code</a>(halo_field)</div><div class="line"><a name="l04931"></a><span class="lineno"> 4931</span>&#160;</div><div class="line"><a name="l04932"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#afede07b3ebb038a972eaa771eb334146"> 4932</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#afede07b3ebb038a972eaa771eb334146">update_halo_exchanges</a>(self):</div><div class="line"><a name="l04933"></a><span class="lineno"> 4933</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;add and/or remove halo exchanges due to changes in the loops</span></div><div class="line"><a name="l04934"></a><span class="lineno"> 4934</span>&#160;<span class="stringliteral">        bounds&#39;&#39;&#39;</span></div><div class="line"><a name="l04935"></a><span class="lineno"> 4935</span>&#160;        <span class="comment"># this call adds any new halo exchanges that are</span></div><div class="line"><a name="l04936"></a><span class="lineno"> 4936</span>&#160;        <span class="comment"># required. This is done by adding halo exchanges before this</span></div><div class="line"><a name="l04937"></a><span class="lineno"> 4937</span>&#160;        <span class="comment"># loop for any fields in the loop that require a halo exchange</span></div><div class="line"><a name="l04938"></a><span class="lineno"> 4938</span>&#160;        <span class="comment"># and don&#39;t already have one</span></div><div class="line"><a name="l04939"></a><span class="lineno"> 4939</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#af98ed18daa2a1e1014dcbef9c7dc9fb7">create_halo_exchanges</a>()</div><div class="line"><a name="l04940"></a><span class="lineno"> 4940</span>&#160;        <span class="comment"># Now remove any existing halo exchanges that are no longer</span></div><div class="line"><a name="l04941"></a><span class="lineno"> 4941</span>&#160;        <span class="comment"># required. This is done by removing halo exchanges after this</span></div><div class="line"><a name="l04942"></a><span class="lineno"> 4942</span>&#160;        <span class="comment"># loop where a field in this loop previously had a forward</span></div><div class="line"><a name="l04943"></a><span class="lineno"> 4943</span>&#160;        <span class="comment"># dependence on a halo exchange but no longer does</span></div><div class="line"><a name="l04944"></a><span class="lineno"> 4944</span>&#160;        <span class="keywordflow">for</span> call <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1psyGen_1_1Node.html#a42ca6fa079802bdbcd72d3deff79d0fc">calls</a>():</div><div class="line"><a name="l04945"></a><span class="lineno"> 4945</span>&#160;            <span class="keywordflow">for</span> arg <span class="keywordflow">in</span> call.arguments.args:</div><div class="line"><a name="l04946"></a><span class="lineno"> 4946</span>&#160;                <span class="keywordflow">if</span> arg.access <span class="keywordflow">in</span> GH_WRITE_ACCESSES:</div><div class="line"><a name="l04947"></a><span class="lineno"> 4947</span>&#160;                    dep_arg_list = arg.forward_read_dependencies()</div><div class="line"><a name="l04948"></a><span class="lineno"> 4948</span>&#160;                    <span class="keywordflow">for</span> dep_arg <span class="keywordflow">in</span> dep_arg_list:</div><div class="line"><a name="l04949"></a><span class="lineno"> 4949</span>&#160;                        <span class="keywordflow">if</span> isinstance(dep_arg.call, DynHaloExchange):</div><div class="line"><a name="l04950"></a><span class="lineno"> 4950</span>&#160;                            <span class="comment"># found a halo exchange as a forward dependence</span></div><div class="line"><a name="l04951"></a><span class="lineno"> 4951</span>&#160;                            <span class="comment"># ask the halo exchange if it is required</span></div><div class="line"><a name="l04952"></a><span class="lineno"> 4952</span>&#160;                            halo_exchange = dep_arg.call</div><div class="line"><a name="l04953"></a><span class="lineno"> 4953</span>&#160;                            required, _ = halo_exchange.required()</div><div class="line"><a name="l04954"></a><span class="lineno"> 4954</span>&#160;                            <span class="keywordflow">if</span> <span class="keywordflow">not</span> required:</div><div class="line"><a name="l04955"></a><span class="lineno"> 4955</span>&#160;                                halo_exchange.parent.children.remove(</div><div class="line"><a name="l04956"></a><span class="lineno"> 4956</span>&#160;                                    halo_exchange)</div><div class="line"><a name="l04957"></a><span class="lineno"> 4957</span>&#160;</div><div class="line"><a name="l04958"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#af98ed18daa2a1e1014dcbef9c7dc9fb7"> 4958</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#af98ed18daa2a1e1014dcbef9c7dc9fb7">create_halo_exchanges</a>(self):</div><div class="line"><a name="l04959"></a><span class="lineno"> 4959</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;Add halo exchanges before this loop as required by fields within</span></div><div class="line"><a name="l04960"></a><span class="lineno"> 4960</span>&#160;<span class="stringliteral">        this loop. To keep the logic simple we assume that any field</span></div><div class="line"><a name="l04961"></a><span class="lineno"> 4961</span>&#160;<span class="stringliteral">        that accesses the halo will require a halo exchange and then</span></div><div class="line"><a name="l04962"></a><span class="lineno"> 4962</span>&#160;<span class="stringliteral">        remove the halo exchange if this is not the case (when</span></div><div class="line"><a name="l04963"></a><span class="lineno"> 4963</span>&#160;<span class="stringliteral">        previous writers perform sufficient redundant computation). It</span></div><div class="line"><a name="l04964"></a><span class="lineno"> 4964</span>&#160;<span class="stringliteral">        is implemented this way as the halo exchange class determines</span></div><div class="line"><a name="l04965"></a><span class="lineno"> 4965</span>&#160;<span class="stringliteral">        whether it is required or not so a halo exchange needs to</span></div><div class="line"><a name="l04966"></a><span class="lineno"> 4966</span>&#160;<span class="stringliteral">        exist in order to find out. The appropriate logic is coded in</span></div><div class="line"><a name="l04967"></a><span class="lineno"> 4967</span>&#160;<span class="stringliteral">        the _add_halo_exchange helper method. &#39;&#39;&#39;</span></div><div class="line"><a name="l04968"></a><span class="lineno"> 4968</span>&#160;        <span class="keywordflow">for</span> halo_field <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#aa6a96950d9bc282abc4505cdc7363ede">unique_fields_with_halo_reads</a>():</div><div class="line"><a name="l04969"></a><span class="lineno"> 4969</span>&#160;            <span class="comment"># for each unique field in this loop that has its halo</span></div><div class="line"><a name="l04970"></a><span class="lineno"> 4970</span>&#160;            <span class="comment"># read (including annexed dofs), find the previous update</span></div><div class="line"><a name="l04971"></a><span class="lineno"> 4971</span>&#160;            <span class="comment"># of this field</span></div><div class="line"><a name="l04972"></a><span class="lineno"> 4972</span>&#160;            prev_arg_list = halo_field.backward_write_dependencies()</div><div class="line"><a name="l04973"></a><span class="lineno"> 4973</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> prev_arg_list:</div><div class="line"><a name="l04974"></a><span class="lineno"> 4974</span>&#160;                <span class="comment"># field has no previous dependence so create new halo</span></div><div class="line"><a name="l04975"></a><span class="lineno"> 4975</span>&#160;                <span class="comment"># exchange(s) as we don&#39;t know the state of the fields</span></div><div class="line"><a name="l04976"></a><span class="lineno"> 4976</span>&#160;                <span class="comment"># halo on entry to the invoke</span></div><div class="line"><a name="l04977"></a><span class="lineno"> 4977</span>&#160;                self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a2ab46a6bad87d296528120231a77e29d">_add_halo_exchange</a>(halo_field)</div><div class="line"><a name="l04978"></a><span class="lineno"> 4978</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l04979"></a><span class="lineno"> 4979</span>&#160;                <span class="comment"># field has one or more previous dependencies</span></div><div class="line"><a name="l04980"></a><span class="lineno"> 4980</span>&#160;                <span class="keywordflow">if</span> len(prev_arg_list) &gt; 1:</div><div class="line"><a name="l04981"></a><span class="lineno"> 4981</span>&#160;                    <span class="comment"># field has more than one previous dependencies so</span></div><div class="line"><a name="l04982"></a><span class="lineno"> 4982</span>&#160;                    <span class="comment"># should be a vector</span></div><div class="line"><a name="l04983"></a><span class="lineno"> 4983</span>&#160;                    <span class="keywordflow">if</span> halo_field.vector_size &lt;= 1:</div><div class="line"><a name="l04984"></a><span class="lineno"> 4984</span>&#160;                        <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l04985"></a><span class="lineno"> 4985</span>&#160;                            <span class="stringliteral">&quot;Error in create_halo_exchanges. Expecting field &quot;</span></div><div class="line"><a name="l04986"></a><span class="lineno"> 4986</span>&#160;                            <span class="stringliteral">&quot;&#39;{0}&#39; to be a vector as it has multiple previous &quot;</span></div><div class="line"><a name="l04987"></a><span class="lineno"> 4987</span>&#160;                            <span class="stringliteral">&quot;dependencies&quot;</span>.format(halo_field.name))</div><div class="line"><a name="l04988"></a><span class="lineno"> 4988</span>&#160;                    <span class="keywordflow">if</span> len(prev_arg_list) != halo_field.vector_size:</div><div class="line"><a name="l04989"></a><span class="lineno"> 4989</span>&#160;                        <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l04990"></a><span class="lineno"> 4990</span>&#160;                            <span class="stringliteral">&quot;Error in create_halo_exchanges. Expecting a &quot;</span></div><div class="line"><a name="l04991"></a><span class="lineno"> 4991</span>&#160;                            <span class="stringliteral">&quot;dependence for each vector index for field &#39;{0}&#39; &quot;</span></div><div class="line"><a name="l04992"></a><span class="lineno"> 4992</span>&#160;                            <span class="stringliteral">&quot;but the number of dependencies is &#39;{1}&#39; and the &quot;</span></div><div class="line"><a name="l04993"></a><span class="lineno"> 4993</span>&#160;                            <span class="stringliteral">&quot;vector size is &#39;{2}&#39;.&quot;</span>.format(</div><div class="line"><a name="l04994"></a><span class="lineno"> 4994</span>&#160;                                halo_field.name, halo_field.vector_size,</div><div class="line"><a name="l04995"></a><span class="lineno"> 4995</span>&#160;                                len(prev_arg_list)))</div><div class="line"><a name="l04996"></a><span class="lineno"> 4996</span>&#160;                    <span class="keywordflow">for</span> arg <span class="keywordflow">in</span> prev_arg_list:</div><div class="line"><a name="l04997"></a><span class="lineno"> 4997</span>&#160;                        <span class="keywordflow">if</span> <span class="keywordflow">not</span> isinstance(arg.call, DynHaloExchange):</div><div class="line"><a name="l04998"></a><span class="lineno"> 4998</span>&#160;                            <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l04999"></a><span class="lineno"> 4999</span>&#160;                                <span class="stringliteral">&quot;Error in create_halo_exchanges. Expecting &quot;</span></div><div class="line"><a name="l05000"></a><span class="lineno"> 5000</span>&#160;                                <span class="stringliteral">&quot;all dependent nodes to be halo exchanges&quot;</span>)</div><div class="line"><a name="l05001"></a><span class="lineno"> 5001</span>&#160;                prev_node = prev_arg_list[0].call</div><div class="line"><a name="l05002"></a><span class="lineno"> 5002</span>&#160;                <span class="keywordflow">if</span> <span class="keywordflow">not</span> isinstance(prev_node, DynHaloExchange):</div><div class="line"><a name="l05003"></a><span class="lineno"> 5003</span>&#160;                    <span class="comment"># previous dependence is not a halo exchange so</span></div><div class="line"><a name="l05004"></a><span class="lineno"> 5004</span>&#160;                    <span class="comment"># call the add halo exchange logic which</span></div><div class="line"><a name="l05005"></a><span class="lineno"> 5005</span>&#160;                    <span class="comment"># determines whether a halo exchange is required</span></div><div class="line"><a name="l05006"></a><span class="lineno"> 5006</span>&#160;                    <span class="comment"># or not</span></div><div class="line"><a name="l05007"></a><span class="lineno"> 5007</span>&#160;                    self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a2ab46a6bad87d296528120231a77e29d">_add_halo_exchange</a>(halo_field)</div><div class="line"><a name="l05008"></a><span class="lineno"> 5008</span>&#160;</div><div class="line"><a name="l05009"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a056323df2353170d6e33f795eb15d0a2"> 5009</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a056323df2353170d6e33f795eb15d0a2">gen_code</a>(self, parent):</div><div class="line"><a name="l05010"></a><span class="lineno"> 5010</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;Work out the appropriate loop bounds and variable name</span></div><div class="line"><a name="l05011"></a><span class="lineno"> 5011</span>&#160;<span class="stringliteral">        depending on the loop type and then call the base class to</span></div><div class="line"><a name="l05012"></a><span class="lineno"> 5012</span>&#160;<span class="stringliteral">        generate the code.</span></div><div class="line"><a name="l05013"></a><span class="lineno"> 5013</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l05014"></a><span class="lineno"> 5014</span>&#160;<span class="stringliteral">        :param parent: an f2pygen object that will be the parent of \</span></div><div class="line"><a name="l05015"></a><span class="lineno"> 5015</span>&#160;<span class="stringliteral">        f2pygen objects created in this method</span></div><div class="line"><a name="l05016"></a><span class="lineno"> 5016</span>&#160;<span class="stringliteral">        :type parent: :py:class:`psyclone.f2pygen.BaseGen`</span></div><div class="line"><a name="l05017"></a><span class="lineno"> 5017</span>&#160;<span class="stringliteral">        :raises GenerationError: if a loop over colours is within an \</span></div><div class="line"><a name="l05018"></a><span class="lineno"> 5018</span>&#160;<span class="stringliteral">        OpenMP parallel region (as it must be serial)</span></div><div class="line"><a name="l05019"></a><span class="lineno"> 5019</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l05020"></a><span class="lineno"> 5020</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l05021"></a><span class="lineno"> 5021</span>&#160;        <span class="comment"># Check that we&#39;re not within an OpenMP parallel region if</span></div><div class="line"><a name="l05022"></a><span class="lineno"> 5022</span>&#160;        <span class="comment"># we are a loop over colours.</span></div><div class="line"><a name="l05023"></a><span class="lineno"> 5023</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a1ff44a76dff13cfb47c2d0fa65923451">_loop_type</a> == <span class="stringliteral">&quot;colours&quot;</span> <span class="keywordflow">and</span> self.<a class="code" href="classpsyclone_1_1psyGen_1_1Node.html#a68afb39a447656f9ff01930065a1637d">is_openmp_parallel</a>():</div><div class="line"><a name="l05024"></a><span class="lineno"> 5024</span>&#160;            <span class="keywordflow">raise</span> GenerationError(<span class="stringliteral">&quot;Cannot have a loop over &quot;</span></div><div class="line"><a name="l05025"></a><span class="lineno"> 5025</span>&#160;                                  <span class="stringliteral">&quot;colours within an OpenMP &quot;</span></div><div class="line"><a name="l05026"></a><span class="lineno"> 5026</span>&#160;                                  <span class="stringliteral">&quot;parallel region.&quot;</span>)</div><div class="line"><a name="l05027"></a><span class="lineno"> 5027</span>&#160;</div><div class="line"><a name="l05028"></a><span class="lineno"> 5028</span>&#160;        <span class="comment"># get fortran loop bounds</span></div><div class="line"><a name="l05029"></a><span class="lineno"> 5029</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a048f0f694be0fa4a376250074b32a795">_start</a> = self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a9758139bb05a74195f2d02e102277a58">_lower_bound_fortran</a>()</div><div class="line"><a name="l05030"></a><span class="lineno"> 5030</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a3e27c793e731d0af8b3715722b44ce04">_stop</a> = self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a98c64dd710b0b0072791b92909b15830">_upper_bound_fortran</a>()</div><div class="line"><a name="l05031"></a><span class="lineno"> 5031</span>&#160;        Loop.gen_code(self, parent)</div><div class="line"><a name="l05032"></a><span class="lineno"> 5032</span>&#160;</div><div class="line"><a name="l05033"></a><span class="lineno"> 5033</span>&#160;        <span class="keywordflow">if</span> Config.get().distributed_memory <span class="keywordflow">and</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a1ff44a76dff13cfb47c2d0fa65923451">_loop_type</a> != <span class="stringliteral">&quot;colour&quot;</span>:</div><div class="line"><a name="l05034"></a><span class="lineno"> 5034</span>&#160;</div><div class="line"><a name="l05035"></a><span class="lineno"> 5035</span>&#160;            <span class="comment"># Set halo clean/dirty for all fields that are modified</span></div><div class="line"><a name="l05036"></a><span class="lineno"> 5036</span>&#160;            <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> CallGen, CommentGen, DirectiveGen</div><div class="line"><a name="l05037"></a><span class="lineno"> 5037</span>&#160;            fields = self.<a class="code" href="classpsyclone_1_1psyGen_1_1Loop.html#a792ef7a413409afa60e1c658b1f49310">unique_modified_args</a>(FIELD_ACCESS_MAP, <span class="stringliteral">&quot;gh_field&quot;</span>)</div><div class="line"><a name="l05038"></a><span class="lineno"> 5038</span>&#160;</div><div class="line"><a name="l05039"></a><span class="lineno"> 5039</span>&#160;            <span class="keywordflow">if</span> fields:</div><div class="line"><a name="l05040"></a><span class="lineno"> 5040</span>&#160;                parent.add(CommentGen(parent, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l05041"></a><span class="lineno"> 5041</span>&#160;                parent.add(CommentGen(parent,</div><div class="line"><a name="l05042"></a><span class="lineno"> 5042</span>&#160;                                      <span class="stringliteral">&quot; Set halos dirty/clean for fields &quot;</span></div><div class="line"><a name="l05043"></a><span class="lineno"> 5043</span>&#160;                                      <span class="stringliteral">&quot;modified in the above loop&quot;</span>))</div><div class="line"><a name="l05044"></a><span class="lineno"> 5044</span>&#160;                parent.add(CommentGen(parent, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l05045"></a><span class="lineno"> 5045</span>&#160;                <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1psyGen.html">psyclone.psyGen</a> <span class="keyword">import</span> OMPParallelDoDirective</div><div class="line"><a name="l05046"></a><span class="lineno"> 5046</span>&#160;                use_omp_master = <span class="keyword">False</span></div><div class="line"><a name="l05047"></a><span class="lineno"> 5047</span>&#160;                <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1psyGen_1_1Node.html#a68afb39a447656f9ff01930065a1637d">is_openmp_parallel</a>():</div><div class="line"><a name="l05048"></a><span class="lineno"> 5048</span>&#160;                    <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.<a class="code" href="classpsyclone_1_1psyGen_1_1Node.html#ae280d2a4a7fc69bcc4c836a696c8ed94">ancestor</a>(OMPParallelDoDirective):</div><div class="line"><a name="l05049"></a><span class="lineno"> 5049</span>&#160;                        use_omp_master = <span class="keyword">True</span></div><div class="line"><a name="l05050"></a><span class="lineno"> 5050</span>&#160;                        <span class="comment"># I am within an OpenMP Do directive so protect</span></div><div class="line"><a name="l05051"></a><span class="lineno"> 5051</span>&#160;                        <span class="comment"># set_dirty() and set_clean() with OpenMP Master</span></div><div class="line"><a name="l05052"></a><span class="lineno"> 5052</span>&#160;                        parent.add(DirectiveGen(parent, <span class="stringliteral">&quot;omp&quot;</span>, <span class="stringliteral">&quot;begin&quot;</span>,</div><div class="line"><a name="l05053"></a><span class="lineno"> 5053</span>&#160;                                                <span class="stringliteral">&quot;master&quot;</span>, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l05054"></a><span class="lineno"> 5054</span>&#160;                <span class="comment"># first set all of the halo dirty unless we are</span></div><div class="line"><a name="l05055"></a><span class="lineno"> 5055</span>&#160;                <span class="comment"># subsequently going to set all of the halo clean</span></div><div class="line"><a name="l05056"></a><span class="lineno"> 5056</span>&#160;                <span class="keywordflow">for</span> field <span class="keywordflow">in</span> fields:</div><div class="line"><a name="l05057"></a><span class="lineno"> 5057</span>&#160;                    <span class="comment"># The HaloWriteAccess class provides information</span></div><div class="line"><a name="l05058"></a><span class="lineno"> 5058</span>&#160;                    <span class="comment"># about how the supplied field is accessed within</span></div><div class="line"><a name="l05059"></a><span class="lineno"> 5059</span>&#160;                    <span class="comment"># its parent loop</span></div><div class="line"><a name="l05060"></a><span class="lineno"> 5060</span>&#160;                    hwa = <a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloWriteAccess.html">HaloWriteAccess</a>(field)</div><div class="line"><a name="l05061"></a><span class="lineno"> 5061</span>&#160;                    <span class="keywordflow">if</span> <span class="keywordflow">not</span> hwa.max_depth <span class="keywordflow">or</span> hwa.dirty_outer:</div><div class="line"><a name="l05062"></a><span class="lineno"> 5062</span>&#160;                        <span class="comment"># output set dirty as some of the halo will</span></div><div class="line"><a name="l05063"></a><span class="lineno"> 5063</span>&#160;                        <span class="comment"># not be set to clean</span></div><div class="line"><a name="l05064"></a><span class="lineno"> 5064</span>&#160;                        <span class="keywordflow">if</span> field.vector_size &gt; 1:</div><div class="line"><a name="l05065"></a><span class="lineno"> 5065</span>&#160;                            <span class="comment"># the range function below returns values from</span></div><div class="line"><a name="l05066"></a><span class="lineno"> 5066</span>&#160;                            <span class="comment"># 1 to the vector size which is what we</span></div><div class="line"><a name="l05067"></a><span class="lineno"> 5067</span>&#160;                            <span class="comment"># require in our Fortran code</span></div><div class="line"><a name="l05068"></a><span class="lineno"> 5068</span>&#160;                            <span class="keywordflow">for</span> index <span class="keywordflow">in</span> range(1, field.vector_size+1):</div><div class="line"><a name="l05069"></a><span class="lineno"> 5069</span>&#160;                                parent.add(CallGen(parent,</div><div class="line"><a name="l05070"></a><span class="lineno"> 5070</span>&#160;                                                   name=field.proxy_name +</div><div class="line"><a name="l05071"></a><span class="lineno"> 5071</span>&#160;                                                   <span class="stringliteral">&quot;(&quot;</span> + str(index) +</div><div class="line"><a name="l05072"></a><span class="lineno"> 5072</span>&#160;                                                   <span class="stringliteral">&quot;)%set_dirty()&quot;</span>))</div><div class="line"><a name="l05073"></a><span class="lineno"> 5073</span>&#160;                        <span class="keywordflow">else</span>:</div><div class="line"><a name="l05074"></a><span class="lineno"> 5074</span>&#160;                            parent.add(CallGen(parent, name=field.proxy_name +</div><div class="line"><a name="l05075"></a><span class="lineno"> 5075</span>&#160;                                               <span class="stringliteral">&quot;%set_dirty()&quot;</span>))</div><div class="line"><a name="l05076"></a><span class="lineno"> 5076</span>&#160;                <span class="comment"># now set appropriate parts of the halo clean where</span></div><div class="line"><a name="l05077"></a><span class="lineno"> 5077</span>&#160;                <span class="comment"># redundant computation has been performed</span></div><div class="line"><a name="l05078"></a><span class="lineno"> 5078</span>&#160;                <span class="keywordflow">for</span> field <span class="keywordflow">in</span> fields:</div><div class="line"><a name="l05079"></a><span class="lineno"> 5079</span>&#160;                    <span class="comment"># The HaloWriteAccess class provides information</span></div><div class="line"><a name="l05080"></a><span class="lineno"> 5080</span>&#160;                    <span class="comment"># about how the supplied field is accessed within</span></div><div class="line"><a name="l05081"></a><span class="lineno"> 5081</span>&#160;                    <span class="comment"># its parent loop</span></div><div class="line"><a name="l05082"></a><span class="lineno"> 5082</span>&#160;                    hwa = <a class="code" href="classpsyclone_1_1dynamo0p3_1_1HaloWriteAccess.html">HaloWriteAccess</a>(field)</div><div class="line"><a name="l05083"></a><span class="lineno"> 5083</span>&#160;                    <span class="keywordflow">if</span> hwa.literal_depth:</div><div class="line"><a name="l05084"></a><span class="lineno"> 5084</span>&#160;                        <span class="comment"># halo access(es) is/are to a fixed depth</span></div><div class="line"><a name="l05085"></a><span class="lineno"> 5085</span>&#160;                        halo_depth = hwa.literal_depth</div><div class="line"><a name="l05086"></a><span class="lineno"> 5086</span>&#160;                        <span class="keywordflow">if</span> hwa.dirty_outer:</div><div class="line"><a name="l05087"></a><span class="lineno"> 5087</span>&#160;                            halo_depth -= 1</div><div class="line"><a name="l05088"></a><span class="lineno"> 5088</span>&#160;                        <span class="keywordflow">if</span> halo_depth &gt; 0:</div><div class="line"><a name="l05089"></a><span class="lineno"> 5089</span>&#160;                            <span class="keywordflow">if</span> field.vector_size &gt; 1:</div><div class="line"><a name="l05090"></a><span class="lineno"> 5090</span>&#160;                                <span class="comment"># the range function below returns</span></div><div class="line"><a name="l05091"></a><span class="lineno"> 5091</span>&#160;                                <span class="comment"># values from 1 to the vector size</span></div><div class="line"><a name="l05092"></a><span class="lineno"> 5092</span>&#160;                                <span class="comment"># which is what we require in our</span></div><div class="line"><a name="l05093"></a><span class="lineno"> 5093</span>&#160;                                <span class="comment"># Fortran code</span></div><div class="line"><a name="l05094"></a><span class="lineno"> 5094</span>&#160;                                <span class="keywordflow">for</span> index <span class="keywordflow">in</span> range(1, field.vector_size+1):</div><div class="line"><a name="l05095"></a><span class="lineno"> 5095</span>&#160;                                    parent.add(</div><div class="line"><a name="l05096"></a><span class="lineno"> 5096</span>&#160;                                        CallGen(parent,</div><div class="line"><a name="l05097"></a><span class="lineno"> 5097</span>&#160;                                                name=<span class="stringliteral">&quot;{0}({1})%set_clean&quot;</span></div><div class="line"><a name="l05098"></a><span class="lineno"> 5098</span>&#160;                                                <span class="stringliteral">&quot;({2})&quot;</span>.format(</div><div class="line"><a name="l05099"></a><span class="lineno"> 5099</span>&#160;                                                    field.proxy_name,</div><div class="line"><a name="l05100"></a><span class="lineno"> 5100</span>&#160;                                                    str(index),</div><div class="line"><a name="l05101"></a><span class="lineno"> 5101</span>&#160;                                                    halo_depth)))</div><div class="line"><a name="l05102"></a><span class="lineno"> 5102</span>&#160;                            <span class="keywordflow">else</span>:</div><div class="line"><a name="l05103"></a><span class="lineno"> 5103</span>&#160;                                parent.add(</div><div class="line"><a name="l05104"></a><span class="lineno"> 5104</span>&#160;                                    CallGen(parent,</div><div class="line"><a name="l05105"></a><span class="lineno"> 5105</span>&#160;                                            name=<span class="stringliteral">&quot;{0}%set_clean({1})&quot;</span>.</div><div class="line"><a name="l05106"></a><span class="lineno"> 5106</span>&#160;                                            format(field.proxy_name,</div><div class="line"><a name="l05107"></a><span class="lineno"> 5107</span>&#160;                                                   halo_depth)))</div><div class="line"><a name="l05108"></a><span class="lineno"> 5108</span>&#160;                    <span class="keywordflow">elif</span> hwa.max_depth:</div><div class="line"><a name="l05109"></a><span class="lineno"> 5109</span>&#160;                        <span class="comment"># halo accesses(s) is/are to the full halo</span></div><div class="line"><a name="l05110"></a><span class="lineno"> 5110</span>&#160;                        <span class="comment"># depth (-1 if continuous)</span></div><div class="line"><a name="l05111"></a><span class="lineno"> 5111</span>&#160;                        halo_depth = <span class="stringliteral">&quot;mesh%get_halo_depth()&quot;</span></div><div class="line"><a name="l05112"></a><span class="lineno"> 5112</span>&#160;                        <span class="keywordflow">if</span> hwa.dirty_outer:</div><div class="line"><a name="l05113"></a><span class="lineno"> 5113</span>&#160;                            <span class="comment"># a continuous field iterating over</span></div><div class="line"><a name="l05114"></a><span class="lineno"> 5114</span>&#160;                            <span class="comment"># cells leaves the outermost halo</span></div><div class="line"><a name="l05115"></a><span class="lineno"> 5115</span>&#160;                            <span class="comment"># dirty</span></div><div class="line"><a name="l05116"></a><span class="lineno"> 5116</span>&#160;                            halo_depth += <span class="stringliteral">&quot;-1&quot;</span></div><div class="line"><a name="l05117"></a><span class="lineno"> 5117</span>&#160;                        <span class="keywordflow">if</span> field.vector_size &gt; 1:</div><div class="line"><a name="l05118"></a><span class="lineno"> 5118</span>&#160;                            <span class="comment"># the range function below returns</span></div><div class="line"><a name="l05119"></a><span class="lineno"> 5119</span>&#160;                            <span class="comment"># values from 1 to the vector size</span></div><div class="line"><a name="l05120"></a><span class="lineno"> 5120</span>&#160;                            <span class="comment"># which is what we require in our</span></div><div class="line"><a name="l05121"></a><span class="lineno"> 5121</span>&#160;                            <span class="comment"># Fortran code</span></div><div class="line"><a name="l05122"></a><span class="lineno"> 5122</span>&#160;                            <span class="keywordflow">for</span> index <span class="keywordflow">in</span> range(1, field.vector_size+1):</div><div class="line"><a name="l05123"></a><span class="lineno"> 5123</span>&#160;                                call = CallGen(parent,</div><div class="line"><a name="l05124"></a><span class="lineno"> 5124</span>&#160;                                               name=<span class="stringliteral">&quot;{0}({1})%set_clean(&quot;</span></div><div class="line"><a name="l05125"></a><span class="lineno"> 5125</span>&#160;                                               <span class="stringliteral">&quot;{2})&quot;</span>.format(</div><div class="line"><a name="l05126"></a><span class="lineno"> 5126</span>&#160;                                                   field.proxy_name,</div><div class="line"><a name="l05127"></a><span class="lineno"> 5127</span>&#160;                                                   str(index),</div><div class="line"><a name="l05128"></a><span class="lineno"> 5128</span>&#160;                                                   halo_depth))</div><div class="line"><a name="l05129"></a><span class="lineno"> 5129</span>&#160;                                parent.add(call)</div><div class="line"><a name="l05130"></a><span class="lineno"> 5130</span>&#160;                        <span class="keywordflow">else</span>:</div><div class="line"><a name="l05131"></a><span class="lineno"> 5131</span>&#160;                            call = CallGen(parent, name=<span class="stringliteral">&quot;{0}%set_clean(&quot;</span></div><div class="line"><a name="l05132"></a><span class="lineno"> 5132</span>&#160;                                           <span class="stringliteral">&quot;{1})&quot;</span>.format(field.proxy_name,</div><div class="line"><a name="l05133"></a><span class="lineno"> 5133</span>&#160;                                                         halo_depth))</div><div class="line"><a name="l05134"></a><span class="lineno"> 5134</span>&#160;                            parent.add(call)</div><div class="line"><a name="l05135"></a><span class="lineno"> 5135</span>&#160;</div><div class="line"><a name="l05136"></a><span class="lineno"> 5136</span>&#160;                <span class="keywordflow">if</span> use_omp_master:</div><div class="line"><a name="l05137"></a><span class="lineno"> 5137</span>&#160;                    <span class="comment"># I am within an OpenMP Do directive so protect</span></div><div class="line"><a name="l05138"></a><span class="lineno"> 5138</span>&#160;                    <span class="comment"># set_dirty() and set_clean() with OpenMP Master</span></div><div class="line"><a name="l05139"></a><span class="lineno"> 5139</span>&#160;                    parent.add(DirectiveGen(parent, <span class="stringliteral">&quot;omp&quot;</span>, <span class="stringliteral">&quot;end&quot;</span>,</div><div class="line"><a name="l05140"></a><span class="lineno"> 5140</span>&#160;                                            <span class="stringliteral">&quot;master&quot;</span>, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l05141"></a><span class="lineno"> 5141</span>&#160;                parent.add(CommentGen(parent, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l05142"></a><span class="lineno"> 5142</span>&#160;</div><div class="line"><a name="l05143"></a><span class="lineno"> 5143</span>&#160;</div><div class="line"><a name="l05144"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html"> 5144</a></span>&#160;<span class="keyword">class </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html">DynKern</a>(<a class="code" href="classpsyclone_1_1psyGen_1_1Kern.html">Kern</a>):</div><div class="line"><a name="l05145"></a><span class="lineno"> 5145</span>&#160;    <span class="stringliteral">&#39;&#39;&#39; Stores information about Dynamo Kernels as specified by the</span></div><div class="line"><a name="l05146"></a><span class="lineno"> 5146</span>&#160;<span class="stringliteral">    Kernel metadata and associated algorithm call. Uses this</span></div><div class="line"><a name="l05147"></a><span class="lineno"> 5147</span>&#160;<span class="stringliteral">    information to generate appropriate PSy layer code for the Kernel</span></div><div class="line"><a name="l05148"></a><span class="lineno"> 5148</span>&#160;<span class="stringliteral">    instance or to generate a Kernel stub&#39;&#39;&#39;</span></div><div class="line"><a name="l05149"></a><span class="lineno"> 5149</span>&#160;</div><div class="line"><a name="l05150"></a><span class="lineno"> 5150</span>&#160;    <span class="keyword">def </span>__init__(self):</div><div class="line"><a name="l05151"></a><span class="lineno"> 5151</span>&#160;        <span class="keywordflow">if</span> <span class="keyword">False</span>:  <span class="comment"># pylint: disable=using-constant-test</span></div><div class="line"><a name="l05152"></a><span class="lineno"> 5152</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a9993223ac16168df82b670c3cae892c9">_arguments</a> = <a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html">DynKernelArguments</a>(<span class="keywordtype">None</span>, <span class="keywordtype">None</span>)  <span class="comment"># for pyreverse</span></div><div class="line"><a name="l05153"></a><span class="lineno"> 5153</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a739991c89184d7221f51bfa0bfc45ef5">_func_descriptors</a> = <span class="keywordtype">None</span></div><div class="line"><a name="l05154"></a><span class="lineno"> 5154</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a7b8bc2307469e910804aee4337128581">_fs_descriptors</a> = <span class="keywordtype">None</span></div><div class="line"><a name="l05155"></a><span class="lineno"> 5155</span>&#160;        <span class="comment"># Whether this kernel requires quadrature</span></div><div class="line"><a name="l05156"></a><span class="lineno"> 5156</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#aaacdaa0d8fc3ab44afadfc114fc0ae6c">_qr_required</a> = <span class="keyword">False</span></div><div class="line"><a name="l05157"></a><span class="lineno"> 5157</span>&#160;        <span class="comment"># Whether this kernel requires basis functions</span></div><div class="line"><a name="l05158"></a><span class="lineno"> 5158</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#af7b08881b219a0ede28d2400e8f386d7">_basis_required</a> = <span class="keyword">False</span></div><div class="line"><a name="l05159"></a><span class="lineno"> 5159</span>&#160;        <span class="comment"># What shape of evaluator this kernel requires (if any)</span></div><div class="line"><a name="l05160"></a><span class="lineno"> 5160</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a7fe4641a1a9e166d8d39ec01cde935ea">_eval_shape</a> = <span class="stringliteral">&quot;&quot;</span></div><div class="line"><a name="l05161"></a><span class="lineno"> 5161</span>&#160;        <span class="comment"># The function spaces on which to *evaluate* basis/diff-basis</span></div><div class="line"><a name="l05162"></a><span class="lineno"> 5162</span>&#160;        <span class="comment"># functions if any are required for this kernel. Is a dict with</span></div><div class="line"><a name="l05163"></a><span class="lineno"> 5163</span>&#160;        <span class="comment"># (mangled) FS names as keys and associated kernel argument as value.</span></div><div class="line"><a name="l05164"></a><span class="lineno"> 5164</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a60d8a8c1a2520d12b2c60a723df0a850">_eval_targets</a> = OrderedDict()</div><div class="line"><a name="l05165"></a><span class="lineno"> 5165</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a030cc0efc6721fe3e45191872bd5ace1">_qr_text</a> = <span class="stringliteral">&quot;&quot;</span></div><div class="line"><a name="l05166"></a><span class="lineno"> 5166</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a1467c5970619680d6196607fa4b15bbc">_qr_name</a> = <span class="keywordtype">None</span></div><div class="line"><a name="l05167"></a><span class="lineno"> 5167</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a64504a14d7197f6915fe5588d1d32807">_qr_args</a> = <span class="keywordtype">None</span></div><div class="line"><a name="l05168"></a><span class="lineno"> 5168</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#ab99348d7adbe97fa7ace11e64f2be5b0">_name_space_manager</a> = NameSpaceFactory().create()</div><div class="line"><a name="l05169"></a><span class="lineno"> 5169</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a578c493154b39c44a3aadfa900741233">_cma_operation</a> = <span class="keywordtype">None</span></div><div class="line"><a name="l05170"></a><span class="lineno"> 5170</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a5990f404454302ebfa8f760f9b04ad0f">_is_intergrid</a> = <span class="keyword">False</span>  <span class="comment"># Whether this is an inter-grid kernel</span></div><div class="line"><a name="l05171"></a><span class="lineno"> 5171</span>&#160;</div><div class="line"><a name="l05172"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a8aba35c92f189b62f485895e1a2b2ec7"> 5172</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a8aba35c92f189b62f485895e1a2b2ec7">load</a>(self, call, parent=None):</div><div class="line"><a name="l05173"></a><span class="lineno"> 5173</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l05174"></a><span class="lineno"> 5174</span>&#160;<span class="stringliteral">        Sets up kernel information with the call object which is</span></div><div class="line"><a name="l05175"></a><span class="lineno"> 5175</span>&#160;<span class="stringliteral">        created by the parser. This object includes information about</span></div><div class="line"><a name="l05176"></a><span class="lineno"> 5176</span>&#160;<span class="stringliteral">        the invoke call and the associated kernel.</span></div><div class="line"><a name="l05177"></a><span class="lineno"> 5177</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l05178"></a><span class="lineno"> 5178</span>&#160;<span class="stringliteral">        :param call: The KernelCall object from which to extract information</span></div><div class="line"><a name="l05179"></a><span class="lineno"> 5179</span>&#160;<span class="stringliteral">                     about this kernel</span></div><div class="line"><a name="l05180"></a><span class="lineno"> 5180</span>&#160;<span class="stringliteral">        :type call: :py:class:`psyclone.parse.KernelCall`</span></div><div class="line"><a name="l05181"></a><span class="lineno"> 5181</span>&#160;<span class="stringliteral">        :param parent: The parent node of the kernel call in the AST</span></div><div class="line"><a name="l05182"></a><span class="lineno"> 5182</span>&#160;<span class="stringliteral">                       we are constructing. This will be a loop.</span></div><div class="line"><a name="l05183"></a><span class="lineno"> 5183</span>&#160;<span class="stringliteral">        :type parent: :py:class:`psyclone.dynamo0p3.DynLoop`</span></div><div class="line"><a name="l05184"></a><span class="lineno"> 5184</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l05185"></a><span class="lineno"> 5185</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a731480dd01bc8d93f89ebe7785887efb">_setup_basis</a>(call.ktype)</div><div class="line"><a name="l05186"></a><span class="lineno"> 5186</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a1695038ac7d13e1b48aa4cab79a75577">_setup</a>(call.ktype, call.module_name, call.args, parent)</div><div class="line"><a name="l05187"></a><span class="lineno"> 5187</span>&#160;</div><div class="line"><a name="l05188"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a7d26165d0414c7ed202bb31ffd360061"> 5188</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a7d26165d0414c7ed202bb31ffd360061">load_meta</a>(self, ktype):</div><div class="line"><a name="l05189"></a><span class="lineno"> 5189</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l05190"></a><span class="lineno"> 5190</span>&#160;<span class="stringliteral">        Sets up kernel information with the kernel type object</span></div><div class="line"><a name="l05191"></a><span class="lineno"> 5191</span>&#160;<span class="stringliteral">        which is created by the parser. The object includes the</span></div><div class="line"><a name="l05192"></a><span class="lineno"> 5192</span>&#160;<span class="stringliteral">        metadata describing the kernel code.</span></div><div class="line"><a name="l05193"></a><span class="lineno"> 5193</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l05194"></a><span class="lineno"> 5194</span>&#160;<span class="stringliteral">        :param ktype: the kernel meta-data object produced by the parser</span></div><div class="line"><a name="l05195"></a><span class="lineno"> 5195</span>&#160;<span class="stringliteral">        :type ktype: :py:class:`psyclone.dynamo0p3.DynKernMetadata`</span></div><div class="line"><a name="l05196"></a><span class="lineno"> 5196</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l05197"></a><span class="lineno"> 5197</span>&#160;        <span class="comment"># create a name for each argument</span></div><div class="line"><a name="l05198"></a><span class="lineno"> 5198</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1parse.html">psyclone.parse</a> <span class="keyword">import</span> Arg</div><div class="line"><a name="l05199"></a><span class="lineno"> 5199</span>&#160;        args = []</div><div class="line"><a name="l05200"></a><span class="lineno"> 5200</span>&#160;        <span class="keywordflow">for</span> idx, descriptor <span class="keywordflow">in</span> enumerate(ktype.arg_descriptors):</div><div class="line"><a name="l05201"></a><span class="lineno"> 5201</span>&#160;            pre = <span class="keywordtype">None</span></div><div class="line"><a name="l05202"></a><span class="lineno"> 5202</span>&#160;            <span class="keywordflow">if</span> descriptor.type.lower() == <span class="stringliteral">&quot;gh_operator&quot;</span>:</div><div class="line"><a name="l05203"></a><span class="lineno"> 5203</span>&#160;                pre = <span class="stringliteral">&quot;op_&quot;</span></div><div class="line"><a name="l05204"></a><span class="lineno"> 5204</span>&#160;            <span class="keywordflow">elif</span> descriptor.type.lower() == <span class="stringliteral">&quot;gh_columnwise_operator&quot;</span>:</div><div class="line"><a name="l05205"></a><span class="lineno"> 5205</span>&#160;                pre = <span class="stringliteral">&quot;cma_op_&quot;</span></div><div class="line"><a name="l05206"></a><span class="lineno"> 5206</span>&#160;            <span class="keywordflow">elif</span> descriptor.type.lower() == <span class="stringliteral">&quot;gh_field&quot;</span>:</div><div class="line"><a name="l05207"></a><span class="lineno"> 5207</span>&#160;                pre = <span class="stringliteral">&quot;field_&quot;</span></div><div class="line"><a name="l05208"></a><span class="lineno"> 5208</span>&#160;            <span class="keywordflow">elif</span> descriptor.type.lower() == <span class="stringliteral">&quot;gh_real&quot;</span>:</div><div class="line"><a name="l05209"></a><span class="lineno"> 5209</span>&#160;                pre = <span class="stringliteral">&quot;rscalar_&quot;</span></div><div class="line"><a name="l05210"></a><span class="lineno"> 5210</span>&#160;            <span class="keywordflow">elif</span> descriptor.type.lower() == <span class="stringliteral">&quot;gh_integer&quot;</span>:</div><div class="line"><a name="l05211"></a><span class="lineno"> 5211</span>&#160;                pre = <span class="stringliteral">&quot;iscalar_&quot;</span></div><div class="line"><a name="l05212"></a><span class="lineno"> 5212</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l05213"></a><span class="lineno"> 5213</span>&#160;                <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l05214"></a><span class="lineno"> 5214</span>&#160;                    <span class="stringliteral">&quot;load_meta expected one of &#39;{0}&#39; but &quot;</span></div><div class="line"><a name="l05215"></a><span class="lineno"> 5215</span>&#160;                    <span class="stringliteral">&quot;found &#39;{1}&#39;&quot;</span>.format(VALID_ARG_TYPE_NAMES,</div><div class="line"><a name="l05216"></a><span class="lineno"> 5216</span>&#160;                                         descriptor.type))</div><div class="line"><a name="l05217"></a><span class="lineno"> 5217</span>&#160;            args.append(Arg(<span class="stringliteral">&quot;variable&quot;</span>, pre+str(idx+1)))</div><div class="line"><a name="l05218"></a><span class="lineno"> 5218</span>&#160;</div><div class="line"><a name="l05219"></a><span class="lineno"> 5219</span>&#160;            <span class="keywordflow">if</span> descriptor.stencil:</div><div class="line"><a name="l05220"></a><span class="lineno"> 5220</span>&#160;                <span class="keywordflow">if</span> <span class="keywordflow">not</span> descriptor.stencil[<span class="stringliteral">&quot;extent&quot;</span>]:</div><div class="line"><a name="l05221"></a><span class="lineno"> 5221</span>&#160;                    <span class="comment"># stencil size (in cells) is passed in</span></div><div class="line"><a name="l05222"></a><span class="lineno"> 5222</span>&#160;                    args.append(Arg(<span class="stringliteral">&quot;variable&quot;</span>,</div><div class="line"><a name="l05223"></a><span class="lineno"> 5223</span>&#160;                                    pre+str(idx+1)+<span class="stringliteral">&quot;_stencil_size&quot;</span>))</div><div class="line"><a name="l05224"></a><span class="lineno"> 5224</span>&#160;                <span class="keywordflow">if</span> descriptor.stencil[<span class="stringliteral">&quot;type&quot;</span>] == <span class="stringliteral">&quot;xory1d&quot;</span>:</div><div class="line"><a name="l05225"></a><span class="lineno"> 5225</span>&#160;                    <span class="comment"># direction is passed in</span></div><div class="line"><a name="l05226"></a><span class="lineno"> 5226</span>&#160;                    args.append(Arg(<span class="stringliteral">&quot;variable&quot;</span>, pre+str(idx+1)+<span class="stringliteral">&quot;_direction&quot;</span>))</div><div class="line"><a name="l05227"></a><span class="lineno"> 5227</span>&#160;</div><div class="line"><a name="l05228"></a><span class="lineno"> 5228</span>&#160;        <span class="comment"># initialise basis/diff basis so we can test whether quadrature</span></div><div class="line"><a name="l05229"></a><span class="lineno"> 5229</span>&#160;        <span class="comment"># or an evaluator is required</span></div><div class="line"><a name="l05230"></a><span class="lineno"> 5230</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a731480dd01bc8d93f89ebe7785887efb">_setup_basis</a>(ktype)</div><div class="line"><a name="l05231"></a><span class="lineno"> 5231</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#af7b08881b219a0ede28d2400e8f386d7">_basis_required</a> <span class="keywordflow">and</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a7fe4641a1a9e166d8d39ec01cde935ea">_eval_shape</a> <span class="keywordflow">in</span> \</div><div class="line"><a name="l05232"></a><span class="lineno"> 5232</span>&#160;           VALID_QUADRATURE_SHAPES:</div><div class="line"><a name="l05233"></a><span class="lineno"> 5233</span>&#160;            <span class="comment"># Basis functions on quadrature points are required so add</span></div><div class="line"><a name="l05234"></a><span class="lineno"> 5234</span>&#160;            <span class="comment"># a qr algorithm argument</span></div><div class="line"><a name="l05235"></a><span class="lineno"> 5235</span>&#160;            args.append(Arg(<span class="stringliteral">&quot;variable&quot;</span>, <span class="stringliteral">&quot;qr&quot;</span>))</div><div class="line"><a name="l05236"></a><span class="lineno"> 5236</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a1695038ac7d13e1b48aa4cab79a75577">_setup</a>(ktype, <span class="stringliteral">&quot;dummy_name&quot;</span>, args, <span class="keywordtype">None</span>)</div><div class="line"><a name="l05237"></a><span class="lineno"> 5237</span>&#160;</div><div class="line"><a name="l05238"></a><span class="lineno"> 5238</span>&#160;    <span class="keyword">def </span>_setup_basis(self, kmetadata):</div><div class="line"><a name="l05239"></a><span class="lineno"> 5239</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l05240"></a><span class="lineno"> 5240</span>&#160;<span class="stringliteral">        Initialisation of the basis/diff basis information. This may be</span></div><div class="line"><a name="l05241"></a><span class="lineno"> 5241</span>&#160;<span class="stringliteral">        needed before general setup so is computed in a separate method.</span></div><div class="line"><a name="l05242"></a><span class="lineno"> 5242</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l05243"></a><span class="lineno"> 5243</span>&#160;<span class="stringliteral">        :param kmetadata: The kernel meta-data object produced by the</span></div><div class="line"><a name="l05244"></a><span class="lineno"> 5244</span>&#160;<span class="stringliteral">                          parser.</span></div><div class="line"><a name="l05245"></a><span class="lineno"> 5245</span>&#160;<span class="stringliteral">        :type kmetadata: :py:class:`psyclone.dynamo0p3.DynKernMetadata`</span></div><div class="line"><a name="l05246"></a><span class="lineno"> 5246</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l05247"></a><span class="lineno"> 5247</span>&#160;        <span class="keywordflow">for</span> descriptor <span class="keywordflow">in</span> kmetadata.func_descriptors:</div><div class="line"><a name="l05248"></a><span class="lineno"> 5248</span>&#160;            <span class="keywordflow">if</span> len(descriptor.operator_names) &gt; 0:</div><div class="line"><a name="l05249"></a><span class="lineno"> 5249</span>&#160;                self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#af7b08881b219a0ede28d2400e8f386d7">_basis_required</a> = <span class="keyword">True</span></div><div class="line"><a name="l05250"></a><span class="lineno"> 5250</span>&#160;                self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a7fe4641a1a9e166d8d39ec01cde935ea">_eval_shape</a> = kmetadata.eval_shape</div><div class="line"><a name="l05251"></a><span class="lineno"> 5251</span>&#160;                <span class="keywordflow">break</span></div><div class="line"><a name="l05252"></a><span class="lineno"> 5252</span>&#160;</div><div class="line"><a name="l05253"></a><span class="lineno"> 5253</span>&#160;    <span class="keyword">def </span>_setup(self, ktype, module_name, args, parent):</div><div class="line"><a name="l05254"></a><span class="lineno"> 5254</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l05255"></a><span class="lineno"> 5255</span>&#160;<span class="stringliteral">        Internal setup of kernel information.</span></div><div class="line"><a name="l05256"></a><span class="lineno"> 5256</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l05257"></a><span class="lineno"> 5257</span>&#160;<span class="stringliteral">        :param ktype: Object holding information on the parsed meta-data for</span></div><div class="line"><a name="l05258"></a><span class="lineno"> 5258</span>&#160;<span class="stringliteral">                      this kernel.</span></div><div class="line"><a name="l05259"></a><span class="lineno"> 5259</span>&#160;<span class="stringliteral">        :type ktype: :py:class:`psyclone.dynamo0p3.DynKernMetadata`</span></div><div class="line"><a name="l05260"></a><span class="lineno"> 5260</span>&#160;<span class="stringliteral">        :param str module_name: the name of the Fortran module that contains</span></div><div class="line"><a name="l05261"></a><span class="lineno"> 5261</span>&#160;<span class="stringliteral">                                the source of this Kernel</span></div><div class="line"><a name="l05262"></a><span class="lineno"> 5262</span>&#160;<span class="stringliteral">        :param args: List of Arg objects produced by the parser for the</span></div><div class="line"><a name="l05263"></a><span class="lineno"> 5263</span>&#160;<span class="stringliteral">                     arguments of this kernel call</span></div><div class="line"><a name="l05264"></a><span class="lineno"> 5264</span>&#160;<span class="stringliteral">        :type args: List of :py:class:`psyclone.parse.Arg` objects</span></div><div class="line"><a name="l05265"></a><span class="lineno"> 5265</span>&#160;<span class="stringliteral">        :param parent: the parent of this kernel call in the generated</span></div><div class="line"><a name="l05266"></a><span class="lineno"> 5266</span>&#160;<span class="stringliteral">                       AST (will be a loop object)</span></div><div class="line"><a name="l05267"></a><span class="lineno"> 5267</span>&#160;<span class="stringliteral">        :type parent: :py:class:`psyclone.dynamo0p3.DynLoop`</span></div><div class="line"><a name="l05268"></a><span class="lineno"> 5268</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l05269"></a><span class="lineno"> 5269</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1parse.html">psyclone.parse</a> <span class="keyword">import</span> KernelCall</div><div class="line"><a name="l05270"></a><span class="lineno"> 5270</span>&#160;        Kern.__init__(self, DynKernelArguments,</div><div class="line"><a name="l05271"></a><span class="lineno"> 5271</span>&#160;                      KernelCall(module_name, ktype, args),</div><div class="line"><a name="l05272"></a><span class="lineno"> 5272</span>&#160;                      parent, check=<span class="keyword">False</span>)</div><div class="line"><a name="l05273"></a><span class="lineno"> 5273</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a739991c89184d7221f51bfa0bfc45ef5">_func_descriptors</a> = ktype.func_descriptors</div><div class="line"><a name="l05274"></a><span class="lineno"> 5274</span>&#160;        <span class="comment"># Keep a record of the type of CMA kernel identified when</span></div><div class="line"><a name="l05275"></a><span class="lineno"> 5275</span>&#160;        <span class="comment"># parsing the kernel meta-data</span></div><div class="line"><a name="l05276"></a><span class="lineno"> 5276</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a578c493154b39c44a3aadfa900741233">_cma_operation</a> = ktype.cma_operation</div><div class="line"><a name="l05277"></a><span class="lineno"> 5277</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a7b8bc2307469e910804aee4337128581">_fs_descriptors</a> = <a class="code" href="classpsyclone_1_1dynamo0p3_1_1FSDescriptors.html">FSDescriptors</a>(ktype.func_descriptors)</div><div class="line"><a name="l05278"></a><span class="lineno"> 5278</span>&#160;</div><div class="line"><a name="l05279"></a><span class="lineno"> 5279</span>&#160;        <span class="comment"># Record whether or not the kernel meta-data specifies that this</span></div><div class="line"><a name="l05280"></a><span class="lineno"> 5280</span>&#160;        <span class="comment"># is an inter-grid kernel</span></div><div class="line"><a name="l05281"></a><span class="lineno"> 5281</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a5990f404454302ebfa8f760f9b04ad0f">_is_intergrid</a> = ktype.is_intergrid</div><div class="line"><a name="l05282"></a><span class="lineno"> 5282</span>&#160;</div><div class="line"><a name="l05283"></a><span class="lineno"> 5283</span>&#160;        <span class="comment"># if there is a quadrature rule, what is the name of the</span></div><div class="line"><a name="l05284"></a><span class="lineno"> 5284</span>&#160;        <span class="comment"># algorithm argument?</span></div><div class="line"><a name="l05285"></a><span class="lineno"> 5285</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a030cc0efc6721fe3e45191872bd5ace1">_qr_text</a> = <span class="stringliteral">&quot;&quot;</span></div><div class="line"><a name="l05286"></a><span class="lineno"> 5286</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a1467c5970619680d6196607fa4b15bbc">_qr_name</a> = <span class="keywordtype">None</span></div><div class="line"><a name="l05287"></a><span class="lineno"> 5287</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a64504a14d7197f6915fe5588d1d32807">_qr_args</a> = []</div><div class="line"><a name="l05288"></a><span class="lineno"> 5288</span>&#160;</div><div class="line"><a name="l05289"></a><span class="lineno"> 5289</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a7fe4641a1a9e166d8d39ec01cde935ea">_eval_shape</a> <span class="keywordflow">in</span> VALID_QUADRATURE_SHAPES:</div><div class="line"><a name="l05290"></a><span class="lineno"> 5290</span>&#160;            <span class="comment"># The quadrature-related arguments always come last</span></div><div class="line"><a name="l05291"></a><span class="lineno"> 5291</span>&#160;            qr_arg = args[-1]</div><div class="line"><a name="l05292"></a><span class="lineno"> 5292</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a030cc0efc6721fe3e45191872bd5ace1">_qr_text</a> = qr_arg.text</div><div class="line"><a name="l05293"></a><span class="lineno"> 5293</span>&#160;            <span class="comment"># use our namespace manager to create a unique name unless</span></div><div class="line"><a name="l05294"></a><span class="lineno"> 5294</span>&#160;            <span class="comment"># the context and label match and in this case return the</span></div><div class="line"><a name="l05295"></a><span class="lineno"> 5295</span>&#160;            <span class="comment"># previous name. We use the full text of the original</span></div><div class="line"><a name="l05296"></a><span class="lineno"> 5296</span>&#160;            <span class="comment"># as a label.</span></div><div class="line"><a name="l05297"></a><span class="lineno"> 5297</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a1467c5970619680d6196607fa4b15bbc">_qr_name</a> = self._name_space_manager.create_name(</div><div class="line"><a name="l05298"></a><span class="lineno"> 5298</span>&#160;                root_name=qr_arg.varName, context=<span class="stringliteral">&quot;AlgArgs&quot;</span>,</div><div class="line"><a name="l05299"></a><span class="lineno"> 5299</span>&#160;                label=self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a030cc0efc6721fe3e45191872bd5ace1">_qr_text</a>)</div><div class="line"><a name="l05300"></a><span class="lineno"> 5300</span>&#160;            <span class="comment"># dynamo 0.3 api kernels require quadrature rule arguments to be</span></div><div class="line"><a name="l05301"></a><span class="lineno"> 5301</span>&#160;            <span class="comment"># passed in if one or more basis functions are used by the kernel</span></div><div class="line"><a name="l05302"></a><span class="lineno"> 5302</span>&#160;            <span class="comment"># and gh_shape == &quot;gh_quadrature_***&quot;.</span></div><div class="line"><a name="l05303"></a><span class="lineno"> 5303</span>&#160;            <span class="comment"># Currently only _xyoz is supported...</span></div><div class="line"><a name="l05304"></a><span class="lineno"> 5304</span>&#160;            <span class="comment"># if self._eval_shape == &quot;gh_quadrature_xyz&quot;:</span></div><div class="line"><a name="l05305"></a><span class="lineno"> 5305</span>&#160;            <span class="comment">#     self._qr_args = [&quot;np_xyz&quot;, &quot;weights_xyz&quot;]</span></div><div class="line"><a name="l05306"></a><span class="lineno"> 5306</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a7fe4641a1a9e166d8d39ec01cde935ea">_eval_shape</a> == <span class="stringliteral">&quot;gh_quadrature_xyoz&quot;</span>:</div><div class="line"><a name="l05307"></a><span class="lineno"> 5307</span>&#160;                self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a64504a14d7197f6915fe5588d1d32807">_qr_args</a> = [<span class="stringliteral">&quot;np_xy&quot;</span>, <span class="stringliteral">&quot;np_z&quot;</span>, <span class="stringliteral">&quot;weights_xy&quot;</span>, <span class="stringliteral">&quot;weights_z&quot;</span>]</div><div class="line"><a name="l05308"></a><span class="lineno"> 5308</span>&#160;            <span class="comment"># elif self._eval_shape == &quot;gh_quadrature_xoyoz&quot;:</span></div><div class="line"><a name="l05309"></a><span class="lineno"> 5309</span>&#160;            <span class="comment">#     self._qr_args = [&quot;np_x&quot;, &quot;np_y&quot;, &quot;np_z&quot;,</span></div><div class="line"><a name="l05310"></a><span class="lineno"> 5310</span>&#160;            <span class="comment">#                      &quot;weights_x&quot;, &quot;weights_y&quot;, &quot;weights_z&quot;]</span></div><div class="line"><a name="l05311"></a><span class="lineno"> 5311</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l05312"></a><span class="lineno"> 5312</span>&#160;                <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l05313"></a><span class="lineno"> 5313</span>&#160;                    <span class="stringliteral">&quot;Internal error: unsupported shape ({0}) found in &quot;</span></div><div class="line"><a name="l05314"></a><span class="lineno"> 5314</span>&#160;                    <span class="stringliteral">&quot;DynKern._setup&quot;</span>.format(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a7fe4641a1a9e166d8d39ec01cde935ea">_eval_shape</a>))</div><div class="line"><a name="l05315"></a><span class="lineno"> 5315</span>&#160;</div><div class="line"><a name="l05316"></a><span class="lineno"> 5316</span>&#160;            <span class="comment"># If we&#39;re not a kernel stub then we will have a name for the qr</span></div><div class="line"><a name="l05317"></a><span class="lineno"> 5317</span>&#160;            <span class="comment"># argument. We append this to the names of the qr-related</span></div><div class="line"><a name="l05318"></a><span class="lineno"> 5318</span>&#160;            <span class="comment"># variables.</span></div><div class="line"><a name="l05319"></a><span class="lineno"> 5319</span>&#160;            <span class="keywordflow">if</span> qr_arg.varName:</div><div class="line"><a name="l05320"></a><span class="lineno"> 5320</span>&#160;                self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a64504a14d7197f6915fe5588d1d32807">_qr_args</a> = [</div><div class="line"><a name="l05321"></a><span class="lineno"> 5321</span>&#160;                    arg + <span class="stringliteral">&quot;_&quot;</span> + self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a1467c5970619680d6196607fa4b15bbc">_qr_name</a> <span class="keywordflow">for</span> arg <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a64504a14d7197f6915fe5588d1d32807">_qr_args</a>]</div><div class="line"><a name="l05322"></a><span class="lineno"> 5322</span>&#160;</div><div class="line"><a name="l05323"></a><span class="lineno"> 5323</span>&#160;        <span class="keywordflow">elif</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a7fe4641a1a9e166d8d39ec01cde935ea">_eval_shape</a> == <span class="stringliteral">&quot;gh_evaluator&quot;</span>:</div><div class="line"><a name="l05324"></a><span class="lineno"> 5324</span>&#160;            <span class="comment"># Kernel has an evaluator. If gh_evaluator_targets is present</span></div><div class="line"><a name="l05325"></a><span class="lineno"> 5325</span>&#160;            <span class="comment"># then that specifies the function spaces for which the evaluator</span></div><div class="line"><a name="l05326"></a><span class="lineno"> 5326</span>&#160;            <span class="comment"># is required. Otherwise, the FS of the updated argument(s) tells</span></div><div class="line"><a name="l05327"></a><span class="lineno"> 5327</span>&#160;            <span class="comment"># us upon which nodal points the evaluator will be required</span></div><div class="line"><a name="l05328"></a><span class="lineno"> 5328</span>&#160;            <span class="keywordflow">for</span> fs_name <span class="keywordflow">in</span> ktype.eval_targets:</div><div class="line"><a name="l05329"></a><span class="lineno"> 5329</span>&#160;                arg, fspace = self.arguments.get_arg_on_space_name(fs_name)</div><div class="line"><a name="l05330"></a><span class="lineno"> 5330</span>&#160;                <span class="comment"># Set up our dict of evaluator targets, one entry per</span></div><div class="line"><a name="l05331"></a><span class="lineno"> 5331</span>&#160;                <span class="comment"># target FS.</span></div><div class="line"><a name="l05332"></a><span class="lineno"> 5332</span>&#160;                <span class="keywordflow">if</span> fspace.mangled_name <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a60d8a8c1a2520d12b2c60a723df0a850">_eval_targets</a>:</div><div class="line"><a name="l05333"></a><span class="lineno"> 5333</span>&#160;                    self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a60d8a8c1a2520d12b2c60a723df0a850">_eval_targets</a>[fspace.mangled_name] = (fspace, arg)</div><div class="line"><a name="l05334"></a><span class="lineno"> 5334</span>&#160;</div><div class="line"><a name="l05335"></a><span class="lineno"> 5335</span>&#160;        <span class="keywordflow">elif</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a7fe4641a1a9e166d8d39ec01cde935ea">_eval_shape</a>:</div><div class="line"><a name="l05336"></a><span class="lineno"> 5336</span>&#160;            <span class="comment"># Should never get to here!</span></div><div class="line"><a name="l05337"></a><span class="lineno"> 5337</span>&#160;            <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l05338"></a><span class="lineno"> 5338</span>&#160;                <span class="stringliteral">&quot;Internal error: evaluator shape &#39;{0}&#39; is not recognised. &quot;</span></div><div class="line"><a name="l05339"></a><span class="lineno"> 5339</span>&#160;                <span class="stringliteral">&quot;Must be one of {1}.&quot;</span>.format(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a7fe4641a1a9e166d8d39ec01cde935ea">_eval_shape</a>,</div><div class="line"><a name="l05340"></a><span class="lineno"> 5340</span>&#160;                                             VALID_EVALUATOR_SHAPES))</div><div class="line"><a name="l05341"></a><span class="lineno"> 5341</span>&#160;</div><div class="line"><a name="l05342"></a><span class="lineno"> 5342</span>&#160;    @property</div><div class="line"><a name="l05343"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#aad47462ba71b44c4ee49b8ccc6d7d996"> 5343</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#aad47462ba71b44c4ee49b8ccc6d7d996">cma_operation</a>(self):</div><div class="line"><a name="l05344"></a><span class="lineno"> 5344</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Returns the type of CMA operation performed by this kernel</span></div><div class="line"><a name="l05345"></a><span class="lineno"> 5345</span>&#160;<span class="stringliteral">        (one of &#39;assembly&#39;, &#39;apply&#39; or &#39;matrix-matrix&#39;) or None if the</span></div><div class="line"><a name="l05346"></a><span class="lineno"> 5346</span>&#160;<span class="stringliteral">        the kernel does not involve CMA operators &#39;&#39;&#39;</span></div><div class="line"><a name="l05347"></a><span class="lineno"> 5347</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a578c493154b39c44a3aadfa900741233">_cma_operation</a></div><div class="line"><a name="l05348"></a><span class="lineno"> 5348</span>&#160;</div><div class="line"><a name="l05349"></a><span class="lineno"> 5349</span>&#160;    @property</div><div class="line"><a name="l05350"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a201d000d786855726295b9cca7fb7516"> 5350</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a201d000d786855726295b9cca7fb7516">is_intergrid</a>(self):</div><div class="line"><a name="l05351"></a><span class="lineno"> 5351</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l05352"></a><span class="lineno"> 5352</span>&#160;<span class="stringliteral">        Getter for whether or not this is an inter-grid kernel call</span></div><div class="line"><a name="l05353"></a><span class="lineno"> 5353</span>&#160;<span class="stringliteral">        :return: True if it is an inter-grid kernel, False otherwise</span></div><div class="line"><a name="l05354"></a><span class="lineno"> 5354</span>&#160;<span class="stringliteral">        :rtype: bool</span></div><div class="line"><a name="l05355"></a><span class="lineno"> 5355</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l05356"></a><span class="lineno"> 5356</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a5990f404454302ebfa8f760f9b04ad0f">_is_intergrid</a></div><div class="line"><a name="l05357"></a><span class="lineno"> 5357</span>&#160;</div><div class="line"><a name="l05358"></a><span class="lineno"> 5358</span>&#160;    @property</div><div class="line"><a name="l05359"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a1bcc844fb892249179351237be168d66"> 5359</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a1bcc844fb892249179351237be168d66">colourmap</a>(self):</div><div class="line"><a name="l05360"></a><span class="lineno"> 5360</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l05361"></a><span class="lineno"> 5361</span>&#160;<span class="stringliteral">        Getter for the name of the colourmap associated with this kernel call.</span></div><div class="line"><a name="l05362"></a><span class="lineno"> 5362</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l05363"></a><span class="lineno"> 5363</span>&#160;<span class="stringliteral">        :return: name of the colourmap (Fortran array)</span></div><div class="line"><a name="l05364"></a><span class="lineno"> 5364</span>&#160;<span class="stringliteral">        :rtype: str</span></div><div class="line"><a name="l05365"></a><span class="lineno"> 5365</span>&#160;<span class="stringliteral">        :raises InternalError: if this kernel is not coloured or the \</span></div><div class="line"><a name="l05366"></a><span class="lineno"> 5366</span>&#160;<span class="stringliteral">                               dictionary of inter-grid kernels and \</span></div><div class="line"><a name="l05367"></a><span class="lineno"> 5367</span>&#160;<span class="stringliteral">                               colourmaps has not been constructed.</span></div><div class="line"><a name="l05368"></a><span class="lineno"> 5368</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l05369"></a><span class="lineno"> 5369</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.<a class="code" href="classpsyclone_1_1psyGen_1_1Kern.html#ad5ccfbc244cb81b6733b56133ac9e6c1">is_coloured</a>():</div><div class="line"><a name="l05370"></a><span class="lineno"> 5370</span>&#160;            <span class="keywordflow">raise</span> InternalError(<span class="stringliteral">&quot;Kernel &#39;{0}&#39; is not inside a coloured &quot;</span></div><div class="line"><a name="l05371"></a><span class="lineno"> 5371</span>&#160;                                <span class="stringliteral">&quot;loop.&quot;</span>.format(self.<a class="code" href="classpsyclone_1_1psyGen_1_1Kern.html#abc6975e1dcdfa711ef7b43807ae38e44">name</a>))</div><div class="line"><a name="l05372"></a><span class="lineno"> 5372</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a5990f404454302ebfa8f760f9b04ad0f">_is_intergrid</a>:</div><div class="line"><a name="l05373"></a><span class="lineno"> 5373</span>&#160;            invoke = self.root.invoke</div><div class="line"><a name="l05374"></a><span class="lineno"> 5374</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1psyGen_1_1Kern.html#abc6975e1dcdfa711ef7b43807ae38e44">name</a> <span class="keywordflow">not</span> <span class="keywordflow">in</span> invoke.meshes.intergrid_kernels:</div><div class="line"><a name="l05375"></a><span class="lineno"> 5375</span>&#160;                <span class="keywordflow">raise</span> InternalError(</div><div class="line"><a name="l05376"></a><span class="lineno"> 5376</span>&#160;                    <span class="stringliteral">&quot;Colourmap information for kernel &#39;{0}&#39; has not yet &quot;</span></div><div class="line"><a name="l05377"></a><span class="lineno"> 5377</span>&#160;                    <span class="stringliteral">&quot;been initialised&quot;</span>.format(self.<a class="code" href="classpsyclone_1_1psyGen_1_1Kern.html#abc6975e1dcdfa711ef7b43807ae38e44">name</a>))</div><div class="line"><a name="l05378"></a><span class="lineno"> 5378</span>&#160;            cmap = invoke.meshes.intergrid_kernels[self.<a class="code" href="classpsyclone_1_1psyGen_1_1Kern.html#abc6975e1dcdfa711ef7b43807ae38e44">name</a>].colourmap</div><div class="line"><a name="l05379"></a><span class="lineno"> 5379</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l05380"></a><span class="lineno"> 5380</span>&#160;            cmap = self._name_space_manager.create_name(</div><div class="line"><a name="l05381"></a><span class="lineno"> 5381</span>&#160;                root_name=<span class="stringliteral">&quot;cmap&quot;</span>, context=<span class="stringliteral">&quot;PSyVars&quot;</span>, label=<span class="stringliteral">&quot;cmap&quot;</span>)</div><div class="line"><a name="l05382"></a><span class="lineno"> 5382</span>&#160;        <span class="keywordflow">return</span> cmap</div><div class="line"><a name="l05383"></a><span class="lineno"> 5383</span>&#160;</div><div class="line"><a name="l05384"></a><span class="lineno"> 5384</span>&#160;    @property</div><div class="line"><a name="l05385"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a332244b572bfd2a6c00f29edeb8fec01"> 5385</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a332244b572bfd2a6c00f29edeb8fec01">ncolours_var</a>(self):</div><div class="line"><a name="l05386"></a><span class="lineno"> 5386</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l05387"></a><span class="lineno"> 5387</span>&#160;<span class="stringliteral">        Getter for the name of the variable holding the number of colours</span></div><div class="line"><a name="l05388"></a><span class="lineno"> 5388</span>&#160;<span class="stringliteral">        associated with this kernel call.</span></div><div class="line"><a name="l05389"></a><span class="lineno"> 5389</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l05390"></a><span class="lineno"> 5390</span>&#160;<span class="stringliteral">        :return: name of the variable holding the number of colours</span></div><div class="line"><a name="l05391"></a><span class="lineno"> 5391</span>&#160;<span class="stringliteral">        :rtype: str</span></div><div class="line"><a name="l05392"></a><span class="lineno"> 5392</span>&#160;<span class="stringliteral">        :raises InternalError: if this kernel is not coloured or the \</span></div><div class="line"><a name="l05393"></a><span class="lineno"> 5393</span>&#160;<span class="stringliteral">                               colour-map information has not been initialised.</span></div><div class="line"><a name="l05394"></a><span class="lineno"> 5394</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l05395"></a><span class="lineno"> 5395</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.<a class="code" href="classpsyclone_1_1psyGen_1_1Kern.html#ad5ccfbc244cb81b6733b56133ac9e6c1">is_coloured</a>():</div><div class="line"><a name="l05396"></a><span class="lineno"> 5396</span>&#160;            <span class="keywordflow">raise</span> InternalError(<span class="stringliteral">&quot;Kernel &#39;{0}&#39; is not inside a coloured &quot;</span></div><div class="line"><a name="l05397"></a><span class="lineno"> 5397</span>&#160;                                <span class="stringliteral">&quot;loop.&quot;</span>.format(self.<a class="code" href="classpsyclone_1_1psyGen_1_1Kern.html#abc6975e1dcdfa711ef7b43807ae38e44">name</a>))</div><div class="line"><a name="l05398"></a><span class="lineno"> 5398</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a5990f404454302ebfa8f760f9b04ad0f">_is_intergrid</a>:</div><div class="line"><a name="l05399"></a><span class="lineno"> 5399</span>&#160;            invoke = self.root.invoke</div><div class="line"><a name="l05400"></a><span class="lineno"> 5400</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1psyGen_1_1Kern.html#abc6975e1dcdfa711ef7b43807ae38e44">name</a> <span class="keywordflow">not</span> <span class="keywordflow">in</span> invoke.meshes.intergrid_kernels:</div><div class="line"><a name="l05401"></a><span class="lineno"> 5401</span>&#160;                <span class="keywordflow">raise</span> InternalError(</div><div class="line"><a name="l05402"></a><span class="lineno"> 5402</span>&#160;                    <span class="stringliteral">&quot;Colourmap information for kernel &#39;{0}&#39; has not yet &quot;</span></div><div class="line"><a name="l05403"></a><span class="lineno"> 5403</span>&#160;                    <span class="stringliteral">&quot;been initialised&quot;</span>.format(self.<a class="code" href="classpsyclone_1_1psyGen_1_1Kern.html#abc6975e1dcdfa711ef7b43807ae38e44">name</a>))</div><div class="line"><a name="l05404"></a><span class="lineno"> 5404</span>&#160;            ncols = invoke.meshes.intergrid_kernels[self.<a class="code" href="classpsyclone_1_1psyGen_1_1Kern.html#abc6975e1dcdfa711ef7b43807ae38e44">name</a>].ncolours_var</div><div class="line"><a name="l05405"></a><span class="lineno"> 5405</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l05406"></a><span class="lineno"> 5406</span>&#160;            ncols = self._name_space_manager.create_name(</div><div class="line"><a name="l05407"></a><span class="lineno"> 5407</span>&#160;                root_name=<span class="stringliteral">&quot;ncolour&quot;</span>, context=<span class="stringliteral">&quot;PSyVars&quot;</span>, label=<span class="stringliteral">&quot;ncolour&quot;</span>)</div><div class="line"><a name="l05408"></a><span class="lineno"> 5408</span>&#160;        <span class="keywordflow">return</span> ncols</div><div class="line"><a name="l05409"></a><span class="lineno"> 5409</span>&#160;</div><div class="line"><a name="l05410"></a><span class="lineno"> 5410</span>&#160;    @property</div><div class="line"><a name="l05411"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a10d2490dc2952c4be2107d78c87fb128"> 5411</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a10d2490dc2952c4be2107d78c87fb128">fs_descriptors</a>(self):</div><div class="line"><a name="l05412"></a><span class="lineno"> 5412</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Returns a list of function space descriptor objects of</span></div><div class="line"><a name="l05413"></a><span class="lineno"> 5413</span>&#160;<span class="stringliteral">        type FSDescriptor which contain information about the function</span></div><div class="line"><a name="l05414"></a><span class="lineno"> 5414</span>&#160;<span class="stringliteral">        spaces. &#39;&#39;&#39;</span></div><div class="line"><a name="l05415"></a><span class="lineno"> 5415</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a7b8bc2307469e910804aee4337128581">_fs_descriptors</a></div><div class="line"><a name="l05416"></a><span class="lineno"> 5416</span>&#160;</div><div class="line"><a name="l05417"></a><span class="lineno"> 5417</span>&#160;    @property</div><div class="line"><a name="l05418"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a1834915de0fe9023daf09167bd7229ed"> 5418</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a1834915de0fe9023daf09167bd7229ed">qr_required</a>(self):</div><div class="line"><a name="l05419"></a><span class="lineno"> 5419</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l05420"></a><span class="lineno"> 5420</span>&#160;<span class="stringliteral">        :return: True if this kernel requires quadrature, else returns False.</span></div><div class="line"><a name="l05421"></a><span class="lineno"> 5421</span>&#160;<span class="stringliteral">        :rtype: bool</span></div><div class="line"><a name="l05422"></a><span class="lineno"> 5422</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l05423"></a><span class="lineno"> 5423</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#af7b08881b219a0ede28d2400e8f386d7">_basis_required</a> <span class="keywordflow">and</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a7fe4641a1a9e166d8d39ec01cde935ea">_eval_shape</a> <span class="keywordflow">in</span> \</div><div class="line"><a name="l05424"></a><span class="lineno"> 5424</span>&#160;           VALID_QUADRATURE_SHAPES:</div><div class="line"><a name="l05425"></a><span class="lineno"> 5425</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">True</span></div><div class="line"><a name="l05426"></a><span class="lineno"> 5426</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">False</span></div><div class="line"><a name="l05427"></a><span class="lineno"> 5427</span>&#160;</div><div class="line"><a name="l05428"></a><span class="lineno"> 5428</span>&#160;    @property</div><div class="line"><a name="l05429"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a3f533a08e00764d606a5cd7effd746bb"> 5429</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a3f533a08e00764d606a5cd7effd746bb">eval_shape</a>(self):</div><div class="line"><a name="l05430"></a><span class="lineno"> 5430</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l05431"></a><span class="lineno"> 5431</span>&#160;<span class="stringliteral">        :return: the value of GH_SHAPE for this kernel or an empty string \</span></div><div class="line"><a name="l05432"></a><span class="lineno"> 5432</span>&#160;<span class="stringliteral">                 if none is specified.</span></div><div class="line"><a name="l05433"></a><span class="lineno"> 5433</span>&#160;<span class="stringliteral">        :rtype: str</span></div><div class="line"><a name="l05434"></a><span class="lineno"> 5434</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l05435"></a><span class="lineno"> 5435</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a7fe4641a1a9e166d8d39ec01cde935ea">_eval_shape</a></div><div class="line"><a name="l05436"></a><span class="lineno"> 5436</span>&#160;</div><div class="line"><a name="l05437"></a><span class="lineno"> 5437</span>&#160;    @property</div><div class="line"><a name="l05438"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#abb32cbaeda1bf57266969e31937680d3"> 5438</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#abb32cbaeda1bf57266969e31937680d3">eval_targets</a>(self):</div><div class="line"><a name="l05439"></a><span class="lineno"> 5439</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l05440"></a><span class="lineno"> 5440</span>&#160;<span class="stringliteral">        :return: the function spaces upon which basis/diff-basis functions \</span></div><div class="line"><a name="l05441"></a><span class="lineno"> 5441</span>&#160;<span class="stringliteral">                 are to be evaluated for this kernel.</span></div><div class="line"><a name="l05442"></a><span class="lineno"> 5442</span>&#160;<span class="stringliteral">        :rtype: dict of (:py:class:`psyclone.dynamo0p3.FunctionSpace`, \</span></div><div class="line"><a name="l05443"></a><span class="lineno"> 5443</span>&#160;<span class="stringliteral">                :py:class`psyclone.dynamo0p3.DynKernelArgument`), indexed by \</span></div><div class="line"><a name="l05444"></a><span class="lineno"> 5444</span>&#160;<span class="stringliteral">                the names of the target function spaces.</span></div><div class="line"><a name="l05445"></a><span class="lineno"> 5445</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l05446"></a><span class="lineno"> 5446</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a60d8a8c1a2520d12b2c60a723df0a850">_eval_targets</a></div><div class="line"><a name="l05447"></a><span class="lineno"> 5447</span>&#160;</div><div class="line"><a name="l05448"></a><span class="lineno"> 5448</span>&#160;    @property</div><div class="line"><a name="l05449"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a93a6dda29c366911105fc624951b3b3f"> 5449</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a93a6dda29c366911105fc624951b3b3f">qr_text</a>(self):</div><div class="line"><a name="l05450"></a><span class="lineno"> 5450</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Returns the QR argument-text used by the algorithm layer</span></div><div class="line"><a name="l05451"></a><span class="lineno"> 5451</span>&#160;<span class="stringliteral">        in the calling argument list. &#39;&#39;&#39;</span></div><div class="line"><a name="l05452"></a><span class="lineno"> 5452</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a030cc0efc6721fe3e45191872bd5ace1">_qr_text</a></div><div class="line"><a name="l05453"></a><span class="lineno"> 5453</span>&#160;</div><div class="line"><a name="l05454"></a><span class="lineno"> 5454</span>&#160;    @property</div><div class="line"><a name="l05455"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#adb1b64e3c3fdeb850b16a7ff35743b83"> 5455</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#adb1b64e3c3fdeb850b16a7ff35743b83">qr_name</a>(self):</div><div class="line"><a name="l05456"></a><span class="lineno"> 5456</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Returns a Quadrature-rule name for this Kernel. &#39;&#39;&#39;</span></div><div class="line"><a name="l05457"></a><span class="lineno"> 5457</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a1467c5970619680d6196607fa4b15bbc">_qr_name</a></div><div class="line"><a name="l05458"></a><span class="lineno"> 5458</span>&#160;</div><div class="line"><a name="l05459"></a><span class="lineno"> 5459</span>&#160;    @property</div><div class="line"><a name="l05460"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a53af93e8f1a0feed476d6782db1c4165"> 5460</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a53af93e8f1a0feed476d6782db1c4165">qr_args</a>(self):</div><div class="line"><a name="l05461"></a><span class="lineno"> 5461</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;Returns a dictionary of generic qr names mapped to specific</span></div><div class="line"><a name="l05462"></a><span class="lineno"> 5462</span>&#160;<span class="stringliteral">        dynamo0.3 names&#39;&#39;&#39;</span></div><div class="line"><a name="l05463"></a><span class="lineno"> 5463</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a64504a14d7197f6915fe5588d1d32807">_qr_args</a></div><div class="line"><a name="l05464"></a><span class="lineno"> 5464</span>&#160;</div><div class="line"><a name="l05465"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a304543e5eea8d79deaf9c6001a40b02d"> 5465</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a304543e5eea8d79deaf9c6001a40b02d">local_vars</a>(self):</div><div class="line"><a name="l05466"></a><span class="lineno"> 5466</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Returns the names used by the Kernel that vary from one</span></div><div class="line"><a name="l05467"></a><span class="lineno"> 5467</span>&#160;<span class="stringliteral">        invocation to the next and therefore require privatisation</span></div><div class="line"><a name="l05468"></a><span class="lineno"> 5468</span>&#160;<span class="stringliteral">        when parallelised. &#39;&#39;&#39;</span></div><div class="line"><a name="l05469"></a><span class="lineno"> 5469</span>&#160;        lvars = []</div><div class="line"><a name="l05470"></a><span class="lineno"> 5470</span>&#160;        <span class="comment"># Orientation maps</span></div><div class="line"><a name="l05471"></a><span class="lineno"> 5471</span>&#160;        <span class="keywordflow">for</span> unique_fs <span class="keywordflow">in</span> self.arguments.unique_fss:</div><div class="line"><a name="l05472"></a><span class="lineno"> 5472</span>&#160;            <span class="keywordflow">if</span> self._fs_descriptors.exists(unique_fs):</div><div class="line"><a name="l05473"></a><span class="lineno"> 5473</span>&#160;                fs_descriptor = self._fs_descriptors.get_descriptor(unique_fs)</div><div class="line"><a name="l05474"></a><span class="lineno"> 5474</span>&#160;                <span class="keywordflow">if</span> fs_descriptor.requires_orientation:</div><div class="line"><a name="l05475"></a><span class="lineno"> 5475</span>&#160;                    lvars.append(get_fs_orientation_name(unique_fs))</div><div class="line"><a name="l05476"></a><span class="lineno"> 5476</span>&#160;        <span class="keywordflow">return</span> lvars</div><div class="line"><a name="l05477"></a><span class="lineno"> 5477</span>&#160;</div><div class="line"><a name="l05478"></a><span class="lineno"> 5478</span>&#160;    @property</div><div class="line"><a name="l05479"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#af231c71913c208055c7c800a30eb5cc2"> 5479</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#af231c71913c208055c7c800a30eb5cc2">gen_stub</a>(self):</div><div class="line"><a name="l05480"></a><span class="lineno"> 5480</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; output a kernel stub &#39;&#39;&#39;</span></div><div class="line"><a name="l05481"></a><span class="lineno"> 5481</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> ModuleGen, SubroutineGen</div><div class="line"><a name="l05482"></a><span class="lineno"> 5482</span>&#160;</div><div class="line"><a name="l05483"></a><span class="lineno"> 5483</span>&#160;        <span class="comment"># remove &quot;_code&quot; from the name if it exists to determine the</span></div><div class="line"><a name="l05484"></a><span class="lineno"> 5484</span>&#160;        <span class="comment"># base name which (if dynamo0.3 naming conventions are</span></div><div class="line"><a name="l05485"></a><span class="lineno"> 5485</span>&#160;        <span class="comment"># followed) is used as the root for the module and subroutine</span></div><div class="line"><a name="l05486"></a><span class="lineno"> 5486</span>&#160;        <span class="comment"># names.</span></div><div class="line"><a name="l05487"></a><span class="lineno"> 5487</span>&#160;        <span class="keywordflow">if</span> self.name.lower().endswith(<span class="stringliteral">&quot;_code&quot;</span>):</div><div class="line"><a name="l05488"></a><span class="lineno"> 5488</span>&#160;            base_name = self.<a class="code" href="classpsyclone_1_1psyGen_1_1Kern.html#abc6975e1dcdfa711ef7b43807ae38e44">name</a>[:-5]</div><div class="line"><a name="l05489"></a><span class="lineno"> 5489</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l05490"></a><span class="lineno"> 5490</span>&#160;            <span class="comment"># TODO: add a warning here when logging is added</span></div><div class="line"><a name="l05491"></a><span class="lineno"> 5491</span>&#160;            base_name = self.<a class="code" href="classpsyclone_1_1psyGen_1_1Kern.html#abc6975e1dcdfa711ef7b43807ae38e44">name</a></div><div class="line"><a name="l05492"></a><span class="lineno"> 5492</span>&#160;</div><div class="line"><a name="l05493"></a><span class="lineno"> 5493</span>&#160;        <span class="comment"># create an empty PSy layer module</span></div><div class="line"><a name="l05494"></a><span class="lineno"> 5494</span>&#160;        psy_module = ModuleGen(base_name+<span class="stringliteral">&quot;_mod&quot;</span>)</div><div class="line"><a name="l05495"></a><span class="lineno"> 5495</span>&#160;</div><div class="line"><a name="l05496"></a><span class="lineno"> 5496</span>&#160;        <span class="comment"># create the subroutine</span></div><div class="line"><a name="l05497"></a><span class="lineno"> 5497</span>&#160;        sub_stub = SubroutineGen(psy_module, name=base_name+<span class="stringliteral">&quot;_code&quot;</span>,</div><div class="line"><a name="l05498"></a><span class="lineno"> 5498</span>&#160;                                 implicitnone=<span class="keyword">True</span>)</div><div class="line"><a name="l05499"></a><span class="lineno"> 5499</span>&#160;        <span class="comment"># create the arglist and declarations</span></div><div class="line"><a name="l05500"></a><span class="lineno"> 5500</span>&#160;        create_arg_list = <a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html">KernStubArgList</a>(self, sub_stub)</div><div class="line"><a name="l05501"></a><span class="lineno"> 5501</span>&#160;        create_arg_list.generate()</div><div class="line"><a name="l05502"></a><span class="lineno"> 5502</span>&#160;        arglist = create_arg_list.arglist</div><div class="line"><a name="l05503"></a><span class="lineno"> 5503</span>&#160;        <span class="comment"># add the arglist</span></div><div class="line"><a name="l05504"></a><span class="lineno"> 5504</span>&#160;        sub_stub.args = arglist</div><div class="line"><a name="l05505"></a><span class="lineno"> 5505</span>&#160;        <span class="comment"># add the subroutine to the parent module</span></div><div class="line"><a name="l05506"></a><span class="lineno"> 5506</span>&#160;        psy_module.add(sub_stub)</div><div class="line"><a name="l05507"></a><span class="lineno"> 5507</span>&#160;        <span class="keywordflow">return</span> psy_module.root</div><div class="line"><a name="l05508"></a><span class="lineno"> 5508</span>&#160;</div><div class="line"><a name="l05509"></a><span class="lineno"> 5509</span>&#160;    @property</div><div class="line"><a name="l05510"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a434a612f8d6d10a6c305daed68a90a05"> 5510</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a434a612f8d6d10a6c305daed68a90a05">incremented_arg</a>(self):</div><div class="line"><a name="l05511"></a><span class="lineno"> 5511</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Returns the argument corresponding to a field or operator that has</span></div><div class="line"><a name="l05512"></a><span class="lineno"> 5512</span>&#160;<span class="stringliteral">        INC access.  &#39;&#39;&#39;</span></div><div class="line"><a name="l05513"></a><span class="lineno"> 5513</span>&#160;        <span class="keywordflow">return</span> Kern.incremented_arg(self, FIELD_ACCESS_MAP)</div><div class="line"><a name="l05514"></a><span class="lineno"> 5514</span>&#160;</div><div class="line"><a name="l05515"></a><span class="lineno"> 5515</span>&#160;    @property</div><div class="line"><a name="l05516"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#ac57b04e61b66fec36adb14f07705b6dc"> 5516</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#ac57b04e61b66fec36adb14f07705b6dc">written_arg</a>(self):</div><div class="line"><a name="l05517"></a><span class="lineno"> 5517</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Returns the argument corresponding to a field or operator that has</span></div><div class="line"><a name="l05518"></a><span class="lineno"> 5518</span>&#160;<span class="stringliteral">        WRITE access &#39;&#39;&#39;</span></div><div class="line"><a name="l05519"></a><span class="lineno"> 5519</span>&#160;        <span class="keywordflow">return</span> Kern.written_arg(self, FIELD_ACCESS_MAP)</div><div class="line"><a name="l05520"></a><span class="lineno"> 5520</span>&#160;</div><div class="line"><a name="l05521"></a><span class="lineno"> 5521</span>&#160;    @property</div><div class="line"><a name="l05522"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a70f602b67faa0cc3d1dc2c18ff45f687"> 5522</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a70f602b67faa0cc3d1dc2c18ff45f687">updated_arg</a>(self):</div><div class="line"><a name="l05523"></a><span class="lineno"> 5523</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Returns the kernel argument that is updated (incremented or</span></div><div class="line"><a name="l05524"></a><span class="lineno"> 5524</span>&#160;<span class="stringliteral">        written to) &#39;&#39;&#39;</span></div><div class="line"><a name="l05525"></a><span class="lineno"> 5525</span>&#160;        arg = <span class="keywordtype">None</span></div><div class="line"><a name="l05526"></a><span class="lineno"> 5526</span>&#160;        <span class="keywordflow">try</span>:</div><div class="line"><a name="l05527"></a><span class="lineno"> 5527</span>&#160;            arg = self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a434a612f8d6d10a6c305daed68a90a05">incremented_arg</a></div><div class="line"><a name="l05528"></a><span class="lineno"> 5528</span>&#160;        <span class="keywordflow">except</span> FieldNotFoundError:</div><div class="line"><a name="l05529"></a><span class="lineno"> 5529</span>&#160;            arg = self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#ac57b04e61b66fec36adb14f07705b6dc">written_arg</a></div><div class="line"><a name="l05530"></a><span class="lineno"> 5530</span>&#160;        <span class="keywordflow">return</span> arg</div><div class="line"><a name="l05531"></a><span class="lineno"> 5531</span>&#160;</div><div class="line"><a name="l05532"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#aed208ff1a80ee1d5e6006540f91b1549"> 5532</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#aed208ff1a80ee1d5e6006540f91b1549">gen_code</a>(self, parent):</div><div class="line"><a name="l05533"></a><span class="lineno"> 5533</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;Generates dynamo version 0.3 specific psy code for a call to</span></div><div class="line"><a name="l05534"></a><span class="lineno"> 5534</span>&#160;<span class="stringliteral">           the dynamo kernel instance.</span></div><div class="line"><a name="l05535"></a><span class="lineno"> 5535</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l05536"></a><span class="lineno"> 5536</span>&#160;<span class="stringliteral">        :param parent: an f2pygen object that will be the parent of \</span></div><div class="line"><a name="l05537"></a><span class="lineno"> 5537</span>&#160;<span class="stringliteral">                       f2pygen objects created in this method.</span></div><div class="line"><a name="l05538"></a><span class="lineno"> 5538</span>&#160;<span class="stringliteral">        :type parent: :py:class:`psyclone.f2pygen.BaseGen`</span></div><div class="line"><a name="l05539"></a><span class="lineno"> 5539</span>&#160;<span class="stringliteral">        :raises GenerationError: if the loop goes beyond the level 1 \</span></div><div class="line"><a name="l05540"></a><span class="lineno"> 5540</span>&#160;<span class="stringliteral">                                 halo and an operator is accessed.</span></div><div class="line"><a name="l05541"></a><span class="lineno"> 5541</span>&#160;<span class="stringliteral">        :raises GenerationError: if a kernel in the loop has an inc access \</span></div><div class="line"><a name="l05542"></a><span class="lineno"> 5542</span>&#160;<span class="stringliteral">                                 and the loop is not coloured but is within \</span></div><div class="line"><a name="l05543"></a><span class="lineno"> 5543</span>&#160;<span class="stringliteral">                                 an OpenMP parallel region.</span></div><div class="line"><a name="l05544"></a><span class="lineno"> 5544</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l05545"></a><span class="lineno"> 5545</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l05546"></a><span class="lineno"> 5546</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> CallGen, DeclGen, AssignGen, UseGen, \</div><div class="line"><a name="l05547"></a><span class="lineno"> 5547</span>&#160;            CommentGen</div><div class="line"><a name="l05548"></a><span class="lineno"> 5548</span>&#160;        parent.add(DeclGen(parent, datatype=<span class="stringliteral">&quot;integer&quot;</span>,</div><div class="line"><a name="l05549"></a><span class="lineno"> 5549</span>&#160;                           entity_decls=[<span class="stringliteral">&quot;cell&quot;</span>]))</div><div class="line"><a name="l05550"></a><span class="lineno"> 5550</span>&#160;</div><div class="line"><a name="l05551"></a><span class="lineno"> 5551</span>&#160;        <span class="comment"># Check whether this kernel reads from an operator</span></div><div class="line"><a name="l05552"></a><span class="lineno"> 5552</span>&#160;        op_args = self.parent.args_filter(arg_types=VALID_OPERATOR_NAMES,</div><div class="line"><a name="l05553"></a><span class="lineno"> 5553</span>&#160;                                          arg_accesses=[<span class="stringliteral">&quot;gh_read&quot;</span>,</div><div class="line"><a name="l05554"></a><span class="lineno"> 5554</span>&#160;                                                        <span class="stringliteral">&quot;gh_readwrite&quot;</span>])</div><div class="line"><a name="l05555"></a><span class="lineno"> 5555</span>&#160;        <span class="keywordflow">if</span> op_args:</div><div class="line"><a name="l05556"></a><span class="lineno"> 5556</span>&#160;            <span class="comment"># It does. We must check that our parent loop does not</span></div><div class="line"><a name="l05557"></a><span class="lineno"> 5557</span>&#160;            <span class="comment"># go beyond the L1 halo.</span></div><div class="line"><a name="l05558"></a><span class="lineno"> 5558</span>&#160;            <span class="keywordflow">if</span> self.parent.upper_bound_name == <span class="stringliteral">&quot;cell_halo&quot;</span> <span class="keywordflow">and</span> \</div><div class="line"><a name="l05559"></a><span class="lineno"> 5559</span>&#160;               self.parent.upper_bound_halo_depth &gt; 1:</div><div class="line"><a name="l05560"></a><span class="lineno"> 5560</span>&#160;                <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l05561"></a><span class="lineno"> 5561</span>&#160;                    <span class="stringliteral">&quot;Kernel &#39;{0}&#39; reads from an operator and therefore &quot;</span></div><div class="line"><a name="l05562"></a><span class="lineno"> 5562</span>&#160;                    <span class="stringliteral">&quot;cannot be used for cells beyond the level 1 halo. &quot;</span></div><div class="line"><a name="l05563"></a><span class="lineno"> 5563</span>&#160;                    <span class="stringliteral">&quot;However the containing loop goes out to level {1}&quot;</span>.</div><div class="line"><a name="l05564"></a><span class="lineno"> 5564</span>&#160;                    format(self.<a class="code" href="classpsyclone_1_1psyGen_1_1Call.html#a6bd17c037cb747d595e5690133a8443e">_name</a>, self.parent.upper_bound_halo_depth))</div><div class="line"><a name="l05565"></a><span class="lineno"> 5565</span>&#160;</div><div class="line"><a name="l05566"></a><span class="lineno"> 5566</span>&#160;        <span class="comment"># If this kernel is being called from within a coloured</span></div><div class="line"><a name="l05567"></a><span class="lineno"> 5567</span>&#160;        <span class="comment"># loop then we have to look-up the name of the colour map</span></div><div class="line"><a name="l05568"></a><span class="lineno"> 5568</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1psyGen_1_1Kern.html#ad5ccfbc244cb81b6733b56133ac9e6c1">is_coloured</a>():</div><div class="line"><a name="l05569"></a><span class="lineno"> 5569</span>&#160;            <span class="comment"># TODO Check whether this arg is gh_inc and if not, Warn that</span></div><div class="line"><a name="l05570"></a><span class="lineno"> 5570</span>&#160;            <span class="comment"># we&#39;re colouring a kernel that has no field object with INC access</span></div><div class="line"><a name="l05571"></a><span class="lineno"> 5571</span>&#160;</div><div class="line"><a name="l05572"></a><span class="lineno"> 5572</span>&#160;            <span class="comment"># We must look-up the cell index using the colour map rather than</span></div><div class="line"><a name="l05573"></a><span class="lineno"> 5573</span>&#160;            <span class="comment"># use the current cell index directly. We need to know the name</span></div><div class="line"><a name="l05574"></a><span class="lineno"> 5574</span>&#160;            <span class="comment"># of the variable holding the colour map for this kernel.</span></div><div class="line"><a name="l05575"></a><span class="lineno"> 5575</span>&#160;            cell_index = self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a1bcc844fb892249179351237be168d66">colourmap</a> + <span class="stringliteral">&quot;(colour, cell)&quot;</span></div><div class="line"><a name="l05576"></a><span class="lineno"> 5576</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l05577"></a><span class="lineno"> 5577</span>&#160;            <span class="comment"># This kernel call has not been coloured</span></div><div class="line"><a name="l05578"></a><span class="lineno"> 5578</span>&#160;            <span class="comment">#  - is it OpenMP parallel, i.e. are we a child of</span></div><div class="line"><a name="l05579"></a><span class="lineno"> 5579</span>&#160;            <span class="comment"># an OpenMP directive?</span></div><div class="line"><a name="l05580"></a><span class="lineno"> 5580</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1psyGen_1_1Node.html#a68afb39a447656f9ff01930065a1637d">is_openmp_parallel</a>():</div><div class="line"><a name="l05581"></a><span class="lineno"> 5581</span>&#160;                <span class="keywordflow">try</span>:</div><div class="line"><a name="l05582"></a><span class="lineno"> 5582</span>&#160;                    <span class="comment"># It is OpenMP parallel - does it have an argument</span></div><div class="line"><a name="l05583"></a><span class="lineno"> 5583</span>&#160;                    <span class="comment"># with INC access?</span></div><div class="line"><a name="l05584"></a><span class="lineno"> 5584</span>&#160;                    arg = self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a434a612f8d6d10a6c305daed68a90a05">incremented_arg</a></div><div class="line"><a name="l05585"></a><span class="lineno"> 5585</span>&#160;                <span class="keywordflow">except</span> FieldNotFoundError:</div><div class="line"><a name="l05586"></a><span class="lineno"> 5586</span>&#160;                    arg = <span class="keywordtype">None</span></div><div class="line"><a name="l05587"></a><span class="lineno"> 5587</span>&#160;                <span class="keywordflow">if</span> arg:</div><div class="line"><a name="l05588"></a><span class="lineno"> 5588</span>&#160;                    <span class="keywordflow">raise</span> GenerationError(<span class="stringliteral">&quot;Kernel {0} has an argument with &quot;</span></div><div class="line"><a name="l05589"></a><span class="lineno"> 5589</span>&#160;                                          <span class="stringliteral">&quot;INC access and therefore must &quot;</span></div><div class="line"><a name="l05590"></a><span class="lineno"> 5590</span>&#160;                                          <span class="stringliteral">&quot;be coloured in order to be &quot;</span></div><div class="line"><a name="l05591"></a><span class="lineno"> 5591</span>&#160;                                          <span class="stringliteral">&quot;parallelised with OpenMP&quot;</span>.</div><div class="line"><a name="l05592"></a><span class="lineno"> 5592</span>&#160;                                          format(self.<a class="code" href="classpsyclone_1_1psyGen_1_1Call.html#a6bd17c037cb747d595e5690133a8443e">_name</a>))</div><div class="line"><a name="l05593"></a><span class="lineno"> 5593</span>&#160;            cell_index = <span class="stringliteral">&quot;cell&quot;</span></div><div class="line"><a name="l05594"></a><span class="lineno"> 5594</span>&#160;</div><div class="line"><a name="l05595"></a><span class="lineno"> 5595</span>&#160;        parent.add(CommentGen(parent, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l05596"></a><span class="lineno"> 5596</span>&#160;</div><div class="line"><a name="l05597"></a><span class="lineno"> 5597</span>&#160;        <span class="comment"># orientation arrays initialisation and their declarations</span></div><div class="line"><a name="l05598"></a><span class="lineno"> 5598</span>&#160;        orientation_decl_names = []</div><div class="line"><a name="l05599"></a><span class="lineno"> 5599</span>&#160;        <span class="keywordflow">for</span> unique_fs <span class="keywordflow">in</span> self.arguments.unique_fss:</div><div class="line"><a name="l05600"></a><span class="lineno"> 5600</span>&#160;            <span class="keywordflow">if</span> self._fs_descriptors.exists(unique_fs):</div><div class="line"><a name="l05601"></a><span class="lineno"> 5601</span>&#160;                fs_descriptor = self._fs_descriptors.get_descriptor(unique_fs)</div><div class="line"><a name="l05602"></a><span class="lineno"> 5602</span>&#160;                <span class="keywordflow">if</span> fs_descriptor.requires_orientation:</div><div class="line"><a name="l05603"></a><span class="lineno"> 5603</span>&#160;                    field = self.arguments.get_arg_on_space(unique_fs)</div><div class="line"><a name="l05604"></a><span class="lineno"> 5604</span>&#160;                    oname = get_fs_orientation_name(unique_fs)</div><div class="line"><a name="l05605"></a><span class="lineno"> 5605</span>&#160;                    orientation_decl_names.append(oname+<span class="stringliteral">&quot;(:) =&gt; null()&quot;</span>)</div><div class="line"><a name="l05606"></a><span class="lineno"> 5606</span>&#160;                    parent.add(</div><div class="line"><a name="l05607"></a><span class="lineno"> 5607</span>&#160;                        AssignGen(parent, pointer=<span class="keyword">True</span>,</div><div class="line"><a name="l05608"></a><span class="lineno"> 5608</span>&#160;                                  lhs=oname,</div><div class="line"><a name="l05609"></a><span class="lineno"> 5609</span>&#160;                                  rhs=field.proxy_name_indexed + <span class="stringliteral">&quot;%&quot;</span> +</div><div class="line"><a name="l05610"></a><span class="lineno"> 5610</span>&#160;                                  field.ref_name(unique_fs) +</div><div class="line"><a name="l05611"></a><span class="lineno"> 5611</span>&#160;                                  <span class="stringliteral">&quot;%get_cell_orientation(&quot;</span> +</div><div class="line"><a name="l05612"></a><span class="lineno"> 5612</span>&#160;                                  cell_index + <span class="stringliteral">&quot;)&quot;</span>))</div><div class="line"><a name="l05613"></a><span class="lineno"> 5613</span>&#160;        <span class="keywordflow">if</span> orientation_decl_names:</div><div class="line"><a name="l05614"></a><span class="lineno"> 5614</span>&#160;            parent.add(DeclGen(parent, datatype=<span class="stringliteral">&quot;integer&quot;</span>, pointer=<span class="keyword">True</span>,</div><div class="line"><a name="l05615"></a><span class="lineno"> 5615</span>&#160;                               entity_decls=orientation_decl_names))</div><div class="line"><a name="l05616"></a><span class="lineno"> 5616</span>&#160;            parent.add(CommentGen(parent, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l05617"></a><span class="lineno"> 5617</span>&#160;</div><div class="line"><a name="l05618"></a><span class="lineno"> 5618</span>&#160;        <span class="comment"># dump = True</span></div><div class="line"><a name="l05619"></a><span class="lineno"> 5619</span>&#160;        <span class="comment"># if dump:</span></div><div class="line"><a name="l05620"></a><span class="lineno"> 5620</span>&#160;        <span class="comment">#    new_parent, position = parent.start_parent_loop()</span></div><div class="line"><a name="l05621"></a><span class="lineno"> 5621</span>&#160;        <span class="comment">#    create_dump = DinoWriters(self, new_parent, position)</span></div><div class="line"><a name="l05622"></a><span class="lineno"> 5622</span>&#160;        <span class="comment">#    create_dump.generate()</span></div><div class="line"><a name="l05623"></a><span class="lineno"> 5623</span>&#160;</div><div class="line"><a name="l05624"></a><span class="lineno"> 5624</span>&#160;        super(DynKern, self).<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#aed208ff1a80ee1d5e6006540f91b1549">gen_code</a>(parent)</div><div class="line"><a name="l05625"></a><span class="lineno"> 5625</span>&#160;</div><div class="line"><a name="l05626"></a><span class="lineno"> 5626</span>&#160;</div><div class="line"><a name="l05627"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html"> 5627</a></span>&#160;<span class="keyword">class </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html">ArgOrdering</a>(object):</div><div class="line"><a name="l05628"></a><span class="lineno"> 5628</span>&#160;    <span class="stringliteral">&#39;&#39;&#39;Base class capturing the arguments, type and ordering of data in</span></div><div class="line"><a name="l05629"></a><span class="lineno"> 5629</span>&#160;<span class="stringliteral">    a Kernel call.&#39;&#39;&#39;</span></div><div class="line"><a name="l05630"></a><span class="lineno"> 5630</span>&#160;    <span class="keyword">def </span>__init__(self, kern):</div><div class="line"><a name="l05631"></a><span class="lineno"> 5631</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a1651baaa5383b5e525dbeeb8235f06bc">_kern</a> = kern</div><div class="line"><a name="l05632"></a><span class="lineno"> 5632</span>&#160;</div><div class="line"><a name="l05633"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a1792d63f369ef2304d70a2288bf9258c"> 5633</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a1792d63f369ef2304d70a2288bf9258c">generate</a>(self):</div><div class="line"><a name="l05634"></a><span class="lineno"> 5634</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l05635"></a><span class="lineno"> 5635</span>&#160;<span class="stringliteral">        Specifies which arguments appear in an argument list, their type</span></div><div class="line"><a name="l05636"></a><span class="lineno"> 5636</span>&#160;<span class="stringliteral">        and their ordering. Calls methods for each type of argument</span></div><div class="line"><a name="l05637"></a><span class="lineno"> 5637</span>&#160;<span class="stringliteral">        that can be specialised by a child class for its particular need.</span></div><div class="line"><a name="l05638"></a><span class="lineno"> 5638</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l05639"></a><span class="lineno"> 5639</span>&#160;<span class="stringliteral">        :raises GenerationError: if the kernel arguments break the</span></div><div class="line"><a name="l05640"></a><span class="lineno"> 5640</span>&#160;<span class="stringliteral">                                 rules for the Dynamo 0.3 API.</span></div><div class="line"><a name="l05641"></a><span class="lineno"> 5641</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l05642"></a><span class="lineno"> 5642</span>&#160;        <span class="keywordflow">if</span> self._kern.arguments.has_operator():</div><div class="line"><a name="l05643"></a><span class="lineno"> 5643</span>&#160;            <span class="comment"># All operator types require the cell index to be provided</span></div><div class="line"><a name="l05644"></a><span class="lineno"> 5644</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a3a6a0d4274bd8b1de3981636cf12b1f9">cell_position</a>()</div><div class="line"><a name="l05645"></a><span class="lineno"> 5645</span>&#160;        <span class="comment"># Pass the number of layers in the mesh unless this kernel is</span></div><div class="line"><a name="l05646"></a><span class="lineno"> 5646</span>&#160;        <span class="comment"># applying a CMA operator or doing a CMA matrix-matrix calculation</span></div><div class="line"><a name="l05647"></a><span class="lineno"> 5647</span>&#160;        <span class="keywordflow">if</span> self._kern.cma_operation <span class="keywordflow">not</span> <span class="keywordflow">in</span> [<span class="stringliteral">&quot;apply&quot;</span>, <span class="stringliteral">&quot;matrix-matrix&quot;</span>]:</div><div class="line"><a name="l05648"></a><span class="lineno"> 5648</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a1815cf0ec5d4c5f2fdab681330b2d033">mesh_height</a>()</div><div class="line"><a name="l05649"></a><span class="lineno"> 5649</span>&#160;        <span class="comment"># Pass the number of cells in the mesh if this kernel has a</span></div><div class="line"><a name="l05650"></a><span class="lineno"> 5650</span>&#160;        <span class="comment"># LMA operator argument</span></div><div class="line"><a name="l05651"></a><span class="lineno"> 5651</span>&#160;        <span class="comment"># TODO this code should replace the code that currently includes</span></div><div class="line"><a name="l05652"></a><span class="lineno"> 5652</span>&#160;        <span class="comment"># this quantity for *every* operator it encounters.</span></div><div class="line"><a name="l05653"></a><span class="lineno"> 5653</span>&#160;        <span class="comment"># if self._kern.arguments.has_operator(op_type=&quot;gh_operator&quot;):</span></div><div class="line"><a name="l05654"></a><span class="lineno"> 5654</span>&#160;        <span class="comment">#     self.mesh_ncell3d()</span></div><div class="line"><a name="l05655"></a><span class="lineno"> 5655</span>&#160;        <span class="comment"># Pass the number of columns in the mesh if this kernel has a CMA</span></div><div class="line"><a name="l05656"></a><span class="lineno"> 5656</span>&#160;        <span class="comment"># operator argument</span></div><div class="line"><a name="l05657"></a><span class="lineno"> 5657</span>&#160;        <span class="keywordflow">if</span> self._kern.arguments.has_operator(op_type=<span class="stringliteral">&quot;gh_columnwise_operator&quot;</span>):</div><div class="line"><a name="l05658"></a><span class="lineno"> 5658</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#adb61c8779c13200cbf923f879f7e26a5">mesh_ncell2d</a>()</div><div class="line"><a name="l05659"></a><span class="lineno"> 5659</span>&#160;</div><div class="line"><a name="l05660"></a><span class="lineno"> 5660</span>&#160;        <span class="keywordflow">if</span> self._kern.is_intergrid:</div><div class="line"><a name="l05661"></a><span class="lineno"> 5661</span>&#160;            <span class="comment"># Inter-grid kernels require special arguments</span></div><div class="line"><a name="l05662"></a><span class="lineno"> 5662</span>&#160;            <span class="comment"># The cell-map for the current column providing the mapping from</span></div><div class="line"><a name="l05663"></a><span class="lineno"> 5663</span>&#160;            <span class="comment"># the coarse to the fine mesh.</span></div><div class="line"><a name="l05664"></a><span class="lineno"> 5664</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#aacac0c302ed31ac61b8a4e6652450fd7">cell_map</a>()</div><div class="line"><a name="l05665"></a><span class="lineno"> 5665</span>&#160;</div><div class="line"><a name="l05666"></a><span class="lineno"> 5666</span>&#160;        <span class="comment"># for each argument in the order they are specified in the</span></div><div class="line"><a name="l05667"></a><span class="lineno"> 5667</span>&#160;        <span class="comment"># kernel metadata, call particular methods depending on what</span></div><div class="line"><a name="l05668"></a><span class="lineno"> 5668</span>&#160;        <span class="comment"># type of argument we find (field, field vector, operator or</span></div><div class="line"><a name="l05669"></a><span class="lineno"> 5669</span>&#160;        <span class="comment"># scalar). If the argument is a field or field vector and also</span></div><div class="line"><a name="l05670"></a><span class="lineno"> 5670</span>&#160;        <span class="comment"># has a stencil access then also call appropriate stencil</span></div><div class="line"><a name="l05671"></a><span class="lineno"> 5671</span>&#160;        <span class="comment"># methods.</span></div><div class="line"><a name="l05672"></a><span class="lineno"> 5672</span>&#160;        <span class="keywordflow">for</span> arg <span class="keywordflow">in</span> self._kern.arguments.args:</div><div class="line"><a name="l05673"></a><span class="lineno"> 5673</span>&#160;            <span class="keywordflow">if</span> arg.type == <span class="stringliteral">&quot;gh_field&quot;</span>:</div><div class="line"><a name="l05674"></a><span class="lineno"> 5674</span>&#160;                <span class="keywordflow">if</span> arg.vector_size &gt; 1:</div><div class="line"><a name="l05675"></a><span class="lineno"> 5675</span>&#160;                    self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a6486b1c8596fec1e5413b02d86b97eea">field_vector</a>(arg)</div><div class="line"><a name="l05676"></a><span class="lineno"> 5676</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l05677"></a><span class="lineno"> 5677</span>&#160;                    self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#aaab1aca69f260698f5541d384bf65415">field</a>(arg)</div><div class="line"><a name="l05678"></a><span class="lineno"> 5678</span>&#160;                <span class="keywordflow">if</span> arg.descriptor.stencil:</div><div class="line"><a name="l05679"></a><span class="lineno"> 5679</span>&#160;                    <span class="keywordflow">if</span> <span class="keywordflow">not</span> arg.descriptor.stencil[<span class="stringliteral">&#39;extent&#39;</span>]:</div><div class="line"><a name="l05680"></a><span class="lineno"> 5680</span>&#160;                        <span class="comment"># stencil extent is not provided in the</span></div><div class="line"><a name="l05681"></a><span class="lineno"> 5681</span>&#160;                        <span class="comment"># metadata so must be passed</span></div><div class="line"><a name="l05682"></a><span class="lineno"> 5682</span>&#160;                        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a41d378f72b5a0da177028e0d183c56e3">stencil_unknown_extent</a>(arg)</div><div class="line"><a name="l05683"></a><span class="lineno"> 5683</span>&#160;                    <span class="keywordflow">if</span> arg.descriptor.stencil[<span class="stringliteral">&#39;type&#39;</span>] == <span class="stringliteral">&quot;xory1d&quot;</span>:</div><div class="line"><a name="l05684"></a><span class="lineno"> 5684</span>&#160;                        <span class="comment"># if &quot;xory1d is specified then the actual</span></div><div class="line"><a name="l05685"></a><span class="lineno"> 5685</span>&#160;                        <span class="comment"># direction must be passed</span></div><div class="line"><a name="l05686"></a><span class="lineno"> 5686</span>&#160;                        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a6c766cbb2d5453b938b48422c6658d20">stencil_unknown_direction</a>(arg)</div><div class="line"><a name="l05687"></a><span class="lineno"> 5687</span>&#160;                    <span class="comment"># stencil information that is always passed</span></div><div class="line"><a name="l05688"></a><span class="lineno"> 5688</span>&#160;                    self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#ad8eee666d0871d55b27961224faa80e9">stencil</a>(arg)</div><div class="line"><a name="l05689"></a><span class="lineno"> 5689</span>&#160;            <span class="keywordflow">elif</span> arg.type == <span class="stringliteral">&quot;gh_operator&quot;</span>:</div><div class="line"><a name="l05690"></a><span class="lineno"> 5690</span>&#160;                self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a75dc0198d318dd291982ca87a3af70b2">operator</a>(arg)</div><div class="line"><a name="l05691"></a><span class="lineno"> 5691</span>&#160;            <span class="keywordflow">elif</span> arg.type == <span class="stringliteral">&quot;gh_columnwise_operator&quot;</span>:</div><div class="line"><a name="l05692"></a><span class="lineno"> 5692</span>&#160;                self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#ac0254dcd091f305ee7241ac112634c1a">cma_operator</a>(arg)</div><div class="line"><a name="l05693"></a><span class="lineno"> 5693</span>&#160;            <span class="keywordflow">elif</span> arg.type <span class="keywordflow">in</span> VALID_SCALAR_NAMES:</div><div class="line"><a name="l05694"></a><span class="lineno"> 5694</span>&#160;                self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a3884d69be074c97ce061bb264e2693be">scalar</a>(arg)</div><div class="line"><a name="l05695"></a><span class="lineno"> 5695</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l05696"></a><span class="lineno"> 5696</span>&#160;                <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l05697"></a><span class="lineno"> 5697</span>&#160;                    <span class="stringliteral">&quot;Unexpected arg type found in dynamo0p3.py:&quot;</span></div><div class="line"><a name="l05698"></a><span class="lineno"> 5698</span>&#160;                    <span class="stringliteral">&quot;ArgOrdering:generate(). Expected one of &#39;{0}&#39; &quot;</span></div><div class="line"><a name="l05699"></a><span class="lineno"> 5699</span>&#160;                    <span class="stringliteral">&quot;but found &#39;{1}&#39;&quot;</span>.format(VALID_ARG_TYPE_NAMES, arg.type))</div><div class="line"><a name="l05700"></a><span class="lineno"> 5700</span>&#160;        <span class="comment"># For each function space (in the order they appear in the</span></div><div class="line"><a name="l05701"></a><span class="lineno"> 5701</span>&#160;        <span class="comment"># metadata arguments)</span></div><div class="line"><a name="l05702"></a><span class="lineno"> 5702</span>&#160;        <span class="keywordflow">for</span> unique_fs <span class="keywordflow">in</span> self._kern.arguments.unique_fss:</div><div class="line"><a name="l05703"></a><span class="lineno"> 5703</span>&#160;            <span class="comment"># Provide arguments common to LMA operators and fields on</span></div><div class="line"><a name="l05704"></a><span class="lineno"> 5704</span>&#160;            <span class="comment"># a space *unless* this is an inter-grid or CMA</span></div><div class="line"><a name="l05705"></a><span class="lineno"> 5705</span>&#160;            <span class="comment"># matrix-matrix kernel</span></div><div class="line"><a name="l05706"></a><span class="lineno"> 5706</span>&#160;            <span class="keywordflow">if</span> self._kern.cma_operation <span class="keywordflow">not</span> <span class="keywordflow">in</span> [<span class="stringliteral">&quot;matrix-matrix&quot;</span>] <span class="keywordflow">and</span> \</div><div class="line"><a name="l05707"></a><span class="lineno"> 5707</span>&#160;               <span class="keywordflow">not</span> self._kern.is_intergrid:</div><div class="line"><a name="l05708"></a><span class="lineno"> 5708</span>&#160;                self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a3f8c25a562a08acb6558af724105f611">fs_common</a>(unique_fs)</div><div class="line"><a name="l05709"></a><span class="lineno"> 5709</span>&#160;            <span class="comment"># Provide additional arguments if there is a</span></div><div class="line"><a name="l05710"></a><span class="lineno"> 5710</span>&#160;            <span class="comment"># field on this space</span></div><div class="line"><a name="l05711"></a><span class="lineno"> 5711</span>&#160;            <span class="keywordflow">if</span> field_on_space(unique_fs, self._kern.arguments):</div><div class="line"><a name="l05712"></a><span class="lineno"> 5712</span>&#160;                <span class="keywordflow">if</span> self._kern.is_intergrid:</div><div class="line"><a name="l05713"></a><span class="lineno"> 5713</span>&#160;                    self.fs_intergrid(unique_fs)</div><div class="line"><a name="l05714"></a><span class="lineno"> 5714</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l05715"></a><span class="lineno"> 5715</span>&#160;                    self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a931b962e11ff13ace2611a65abf24aa5">fs_compulsory_field</a>(unique_fs)</div><div class="line"><a name="l05716"></a><span class="lineno"> 5716</span>&#160;            cma_op = cma_on_space(unique_fs, self._kern.arguments)</div><div class="line"><a name="l05717"></a><span class="lineno"> 5717</span>&#160;            <span class="keywordflow">if</span> cma_op:</div><div class="line"><a name="l05718"></a><span class="lineno"> 5718</span>&#160;                <span class="keywordflow">if</span> self._kern.cma_operation == <span class="stringliteral">&quot;assembly&quot;</span>:</div><div class="line"><a name="l05719"></a><span class="lineno"> 5719</span>&#160;                    <span class="comment"># CMA-assembly requires banded dofmaps</span></div><div class="line"><a name="l05720"></a><span class="lineno"> 5720</span>&#160;                    self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#ae447b81eefcae9c0b292084a68c7441d">banded_dofmap</a>(unique_fs)</div><div class="line"><a name="l05721"></a><span class="lineno"> 5721</span>&#160;                <span class="keywordflow">elif</span> self._kern.cma_operation == <span class="stringliteral">&quot;apply&quot;</span>:</div><div class="line"><a name="l05722"></a><span class="lineno"> 5722</span>&#160;                    <span class="comment"># Applying a CMA operator requires indirection dofmaps</span></div><div class="line"><a name="l05723"></a><span class="lineno"> 5723</span>&#160;                    self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#abe3738e0c224dedd864dd24006940ef6">indirection_dofmap</a>(unique_fs, operator=cma_op)</div><div class="line"><a name="l05724"></a><span class="lineno"> 5724</span>&#160;</div><div class="line"><a name="l05725"></a><span class="lineno"> 5725</span>&#160;            <span class="comment"># Provide any optional arguments. These arguments are</span></div><div class="line"><a name="l05726"></a><span class="lineno"> 5726</span>&#160;            <span class="comment"># associated with the keyword arguments (basis function,</span></div><div class="line"><a name="l05727"></a><span class="lineno"> 5727</span>&#160;            <span class="comment"># differential basis function and orientation) for a</span></div><div class="line"><a name="l05728"></a><span class="lineno"> 5728</span>&#160;            <span class="comment"># function space.</span></div><div class="line"><a name="l05729"></a><span class="lineno"> 5729</span>&#160;            <span class="keywordflow">if</span> self._kern.fs_descriptors.exists(unique_fs):</div><div class="line"><a name="l05730"></a><span class="lineno"> 5730</span>&#160;                descriptors = self._kern.fs_descriptors</div><div class="line"><a name="l05731"></a><span class="lineno"> 5731</span>&#160;                descriptor = descriptors.get_descriptor(unique_fs)</div><div class="line"><a name="l05732"></a><span class="lineno"> 5732</span>&#160;                <span class="keywordflow">if</span> descriptor.requires_basis:</div><div class="line"><a name="l05733"></a><span class="lineno"> 5733</span>&#160;                    self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a7f1c8b027d438eb49fc9045dad8de2c6">basis</a>(unique_fs)</div><div class="line"><a name="l05734"></a><span class="lineno"> 5734</span>&#160;                <span class="keywordflow">if</span> descriptor.requires_diff_basis:</div><div class="line"><a name="l05735"></a><span class="lineno"> 5735</span>&#160;                    self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a0335069a7e6706d533c85607fec143ee">diff_basis</a>(unique_fs)</div><div class="line"><a name="l05736"></a><span class="lineno"> 5736</span>&#160;                <span class="keywordflow">if</span> descriptor.requires_orientation:</div><div class="line"><a name="l05737"></a><span class="lineno"> 5737</span>&#160;                    self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#aa04177eb8a6e4f253c2fba95e51faec7">orientation</a>(unique_fs)</div><div class="line"><a name="l05738"></a><span class="lineno"> 5738</span>&#160;            <span class="comment"># Fix for boundary_dofs array to the boundary condition</span></div><div class="line"><a name="l05739"></a><span class="lineno"> 5739</span>&#160;            <span class="comment"># kernel (enforce_bc_kernel) arguments</span></div><div class="line"><a name="l05740"></a><span class="lineno"> 5740</span>&#160;            <span class="keywordflow">if</span> self._kern.name.lower() == <span class="stringliteral">&quot;enforce_bc_code&quot;</span> <span class="keywordflow">and</span> \</div><div class="line"><a name="l05741"></a><span class="lineno"> 5741</span>&#160;               unique_fs.orig_name.lower() == <span class="stringliteral">&quot;any_space_1&quot;</span>:</div><div class="line"><a name="l05742"></a><span class="lineno"> 5742</span>&#160;                self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#acc72560435e14e43c1388e1282d8bbdf">field_bcs_kernel</a>(unique_fs)</div><div class="line"><a name="l05743"></a><span class="lineno"> 5743</span>&#160;</div><div class="line"><a name="l05744"></a><span class="lineno"> 5744</span>&#160;        <span class="comment"># Add boundary dofs array to the operator boundary condition</span></div><div class="line"><a name="l05745"></a><span class="lineno"> 5745</span>&#160;        <span class="comment"># kernel (enforce_operator_bc_kernel) arguments</span></div><div class="line"><a name="l05746"></a><span class="lineno"> 5746</span>&#160;        <span class="keywordflow">if</span> self._kern.name.lower() == <span class="stringliteral">&quot;enforce_operator_bc_code&quot;</span>:</div><div class="line"><a name="l05747"></a><span class="lineno"> 5747</span>&#160;            <span class="comment"># Sanity checks - this kernel should only have a single LMA</span></div><div class="line"><a name="l05748"></a><span class="lineno"> 5748</span>&#160;            <span class="comment"># operator as argument</span></div><div class="line"><a name="l05749"></a><span class="lineno"> 5749</span>&#160;            <span class="keywordflow">if</span> len(self._kern.arguments.args) &gt; 1:</div><div class="line"><a name="l05750"></a><span class="lineno"> 5750</span>&#160;                <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l05751"></a><span class="lineno"> 5751</span>&#160;                    <span class="stringliteral">&quot;Kernel {0} has {1} arguments when it should only have 1 &quot;</span></div><div class="line"><a name="l05752"></a><span class="lineno"> 5752</span>&#160;                    <span class="stringliteral">&quot;(an LMA operator)&quot;</span>.format(self._kern.name,</div><div class="line"><a name="l05753"></a><span class="lineno"> 5753</span>&#160;                                               len(self._kern.arguments.args)))</div><div class="line"><a name="l05754"></a><span class="lineno"> 5754</span>&#160;            op_arg = self._kern.arguments.args[0]</div><div class="line"><a name="l05755"></a><span class="lineno"> 5755</span>&#160;            <span class="keywordflow">if</span> op_arg.type != <span class="stringliteral">&quot;gh_operator&quot;</span>:</div><div class="line"><a name="l05756"></a><span class="lineno"> 5756</span>&#160;                <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l05757"></a><span class="lineno"> 5757</span>&#160;                    <span class="stringliteral">&quot;Expected a LMA operator from which to look-up boundary &quot;</span></div><div class="line"><a name="l05758"></a><span class="lineno"> 5758</span>&#160;                    <span class="stringliteral">&quot;dofs but kernel {0} has argument {1}.&quot;</span>.</div><div class="line"><a name="l05759"></a><span class="lineno"> 5759</span>&#160;                    format(self._kern.name, op_arg.type))</div><div class="line"><a name="l05760"></a><span class="lineno"> 5760</span>&#160;            <span class="keywordflow">if</span> op_arg.access != <span class="stringliteral">&quot;gh_readwrite&quot;</span>:</div><div class="line"><a name="l05761"></a><span class="lineno"> 5761</span>&#160;                <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l05762"></a><span class="lineno"> 5762</span>&#160;                    <span class="stringliteral">&quot;Kernel {0} is recognised as a kernel which applies &quot;</span></div><div class="line"><a name="l05763"></a><span class="lineno"> 5763</span>&#160;                    <span class="stringliteral">&quot;boundary conditions to an operator. However its operator &quot;</span></div><div class="line"><a name="l05764"></a><span class="lineno"> 5764</span>&#160;                    <span class="stringliteral">&quot;argument has access {1} rather than gh_readwrite.&quot;</span>.</div><div class="line"><a name="l05765"></a><span class="lineno"> 5765</span>&#160;                    format(self._kern.name, op_arg.access))</div><div class="line"><a name="l05766"></a><span class="lineno"> 5766</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a95a7f4be43c9b22dc2eb2ae8ba3ab8c8">operator_bcs_kernel</a>(op_arg.function_space_to)</div><div class="line"><a name="l05767"></a><span class="lineno"> 5767</span>&#160;</div><div class="line"><a name="l05768"></a><span class="lineno"> 5768</span>&#160;        <span class="comment"># Provide qr arguments if required</span></div><div class="line"><a name="l05769"></a><span class="lineno"> 5769</span>&#160;        <span class="keywordflow">if</span> self._kern.qr_required:</div><div class="line"><a name="l05770"></a><span class="lineno"> 5770</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a6684f61f12fa76c5714f3b51e5dca89b">quad_rule</a>()</div><div class="line"><a name="l05771"></a><span class="lineno"> 5771</span>&#160;</div><div class="line"><a name="l05772"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a3a6a0d4274bd8b1de3981636cf12b1f9"> 5772</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a3a6a0d4274bd8b1de3981636cf12b1f9">cell_position</a>(self):</div><div class="line"><a name="l05773"></a><span class="lineno"> 5773</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l05774"></a><span class="lineno"> 5774</span>&#160;<span class="stringliteral">        Add cell position information</span></div><div class="line"><a name="l05775"></a><span class="lineno"> 5775</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l05776"></a><span class="lineno"> 5776</span>&#160;<span class="stringliteral">        :raises NotImplementedError: because this is an abstract method</span></div><div class="line"><a name="l05777"></a><span class="lineno"> 5777</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l05778"></a><span class="lineno"> 5778</span>&#160;        <span class="keywordflow">raise</span> NotImplementedError(</div><div class="line"><a name="l05779"></a><span class="lineno"> 5779</span>&#160;            <span class="stringliteral">&quot;Error: ArgOrdering.cell_position() must be implemented by &quot;</span></div><div class="line"><a name="l05780"></a><span class="lineno"> 5780</span>&#160;            <span class="stringliteral">&quot;subclass&quot;</span>)</div><div class="line"><a name="l05781"></a><span class="lineno"> 5781</span>&#160;</div><div class="line"><a name="l05782"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#aacac0c302ed31ac61b8a4e6652450fd7"> 5782</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#aacac0c302ed31ac61b8a4e6652450fd7">cell_map</a>(self):</div><div class="line"><a name="l05783"></a><span class="lineno"> 5783</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l05784"></a><span class="lineno"> 5784</span>&#160;<span class="stringliteral">        Add cell-map information (for inter-grid kernels)</span></div><div class="line"><a name="l05785"></a><span class="lineno"> 5785</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l05786"></a><span class="lineno"> 5786</span>&#160;<span class="stringliteral">        :raises NotImplementedError: because this is an abstract method</span></div><div class="line"><a name="l05787"></a><span class="lineno"> 5787</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l05788"></a><span class="lineno"> 5788</span>&#160;        <span class="keywordflow">raise</span> NotImplementedError(</div><div class="line"><a name="l05789"></a><span class="lineno"> 5789</span>&#160;            <span class="stringliteral">&quot;Error: ArgOrdering.cell_map() must be implemented by subclass&quot;</span>)</div><div class="line"><a name="l05790"></a><span class="lineno"> 5790</span>&#160;</div><div class="line"><a name="l05791"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a1815cf0ec5d4c5f2fdab681330b2d033"> 5791</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a1815cf0ec5d4c5f2fdab681330b2d033">mesh_height</a>(self):</div><div class="line"><a name="l05792"></a><span class="lineno"> 5792</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l05793"></a><span class="lineno"> 5793</span>&#160;<span class="stringliteral">        Add height information (i.e. no. of layers)</span></div><div class="line"><a name="l05794"></a><span class="lineno"> 5794</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l05795"></a><span class="lineno"> 5795</span>&#160;<span class="stringliteral">        :raises NotImplementedError: because this is an abstract method</span></div><div class="line"><a name="l05796"></a><span class="lineno"> 5796</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l05797"></a><span class="lineno"> 5797</span>&#160;        <span class="keywordflow">raise</span> NotImplementedError(</div><div class="line"><a name="l05798"></a><span class="lineno"> 5798</span>&#160;            <span class="stringliteral">&quot;Error: ArgOrdering.mesh_height() must be implemented by subclass&quot;</span>)</div><div class="line"><a name="l05799"></a><span class="lineno"> 5799</span>&#160;</div><div class="line"><a name="l05800"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#adb61c8779c13200cbf923f879f7e26a5"> 5800</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#adb61c8779c13200cbf923f879f7e26a5">mesh_ncell2d</a>(self):</div><div class="line"><a name="l05801"></a><span class="lineno"> 5801</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l05802"></a><span class="lineno"> 5802</span>&#160;<span class="stringliteral">        Add the number of columns in the mesh</span></div><div class="line"><a name="l05803"></a><span class="lineno"> 5803</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l05804"></a><span class="lineno"> 5804</span>&#160;<span class="stringliteral">        :raises NotImplementedError: because this is an abstract method</span></div><div class="line"><a name="l05805"></a><span class="lineno"> 5805</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l05806"></a><span class="lineno"> 5806</span>&#160;        <span class="keywordflow">raise</span> NotImplementedError(</div><div class="line"><a name="l05807"></a><span class="lineno"> 5807</span>&#160;            <span class="stringliteral">&quot;Error: ArgOrdering.mesh_ncell2d() must be implemented by&quot;</span></div><div class="line"><a name="l05808"></a><span class="lineno"> 5808</span>&#160;            <span class="stringliteral">&quot;subclass&quot;</span>)</div><div class="line"><a name="l05809"></a><span class="lineno"> 5809</span>&#160;</div><div class="line"><a name="l05810"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#ac0254dcd091f305ee7241ac112634c1a"> 5810</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#ac0254dcd091f305ee7241ac112634c1a">cma_operator</a>(self, arg):</div><div class="line"><a name="l05811"></a><span class="lineno"> 5811</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l05812"></a><span class="lineno"> 5812</span>&#160;<span class="stringliteral">        Add information on the CMA operator</span></div><div class="line"><a name="l05813"></a><span class="lineno"> 5813</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l05814"></a><span class="lineno"> 5814</span>&#160;<span class="stringliteral">        :raises NotImplementedError: because this is an abstract method</span></div><div class="line"><a name="l05815"></a><span class="lineno"> 5815</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l05816"></a><span class="lineno"> 5816</span>&#160;        <span class="keywordflow">raise</span> NotImplementedError(<span class="stringliteral">&quot;Error: ArgOrdering.cma_operator() must &quot;</span></div><div class="line"><a name="l05817"></a><span class="lineno"> 5817</span>&#160;                                  <span class="stringliteral">&quot;be implemented by subclass&quot;</span>)</div><div class="line"><a name="l05818"></a><span class="lineno"> 5818</span>&#160;</div><div class="line"><a name="l05819"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a6486b1c8596fec1e5413b02d86b97eea"> 5819</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a6486b1c8596fec1e5413b02d86b97eea">field_vector</a>(self, arg):</div><div class="line"><a name="l05820"></a><span class="lineno"> 5820</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l05821"></a><span class="lineno"> 5821</span>&#160;<span class="stringliteral">        Add field-vector information for this field-vector argument</span></div><div class="line"><a name="l05822"></a><span class="lineno"> 5822</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l05823"></a><span class="lineno"> 5823</span>&#160;<span class="stringliteral">        :raises NotImplementedError: because this is an abstract method</span></div><div class="line"><a name="l05824"></a><span class="lineno"> 5824</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l05825"></a><span class="lineno"> 5825</span>&#160;        <span class="keywordflow">raise</span> NotImplementedError(</div><div class="line"><a name="l05826"></a><span class="lineno"> 5826</span>&#160;            <span class="stringliteral">&quot;Error: ArgOrdering.field_vector() must be implemented by &quot;</span></div><div class="line"><a name="l05827"></a><span class="lineno"> 5827</span>&#160;            <span class="stringliteral">&quot;subclass&quot;</span>)</div><div class="line"><a name="l05828"></a><span class="lineno"> 5828</span>&#160;</div><div class="line"><a name="l05829"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#aaab1aca69f260698f5541d384bf65415"> 5829</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#aaab1aca69f260698f5541d384bf65415">field</a>(self, arg):</div><div class="line"><a name="l05830"></a><span class="lineno"> 5830</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l05831"></a><span class="lineno"> 5831</span>&#160;<span class="stringliteral">        Add field information for this field argument</span></div><div class="line"><a name="l05832"></a><span class="lineno"> 5832</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l05833"></a><span class="lineno"> 5833</span>&#160;<span class="stringliteral">        :raises NotImplementedError: because this is an abstract method</span></div><div class="line"><a name="l05834"></a><span class="lineno"> 5834</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l05835"></a><span class="lineno"> 5835</span>&#160;        <span class="keywordflow">raise</span> NotImplementedError(</div><div class="line"><a name="l05836"></a><span class="lineno"> 5836</span>&#160;            <span class="stringliteral">&quot;Error: ArgOrdering.field() must be implemented by subclass&quot;</span>)</div><div class="line"><a name="l05837"></a><span class="lineno"> 5837</span>&#160;</div><div class="line"><a name="l05838"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a41d378f72b5a0da177028e0d183c56e3"> 5838</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a41d378f72b5a0da177028e0d183c56e3">stencil_unknown_extent</a>(self, arg):</div><div class="line"><a name="l05839"></a><span class="lineno"> 5839</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l05840"></a><span class="lineno"> 5840</span>&#160;<span class="stringliteral">        Add stencil extent information for this stencil argument</span></div><div class="line"><a name="l05841"></a><span class="lineno"> 5841</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l05842"></a><span class="lineno"> 5842</span>&#160;<span class="stringliteral">        :raises NotImplementedError: because this is an abstract method</span></div><div class="line"><a name="l05843"></a><span class="lineno"> 5843</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l05844"></a><span class="lineno"> 5844</span>&#160;        <span class="keywordflow">raise</span> NotImplementedError(</div><div class="line"><a name="l05845"></a><span class="lineno"> 5845</span>&#160;            <span class="stringliteral">&quot;Error: ArgOrdering.stencil_unknown_extent() must be implemented &quot;</span></div><div class="line"><a name="l05846"></a><span class="lineno"> 5846</span>&#160;            <span class="stringliteral">&quot;by subclass&quot;</span>)</div><div class="line"><a name="l05847"></a><span class="lineno"> 5847</span>&#160;</div><div class="line"><a name="l05848"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a6c766cbb2d5453b938b48422c6658d20"> 5848</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a6c766cbb2d5453b938b48422c6658d20">stencil_unknown_direction</a>(self, arg):</div><div class="line"><a name="l05849"></a><span class="lineno"> 5849</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l05850"></a><span class="lineno"> 5850</span>&#160;<span class="stringliteral">        Add stencil direction information for this stencil argument</span></div><div class="line"><a name="l05851"></a><span class="lineno"> 5851</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l05852"></a><span class="lineno"> 5852</span>&#160;<span class="stringliteral">        :raises NotImplementedError: because this is an abstract method</span></div><div class="line"><a name="l05853"></a><span class="lineno"> 5853</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l05854"></a><span class="lineno"> 5854</span>&#160;        <span class="keywordflow">raise</span> NotImplementedError(</div><div class="line"><a name="l05855"></a><span class="lineno"> 5855</span>&#160;            <span class="stringliteral">&quot;Error: ArgOrdering.stencil_unknown_direction() must be &quot;</span></div><div class="line"><a name="l05856"></a><span class="lineno"> 5856</span>&#160;            <span class="stringliteral">&quot;implemented by subclass&quot;</span>)</div><div class="line"><a name="l05857"></a><span class="lineno"> 5857</span>&#160;</div><div class="line"><a name="l05858"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#ad8eee666d0871d55b27961224faa80e9"> 5858</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#ad8eee666d0871d55b27961224faa80e9">stencil</a>(self, arg):</div><div class="line"><a name="l05859"></a><span class="lineno"> 5859</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l05860"></a><span class="lineno"> 5860</span>&#160;<span class="stringliteral">        Add stencil information for this stencil argument</span></div><div class="line"><a name="l05861"></a><span class="lineno"> 5861</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l05862"></a><span class="lineno"> 5862</span>&#160;<span class="stringliteral">        :raises NotImplementedError: because this is an abstract method</span></div><div class="line"><a name="l05863"></a><span class="lineno"> 5863</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l05864"></a><span class="lineno"> 5864</span>&#160;        <span class="keywordflow">raise</span> NotImplementedError(</div><div class="line"><a name="l05865"></a><span class="lineno"> 5865</span>&#160;            <span class="stringliteral">&quot;Error: ArgOrdering.stencil() must be implemented by subclass&quot;</span>)</div><div class="line"><a name="l05866"></a><span class="lineno"> 5866</span>&#160;</div><div class="line"><a name="l05867"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a75dc0198d318dd291982ca87a3af70b2"> 5867</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a75dc0198d318dd291982ca87a3af70b2">operator</a>(self, arg):</div><div class="line"><a name="l05868"></a><span class="lineno"> 5868</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l05869"></a><span class="lineno"> 5869</span>&#160;<span class="stringliteral">        Add operator information for this operator argument</span></div><div class="line"><a name="l05870"></a><span class="lineno"> 5870</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l05871"></a><span class="lineno"> 5871</span>&#160;<span class="stringliteral">        :raises NotImplementedError: because this is an abstract method</span></div><div class="line"><a name="l05872"></a><span class="lineno"> 5872</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l05873"></a><span class="lineno"> 5873</span>&#160;        <span class="keywordflow">raise</span> NotImplementedError(</div><div class="line"><a name="l05874"></a><span class="lineno"> 5874</span>&#160;            <span class="stringliteral">&quot;Error: ArgOrdering.operator() must be implemented by subclass&quot;</span>)</div><div class="line"><a name="l05875"></a><span class="lineno"> 5875</span>&#160;</div><div class="line"><a name="l05876"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a3884d69be074c97ce061bb264e2693be"> 5876</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a3884d69be074c97ce061bb264e2693be">scalar</a>(self, arg):</div><div class="line"><a name="l05877"></a><span class="lineno"> 5877</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l05878"></a><span class="lineno"> 5878</span>&#160;<span class="stringliteral">        Add scalar information for this scalar argument</span></div><div class="line"><a name="l05879"></a><span class="lineno"> 5879</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l05880"></a><span class="lineno"> 5880</span>&#160;<span class="stringliteral">        :raises NotImplementedError: because this is an abstract method</span></div><div class="line"><a name="l05881"></a><span class="lineno"> 5881</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l05882"></a><span class="lineno"> 5882</span>&#160;        <span class="keywordflow">raise</span> NotImplementedError(</div><div class="line"><a name="l05883"></a><span class="lineno"> 5883</span>&#160;            <span class="stringliteral">&quot;Error: ArgOrdering.scalar() must be implemented by subclass&quot;</span>)</div><div class="line"><a name="l05884"></a><span class="lineno"> 5884</span>&#160;</div><div class="line"><a name="l05885"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a3f8c25a562a08acb6558af724105f611"> 5885</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a3f8c25a562a08acb6558af724105f611">fs_common</a>(self, function_space):</div><div class="line"><a name="l05886"></a><span class="lineno"> 5886</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l05887"></a><span class="lineno"> 5887</span>&#160;<span class="stringliteral">        Add information common to LMA operators and fields for this</span></div><div class="line"><a name="l05888"></a><span class="lineno"> 5888</span>&#160;<span class="stringliteral">        function space</span></div><div class="line"><a name="l05889"></a><span class="lineno"> 5889</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l05890"></a><span class="lineno"> 5890</span>&#160;<span class="stringliteral">        :raises NotImplementedError: because this is an abstract method</span></div><div class="line"><a name="l05891"></a><span class="lineno"> 5891</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l05892"></a><span class="lineno"> 5892</span>&#160;        <span class="keywordflow">raise</span> NotImplementedError(</div><div class="line"><a name="l05893"></a><span class="lineno"> 5893</span>&#160;            <span class="stringliteral">&quot;Error: ArgOrdering.fs_common() must be implemented by &quot;</span></div><div class="line"><a name="l05894"></a><span class="lineno"> 5894</span>&#160;            <span class="stringliteral">&quot;subclass&quot;</span>)</div><div class="line"><a name="l05895"></a><span class="lineno"> 5895</span>&#160;</div><div class="line"><a name="l05896"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a931b962e11ff13ace2611a65abf24aa5"> 5896</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a931b962e11ff13ace2611a65abf24aa5">fs_compulsory_field</a>(self, function_space):</div><div class="line"><a name="l05897"></a><span class="lineno"> 5897</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l05898"></a><span class="lineno"> 5898</span>&#160;<span class="stringliteral">        Add compulsory information for this function space</span></div><div class="line"><a name="l05899"></a><span class="lineno"> 5899</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l05900"></a><span class="lineno"> 5900</span>&#160;<span class="stringliteral">        :raises NotImplementedError: because this is an abstract method</span></div><div class="line"><a name="l05901"></a><span class="lineno"> 5901</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l05902"></a><span class="lineno"> 5902</span>&#160;        <span class="keywordflow">raise</span> NotImplementedError(</div><div class="line"><a name="l05903"></a><span class="lineno"> 5903</span>&#160;            <span class="stringliteral">&quot;Error: ArgOrdering.fs_compulsory_field() must be implemented &quot;</span></div><div class="line"><a name="l05904"></a><span class="lineno"> 5904</span>&#160;            <span class="stringliteral">&quot;by subclass&quot;</span>)</div><div class="line"><a name="l05905"></a><span class="lineno"> 5905</span>&#160;</div><div class="line"><a name="l05906"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a7f1c8b027d438eb49fc9045dad8de2c6"> 5906</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a7f1c8b027d438eb49fc9045dad8de2c6">basis</a>(self, function_space):</div><div class="line"><a name="l05907"></a><span class="lineno"> 5907</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l05908"></a><span class="lineno"> 5908</span>&#160;<span class="stringliteral">        Add basis function information for this function space</span></div><div class="line"><a name="l05909"></a><span class="lineno"> 5909</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l05910"></a><span class="lineno"> 5910</span>&#160;<span class="stringliteral">        :raises NotImplementedError: because this is an abstract method</span></div><div class="line"><a name="l05911"></a><span class="lineno"> 5911</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l05912"></a><span class="lineno"> 5912</span>&#160;        <span class="keywordflow">raise</span> NotImplementedError(</div><div class="line"><a name="l05913"></a><span class="lineno"> 5913</span>&#160;            <span class="stringliteral">&quot;Error: ArgOrdering.basis() must be implemented by subclass&quot;</span>)</div><div class="line"><a name="l05914"></a><span class="lineno"> 5914</span>&#160;</div><div class="line"><a name="l05915"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a0335069a7e6706d533c85607fec143ee"> 5915</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a0335069a7e6706d533c85607fec143ee">diff_basis</a>(self, function_space):</div><div class="line"><a name="l05916"></a><span class="lineno"> 5916</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l05917"></a><span class="lineno"> 5917</span>&#160;<span class="stringliteral">        Add differential basis function information for this function</span></div><div class="line"><a name="l05918"></a><span class="lineno"> 5918</span>&#160;<span class="stringliteral">        space</span></div><div class="line"><a name="l05919"></a><span class="lineno"> 5919</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l05920"></a><span class="lineno"> 5920</span>&#160;<span class="stringliteral">        :raises NotImplementedError: because this is an abstract method</span></div><div class="line"><a name="l05921"></a><span class="lineno"> 5921</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l05922"></a><span class="lineno"> 5922</span>&#160;        <span class="keywordflow">raise</span> NotImplementedError(</div><div class="line"><a name="l05923"></a><span class="lineno"> 5923</span>&#160;            <span class="stringliteral">&quot;Error: ArgOrdering.diff_basis() must be implemented by subclass&quot;</span>)</div><div class="line"><a name="l05924"></a><span class="lineno"> 5924</span>&#160;</div><div class="line"><a name="l05925"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#aa04177eb8a6e4f253c2fba95e51faec7"> 5925</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#aa04177eb8a6e4f253c2fba95e51faec7">orientation</a>(self, function_space):</div><div class="line"><a name="l05926"></a><span class="lineno"> 5926</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l05927"></a><span class="lineno"> 5927</span>&#160;<span class="stringliteral">        Add orientation information for this function space</span></div><div class="line"><a name="l05928"></a><span class="lineno"> 5928</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l05929"></a><span class="lineno"> 5929</span>&#160;<span class="stringliteral">        :raises NotImplementedError: because this is an abstract method</span></div><div class="line"><a name="l05930"></a><span class="lineno"> 5930</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l05931"></a><span class="lineno"> 5931</span>&#160;        <span class="keywordflow">raise</span> NotImplementedError(</div><div class="line"><a name="l05932"></a><span class="lineno"> 5932</span>&#160;            <span class="stringliteral">&quot;Error: ArgOrdering.orientation() must be implemented by subclass&quot;</span>)</div><div class="line"><a name="l05933"></a><span class="lineno"> 5933</span>&#160;</div><div class="line"><a name="l05934"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#acc72560435e14e43c1388e1282d8bbdf"> 5934</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#acc72560435e14e43c1388e1282d8bbdf">field_bcs_kernel</a>(self, function_space):</div><div class="line"><a name="l05935"></a><span class="lineno"> 5935</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l05936"></a><span class="lineno"> 5936</span>&#160;<span class="stringliteral">        Add boundary condition information for a field on this function</span></div><div class="line"><a name="l05937"></a><span class="lineno"> 5937</span>&#160;<span class="stringliteral">        space</span></div><div class="line"><a name="l05938"></a><span class="lineno"> 5938</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l05939"></a><span class="lineno"> 5939</span>&#160;<span class="stringliteral">        :raises NotImplementedError: because this is an abstract method</span></div><div class="line"><a name="l05940"></a><span class="lineno"> 5940</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l05941"></a><span class="lineno"> 5941</span>&#160;        <span class="keywordflow">raise</span> NotImplementedError(</div><div class="line"><a name="l05942"></a><span class="lineno"> 5942</span>&#160;            <span class="stringliteral">&quot;Error: ArgOrdering.field_bcs_kernel() must be implemented by &quot;</span></div><div class="line"><a name="l05943"></a><span class="lineno"> 5943</span>&#160;            <span class="stringliteral">&quot;subclass&quot;</span>)</div><div class="line"><a name="l05944"></a><span class="lineno"> 5944</span>&#160;</div><div class="line"><a name="l05945"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a95a7f4be43c9b22dc2eb2ae8ba3ab8c8"> 5945</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a95a7f4be43c9b22dc2eb2ae8ba3ab8c8">operator_bcs_kernel</a>(self, function_space):</div><div class="line"><a name="l05946"></a><span class="lineno"> 5946</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l05947"></a><span class="lineno"> 5947</span>&#160;<span class="stringliteral">        Add boundary condition information for an operator on this function</span></div><div class="line"><a name="l05948"></a><span class="lineno"> 5948</span>&#160;<span class="stringliteral">        space</span></div><div class="line"><a name="l05949"></a><span class="lineno"> 5949</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l05950"></a><span class="lineno"> 5950</span>&#160;<span class="stringliteral">        :raises NotImplementedError: because this is an abstract method</span></div><div class="line"><a name="l05951"></a><span class="lineno"> 5951</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l05952"></a><span class="lineno"> 5952</span>&#160;        <span class="keywordflow">raise</span> NotImplementedError(</div><div class="line"><a name="l05953"></a><span class="lineno"> 5953</span>&#160;            <span class="stringliteral">&quot;Error: ArgOrdering.operator_bcs_kernel() must be implemented by &quot;</span></div><div class="line"><a name="l05954"></a><span class="lineno"> 5954</span>&#160;            <span class="stringliteral">&quot;subclass&quot;</span>)</div><div class="line"><a name="l05955"></a><span class="lineno"> 5955</span>&#160;</div><div class="line"><a name="l05956"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a6684f61f12fa76c5714f3b51e5dca89b"> 5956</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a6684f61f12fa76c5714f3b51e5dca89b">quad_rule</a>(self):</div><div class="line"><a name="l05957"></a><span class="lineno"> 5957</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l05958"></a><span class="lineno"> 5958</span>&#160;<span class="stringliteral">        Add qr information</span></div><div class="line"><a name="l05959"></a><span class="lineno"> 5959</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l05960"></a><span class="lineno"> 5960</span>&#160;<span class="stringliteral">        :raises NotImplementedError: because this is an abstract method</span></div><div class="line"><a name="l05961"></a><span class="lineno"> 5961</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l05962"></a><span class="lineno"> 5962</span>&#160;        <span class="keywordflow">raise</span> NotImplementedError(</div><div class="line"><a name="l05963"></a><span class="lineno"> 5963</span>&#160;            <span class="stringliteral">&quot;Error: ArgOrdering.quad_rule() must be implemented by subclass&quot;</span>)</div><div class="line"><a name="l05964"></a><span class="lineno"> 5964</span>&#160;</div><div class="line"><a name="l05965"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#ae447b81eefcae9c0b292084a68c7441d"> 5965</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#ae447b81eefcae9c0b292084a68c7441d">banded_dofmap</a>(self, function_space):</div><div class="line"><a name="l05966"></a><span class="lineno"> 5966</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l05967"></a><span class="lineno"> 5967</span>&#160;<span class="stringliteral">        Add banded dofmap (required for CMA operator assembly)</span></div><div class="line"><a name="l05968"></a><span class="lineno"> 5968</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l05969"></a><span class="lineno"> 5969</span>&#160;<span class="stringliteral">        :raises NotImplementedError: because this is an abstract method</span></div><div class="line"><a name="l05970"></a><span class="lineno"> 5970</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l05971"></a><span class="lineno"> 5971</span>&#160;        <span class="keywordflow">raise</span> NotImplementedError(<span class="stringliteral">&quot;Error: ArgOrdering.banded_dofmap() must&quot;</span></div><div class="line"><a name="l05972"></a><span class="lineno"> 5972</span>&#160;                                  <span class="stringliteral">&quot; be implemented by subclass&quot;</span>)</div><div class="line"><a name="l05973"></a><span class="lineno"> 5973</span>&#160;</div><div class="line"><a name="l05974"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#abe3738e0c224dedd864dd24006940ef6"> 5974</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#abe3738e0c224dedd864dd24006940ef6">indirection_dofmap</a>(self, arg, operator=None):</div><div class="line"><a name="l05975"></a><span class="lineno"> 5975</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l05976"></a><span class="lineno"> 5976</span>&#160;<span class="stringliteral">        Add indirection dofmap required when applying a CMA operator</span></div><div class="line"><a name="l05977"></a><span class="lineno"> 5977</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l05978"></a><span class="lineno"> 5978</span>&#160;<span class="stringliteral">        :raises NotImplementedError: because this is an abstract method</span></div><div class="line"><a name="l05979"></a><span class="lineno"> 5979</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l05980"></a><span class="lineno"> 5980</span>&#160;        <span class="keywordflow">raise</span> NotImplementedError(<span class="stringliteral">&quot;Error: ArgOrdering.indirection_dofmap() &quot;</span></div><div class="line"><a name="l05981"></a><span class="lineno"> 5981</span>&#160;                                  <span class="stringliteral">&quot;must be implemented by subclass&quot;</span>)</div><div class="line"><a name="l05982"></a><span class="lineno"> 5982</span>&#160;</div><div class="line"><a name="l05983"></a><span class="lineno"> 5983</span>&#160;</div><div class="line"><a name="l05984"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html"> 5984</a></span>&#160;<span class="keyword">class </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html">KernCallArgList</a>(<a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html">ArgOrdering</a>):</div><div class="line"><a name="l05985"></a><span class="lineno"> 5985</span>&#160;    <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l05986"></a><span class="lineno"> 5986</span>&#160;<span class="stringliteral">    Creates the argument list required to call kernel &quot;kern&quot; from the</span></div><div class="line"><a name="l05987"></a><span class="lineno"> 5987</span>&#160;<span class="stringliteral">    PSy-layer. The ordering and type of arguments is captured by the base</span></div><div class="line"><a name="l05988"></a><span class="lineno"> 5988</span>&#160;<span class="stringliteral">    class.</span></div><div class="line"><a name="l05989"></a><span class="lineno"> 5989</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l05990"></a><span class="lineno"> 5990</span>&#160;<span class="stringliteral">    :param kern: The kernel that is being called.</span></div><div class="line"><a name="l05991"></a><span class="lineno"> 5991</span>&#160;<span class="stringliteral">    :type kern: :py:class:`psyclone.dynamo0p3.DynKern`</span></div><div class="line"><a name="l05992"></a><span class="lineno"> 5992</span>&#160;<span class="stringliteral">    :param parent: parent of this kernel-call node in the PSyIRe.</span></div><div class="line"><a name="l05993"></a><span class="lineno"> 5993</span>&#160;<span class="stringliteral">    :type parent: :py:class:`psyclone.f2pygen.DoGen`</span></div><div class="line"><a name="l05994"></a><span class="lineno"> 5994</span>&#160;<span class="stringliteral">    &#39;&#39;&#39;</span></div><div class="line"><a name="l05995"></a><span class="lineno"> 5995</span>&#160;    <span class="keyword">def </span>__init__(self, kern, parent=None):</div><div class="line"><a name="l05996"></a><span class="lineno"> 5996</span>&#160;        ArgOrdering.__init__(self, kern)</div><div class="line"><a name="l05997"></a><span class="lineno"> 5997</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a284163a34aa8727b033aba2cc14af970">_parent</a> = parent</div><div class="line"><a name="l05998"></a><span class="lineno"> 5998</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#afce3f4d66984e336db84826a6e5e2701">_arglist</a> = []</div><div class="line"><a name="l05999"></a><span class="lineno"> 5999</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a605fb01cd622f598c3327ee5aba903a9">_name_space_manager</a> = NameSpaceFactory().create()</div><div class="line"><a name="l06000"></a><span class="lineno"> 6000</span>&#160;</div><div class="line"><a name="l06001"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a66f0e96cea3cb078dbb96d8df6ebdb87"> 6001</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a66f0e96cea3cb078dbb96d8df6ebdb87">cell_position</a>(self):</div><div class="line"><a name="l06002"></a><span class="lineno"> 6002</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; add a cell argument to the argument list&#39;&#39;&#39;</span></div><div class="line"><a name="l06003"></a><span class="lineno"> 6003</span>&#160;        self._arglist.append(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a613fee118173f3682330e84bdfe3ae22">_cell_ref_name</a>)</div><div class="line"><a name="l06004"></a><span class="lineno"> 6004</span>&#160;</div><div class="line"><a name="l06005"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a813f33568d289e645a228f08612fe0f2"> 6005</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a813f33568d289e645a228f08612fe0f2">cell_map</a>(self):</div><div class="line"><a name="l06006"></a><span class="lineno"> 6006</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Add cell-map and related cell counts to the argument list &#39;&#39;&#39;</span></div><div class="line"><a name="l06007"></a><span class="lineno"> 6007</span>&#160;        cargs = psyGen.args_filter(self._kern.args,</div><div class="line"><a name="l06008"></a><span class="lineno"> 6008</span>&#160;                                   arg_meshes=[<span class="stringliteral">&quot;gh_coarse&quot;</span>])</div><div class="line"><a name="l06009"></a><span class="lineno"> 6009</span>&#160;        carg = cargs[0]</div><div class="line"><a name="l06010"></a><span class="lineno"> 6010</span>&#160;        fargs = psyGen.args_filter(self._kern.args,</div><div class="line"><a name="l06011"></a><span class="lineno"> 6011</span>&#160;                                   arg_meshes=[<span class="stringliteral">&quot;gh_fine&quot;</span>])</div><div class="line"><a name="l06012"></a><span class="lineno"> 6012</span>&#160;        farg = fargs[0]</div><div class="line"><a name="l06013"></a><span class="lineno"> 6013</span>&#160;        base_name = <span class="stringliteral">&quot;cell_map_&quot;</span> + carg.name</div><div class="line"><a name="l06014"></a><span class="lineno"> 6014</span>&#160;        map_name = self._name_space_manager.create_name(</div><div class="line"><a name="l06015"></a><span class="lineno"> 6015</span>&#160;            root_name=base_name, context=<span class="stringliteral">&quot;PSyVars&quot;</span>, label=base_name)</div><div class="line"><a name="l06016"></a><span class="lineno"> 6016</span>&#160;        <span class="comment"># Add the cell map to our argument list</span></div><div class="line"><a name="l06017"></a><span class="lineno"> 6017</span>&#160;        self._arglist.append(<span class="stringliteral">&quot;{0}(:,{1})&quot;</span>.format(map_name,</div><div class="line"><a name="l06018"></a><span class="lineno"> 6018</span>&#160;                                                 self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a613fee118173f3682330e84bdfe3ae22">_cell_ref_name</a>))</div><div class="line"><a name="l06019"></a><span class="lineno"> 6019</span>&#160;        <span class="comment"># No. of fine cells per coarse cell</span></div><div class="line"><a name="l06020"></a><span class="lineno"> 6020</span>&#160;        base_name = <span class="stringliteral">&quot;ncpc_{0}_{1}&quot;</span>.format(farg.name, carg.name)</div><div class="line"><a name="l06021"></a><span class="lineno"> 6021</span>&#160;        ncellpercell = self._name_space_manager.create_name(</div><div class="line"><a name="l06022"></a><span class="lineno"> 6022</span>&#160;            root_name=base_name, context=<span class="stringliteral">&quot;PSyVars&quot;</span>, label=base_name)</div><div class="line"><a name="l06023"></a><span class="lineno"> 6023</span>&#160;        self._arglist.append(ncellpercell)</div><div class="line"><a name="l06024"></a><span class="lineno"> 6024</span>&#160;        <span class="comment"># No. of columns in the fine mesh</span></div><div class="line"><a name="l06025"></a><span class="lineno"> 6025</span>&#160;        base_name = <span class="stringliteral">&quot;ncell_{0}&quot;</span>.format(farg.name)</div><div class="line"><a name="l06026"></a><span class="lineno"> 6026</span>&#160;        ncell_fine = self._name_space_manager.create_name(</div><div class="line"><a name="l06027"></a><span class="lineno"> 6027</span>&#160;            root_name=base_name, context=<span class="stringliteral">&quot;PSyVars&quot;</span>, label=base_name)</div><div class="line"><a name="l06028"></a><span class="lineno"> 6028</span>&#160;        self._arglist.append(ncell_fine)</div><div class="line"><a name="l06029"></a><span class="lineno"> 6029</span>&#160;</div><div class="line"><a name="l06030"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a2d99ac4d537a80b2b46a5c149e0ea512"> 6030</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a2d99ac4d537a80b2b46a5c149e0ea512">mesh_height</a>(self):</div><div class="line"><a name="l06031"></a><span class="lineno"> 6031</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; add mesh height (nlayers) to the argument list&#39;&#39;&#39;</span></div><div class="line"><a name="l06032"></a><span class="lineno"> 6032</span>&#160;        nlayers_name = self._name_space_manager.create_name(</div><div class="line"><a name="l06033"></a><span class="lineno"> 6033</span>&#160;            root_name=<span class="stringliteral">&quot;nlayers&quot;</span>, context=<span class="stringliteral">&quot;PSyVars&quot;</span>, label=<span class="stringliteral">&quot;nlayers&quot;</span>)</div><div class="line"><a name="l06034"></a><span class="lineno"> 6034</span>&#160;        self._arglist.append(nlayers_name)</div><div class="line"><a name="l06035"></a><span class="lineno"> 6035</span>&#160;</div><div class="line"><a name="l06036"></a><span class="lineno"> 6036</span>&#160;    <span class="comment"># TODO uncomment this method when ensuring we only pass ncell3d once</span></div><div class="line"><a name="l06037"></a><span class="lineno"> 6037</span>&#160;    <span class="comment"># to any given kernel.</span></div><div class="line"><a name="l06038"></a><span class="lineno"> 6038</span>&#160;    <span class="comment"># def mesh_ncell3d(self):</span></div><div class="line"><a name="l06039"></a><span class="lineno"> 6039</span>&#160;    <span class="comment">#     &#39;&#39;&#39; Add the number of cells in the full 3D mesh to the argument</span></div><div class="line"><a name="l06040"></a><span class="lineno"> 6040</span>&#160;    <span class="comment">#     list &#39;&#39;&#39;</span></div><div class="line"><a name="l06041"></a><span class="lineno"> 6041</span>&#160;    <span class="comment">#     ncell3d_name = self._name_space_manager.create_name(</span></div><div class="line"><a name="l06042"></a><span class="lineno"> 6042</span>&#160;    <span class="comment">#         root_name=&quot;ncell_3d&quot;, context=&quot;PSyVars&quot;, label=&quot;ncell3d&quot;)</span></div><div class="line"><a name="l06043"></a><span class="lineno"> 6043</span>&#160;    <span class="comment">#     self._arglist.append(ncell3d_name)</span></div><div class="line"><a name="l06044"></a><span class="lineno"> 6044</span>&#160;</div><div class="line"><a name="l06045"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a2c2410d54ffcfbf92ca0919eac4f9103"> 6045</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a2c2410d54ffcfbf92ca0919eac4f9103">mesh_ncell2d</a>(self):</div><div class="line"><a name="l06046"></a><span class="lineno"> 6046</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Add the number of columns in the mesh to the argument list &#39;&#39;&#39;</span></div><div class="line"><a name="l06047"></a><span class="lineno"> 6047</span>&#160;        ncell2d_name = self._name_space_manager.create_name(</div><div class="line"><a name="l06048"></a><span class="lineno"> 6048</span>&#160;            root_name=<span class="stringliteral">&quot;ncell_2d&quot;</span>, context=<span class="stringliteral">&quot;PSyVars&quot;</span>, label=<span class="stringliteral">&quot;ncell_2d&quot;</span>)</div><div class="line"><a name="l06049"></a><span class="lineno"> 6049</span>&#160;        self._arglist.append(ncell2d_name)</div><div class="line"><a name="l06050"></a><span class="lineno"> 6050</span>&#160;</div><div class="line"><a name="l06051"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#af8f56cd931a698c69a982648af1e9978"> 6051</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#af8f56cd931a698c69a982648af1e9978">field_vector</a>(self, argvect):</div><div class="line"><a name="l06052"></a><span class="lineno"> 6052</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;add the field vector associated with the argument &#39;argvect&#39; to the</span></div><div class="line"><a name="l06053"></a><span class="lineno"> 6053</span>&#160;<span class="stringliteral">        argument list &#39;&#39;&#39;</span></div><div class="line"><a name="l06054"></a><span class="lineno"> 6054</span>&#160;        <span class="comment"># the range function below returns values from</span></div><div class="line"><a name="l06055"></a><span class="lineno"> 6055</span>&#160;        <span class="comment"># 1 to the vector size which is what we</span></div><div class="line"><a name="l06056"></a><span class="lineno"> 6056</span>&#160;        <span class="comment"># require in our Fortran code</span></div><div class="line"><a name="l06057"></a><span class="lineno"> 6057</span>&#160;        <span class="keywordflow">for</span> idx <span class="keywordflow">in</span> range(1, argvect.vector_size+1):</div><div class="line"><a name="l06058"></a><span class="lineno"> 6058</span>&#160;            text = argvect.proxy_name + <span class="stringliteral">&quot;(&quot;</span> + str(idx) + <span class="stringliteral">&quot;)%data&quot;</span></div><div class="line"><a name="l06059"></a><span class="lineno"> 6059</span>&#160;            self._arglist.append(text)</div><div class="line"><a name="l06060"></a><span class="lineno"> 6060</span>&#160;</div><div class="line"><a name="l06061"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a931deb1444a0cb85032b66a2739bd214"> 6061</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a931deb1444a0cb85032b66a2739bd214">field</a>(self, arg):</div><div class="line"><a name="l06062"></a><span class="lineno"> 6062</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;add the field array associated with the argument &#39;arg&#39; to the</span></div><div class="line"><a name="l06063"></a><span class="lineno"> 6063</span>&#160;<span class="stringliteral">        argument list&#39;&#39;&#39;</span></div><div class="line"><a name="l06064"></a><span class="lineno"> 6064</span>&#160;        text = arg.proxy_name + <span class="stringliteral">&quot;%data&quot;</span></div><div class="line"><a name="l06065"></a><span class="lineno"> 6065</span>&#160;        self._arglist.append(text)</div><div class="line"><a name="l06066"></a><span class="lineno"> 6066</span>&#160;</div><div class="line"><a name="l06067"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a39f19335e6b57509ff6f56e859772e74"> 6067</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a39f19335e6b57509ff6f56e859772e74">stencil_unknown_extent</a>(self, arg):</div><div class="line"><a name="l06068"></a><span class="lineno"> 6068</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;add stencil information to the argument list associated with the</span></div><div class="line"><a name="l06069"></a><span class="lineno"> 6069</span>&#160;<span class="stringliteral">        argument &#39;arg&#39; if the extent is unknown&#39;&#39;&#39;</span></div><div class="line"><a name="l06070"></a><span class="lineno"> 6070</span>&#160;        <span class="comment"># the extent is not specified in the metadata</span></div><div class="line"><a name="l06071"></a><span class="lineno"> 6071</span>&#160;        <span class="comment"># so pass the value in</span></div><div class="line"><a name="l06072"></a><span class="lineno"> 6072</span>&#160;        name = stencil_size_name(arg)</div><div class="line"><a name="l06073"></a><span class="lineno"> 6073</span>&#160;        self._arglist.append(name)</div><div class="line"><a name="l06074"></a><span class="lineno"> 6074</span>&#160;</div><div class="line"><a name="l06075"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a5a1a66d6d07bb2ae7b316000ce3e339f"> 6075</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a5a1a66d6d07bb2ae7b316000ce3e339f">stencil_unknown_direction</a>(self, arg):</div><div class="line"><a name="l06076"></a><span class="lineno"> 6076</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;add stencil information to the argument list associated with the</span></div><div class="line"><a name="l06077"></a><span class="lineno"> 6077</span>&#160;<span class="stringliteral">        argument &#39;arg&#39; if the direction is unknown&#39;&#39;&#39;</span></div><div class="line"><a name="l06078"></a><span class="lineno"> 6078</span>&#160;        <span class="comment"># the direction of the stencil is not known so pass the value in</span></div><div class="line"><a name="l06079"></a><span class="lineno"> 6079</span>&#160;        name = arg.stencil.direction_arg.varName</div><div class="line"><a name="l06080"></a><span class="lineno"> 6080</span>&#160;        self._arglist.append(name)</div><div class="line"><a name="l06081"></a><span class="lineno"> 6081</span>&#160;</div><div class="line"><a name="l06082"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a0eecf229788497b63a60667ba414b2f3"> 6082</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a0eecf229788497b63a60667ba414b2f3">stencil</a>(self, arg):</div><div class="line"><a name="l06083"></a><span class="lineno"> 6083</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;add general stencil information associated with the argument &#39;arg&#39;</span></div><div class="line"><a name="l06084"></a><span class="lineno"> 6084</span>&#160;<span class="stringliteral">        to the argument list&#39;&#39;&#39;</span></div><div class="line"><a name="l06085"></a><span class="lineno"> 6085</span>&#160;        <span class="comment"># add in stencil dofmap</span></div><div class="line"><a name="l06086"></a><span class="lineno"> 6086</span>&#160;        var_name = stencil_dofmap_name(arg)</div><div class="line"><a name="l06087"></a><span class="lineno"> 6087</span>&#160;        name = var_name + <span class="stringliteral">&quot;(:,:,&quot;</span> + self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a613fee118173f3682330e84bdfe3ae22">_cell_ref_name</a> + <span class="stringliteral">&quot;)&quot;</span></div><div class="line"><a name="l06088"></a><span class="lineno"> 6088</span>&#160;        self._arglist.append(name)</div><div class="line"><a name="l06089"></a><span class="lineno"> 6089</span>&#160;</div><div class="line"><a name="l06090"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a53a57b6588b7b5e1f97ffa05a6a2236e"> 6090</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a53a57b6588b7b5e1f97ffa05a6a2236e">operator</a>(self, arg):</div><div class="line"><a name="l06091"></a><span class="lineno"> 6091</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; add the operator arguments to the argument list &#39;&#39;&#39;</span></div><div class="line"><a name="l06092"></a><span class="lineno"> 6092</span>&#160;        <span class="comment"># TODO we should only be including ncell_3d once in the argument</span></div><div class="line"><a name="l06093"></a><span class="lineno"> 6093</span>&#160;        <span class="comment"># list but this adds it for every operator</span></div><div class="line"><a name="l06094"></a><span class="lineno"> 6094</span>&#160;        self._arglist.append(arg.proxy_name_indexed+<span class="stringliteral">&quot;%ncell_3d&quot;</span>)</div><div class="line"><a name="l06095"></a><span class="lineno"> 6095</span>&#160;        self._arglist.append(arg.proxy_name_indexed+<span class="stringliteral">&quot;%local_stencil&quot;</span>)</div><div class="line"><a name="l06096"></a><span class="lineno"> 6096</span>&#160;</div><div class="line"><a name="l06097"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a530c10416ddcf177d587f5fe2ec827e0"> 6097</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a530c10416ddcf177d587f5fe2ec827e0">cma_operator</a>(self, arg):</div><div class="line"><a name="l06098"></a><span class="lineno"> 6098</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; add the CMA operator and associated scalars to the argument</span></div><div class="line"><a name="l06099"></a><span class="lineno"> 6099</span>&#160;<span class="stringliteral">        list &#39;&#39;&#39;</span></div><div class="line"><a name="l06100"></a><span class="lineno"> 6100</span>&#160;        <span class="keywordflow">if</span> arg.function_space_to.orig_name != \</div><div class="line"><a name="l06101"></a><span class="lineno"> 6101</span>&#160;           arg.function_space_from.orig_name:</div><div class="line"><a name="l06102"></a><span class="lineno"> 6102</span>&#160;            components = [<span class="stringliteral">&quot;matrix&quot;</span>] + DynInvokeCMAOperators.cma_diff_fs_params</div><div class="line"><a name="l06103"></a><span class="lineno"> 6103</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l06104"></a><span class="lineno"> 6104</span>&#160;            components = [<span class="stringliteral">&quot;matrix&quot;</span>] + DynInvokeCMAOperators.cma_same_fs_params</div><div class="line"><a name="l06105"></a><span class="lineno"> 6105</span>&#160;        <span class="keywordflow">for</span> component <span class="keywordflow">in</span> components:</div><div class="line"><a name="l06106"></a><span class="lineno"> 6106</span>&#160;            self._arglist.append(</div><div class="line"><a name="l06107"></a><span class="lineno"> 6107</span>&#160;                self._name_space_manager.create_name(</div><div class="line"><a name="l06108"></a><span class="lineno"> 6108</span>&#160;                    root_name=arg.name+<span class="stringliteral">&quot;_&quot;</span>+component,</div><div class="line"><a name="l06109"></a><span class="lineno"> 6109</span>&#160;                    context=<span class="stringliteral">&quot;PSyVars&quot;</span>,</div><div class="line"><a name="l06110"></a><span class="lineno"> 6110</span>&#160;                    label=arg.name+<span class="stringliteral">&quot;_&quot;</span>+component))</div><div class="line"><a name="l06111"></a><span class="lineno"> 6111</span>&#160;</div><div class="line"><a name="l06112"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a8bd6ce847f70c29aa2f080e4285f48a1"> 6112</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a8bd6ce847f70c29aa2f080e4285f48a1">scalar</a>(self, scalar_arg):</div><div class="line"><a name="l06113"></a><span class="lineno"> 6113</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;add the name associated with the scalar argument to the argument</span></div><div class="line"><a name="l06114"></a><span class="lineno"> 6114</span>&#160;<span class="stringliteral">        list&#39;&#39;&#39;</span></div><div class="line"><a name="l06115"></a><span class="lineno"> 6115</span>&#160;        self._arglist.append(scalar_arg.name)</div><div class="line"><a name="l06116"></a><span class="lineno"> 6116</span>&#160;</div><div class="line"><a name="l06117"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#ad3a8e049c6ecafa838d4c3836a442e49"> 6117</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#ad3a8e049c6ecafa838d4c3836a442e49">fs_common</a>(self, function_space):</div><div class="line"><a name="l06118"></a><span class="lineno"> 6118</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;add function-space related arguments common to LMA operators and</span></div><div class="line"><a name="l06119"></a><span class="lineno"> 6119</span>&#160;<span class="stringliteral">        fields&#39;&#39;&#39;</span></div><div class="line"><a name="l06120"></a><span class="lineno"> 6120</span>&#160;        <span class="comment"># There is currently one argument: &quot;ndf&quot;</span></div><div class="line"><a name="l06121"></a><span class="lineno"> 6121</span>&#160;        ndf_name = get_fs_ndf_name(function_space)</div><div class="line"><a name="l06122"></a><span class="lineno"> 6122</span>&#160;        self._arglist.append(ndf_name)</div><div class="line"><a name="l06123"></a><span class="lineno"> 6123</span>&#160;</div><div class="line"><a name="l06124"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a15bcf32a9c8ca47c6f2d074e4babaf2a"> 6124</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a15bcf32a9c8ca47c6f2d074e4babaf2a">fs_compulsory_field</a>(self, function_space):</div><div class="line"><a name="l06125"></a><span class="lineno"> 6125</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;add compulsory arguments to the argument list, when there is a</span></div><div class="line"><a name="l06126"></a><span class="lineno"> 6126</span>&#160;<span class="stringliteral">        field on this function space&#39;&#39;&#39;</span></div><div class="line"><a name="l06127"></a><span class="lineno"> 6127</span>&#160;        undf_name = get_fs_undf_name(function_space)</div><div class="line"><a name="l06128"></a><span class="lineno"> 6128</span>&#160;        self._arglist.append(undf_name)</div><div class="line"><a name="l06129"></a><span class="lineno"> 6129</span>&#160;        map_name = get_fs_map_name(function_space)</div><div class="line"><a name="l06130"></a><span class="lineno"> 6130</span>&#160;        self._arglist.append(map_name+<span class="stringliteral">&quot;(:,&quot;</span>+self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a613fee118173f3682330e84bdfe3ae22">_cell_ref_name</a>+<span class="stringliteral">&quot;)&quot;</span>)</div><div class="line"><a name="l06131"></a><span class="lineno"> 6131</span>&#160;</div><div class="line"><a name="l06132"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a4e41295640272645f6b3e5eb71a7bd3e"> 6132</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a4e41295640272645f6b3e5eb71a7bd3e">fs_intergrid</a>(self, function_space):</div><div class="line"><a name="l06133"></a><span class="lineno"> 6133</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l06134"></a><span class="lineno"> 6134</span>&#160;<span class="stringliteral">        Add function-space related arguments for an intergrid kernel</span></div><div class="line"><a name="l06135"></a><span class="lineno"> 6135</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l06136"></a><span class="lineno"> 6136</span>&#160;<span class="stringliteral">        :param function_space: the function space for which to add arguments</span></div><div class="line"><a name="l06137"></a><span class="lineno"> 6137</span>&#160;<span class="stringliteral">        :type function_space: :py:class:`psyclone.dynamo0p3.FunctionSpace`</span></div><div class="line"><a name="l06138"></a><span class="lineno"> 6138</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l06139"></a><span class="lineno"> 6139</span>&#160;        <span class="comment"># Is this FS associated with the coarse or fine mesh? (All fields</span></div><div class="line"><a name="l06140"></a><span class="lineno"> 6140</span>&#160;        <span class="comment"># on a given mesh must be on the same FS.)</span></div><div class="line"><a name="l06141"></a><span class="lineno"> 6141</span>&#160;        arg = self._kern.arguments.get_arg_on_space(function_space)</div><div class="line"><a name="l06142"></a><span class="lineno"> 6142</span>&#160;        <span class="keywordflow">if</span> arg.mesh == <span class="stringliteral">&quot;gh_fine&quot;</span>:</div><div class="line"><a name="l06143"></a><span class="lineno"> 6143</span>&#160;            <span class="comment"># For the fine mesh, we need ndf, undf and the *whole*</span></div><div class="line"><a name="l06144"></a><span class="lineno"> 6144</span>&#160;            <span class="comment"># dofmap</span></div><div class="line"><a name="l06145"></a><span class="lineno"> 6145</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a3f8c25a562a08acb6558af724105f611">fs_common</a>(function_space)</div><div class="line"><a name="l06146"></a><span class="lineno"> 6146</span>&#160;            undf_name = get_fs_undf_name(function_space)</div><div class="line"><a name="l06147"></a><span class="lineno"> 6147</span>&#160;            self._arglist.append(undf_name)</div><div class="line"><a name="l06148"></a><span class="lineno"> 6148</span>&#160;            map_name = get_fs_map_name(function_space)</div><div class="line"><a name="l06149"></a><span class="lineno"> 6149</span>&#160;            self._arglist.append(map_name)</div><div class="line"><a name="l06150"></a><span class="lineno"> 6150</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l06151"></a><span class="lineno"> 6151</span>&#160;            <span class="comment"># For the coarse mesh we only need undf and the dofmap for</span></div><div class="line"><a name="l06152"></a><span class="lineno"> 6152</span>&#160;            <span class="comment"># the current column</span></div><div class="line"><a name="l06153"></a><span class="lineno"> 6153</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a931b962e11ff13ace2611a65abf24aa5">fs_compulsory_field</a>(function_space)</div><div class="line"><a name="l06154"></a><span class="lineno"> 6154</span>&#160;</div><div class="line"><a name="l06155"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#aab1e79d911d89b92deeb857573217193"> 6155</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#aab1e79d911d89b92deeb857573217193">basis</a>(self, function_space):</div><div class="line"><a name="l06156"></a><span class="lineno"> 6156</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l06157"></a><span class="lineno"> 6157</span>&#160;<span class="stringliteral">        Add basis function information for this function space to the</span></div><div class="line"><a name="l06158"></a><span class="lineno"> 6158</span>&#160;<span class="stringliteral">        argument list.</span></div><div class="line"><a name="l06159"></a><span class="lineno"> 6159</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l06160"></a><span class="lineno"> 6160</span>&#160;<span class="stringliteral">        :param function_space: the function space for which the basis \</span></div><div class="line"><a name="l06161"></a><span class="lineno"> 6161</span>&#160;<span class="stringliteral">                               function is required.</span></div><div class="line"><a name="l06162"></a><span class="lineno"> 6162</span>&#160;<span class="stringliteral">        :type function_space: :py:class:`psyclone.dynamo0p3.FunctionSpace`</span></div><div class="line"><a name="l06163"></a><span class="lineno"> 6163</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l06164"></a><span class="lineno"> 6164</span>&#160;        <span class="keywordflow">if</span> self._kern.qr_required:</div><div class="line"><a name="l06165"></a><span class="lineno"> 6165</span>&#160;            basis_name = get_fs_basis_name(function_space,</div><div class="line"><a name="l06166"></a><span class="lineno"> 6166</span>&#160;                                           qr_var=self._kern.qr_name)</div><div class="line"><a name="l06167"></a><span class="lineno"> 6167</span>&#160;            self._arglist.append(basis_name)</div><div class="line"><a name="l06168"></a><span class="lineno"> 6168</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l06169"></a><span class="lineno"> 6169</span>&#160;            <span class="comment"># We are dealing with an evaluator and therefore need as many</span></div><div class="line"><a name="l06170"></a><span class="lineno"> 6170</span>&#160;            <span class="comment"># basis functions as there are target function spaces.</span></div><div class="line"><a name="l06171"></a><span class="lineno"> 6171</span>&#160;            <span class="keywordflow">for</span> fs_name <span class="keywordflow">in</span> self._kern.eval_targets:</div><div class="line"><a name="l06172"></a><span class="lineno"> 6172</span>&#160;                <span class="comment"># The associated FunctionSpace object is the first item in</span></div><div class="line"><a name="l06173"></a><span class="lineno"> 6173</span>&#160;                <span class="comment"># the tuple dict entry associated with the name of the target</span></div><div class="line"><a name="l06174"></a><span class="lineno"> 6174</span>&#160;                <span class="comment"># function space</span></div><div class="line"><a name="l06175"></a><span class="lineno"> 6175</span>&#160;                fspace = self._kern.eval_targets[fs_name][0]</div><div class="line"><a name="l06176"></a><span class="lineno"> 6176</span>&#160;                basis_name = get_fs_basis_name(function_space,</div><div class="line"><a name="l06177"></a><span class="lineno"> 6177</span>&#160;                                               qr_var=self._kern.qr_name,</div><div class="line"><a name="l06178"></a><span class="lineno"> 6178</span>&#160;                                               on_space=fspace)</div><div class="line"><a name="l06179"></a><span class="lineno"> 6179</span>&#160;                self._arglist.append(basis_name)</div><div class="line"><a name="l06180"></a><span class="lineno"> 6180</span>&#160;</div><div class="line"><a name="l06181"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#aaaf6bbe54b3d5f2f77d2f9794a1cc28e"> 6181</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#aaaf6bbe54b3d5f2f77d2f9794a1cc28e">diff_basis</a>(self, function_space):</div><div class="line"><a name="l06182"></a><span class="lineno"> 6182</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l06183"></a><span class="lineno"> 6183</span>&#160;<span class="stringliteral">        Add differential basis information for the function space to the</span></div><div class="line"><a name="l06184"></a><span class="lineno"> 6184</span>&#160;<span class="stringliteral">        argument list.</span></div><div class="line"><a name="l06185"></a><span class="lineno"> 6185</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l06186"></a><span class="lineno"> 6186</span>&#160;<span class="stringliteral">        :param function_space: the function space for which the differential</span></div><div class="line"><a name="l06187"></a><span class="lineno"> 6187</span>&#160;<span class="stringliteral">                               basis functions are required</span></div><div class="line"><a name="l06188"></a><span class="lineno"> 6188</span>&#160;<span class="stringliteral">        :type function_space: :py:class:`psyclone.dynamo0p3.FunctionSpace`</span></div><div class="line"><a name="l06189"></a><span class="lineno"> 6189</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l06190"></a><span class="lineno"> 6190</span>&#160;        <span class="keywordflow">if</span> self._kern.qr_required:</div><div class="line"><a name="l06191"></a><span class="lineno"> 6191</span>&#160;            diff_basis_name = get_fs_diff_basis_name(</div><div class="line"><a name="l06192"></a><span class="lineno"> 6192</span>&#160;                function_space, qr_var=self._kern.qr_name)</div><div class="line"><a name="l06193"></a><span class="lineno"> 6193</span>&#160;            self._arglist.append(diff_basis_name)</div><div class="line"><a name="l06194"></a><span class="lineno"> 6194</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l06195"></a><span class="lineno"> 6195</span>&#160;            <span class="comment"># We are dealing with an evaluator and therefore need as many</span></div><div class="line"><a name="l06196"></a><span class="lineno"> 6196</span>&#160;            <span class="comment"># basis functions as there are target function spaces.</span></div><div class="line"><a name="l06197"></a><span class="lineno"> 6197</span>&#160;            <span class="keywordflow">for</span> fs_name <span class="keywordflow">in</span> self._kern.eval_targets:</div><div class="line"><a name="l06198"></a><span class="lineno"> 6198</span>&#160;                <span class="comment"># The associated FunctionSpace object is the first item in</span></div><div class="line"><a name="l06199"></a><span class="lineno"> 6199</span>&#160;                <span class="comment"># the tuple dict entry associated with the name of the target</span></div><div class="line"><a name="l06200"></a><span class="lineno"> 6200</span>&#160;                <span class="comment"># function space</span></div><div class="line"><a name="l06201"></a><span class="lineno"> 6201</span>&#160;                fspace = self._kern.eval_targets[fs_name][0]</div><div class="line"><a name="l06202"></a><span class="lineno"> 6202</span>&#160;                diff_basis_name = get_fs_diff_basis_name(</div><div class="line"><a name="l06203"></a><span class="lineno"> 6203</span>&#160;                    function_space, qr_var=self._kern.qr_name, on_space=fspace)</div><div class="line"><a name="l06204"></a><span class="lineno"> 6204</span>&#160;                self._arglist.append(diff_basis_name)</div><div class="line"><a name="l06205"></a><span class="lineno"> 6205</span>&#160;</div><div class="line"><a name="l06206"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a6f512993240280175cef8ed5d79da98d"> 6206</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a6f512993240280175cef8ed5d79da98d">orientation</a>(self, function_space):</div><div class="line"><a name="l06207"></a><span class="lineno"> 6207</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;add orientation information for this function space to the</span></div><div class="line"><a name="l06208"></a><span class="lineno"> 6208</span>&#160;<span class="stringliteral">        argument list&#39;&#39;&#39;</span></div><div class="line"><a name="l06209"></a><span class="lineno"> 6209</span>&#160;        orientation_name = get_fs_orientation_name(function_space)</div><div class="line"><a name="l06210"></a><span class="lineno"> 6210</span>&#160;        self._arglist.append(orientation_name)</div><div class="line"><a name="l06211"></a><span class="lineno"> 6211</span>&#160;</div><div class="line"><a name="l06212"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a667ecc9acd9ace58d801b4eb3f5fbe64"> 6212</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a667ecc9acd9ace58d801b4eb3f5fbe64">field_bcs_kernel</a>(self, function_space):</div><div class="line"><a name="l06213"></a><span class="lineno"> 6213</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; implement the boundary_dofs array fix for a field &#39;&#39;&#39;</span></div><div class="line"><a name="l06214"></a><span class="lineno"> 6214</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> DeclGen, AssignGen</div><div class="line"><a name="l06215"></a><span class="lineno"> 6215</span>&#160;        self._arglist.append(<span class="stringliteral">&quot;boundary_dofs&quot;</span>)</div><div class="line"><a name="l06216"></a><span class="lineno"> 6216</span>&#160;        parent = self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a284163a34aa8727b033aba2cc14af970">_parent</a></div><div class="line"><a name="l06217"></a><span class="lineno"> 6217</span>&#160;        parent.add(DeclGen(parent, datatype=<span class="stringliteral">&quot;integer&quot;</span>,</div><div class="line"><a name="l06218"></a><span class="lineno"> 6218</span>&#160;                           pointer=<span class="keyword">True</span>, entity_decls=[</div><div class="line"><a name="l06219"></a><span class="lineno"> 6219</span>&#160;                               <span class="stringliteral">&quot;boundary_dofs(:,:) =&gt; null()&quot;</span>]))</div><div class="line"><a name="l06220"></a><span class="lineno"> 6220</span>&#160;        fspace = <span class="keywordtype">None</span></div><div class="line"><a name="l06221"></a><span class="lineno"> 6221</span>&#160;        <span class="keywordflow">for</span> fspace <span class="keywordflow">in</span> self._kern.arguments.unique_fss:</div><div class="line"><a name="l06222"></a><span class="lineno"> 6222</span>&#160;            <span class="keywordflow">if</span> fspace.orig_name == <span class="stringliteral">&quot;any_space_1&quot;</span>:</div><div class="line"><a name="l06223"></a><span class="lineno"> 6223</span>&#160;                <span class="keywordflow">break</span></div><div class="line"><a name="l06224"></a><span class="lineno"> 6224</span>&#160;        farg = self._kern.arguments.get_arg_on_space(fspace)</div><div class="line"><a name="l06225"></a><span class="lineno"> 6225</span>&#160;        <span class="comment"># Sanity check - expect the enforce_bc_code kernel to only have</span></div><div class="line"><a name="l06226"></a><span class="lineno"> 6226</span>&#160;        <span class="comment"># a field argument.</span></div><div class="line"><a name="l06227"></a><span class="lineno"> 6227</span>&#160;        <span class="keywordflow">if</span> farg.type != <span class="stringliteral">&quot;gh_field&quot;</span>:</div><div class="line"><a name="l06228"></a><span class="lineno"> 6228</span>&#160;            <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l06229"></a><span class="lineno"> 6229</span>&#160;                <span class="stringliteral">&quot;Expected a gh_field from which to look-up boundary dofs &quot;</span></div><div class="line"><a name="l06230"></a><span class="lineno"> 6230</span>&#160;                <span class="stringliteral">&quot;for kernel {0} but got {1}&quot;</span>.format(self._kern.name,</div><div class="line"><a name="l06231"></a><span class="lineno"> 6231</span>&#160;                                                    farg.type))</div><div class="line"><a name="l06232"></a><span class="lineno"> 6232</span>&#160;        new_parent, position = parent.start_parent_loop()</div><div class="line"><a name="l06233"></a><span class="lineno"> 6233</span>&#160;        new_parent.add(AssignGen(new_parent, pointer=<span class="keyword">True</span>,</div><div class="line"><a name="l06234"></a><span class="lineno"> 6234</span>&#160;                                 lhs=<span class="stringliteral">&quot;boundary_dofs&quot;</span>,</div><div class="line"><a name="l06235"></a><span class="lineno"> 6235</span>&#160;                                 rhs=farg.proxy_name +</div><div class="line"><a name="l06236"></a><span class="lineno"> 6236</span>&#160;                                 <span class="stringliteral">&quot;%vspace%get_boundary_dofs()&quot;</span>),</div><div class="line"><a name="l06237"></a><span class="lineno"> 6237</span>&#160;                       position=[<span class="stringliteral">&quot;before&quot;</span>, position])</div><div class="line"><a name="l06238"></a><span class="lineno"> 6238</span>&#160;</div><div class="line"><a name="l06239"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#ae335919033fb2dc35b9f87b39fdc0906"> 6239</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#ae335919033fb2dc35b9f87b39fdc0906">operator_bcs_kernel</a>(self, function_space):</div><div class="line"><a name="l06240"></a><span class="lineno"> 6240</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Supply necessary additional arguments for the kernel that</span></div><div class="line"><a name="l06241"></a><span class="lineno"> 6241</span>&#160;<span class="stringliteral">        applies boundary conditions to a LMA operator &#39;&#39;&#39;</span></div><div class="line"><a name="l06242"></a><span class="lineno"> 6242</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> DeclGen, AssignGen</div><div class="line"><a name="l06243"></a><span class="lineno"> 6243</span>&#160;        <span class="comment"># This kernel has only a single LMA operator as argument.</span></div><div class="line"><a name="l06244"></a><span class="lineno"> 6244</span>&#160;        <span class="comment"># Checks for this are performed in ArgOrdering.generate()</span></div><div class="line"><a name="l06245"></a><span class="lineno"> 6245</span>&#160;        op_arg = self._kern.arguments.args[0]</div><div class="line"><a name="l06246"></a><span class="lineno"> 6246</span>&#160;        self._arglist.append(<span class="stringliteral">&quot;boundary_dofs&quot;</span>)</div><div class="line"><a name="l06247"></a><span class="lineno"> 6247</span>&#160;        parent = self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a284163a34aa8727b033aba2cc14af970">_parent</a></div><div class="line"><a name="l06248"></a><span class="lineno"> 6248</span>&#160;        parent.add(DeclGen(parent, datatype=<span class="stringliteral">&quot;integer&quot;</span>,</div><div class="line"><a name="l06249"></a><span class="lineno"> 6249</span>&#160;                           pointer=<span class="keyword">True</span>, entity_decls=[</div><div class="line"><a name="l06250"></a><span class="lineno"> 6250</span>&#160;                               <span class="stringliteral">&quot;boundary_dofs(:,:) =&gt; null()&quot;</span>]))</div><div class="line"><a name="l06251"></a><span class="lineno"> 6251</span>&#160;        new_parent, position = parent.start_parent_loop()</div><div class="line"><a name="l06252"></a><span class="lineno"> 6252</span>&#160;        new_parent.add(AssignGen(new_parent, pointer=<span class="keyword">True</span>,</div><div class="line"><a name="l06253"></a><span class="lineno"> 6253</span>&#160;                                 lhs=<span class="stringliteral">&quot;boundary_dofs&quot;</span>,</div><div class="line"><a name="l06254"></a><span class="lineno"> 6254</span>&#160;                                 rhs=op_arg.proxy_name +</div><div class="line"><a name="l06255"></a><span class="lineno"> 6255</span>&#160;                                 <span class="stringliteral">&quot;%fs_to%get_boundary_dofs()&quot;</span>),</div><div class="line"><a name="l06256"></a><span class="lineno"> 6256</span>&#160;                       position=[<span class="stringliteral">&quot;before&quot;</span>, position])</div><div class="line"><a name="l06257"></a><span class="lineno"> 6257</span>&#160;</div><div class="line"><a name="l06258"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a40f165860d73d66ee3315dc1613b256e"> 6258</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a40f165860d73d66ee3315dc1613b256e">quad_rule</a>(self):</div><div class="line"><a name="l06259"></a><span class="lineno"> 6259</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; add qr information to the argument list&#39;&#39;&#39;</span></div><div class="line"><a name="l06260"></a><span class="lineno"> 6260</span>&#160;        self._arglist.extend(self._kern.qr_args)</div><div class="line"><a name="l06261"></a><span class="lineno"> 6261</span>&#160;</div><div class="line"><a name="l06262"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a6b9f5b1e8bf7a57bb14aaa36d69218ba"> 6262</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a6b9f5b1e8bf7a57bb14aaa36d69218ba">banded_dofmap</a>(self, function_space):</div><div class="line"><a name="l06263"></a><span class="lineno"> 6263</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Add banded dofmap (required for CMA operator assembly) &#39;&#39;&#39;</span></div><div class="line"><a name="l06264"></a><span class="lineno"> 6264</span>&#160;        <span class="comment"># Note that the necessary ndf values will already have been added</span></div><div class="line"><a name="l06265"></a><span class="lineno"> 6265</span>&#160;        <span class="comment"># to the argument list as they are mandatory for every function</span></div><div class="line"><a name="l06266"></a><span class="lineno"> 6266</span>&#160;        <span class="comment"># space that appears in the meta-data.</span></div><div class="line"><a name="l06267"></a><span class="lineno"> 6267</span>&#160;        self._arglist.append(get_cbanded_map_name(function_space))</div><div class="line"><a name="l06268"></a><span class="lineno"> 6268</span>&#160;</div><div class="line"><a name="l06269"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a833e00d6b4964a64ef9bbe0f91ff2076"> 6269</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a833e00d6b4964a64ef9bbe0f91ff2076">indirection_dofmap</a>(self, function_space, operator=None):</div><div class="line"><a name="l06270"></a><span class="lineno"> 6270</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Add indirection dofmap required when applying a CMA operator &#39;&#39;&#39;</span></div><div class="line"><a name="l06271"></a><span class="lineno"> 6271</span>&#160;        self._arglist.append(get_cma_indirection_map_name(function_space))</div><div class="line"><a name="l06272"></a><span class="lineno"> 6272</span>&#160;</div><div class="line"><a name="l06273"></a><span class="lineno"> 6273</span>&#160;    @property</div><div class="line"><a name="l06274"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#aa881eb303b8899914b1966e5d3d5281c"> 6274</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#aa881eb303b8899914b1966e5d3d5281c">arglist</a>(self):</div><div class="line"><a name="l06275"></a><span class="lineno"> 6275</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l06276"></a><span class="lineno"> 6276</span>&#160;<span class="stringliteral">        :return: the kernel argument list. The generate function must be \</span></div><div class="line"><a name="l06277"></a><span class="lineno"> 6277</span>&#160;<span class="stringliteral">                 called first.</span></div><div class="line"><a name="l06278"></a><span class="lineno"> 6278</span>&#160;<span class="stringliteral">        :rtype: list of str.</span></div><div class="line"><a name="l06279"></a><span class="lineno"> 6279</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l06280"></a><span class="lineno"> 6280</span>&#160;<span class="stringliteral">        :raises GenerationError: if the argument list is empty.</span></div><div class="line"><a name="l06281"></a><span class="lineno"> 6281</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l06282"></a><span class="lineno"> 6282</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#afce3f4d66984e336db84826a6e5e2701">_arglist</a>:</div><div class="line"><a name="l06283"></a><span class="lineno"> 6283</span>&#160;            <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l06284"></a><span class="lineno"> 6284</span>&#160;                <span class="stringliteral">&quot;Internal error. The argument list in KernCallArgList:&quot;</span></div><div class="line"><a name="l06285"></a><span class="lineno"> 6285</span>&#160;                <span class="stringliteral">&quot;arglist() is empty. Has the generate() method been called?&quot;</span>)</div><div class="line"><a name="l06286"></a><span class="lineno"> 6286</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#afce3f4d66984e336db84826a6e5e2701">_arglist</a></div><div class="line"><a name="l06287"></a><span class="lineno"> 6287</span>&#160;</div><div class="line"><a name="l06288"></a><span class="lineno"> 6288</span>&#160;    @property</div><div class="line"><a name="l06289"></a><span class="lineno"> 6289</span>&#160;    <span class="keyword">def </span>_cell_ref_name(self):</div><div class="line"><a name="l06290"></a><span class="lineno"> 6290</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l06291"></a><span class="lineno"> 6291</span>&#160;<span class="stringliteral">        Utility routine which determines whether to return the cell value</span></div><div class="line"><a name="l06292"></a><span class="lineno"> 6292</span>&#160;<span class="stringliteral">        or the colourmap lookup value.</span></div><div class="line"><a name="l06293"></a><span class="lineno"> 6293</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l06294"></a><span class="lineno"> 6294</span>&#160;<span class="stringliteral">        :returns: the Fortran code needed to access the current cell index.</span></div><div class="line"><a name="l06295"></a><span class="lineno"> 6295</span>&#160;<span class="stringliteral">        :rtype: str</span></div><div class="line"><a name="l06296"></a><span class="lineno"> 6296</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l06297"></a><span class="lineno"> 6297</span>&#160;        <span class="keywordflow">if</span> self._kern.is_coloured():</div><div class="line"><a name="l06298"></a><span class="lineno"> 6298</span>&#160;            <span class="keywordflow">return</span> self._kern.colourmap + <span class="stringliteral">&quot;(colour, cell)&quot;</span></div><div class="line"><a name="l06299"></a><span class="lineno"> 6299</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;cell&quot;</span></div><div class="line"><a name="l06300"></a><span class="lineno"> 6300</span>&#160;</div><div class="line"><a name="l06301"></a><span class="lineno"> 6301</span>&#160;</div><div class="line"><a name="l06302"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html"> 6302</a></span>&#160;<span class="keyword">class </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html">KernStubArgList</a>(<a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html">ArgOrdering</a>):</div><div class="line"><a name="l06303"></a><span class="lineno"> 6303</span>&#160;    <span class="stringliteral">&#39;&#39;&#39;Creates the argument list required to create and declare the</span></div><div class="line"><a name="l06304"></a><span class="lineno"> 6304</span>&#160;<span class="stringliteral">    required arguments for a kernel subroutine.  The ordering and type</span></div><div class="line"><a name="l06305"></a><span class="lineno"> 6305</span>&#160;<span class="stringliteral">    of the arguments is captured by the base class &#39;&#39;&#39;</span></div><div class="line"><a name="l06306"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a3fd82a49fc82f8f816c7203f0c33e27a"> 6306</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a3fd82a49fc82f8f816c7203f0c33e27a">__init__</a>(self, kern, parent):</div><div class="line"><a name="l06307"></a><span class="lineno"> 6307</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l06308"></a><span class="lineno"> 6308</span>&#160;<span class="stringliteral">        :param kern: Kernel for which to create argument list</span></div><div class="line"><a name="l06309"></a><span class="lineno"> 6309</span>&#160;<span class="stringliteral">        :type kern: :py:class:`psyclone.dynamo0p3.DynKern`</span></div><div class="line"><a name="l06310"></a><span class="lineno"> 6310</span>&#160;<span class="stringliteral">        :param parent: Parent subroutine which calls the kernel</span></div><div class="line"><a name="l06311"></a><span class="lineno"> 6311</span>&#160;<span class="stringliteral">        :type parent: :py:class:`psyclone.f2pygen.SubroutineGen`</span></div><div class="line"><a name="l06312"></a><span class="lineno"> 6312</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l06313"></a><span class="lineno"> 6313</span>&#160;<span class="stringliteral">        :raises NotImplementedError: if kernel is inter-grid</span></div><div class="line"><a name="l06314"></a><span class="lineno"> 6314</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l06315"></a><span class="lineno"> 6315</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> UseGen</div><div class="line"><a name="l06316"></a><span class="lineno"> 6316</span>&#160;</div><div class="line"><a name="l06317"></a><span class="lineno"> 6317</span>&#160;        <span class="comment"># We don&#39;t yet support inter-grid kernels (Issue #162)</span></div><div class="line"><a name="l06318"></a><span class="lineno"> 6318</span>&#160;        <span class="keywordflow">if</span> kern.is_intergrid:</div><div class="line"><a name="l06319"></a><span class="lineno"> 6319</span>&#160;            <span class="keywordflow">raise</span> NotImplementedError(</div><div class="line"><a name="l06320"></a><span class="lineno"> 6320</span>&#160;                <span class="stringliteral">&quot;Kernel {0} is an inter-grid kernel and stub generation &quot;</span></div><div class="line"><a name="l06321"></a><span class="lineno"> 6321</span>&#160;                <span class="stringliteral">&quot;is not yet supported for inter-grid kernels&quot;</span>.</div><div class="line"><a name="l06322"></a><span class="lineno"> 6322</span>&#160;                format(kern.name))</div><div class="line"><a name="l06323"></a><span class="lineno"> 6323</span>&#160;</div><div class="line"><a name="l06324"></a><span class="lineno"> 6324</span>&#160;        parent.add(UseGen(parent, name=<span class="stringliteral">&quot;constants_mod&quot;</span>, only=<span class="keyword">True</span>,</div><div class="line"><a name="l06325"></a><span class="lineno"> 6325</span>&#160;                          funcnames=[<span class="stringliteral">&quot;r_def&quot;</span>]))</div><div class="line"><a name="l06326"></a><span class="lineno"> 6326</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#ad399778e0a713e715cc9b90e923bc17f">_first_arg</a> = <span class="keyword">True</span></div><div class="line"><a name="l06327"></a><span class="lineno"> 6327</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a8dc2d43aad4fa2edb207a43e932eaf2e">_first_arg_decl</a> = <span class="keywordtype">None</span></div><div class="line"><a name="l06328"></a><span class="lineno"> 6328</span>&#160;        ArgOrdering.__init__(self, kern)</div><div class="line"><a name="l06329"></a><span class="lineno"> 6329</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a86b4a6b6d644e586a1765e1a6eaa52a1">_parent</a> = parent</div><div class="line"><a name="l06330"></a><span class="lineno"> 6330</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a4633caa757c0d32c33891f38dce70190">_arglist</a> = []</div><div class="line"><a name="l06331"></a><span class="lineno"> 6331</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a2fef742e087cd53b83c9daec7e843e5a">_name_space_manager</a> = NameSpaceFactory().create()</div><div class="line"><a name="l06332"></a><span class="lineno"> 6332</span>&#160;</div><div class="line"><a name="l06333"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a81a43c342c431084e11e48b5609a638a"> 6333</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a81a43c342c431084e11e48b5609a638a">cell_position</a>(self):</div><div class="line"><a name="l06334"></a><span class="lineno"> 6334</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Add cell position to the argument list if required &#39;&#39;&#39;</span></div><div class="line"><a name="l06335"></a><span class="lineno"> 6335</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> DeclGen</div><div class="line"><a name="l06336"></a><span class="lineno"> 6336</span>&#160;        self._arglist.append(<span class="stringliteral">&quot;cell&quot;</span>)</div><div class="line"><a name="l06337"></a><span class="lineno"> 6337</span>&#160;        self._parent.add(DeclGen(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a86b4a6b6d644e586a1765e1a6eaa52a1">_parent</a>, datatype=<span class="stringliteral">&quot;integer&quot;</span>, intent=<span class="stringliteral">&quot;in&quot;</span>,</div><div class="line"><a name="l06338"></a><span class="lineno"> 6338</span>&#160;                                 entity_decls=[<span class="stringliteral">&quot;cell&quot;</span>]))</div><div class="line"><a name="l06339"></a><span class="lineno"> 6339</span>&#160;</div><div class="line"><a name="l06340"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a066c27936d2d59fdda935ba57bb3aa44"> 6340</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a066c27936d2d59fdda935ba57bb3aa44">mesh_height</a>(self):</div><div class="line"><a name="l06341"></a><span class="lineno"> 6341</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; add mesh height (nlayers) to the argument list if required &#39;&#39;&#39;</span></div><div class="line"><a name="l06342"></a><span class="lineno"> 6342</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> DeclGen</div><div class="line"><a name="l06343"></a><span class="lineno"> 6343</span>&#160;        self._arglist.append(<span class="stringliteral">&quot;nlayers&quot;</span>)</div><div class="line"><a name="l06344"></a><span class="lineno"> 6344</span>&#160;        self._parent.add(DeclGen(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a86b4a6b6d644e586a1765e1a6eaa52a1">_parent</a>, datatype=<span class="stringliteral">&quot;integer&quot;</span>, intent=<span class="stringliteral">&quot;in&quot;</span>,</div><div class="line"><a name="l06345"></a><span class="lineno"> 6345</span>&#160;                                 entity_decls=[<span class="stringliteral">&quot;nlayers&quot;</span>]))</div><div class="line"><a name="l06346"></a><span class="lineno"> 6346</span>&#160;</div><div class="line"><a name="l06347"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a27776e4128b99642df7498d0fe2f2ca6"> 6347</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a27776e4128b99642df7498d0fe2f2ca6">mesh_ncell2d</a>(self):</div><div class="line"><a name="l06348"></a><span class="lineno"> 6348</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Add the number of columns in the mesh to the argument list if</span></div><div class="line"><a name="l06349"></a><span class="lineno"> 6349</span>&#160;<span class="stringliteral">        required &#39;&#39;&#39;</span></div><div class="line"><a name="l06350"></a><span class="lineno"> 6350</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> DeclGen</div><div class="line"><a name="l06351"></a><span class="lineno"> 6351</span>&#160;        self._arglist.append(<span class="stringliteral">&quot;ncell_2d&quot;</span>)</div><div class="line"><a name="l06352"></a><span class="lineno"> 6352</span>&#160;        self._parent.add(DeclGen(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a86b4a6b6d644e586a1765e1a6eaa52a1">_parent</a>, datatype=<span class="stringliteral">&quot;integer&quot;</span>, intent=<span class="stringliteral">&quot;in&quot;</span>,</div><div class="line"><a name="l06353"></a><span class="lineno"> 6353</span>&#160;                                 entity_decls=[<span class="stringliteral">&quot;ncell_2d&quot;</span>]))</div><div class="line"><a name="l06354"></a><span class="lineno"> 6354</span>&#160;</div><div class="line"><a name="l06355"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a0b883e83313b6ee23d6ab63b79027f1c"> 6355</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a0b883e83313b6ee23d6ab63b79027f1c">field_vector</a>(self, argvect):</div><div class="line"><a name="l06356"></a><span class="lineno"> 6356</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;add the field vector associated with the argument &#39;argvect&#39; to the</span></div><div class="line"><a name="l06357"></a><span class="lineno"> 6357</span>&#160;<span class="stringliteral">        argument list &#39;&#39;&#39;</span></div><div class="line"><a name="l06358"></a><span class="lineno"> 6358</span>&#160;        undf_name = get_fs_undf_name(argvect.function_space)</div><div class="line"><a name="l06359"></a><span class="lineno"> 6359</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> DeclGen</div><div class="line"><a name="l06360"></a><span class="lineno"> 6360</span>&#160;        <span class="comment"># the range function below returns values from</span></div><div class="line"><a name="l06361"></a><span class="lineno"> 6361</span>&#160;        <span class="comment"># 1 to the vector size which is what we</span></div><div class="line"><a name="l06362"></a><span class="lineno"> 6362</span>&#160;        <span class="comment"># require in our Fortran code</span></div><div class="line"><a name="l06363"></a><span class="lineno"> 6363</span>&#160;        <span class="keywordflow">for</span> idx <span class="keywordflow">in</span> range(1, argvect.vector_size+1):</div><div class="line"><a name="l06364"></a><span class="lineno"> 6364</span>&#160;            text = (argvect.name + <span class="stringliteral">&quot;_&quot;</span> +</div><div class="line"><a name="l06365"></a><span class="lineno"> 6365</span>&#160;                    argvect.function_space.mangled_name +</div><div class="line"><a name="l06366"></a><span class="lineno"> 6366</span>&#160;                    <span class="stringliteral">&quot;_v&quot;</span> + str(idx))</div><div class="line"><a name="l06367"></a><span class="lineno"> 6367</span>&#160;            intent = argvect.intent</div><div class="line"><a name="l06368"></a><span class="lineno"> 6368</span>&#160;            decl = DeclGen(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a86b4a6b6d644e586a1765e1a6eaa52a1">_parent</a>, datatype=<span class="stringliteral">&quot;real&quot;</span>,</div><div class="line"><a name="l06369"></a><span class="lineno"> 6369</span>&#160;                           kind=<span class="stringliteral">&quot;r_def&quot;</span>, dimension=undf_name,</div><div class="line"><a name="l06370"></a><span class="lineno"> 6370</span>&#160;                           intent=intent, entity_decls=[text])</div><div class="line"><a name="l06371"></a><span class="lineno"> 6371</span>&#160;            self._parent.add(decl)</div><div class="line"><a name="l06372"></a><span class="lineno"> 6372</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#ad399778e0a713e715cc9b90e923bc17f">_first_arg</a>:</div><div class="line"><a name="l06373"></a><span class="lineno"> 6373</span>&#160;                self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#ad399778e0a713e715cc9b90e923bc17f">_first_arg</a> = <span class="keyword">False</span></div><div class="line"><a name="l06374"></a><span class="lineno"> 6374</span>&#160;                self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a8dc2d43aad4fa2edb207a43e932eaf2e">_first_arg_decl</a> = decl</div><div class="line"><a name="l06375"></a><span class="lineno"> 6375</span>&#160;            self._arglist.append(text)</div><div class="line"><a name="l06376"></a><span class="lineno"> 6376</span>&#160;</div><div class="line"><a name="l06377"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a9cbadd7fa67eec8057a3b63e2761990f"> 6377</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a9cbadd7fa67eec8057a3b63e2761990f">field</a>(self, arg):</div><div class="line"><a name="l06378"></a><span class="lineno"> 6378</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;add the field associated with the argument &#39;arg&#39; to the argument</span></div><div class="line"><a name="l06379"></a><span class="lineno"> 6379</span>&#160;<span class="stringliteral">        list&#39;&#39;&#39;</span></div><div class="line"><a name="l06380"></a><span class="lineno"> 6380</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> DeclGen</div><div class="line"><a name="l06381"></a><span class="lineno"> 6381</span>&#160;        undf_name = get_fs_undf_name(arg.function_space)</div><div class="line"><a name="l06382"></a><span class="lineno"> 6382</span>&#160;        text = arg.name + <span class="stringliteral">&quot;_&quot;</span> + arg.function_space.mangled_name</div><div class="line"><a name="l06383"></a><span class="lineno"> 6383</span>&#160;        intent = arg.intent</div><div class="line"><a name="l06384"></a><span class="lineno"> 6384</span>&#160;        decl = DeclGen(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a86b4a6b6d644e586a1765e1a6eaa52a1">_parent</a>, datatype=<span class="stringliteral">&quot;real&quot;</span>,</div><div class="line"><a name="l06385"></a><span class="lineno"> 6385</span>&#160;                       kind=<span class="stringliteral">&quot;r_def&quot;</span>, dimension=undf_name,</div><div class="line"><a name="l06386"></a><span class="lineno"> 6386</span>&#160;                       intent=intent, entity_decls=[text])</div><div class="line"><a name="l06387"></a><span class="lineno"> 6387</span>&#160;        self._parent.add(decl)</div><div class="line"><a name="l06388"></a><span class="lineno"> 6388</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#ad399778e0a713e715cc9b90e923bc17f">_first_arg</a>:</div><div class="line"><a name="l06389"></a><span class="lineno"> 6389</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#ad399778e0a713e715cc9b90e923bc17f">_first_arg</a> = <span class="keyword">False</span></div><div class="line"><a name="l06390"></a><span class="lineno"> 6390</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a8dc2d43aad4fa2edb207a43e932eaf2e">_first_arg_decl</a> = decl</div><div class="line"><a name="l06391"></a><span class="lineno"> 6391</span>&#160;        self._arglist.append(text)</div><div class="line"><a name="l06392"></a><span class="lineno"> 6392</span>&#160;</div><div class="line"><a name="l06393"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#af31f3f3931446ab74a34e15c42311120"> 6393</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#af31f3f3931446ab74a34e15c42311120">stencil_unknown_extent</a>(self, arg):</div><div class="line"><a name="l06394"></a><span class="lineno"> 6394</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;add stencil information associated with the argument &#39;arg&#39; if the</span></div><div class="line"><a name="l06395"></a><span class="lineno"> 6395</span>&#160;<span class="stringliteral">        extent is unknown&#39;&#39;&#39;</span></div><div class="line"><a name="l06396"></a><span class="lineno"> 6396</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> DeclGen</div><div class="line"><a name="l06397"></a><span class="lineno"> 6397</span>&#160;        name = arg.name + <span class="stringliteral">&quot;_stencil_size&quot;</span></div><div class="line"><a name="l06398"></a><span class="lineno"> 6398</span>&#160;        self._parent.add(DeclGen(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a86b4a6b6d644e586a1765e1a6eaa52a1">_parent</a>, datatype=<span class="stringliteral">&quot;integer&quot;</span>, intent=<span class="stringliteral">&quot;in&quot;</span>,</div><div class="line"><a name="l06399"></a><span class="lineno"> 6399</span>&#160;                                 entity_decls=[name]))</div><div class="line"><a name="l06400"></a><span class="lineno"> 6400</span>&#160;        self._arglist.append(name)</div><div class="line"><a name="l06401"></a><span class="lineno"> 6401</span>&#160;</div><div class="line"><a name="l06402"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#af8c1491ab742fee68f0310774b94df26"> 6402</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#af8c1491ab742fee68f0310774b94df26">stencil_unknown_direction</a>(self, arg):</div><div class="line"><a name="l06403"></a><span class="lineno"> 6403</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;add stencil information associated with the argument &#39;arg&#39; if the</span></div><div class="line"><a name="l06404"></a><span class="lineno"> 6404</span>&#160;<span class="stringliteral">        direction is unknown&#39;&#39;&#39;</span></div><div class="line"><a name="l06405"></a><span class="lineno"> 6405</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> DeclGen</div><div class="line"><a name="l06406"></a><span class="lineno"> 6406</span>&#160;        name = arg.name+<span class="stringliteral">&quot;_direction&quot;</span></div><div class="line"><a name="l06407"></a><span class="lineno"> 6407</span>&#160;        self._parent.add(DeclGen(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a86b4a6b6d644e586a1765e1a6eaa52a1">_parent</a>, datatype=<span class="stringliteral">&quot;integer&quot;</span>, intent=<span class="stringliteral">&quot;in&quot;</span>,</div><div class="line"><a name="l06408"></a><span class="lineno"> 6408</span>&#160;                                 entity_decls=[name]))</div><div class="line"><a name="l06409"></a><span class="lineno"> 6409</span>&#160;        self._arglist.append(name)</div><div class="line"><a name="l06410"></a><span class="lineno"> 6410</span>&#160;</div><div class="line"><a name="l06411"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a3f6795073a041eed29f3cd2fd09d0c44"> 6411</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a3f6795073a041eed29f3cd2fd09d0c44">stencil</a>(self, arg):</div><div class="line"><a name="l06412"></a><span class="lineno"> 6412</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;add general stencil information associated with the argument</span></div><div class="line"><a name="l06413"></a><span class="lineno"> 6413</span>&#160;<span class="stringliteral">        &#39;arg&#39; &#39;&#39;&#39;</span></div><div class="line"><a name="l06414"></a><span class="lineno"> 6414</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> DeclGen</div><div class="line"><a name="l06415"></a><span class="lineno"> 6415</span>&#160;        name = arg.name+<span class="stringliteral">&quot;_stencil_map&quot;</span></div><div class="line"><a name="l06416"></a><span class="lineno"> 6416</span>&#160;        ndf_name = get_fs_ndf_name(arg.function_space)</div><div class="line"><a name="l06417"></a><span class="lineno"> 6417</span>&#160;        self._parent.add(DeclGen(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a86b4a6b6d644e586a1765e1a6eaa52a1">_parent</a>, datatype=<span class="stringliteral">&quot;integer&quot;</span>, intent=<span class="stringliteral">&quot;in&quot;</span>,</div><div class="line"><a name="l06418"></a><span class="lineno"> 6418</span>&#160;                                 dimension=<span class="stringliteral">&quot;,&quot;</span>.join(</div><div class="line"><a name="l06419"></a><span class="lineno"> 6419</span>&#160;                                     [ndf_name, arg.name + <span class="stringliteral">&quot;_stencil_size&quot;</span>]),</div><div class="line"><a name="l06420"></a><span class="lineno"> 6420</span>&#160;                                 entity_decls=[name]))</div><div class="line"><a name="l06421"></a><span class="lineno"> 6421</span>&#160;        self._arglist.append(name)</div><div class="line"><a name="l06422"></a><span class="lineno"> 6422</span>&#160;</div><div class="line"><a name="l06423"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a2a01a6225bf35142026939878c356c60"> 6423</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a2a01a6225bf35142026939878c356c60">operator</a>(self, arg):</div><div class="line"><a name="l06424"></a><span class="lineno"> 6424</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; add the operator arguments to the argument list &#39;&#39;&#39;</span></div><div class="line"><a name="l06425"></a><span class="lineno"> 6425</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> DeclGen</div><div class="line"><a name="l06426"></a><span class="lineno"> 6426</span>&#160;        size = arg.name + <span class="stringliteral">&quot;_ncell_3d&quot;</span></div><div class="line"><a name="l06427"></a><span class="lineno"> 6427</span>&#160;        self._arglist.append(size)</div><div class="line"><a name="l06428"></a><span class="lineno"> 6428</span>&#160;        decl = DeclGen(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a86b4a6b6d644e586a1765e1a6eaa52a1">_parent</a>, datatype=<span class="stringliteral">&quot;integer&quot;</span>, intent=<span class="stringliteral">&quot;in&quot;</span>,</div><div class="line"><a name="l06429"></a><span class="lineno"> 6429</span>&#160;                       entity_decls=[size])</div><div class="line"><a name="l06430"></a><span class="lineno"> 6430</span>&#160;        self._parent.add(decl)</div><div class="line"><a name="l06431"></a><span class="lineno"> 6431</span>&#160;        <span class="comment"># If this is the first argument in the kernel then keep a</span></div><div class="line"><a name="l06432"></a><span class="lineno"> 6432</span>&#160;        <span class="comment"># note so that we can put subsequent declarations in the</span></div><div class="line"><a name="l06433"></a><span class="lineno"> 6433</span>&#160;        <span class="comment"># correct location</span></div><div class="line"><a name="l06434"></a><span class="lineno"> 6434</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#ad399778e0a713e715cc9b90e923bc17f">_first_arg</a>:</div><div class="line"><a name="l06435"></a><span class="lineno"> 6435</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#ad399778e0a713e715cc9b90e923bc17f">_first_arg</a> = <span class="keyword">False</span></div><div class="line"><a name="l06436"></a><span class="lineno"> 6436</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a8dc2d43aad4fa2edb207a43e932eaf2e">_first_arg_decl</a> = decl</div><div class="line"><a name="l06437"></a><span class="lineno"> 6437</span>&#160;        text = arg.name</div><div class="line"><a name="l06438"></a><span class="lineno"> 6438</span>&#160;        self._arglist.append(text)</div><div class="line"><a name="l06439"></a><span class="lineno"> 6439</span>&#160;</div><div class="line"><a name="l06440"></a><span class="lineno"> 6440</span>&#160;        intent = arg.intent</div><div class="line"><a name="l06441"></a><span class="lineno"> 6441</span>&#160;        ndf_name_to = get_fs_ndf_name(arg.function_space_to)</div><div class="line"><a name="l06442"></a><span class="lineno"> 6442</span>&#160;        ndf_name_from = get_fs_ndf_name(arg.function_space_from)</div><div class="line"><a name="l06443"></a><span class="lineno"> 6443</span>&#160;        self._parent.add(DeclGen(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a86b4a6b6d644e586a1765e1a6eaa52a1">_parent</a>, datatype=<span class="stringliteral">&quot;real&quot;</span>, kind=<span class="stringliteral">&quot;r_def&quot;</span>,</div><div class="line"><a name="l06444"></a><span class="lineno"> 6444</span>&#160;                                 dimension=<span class="stringliteral">&quot;,&quot;</span>.join([ndf_name_to,</div><div class="line"><a name="l06445"></a><span class="lineno"> 6445</span>&#160;                                                     ndf_name_from, size]),</div><div class="line"><a name="l06446"></a><span class="lineno"> 6446</span>&#160;                                 intent=intent, entity_decls=[text]))</div><div class="line"><a name="l06447"></a><span class="lineno"> 6447</span>&#160;</div><div class="line"><a name="l06448"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a0955332570e208be3a21abadacee9cac"> 6448</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a0955332570e208be3a21abadacee9cac">cma_operator</a>(self, arg):</div><div class="line"><a name="l06449"></a><span class="lineno"> 6449</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; add the CMA operator arguments to the argument list &#39;&#39;&#39;</span></div><div class="line"><a name="l06450"></a><span class="lineno"> 6450</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> DeclGen</div><div class="line"><a name="l06451"></a><span class="lineno"> 6451</span>&#160;        <span class="comment"># The CMA operator itself</span></div><div class="line"><a name="l06452"></a><span class="lineno"> 6452</span>&#160;        self._arglist.append(arg.name)</div><div class="line"><a name="l06453"></a><span class="lineno"> 6453</span>&#160;        <span class="comment"># Associated scalar parameters</span></div><div class="line"><a name="l06454"></a><span class="lineno"> 6454</span>&#160;        nrow = arg.name + <span class="stringliteral">&quot;_nrow&quot;</span></div><div class="line"><a name="l06455"></a><span class="lineno"> 6455</span>&#160;        _local_args = [nrow]</div><div class="line"><a name="l06456"></a><span class="lineno"> 6456</span>&#160;        <span class="keywordflow">if</span> arg.function_space_to.orig_name != \</div><div class="line"><a name="l06457"></a><span class="lineno"> 6457</span>&#160;           arg.function_space_from.orig_name:</div><div class="line"><a name="l06458"></a><span class="lineno"> 6458</span>&#160;            <span class="comment"># If the to- and from-spaces are different then so are ncol and</span></div><div class="line"><a name="l06459"></a><span class="lineno"> 6459</span>&#160;            <span class="comment"># nrow so we pass both of them. If they are the same then we</span></div><div class="line"><a name="l06460"></a><span class="lineno"> 6460</span>&#160;            <span class="comment"># could pass either but choose to pass nrow and not ncol.</span></div><div class="line"><a name="l06461"></a><span class="lineno"> 6461</span>&#160;            ncol = arg.name + <span class="stringliteral">&quot;_ncol&quot;</span></div><div class="line"><a name="l06462"></a><span class="lineno"> 6462</span>&#160;            _local_args.append(ncol)</div><div class="line"><a name="l06463"></a><span class="lineno"> 6463</span>&#160;        bandwidth = arg.name + <span class="stringliteral">&quot;_bandwidth&quot;</span></div><div class="line"><a name="l06464"></a><span class="lineno"> 6464</span>&#160;        alpha = arg.name + <span class="stringliteral">&quot;_alpha&quot;</span></div><div class="line"><a name="l06465"></a><span class="lineno"> 6465</span>&#160;        beta = arg.name + <span class="stringliteral">&quot;_beta&quot;</span></div><div class="line"><a name="l06466"></a><span class="lineno"> 6466</span>&#160;        gamma_m = arg.name + <span class="stringliteral">&quot;_gamma_m&quot;</span></div><div class="line"><a name="l06467"></a><span class="lineno"> 6467</span>&#160;        gamma_p = arg.name + <span class="stringliteral">&quot;_gamma_p&quot;</span></div><div class="line"><a name="l06468"></a><span class="lineno"> 6468</span>&#160;        _local_args += [bandwidth, alpha, beta, gamma_m, gamma_p]</div><div class="line"><a name="l06469"></a><span class="lineno"> 6469</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a4633caa757c0d32c33891f38dce70190">_arglist</a> += _local_args</div><div class="line"><a name="l06470"></a><span class="lineno"> 6470</span>&#160;</div><div class="line"><a name="l06471"></a><span class="lineno"> 6471</span>&#160;        intent = arg.intent</div><div class="line"><a name="l06472"></a><span class="lineno"> 6472</span>&#160;        <span class="comment"># Declare the associated scalar arguments before the array because</span></div><div class="line"><a name="l06473"></a><span class="lineno"> 6473</span>&#160;        <span class="comment"># some of them are used to dimension the latter (and some compilers</span></div><div class="line"><a name="l06474"></a><span class="lineno"> 6474</span>&#160;        <span class="comment"># get upset if this ordering is not followed)</span></div><div class="line"><a name="l06475"></a><span class="lineno"> 6475</span>&#160;        self._parent.add(DeclGen(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a86b4a6b6d644e586a1765e1a6eaa52a1">_parent</a>, datatype=<span class="stringliteral">&quot;integer&quot;</span>,</div><div class="line"><a name="l06476"></a><span class="lineno"> 6476</span>&#160;                                 intent=<span class="stringliteral">&quot;in&quot;</span>,</div><div class="line"><a name="l06477"></a><span class="lineno"> 6477</span>&#160;                                 entity_decls=_local_args))</div><div class="line"><a name="l06478"></a><span class="lineno"> 6478</span>&#160;        <span class="comment"># Declare the array that holds the CMA operator</span></div><div class="line"><a name="l06479"></a><span class="lineno"> 6479</span>&#160;        <span class="comment"># If this is the first argument in the kernel then keep a</span></div><div class="line"><a name="l06480"></a><span class="lineno"> 6480</span>&#160;        <span class="comment"># note so that we can put subsequent declarations in the</span></div><div class="line"><a name="l06481"></a><span class="lineno"> 6481</span>&#160;        <span class="comment"># correct location</span></div><div class="line"><a name="l06482"></a><span class="lineno"> 6482</span>&#160;        decl = DeclGen(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a86b4a6b6d644e586a1765e1a6eaa52a1">_parent</a>, datatype=<span class="stringliteral">&quot;real&quot;</span>, kind=<span class="stringliteral">&quot;r_def&quot;</span>,</div><div class="line"><a name="l06483"></a><span class="lineno"> 6483</span>&#160;                       dimension=<span class="stringliteral">&quot;,&quot;</span>.join([bandwidth,</div><div class="line"><a name="l06484"></a><span class="lineno"> 6484</span>&#160;                                           nrow, <span class="stringliteral">&quot;ncell_2d&quot;</span>]),</div><div class="line"><a name="l06485"></a><span class="lineno"> 6485</span>&#160;                       intent=intent, entity_decls=[arg.name])</div><div class="line"><a name="l06486"></a><span class="lineno"> 6486</span>&#160;        self._parent.add(decl)</div><div class="line"><a name="l06487"></a><span class="lineno"> 6487</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#ad399778e0a713e715cc9b90e923bc17f">_first_arg</a>:</div><div class="line"><a name="l06488"></a><span class="lineno"> 6488</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#ad399778e0a713e715cc9b90e923bc17f">_first_arg</a> = <span class="keyword">False</span></div><div class="line"><a name="l06489"></a><span class="lineno"> 6489</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a8dc2d43aad4fa2edb207a43e932eaf2e">_first_arg_decl</a> = decl</div><div class="line"><a name="l06490"></a><span class="lineno"> 6490</span>&#160;</div><div class="line"><a name="l06491"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#ae3e2b881c08bde1288a44f8474a2ff75"> 6491</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#ae3e2b881c08bde1288a44f8474a2ff75">banded_dofmap</a>(self, function_space):</div><div class="line"><a name="l06492"></a><span class="lineno"> 6492</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Declare the banded dofmap required for a CMA operator</span></div><div class="line"><a name="l06493"></a><span class="lineno"> 6493</span>&#160;<span class="stringliteral">        that maps to/from the specified function space &#39;&#39;&#39;</span></div><div class="line"><a name="l06494"></a><span class="lineno"> 6494</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> DeclGen</div><div class="line"><a name="l06495"></a><span class="lineno"> 6495</span>&#160;        ndf = get_fs_ndf_name(function_space)</div><div class="line"><a name="l06496"></a><span class="lineno"> 6496</span>&#160;        dofmap = get_cbanded_map_name(function_space)</div><div class="line"><a name="l06497"></a><span class="lineno"> 6497</span>&#160;        self._parent.add(DeclGen(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a86b4a6b6d644e586a1765e1a6eaa52a1">_parent</a>, datatype=<span class="stringliteral">&quot;integer&quot;</span>,</div><div class="line"><a name="l06498"></a><span class="lineno"> 6498</span>&#160;                                 dimension=<span class="stringliteral">&quot;,&quot;</span>.join([ndf, <span class="stringliteral">&quot;nlayers&quot;</span>]),</div><div class="line"><a name="l06499"></a><span class="lineno"> 6499</span>&#160;                                 intent=<span class="stringliteral">&quot;in&quot;</span>,</div><div class="line"><a name="l06500"></a><span class="lineno"> 6500</span>&#160;                                 entity_decls=[dofmap]))</div><div class="line"><a name="l06501"></a><span class="lineno"> 6501</span>&#160;        self._arglist.append(dofmap)</div><div class="line"><a name="l06502"></a><span class="lineno"> 6502</span>&#160;</div><div class="line"><a name="l06503"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#aba190d113df8fea70ec1edf903438b79"> 6503</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#aba190d113df8fea70ec1edf903438b79">indirection_dofmap</a>(self, function_space, operator=None):</div><div class="line"><a name="l06504"></a><span class="lineno"> 6504</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Declare the indirection dofmaps required when applying a</span></div><div class="line"><a name="l06505"></a><span class="lineno"> 6505</span>&#160;<span class="stringliteral">        CMA operator &#39;&#39;&#39;</span></div><div class="line"><a name="l06506"></a><span class="lineno"> 6506</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> DeclGen</div><div class="line"><a name="l06507"></a><span class="lineno"> 6507</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> operator:</div><div class="line"><a name="l06508"></a><span class="lineno"> 6508</span>&#160;            <span class="keywordflow">raise</span> GenerationError(<span class="stringliteral">&quot;Internal error: no CMA operator supplied.&quot;</span>)</div><div class="line"><a name="l06509"></a><span class="lineno"> 6509</span>&#160;        <span class="keywordflow">if</span> operator.type != <span class="stringliteral">&quot;gh_columnwise_operator&quot;</span>:</div><div class="line"><a name="l06510"></a><span class="lineno"> 6510</span>&#160;            <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l06511"></a><span class="lineno"> 6511</span>&#160;                <span class="stringliteral">&quot;Internal error: a CMA operator (gh_columnwise_operator) must &quot;</span></div><div class="line"><a name="l06512"></a><span class="lineno"> 6512</span>&#160;                <span class="stringliteral">&quot;be supplied but got {0}&quot;</span>.format(operator.type))</div><div class="line"><a name="l06513"></a><span class="lineno"> 6513</span>&#160;        <span class="comment"># The extent of the (1D) dofmap depends on whether it is for the &#39;to&#39;</span></div><div class="line"><a name="l06514"></a><span class="lineno"> 6514</span>&#160;        <span class="comment"># or &#39;from&#39; function space of the operator</span></div><div class="line"><a name="l06515"></a><span class="lineno"> 6515</span>&#160;        <span class="keywordflow">if</span> operator.function_space_to.orig_name == function_space.orig_name:</div><div class="line"><a name="l06516"></a><span class="lineno"> 6516</span>&#160;            dim_name = operator.name + <span class="stringliteral">&quot;_nrow&quot;</span></div><div class="line"><a name="l06517"></a><span class="lineno"> 6517</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l06518"></a><span class="lineno"> 6518</span>&#160;            dim_name = operator.name + <span class="stringliteral">&quot;_ncol&quot;</span></div><div class="line"><a name="l06519"></a><span class="lineno"> 6519</span>&#160;        map_name = get_cma_indirection_map_name(function_space)</div><div class="line"><a name="l06520"></a><span class="lineno"> 6520</span>&#160;        self._parent.add(DeclGen(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a86b4a6b6d644e586a1765e1a6eaa52a1">_parent</a>, datatype=<span class="stringliteral">&quot;integer&quot;</span>,</div><div class="line"><a name="l06521"></a><span class="lineno"> 6521</span>&#160;                                 dimension=dim_name,</div><div class="line"><a name="l06522"></a><span class="lineno"> 6522</span>&#160;                                 intent=<span class="stringliteral">&quot;in&quot;</span>,</div><div class="line"><a name="l06523"></a><span class="lineno"> 6523</span>&#160;                                 entity_decls=[map_name]))</div><div class="line"><a name="l06524"></a><span class="lineno"> 6524</span>&#160;        self._arglist.append(map_name)</div><div class="line"><a name="l06525"></a><span class="lineno"> 6525</span>&#160;</div><div class="line"><a name="l06526"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a048f8cccde56780b64141af0837b24fa"> 6526</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a048f8cccde56780b64141af0837b24fa">scalar</a>(self, arg):</div><div class="line"><a name="l06527"></a><span class="lineno"> 6527</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;add the name associated with the scalar argument&#39;&#39;&#39;</span></div><div class="line"><a name="l06528"></a><span class="lineno"> 6528</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> DeclGen</div><div class="line"><a name="l06529"></a><span class="lineno"> 6529</span>&#160;        <span class="keywordflow">if</span> arg.type == <span class="stringliteral">&quot;gh_real&quot;</span>:</div><div class="line"><a name="l06530"></a><span class="lineno"> 6530</span>&#160;            decl = DeclGen(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a86b4a6b6d644e586a1765e1a6eaa52a1">_parent</a>, datatype=<span class="stringliteral">&quot;real&quot;</span>, kind=<span class="stringliteral">&quot;r_def&quot;</span>,</div><div class="line"><a name="l06531"></a><span class="lineno"> 6531</span>&#160;                           intent=arg.intent,</div><div class="line"><a name="l06532"></a><span class="lineno"> 6532</span>&#160;                           entity_decls=[arg.name])</div><div class="line"><a name="l06533"></a><span class="lineno"> 6533</span>&#160;        <span class="keywordflow">elif</span> arg.type == <span class="stringliteral">&quot;gh_integer&quot;</span>:</div><div class="line"><a name="l06534"></a><span class="lineno"> 6534</span>&#160;            decl = DeclGen(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a86b4a6b6d644e586a1765e1a6eaa52a1">_parent</a>, datatype=<span class="stringliteral">&quot;integer&quot;</span>,</div><div class="line"><a name="l06535"></a><span class="lineno"> 6535</span>&#160;                           intent=arg.intent,</div><div class="line"><a name="l06536"></a><span class="lineno"> 6536</span>&#160;                           entity_decls=[arg.name])</div><div class="line"><a name="l06537"></a><span class="lineno"> 6537</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l06538"></a><span class="lineno"> 6538</span>&#160;            <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l06539"></a><span class="lineno"> 6539</span>&#160;                <span class="stringliteral">&quot;Internal error: expected arg type to be one &quot;</span></div><div class="line"><a name="l06540"></a><span class="lineno"> 6540</span>&#160;                <span class="stringliteral">&quot;of &#39;{0}&#39; but got &#39;{1}&#39;&quot;</span>.format(VALID_SCALAR_NAMES,</div><div class="line"><a name="l06541"></a><span class="lineno"> 6541</span>&#160;                                                arg.type))</div><div class="line"><a name="l06542"></a><span class="lineno"> 6542</span>&#160;        self._parent.add(decl)</div><div class="line"><a name="l06543"></a><span class="lineno"> 6543</span>&#160;        self._arglist.append(arg.name)</div><div class="line"><a name="l06544"></a><span class="lineno"> 6544</span>&#160;</div><div class="line"><a name="l06545"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#ac7b8b8ec66058854d569d9745a887f32"> 6545</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#ac7b8b8ec66058854d569d9745a887f32">fs_common</a>(self, function_space):</div><div class="line"><a name="l06546"></a><span class="lineno"> 6546</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Provide arguments common to LMA operators and</span></div><div class="line"><a name="l06547"></a><span class="lineno"> 6547</span>&#160;<span class="stringliteral">        fields on a space. There is one: &quot;ndf&quot;. &#39;&#39;&#39;</span></div><div class="line"><a name="l06548"></a><span class="lineno"> 6548</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> DeclGen</div><div class="line"><a name="l06549"></a><span class="lineno"> 6549</span>&#160;        ndf_name = get_fs_ndf_name(function_space)</div><div class="line"><a name="l06550"></a><span class="lineno"> 6550</span>&#160;        self._arglist.append(ndf_name)</div><div class="line"><a name="l06551"></a><span class="lineno"> 6551</span>&#160;        self._parent.add(</div><div class="line"><a name="l06552"></a><span class="lineno"> 6552</span>&#160;            DeclGen(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a86b4a6b6d644e586a1765e1a6eaa52a1">_parent</a>, datatype=<span class="stringliteral">&quot;integer&quot;</span>, intent=<span class="stringliteral">&quot;in&quot;</span>,</div><div class="line"><a name="l06553"></a><span class="lineno"> 6553</span>&#160;                    entity_decls=[ndf_name]),</div><div class="line"><a name="l06554"></a><span class="lineno"> 6554</span>&#160;            position=[<span class="stringliteral">&quot;before&quot;</span>, self._first_arg_decl.root])</div><div class="line"><a name="l06555"></a><span class="lineno"> 6555</span>&#160;</div><div class="line"><a name="l06556"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#accc69de047d8bad0f774c7ec03032a50"> 6556</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#accc69de047d8bad0f774c7ec03032a50">fs_compulsory_field</a>(self, function_space):</div><div class="line"><a name="l06557"></a><span class="lineno"> 6557</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Provide compulsory arguments if there is a field on this</span></div><div class="line"><a name="l06558"></a><span class="lineno"> 6558</span>&#160;<span class="stringliteral">        function space&#39;&#39;&#39;</span></div><div class="line"><a name="l06559"></a><span class="lineno"> 6559</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> DeclGen</div><div class="line"><a name="l06560"></a><span class="lineno"> 6560</span>&#160;        ndf_name = get_fs_ndf_name(function_space)</div><div class="line"><a name="l06561"></a><span class="lineno"> 6561</span>&#160;        undf_name = get_fs_undf_name(function_space)</div><div class="line"><a name="l06562"></a><span class="lineno"> 6562</span>&#160;        self._arglist.append(undf_name)</div><div class="line"><a name="l06563"></a><span class="lineno"> 6563</span>&#160;        map_name = get_fs_map_name(function_space)</div><div class="line"><a name="l06564"></a><span class="lineno"> 6564</span>&#160;        self._arglist.append(map_name)</div><div class="line"><a name="l06565"></a><span class="lineno"> 6565</span>&#160;        <span class="comment"># ndf* declarations need to be before argument</span></div><div class="line"><a name="l06566"></a><span class="lineno"> 6566</span>&#160;        <span class="comment"># declarations as some compilers don&#39;t like</span></div><div class="line"><a name="l06567"></a><span class="lineno"> 6567</span>&#160;        <span class="comment"># declarations after they have been used. We place</span></div><div class="line"><a name="l06568"></a><span class="lineno"> 6568</span>&#160;        <span class="comment"># ndf* before the first argument declaration</span></div><div class="line"><a name="l06569"></a><span class="lineno"> 6569</span>&#160;        <span class="comment"># (field or operator) (rather than after nlayers)</span></div><div class="line"><a name="l06570"></a><span class="lineno"> 6570</span>&#160;        <span class="comment"># as this keeps the declarations in the order</span></div><div class="line"><a name="l06571"></a><span class="lineno"> 6571</span>&#160;        <span class="comment"># specified in the metadata and first used by</span></div><div class="line"><a name="l06572"></a><span class="lineno"> 6572</span>&#160;        <span class="comment"># fields/operators.</span></div><div class="line"><a name="l06573"></a><span class="lineno"> 6573</span>&#160;        self._parent.add(DeclGen(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a86b4a6b6d644e586a1765e1a6eaa52a1">_parent</a>, datatype=<span class="stringliteral">&quot;integer&quot;</span>, intent=<span class="stringliteral">&quot;in&quot;</span>,</div><div class="line"><a name="l06574"></a><span class="lineno"> 6574</span>&#160;                                 entity_decls=[undf_name]),</div><div class="line"><a name="l06575"></a><span class="lineno"> 6575</span>&#160;                         position=[<span class="stringliteral">&quot;before&quot;</span>, self._first_arg_decl.root])</div><div class="line"><a name="l06576"></a><span class="lineno"> 6576</span>&#160;        self._parent.add(DeclGen(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a86b4a6b6d644e586a1765e1a6eaa52a1">_parent</a>, datatype=<span class="stringliteral">&quot;integer&quot;</span>, intent=<span class="stringliteral">&quot;in&quot;</span>,</div><div class="line"><a name="l06577"></a><span class="lineno"> 6577</span>&#160;                                 dimension=ndf_name,</div><div class="line"><a name="l06578"></a><span class="lineno"> 6578</span>&#160;                                 entity_decls=[map_name]))</div><div class="line"><a name="l06579"></a><span class="lineno"> 6579</span>&#160;</div><div class="line"><a name="l06580"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#afde64572207d2730f973dbd6dbd4924e"> 6580</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#afde64572207d2730f973dbd6dbd4924e">basis</a>(self, function_space):</div><div class="line"><a name="l06581"></a><span class="lineno"> 6581</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l06582"></a><span class="lineno"> 6582</span>&#160;<span class="stringliteral">        Add the necessary declarations for basis function(s) on the supplied</span></div><div class="line"><a name="l06583"></a><span class="lineno"> 6583</span>&#160;<span class="stringliteral">        function space. There can be more than one if this is an evaluator.</span></div><div class="line"><a name="l06584"></a><span class="lineno"> 6584</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l06585"></a><span class="lineno"> 6585</span>&#160;<span class="stringliteral">        :param function_space: the function space for which to provide</span></div><div class="line"><a name="l06586"></a><span class="lineno"> 6586</span>&#160;<span class="stringliteral">                               the basis functions</span></div><div class="line"><a name="l06587"></a><span class="lineno"> 6587</span>&#160;<span class="stringliteral">        :type function_space: :py:class:`psyclone.dynamo0p3.FunctionSpace`</span></div><div class="line"><a name="l06588"></a><span class="lineno"> 6588</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l06589"></a><span class="lineno"> 6589</span>&#160;<span class="stringliteral">        :raises GenerationError: if function_space is not a recognised \</span></div><div class="line"><a name="l06590"></a><span class="lineno"> 6590</span>&#160;<span class="stringliteral">                                 Function Space.</span></div><div class="line"><a name="l06591"></a><span class="lineno"> 6591</span>&#160;<span class="stringliteral">        :raises GenerationError: if a quadrature other than XYoZ is required.</span></div><div class="line"><a name="l06592"></a><span class="lineno"> 6592</span>&#160;<span class="stringliteral">        :raises InternalError: if the evaluator shape is not recognised.</span></div><div class="line"><a name="l06593"></a><span class="lineno"> 6593</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l06594"></a><span class="lineno"> 6594</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> DeclGen</div><div class="line"><a name="l06595"></a><span class="lineno"> 6595</span>&#160;        <span class="comment"># the size of the first dimension for a</span></div><div class="line"><a name="l06596"></a><span class="lineno"> 6596</span>&#160;        <span class="comment"># basis array depends on the</span></div><div class="line"><a name="l06597"></a><span class="lineno"> 6597</span>&#160;        <span class="comment"># function space. The values are</span></div><div class="line"><a name="l06598"></a><span class="lineno"> 6598</span>&#160;        <span class="comment"># w0=1, w1=3, w2=3, w3=1, wtheta=1, w2h=3, w2v=3</span></div><div class="line"><a name="l06599"></a><span class="lineno"> 6599</span>&#160;        first_dim = <span class="keywordtype">None</span></div><div class="line"><a name="l06600"></a><span class="lineno"> 6600</span>&#160;        <span class="keywordflow">if</span> function_space.orig_name.lower() <span class="keywordflow">in</span> \</div><div class="line"><a name="l06601"></a><span class="lineno"> 6601</span>&#160;           [<span class="stringliteral">&quot;w0&quot;</span>, <span class="stringliteral">&quot;w3&quot;</span>, <span class="stringliteral">&quot;wtheta&quot;</span>]:</div><div class="line"><a name="l06602"></a><span class="lineno"> 6602</span>&#160;            first_dim = <span class="stringliteral">&quot;1&quot;</span></div><div class="line"><a name="l06603"></a><span class="lineno"> 6603</span>&#160;        <span class="keywordflow">elif</span> (function_space.orig_name.lower() <span class="keywordflow">in</span></div><div class="line"><a name="l06604"></a><span class="lineno"> 6604</span>&#160;              [<span class="stringliteral">&quot;w1&quot;</span>, <span class="stringliteral">&quot;w2&quot;</span>, <span class="stringliteral">&quot;w2h&quot;</span>, <span class="stringliteral">&quot;w2v&quot;</span>, <span class="stringliteral">&quot;any_w2&quot;</span>]):</div><div class="line"><a name="l06605"></a><span class="lineno"> 6605</span>&#160;            first_dim = <span class="stringliteral">&quot;3&quot;</span></div><div class="line"><a name="l06606"></a><span class="lineno"> 6606</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l06607"></a><span class="lineno"> 6607</span>&#160;            <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l06608"></a><span class="lineno"> 6608</span>&#160;                <span class="stringliteral">&quot;Unsupported space for basis function, &quot;</span></div><div class="line"><a name="l06609"></a><span class="lineno"> 6609</span>&#160;                <span class="stringliteral">&quot;expecting one of {0} but found &quot;</span></div><div class="line"><a name="l06610"></a><span class="lineno"> 6610</span>&#160;                <span class="stringliteral">&quot;&#39;{1}&#39;&quot;</span>.format(VALID_FUNCTION_SPACES,</div><div class="line"><a name="l06611"></a><span class="lineno"> 6611</span>&#160;                               function_space.orig_name))</div><div class="line"><a name="l06612"></a><span class="lineno"> 6612</span>&#160;        ndf_name = get_fs_ndf_name(function_space)</div><div class="line"><a name="l06613"></a><span class="lineno"> 6613</span>&#160;</div><div class="line"><a name="l06614"></a><span class="lineno"> 6614</span>&#160;        <span class="keywordflow">if</span> self._kern.eval_shape <span class="keywordflow">in</span> VALID_QUADRATURE_SHAPES:</div><div class="line"><a name="l06615"></a><span class="lineno"> 6615</span>&#160;            basis_name = get_fs_basis_name(function_space)</div><div class="line"><a name="l06616"></a><span class="lineno"> 6616</span>&#160;            self._arglist.append(basis_name)</div><div class="line"><a name="l06617"></a><span class="lineno"> 6617</span>&#160;</div><div class="line"><a name="l06618"></a><span class="lineno"> 6618</span>&#160;            <span class="keywordflow">if</span> self._kern.eval_shape == <span class="stringliteral">&quot;gh_quadrature_xyoz&quot;</span>:</div><div class="line"><a name="l06619"></a><span class="lineno"> 6619</span>&#160;                dim_list = <span class="stringliteral">&quot;,&quot;</span>.join([first_dim, ndf_name,</div><div class="line"><a name="l06620"></a><span class="lineno"> 6620</span>&#160;                                     <span class="stringliteral">&quot;np_xy&quot;</span>, <span class="stringliteral">&quot;np_z&quot;</span>])</div><div class="line"><a name="l06621"></a><span class="lineno"> 6621</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l06622"></a><span class="lineno"> 6622</span>&#160;                <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l06623"></a><span class="lineno"> 6623</span>&#160;                    <span class="stringliteral">&quot;Quadrature shapes other than GH_QUADRATURE_XYoZ are not &quot;</span></div><div class="line"><a name="l06624"></a><span class="lineno"> 6624</span>&#160;                    <span class="stringliteral">&quot;yet supported&quot;</span>)</div><div class="line"><a name="l06625"></a><span class="lineno"> 6625</span>&#160;            self._parent.add(DeclGen(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a86b4a6b6d644e586a1765e1a6eaa52a1">_parent</a>, datatype=<span class="stringliteral">&quot;real&quot;</span>,</div><div class="line"><a name="l06626"></a><span class="lineno"> 6626</span>&#160;                                     kind=<span class="stringliteral">&quot;r_def&quot;</span>, intent=<span class="stringliteral">&quot;in&quot;</span>,</div><div class="line"><a name="l06627"></a><span class="lineno"> 6627</span>&#160;                                     dimension=dim_list,</div><div class="line"><a name="l06628"></a><span class="lineno"> 6628</span>&#160;                                     entity_decls=[basis_name]))</div><div class="line"><a name="l06629"></a><span class="lineno"> 6629</span>&#160;        <span class="keywordflow">elif</span> self._kern.eval_shape <span class="keywordflow">in</span> VALID_EVALUATOR_SHAPES:</div><div class="line"><a name="l06630"></a><span class="lineno"> 6630</span>&#160;            <span class="comment"># Need a basis array for each target space upon which the basis</span></div><div class="line"><a name="l06631"></a><span class="lineno"> 6631</span>&#160;            <span class="comment"># functions have been evaluated. _kern.eval_targets is a dict</span></div><div class="line"><a name="l06632"></a><span class="lineno"> 6632</span>&#160;            <span class="comment"># where the values are 2-tuples of (FunctionSpace, argument).</span></div><div class="line"><a name="l06633"></a><span class="lineno"> 6633</span>&#160;            <span class="keywordflow">for</span> _, target <span class="keywordflow">in</span> self._kern.eval_targets.items():</div><div class="line"><a name="l06634"></a><span class="lineno"> 6634</span>&#160;                basis_name = get_fs_basis_name(function_space,</div><div class="line"><a name="l06635"></a><span class="lineno"> 6635</span>&#160;                                               on_space=target[0])</div><div class="line"><a name="l06636"></a><span class="lineno"> 6636</span>&#160;                self._arglist.append(basis_name)</div><div class="line"><a name="l06637"></a><span class="lineno"> 6637</span>&#160;</div><div class="line"><a name="l06638"></a><span class="lineno"> 6638</span>&#160;                nodal_ndf_name = get_fs_ndf_name(target[0])</div><div class="line"><a name="l06639"></a><span class="lineno"> 6639</span>&#160;                dim_list = <span class="stringliteral">&quot;,&quot;</span>.join([first_dim, ndf_name, nodal_ndf_name])</div><div class="line"><a name="l06640"></a><span class="lineno"> 6640</span>&#160;                self._parent.add(DeclGen(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a86b4a6b6d644e586a1765e1a6eaa52a1">_parent</a>, datatype=<span class="stringliteral">&quot;real&quot;</span>,</div><div class="line"><a name="l06641"></a><span class="lineno"> 6641</span>&#160;                                         kind=<span class="stringliteral">&quot;r_def&quot;</span>, intent=<span class="stringliteral">&quot;in&quot;</span>,</div><div class="line"><a name="l06642"></a><span class="lineno"> 6642</span>&#160;                                         dimension=dim_list,</div><div class="line"><a name="l06643"></a><span class="lineno"> 6643</span>&#160;                                         entity_decls=[basis_name]))</div><div class="line"><a name="l06644"></a><span class="lineno"> 6644</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l06645"></a><span class="lineno"> 6645</span>&#160;            <span class="keywordflow">raise</span> InternalError(</div><div class="line"><a name="l06646"></a><span class="lineno"> 6646</span>&#160;                <span class="stringliteral">&quot;Unrecognised evaluator shape ({0}). Expected one of: {1}&quot;</span>.</div><div class="line"><a name="l06647"></a><span class="lineno"> 6647</span>&#160;                format(self._kern.eval_shape, VALID_EVALUATOR_SHAPES))</div><div class="line"><a name="l06648"></a><span class="lineno"> 6648</span>&#160;</div><div class="line"><a name="l06649"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a8e7edf3d9f5ff907c0faae354a5278e0"> 6649</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a8e7edf3d9f5ff907c0faae354a5278e0">diff_basis</a>(self, function_space):</div><div class="line"><a name="l06650"></a><span class="lineno"> 6650</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l06651"></a><span class="lineno"> 6651</span>&#160;<span class="stringliteral">        Provide the necessary declarations for the differential basis function</span></div><div class="line"><a name="l06652"></a><span class="lineno"> 6652</span>&#160;<span class="stringliteral">        on the supplied function space.</span></div><div class="line"><a name="l06653"></a><span class="lineno"> 6653</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l06654"></a><span class="lineno"> 6654</span>&#160;<span class="stringliteral">        :param function_space: the function space for which to provide the</span></div><div class="line"><a name="l06655"></a><span class="lineno"> 6655</span>&#160;<span class="stringliteral">                               differential basis function</span></div><div class="line"><a name="l06656"></a><span class="lineno"> 6656</span>&#160;<span class="stringliteral">        :type function_space: :py:class:`psyclone.dynamo0p3.FunctionSpace`</span></div><div class="line"><a name="l06657"></a><span class="lineno"> 6657</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l06658"></a><span class="lineno"> 6658</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> DeclGen</div><div class="line"><a name="l06659"></a><span class="lineno"> 6659</span>&#160;        <span class="comment"># the size of the first dimension for a</span></div><div class="line"><a name="l06660"></a><span class="lineno"> 6660</span>&#160;        <span class="comment"># differential basis array depends on the</span></div><div class="line"><a name="l06661"></a><span class="lineno"> 6661</span>&#160;        <span class="comment"># function space. The values are</span></div><div class="line"><a name="l06662"></a><span class="lineno"> 6662</span>&#160;        <span class="comment"># w0=3, w1=3, w2=1, w3=3, wtheta=3, w2h=1, w2v=1</span></div><div class="line"><a name="l06663"></a><span class="lineno"> 6663</span>&#160;        first_dim = <span class="keywordtype">None</span></div><div class="line"><a name="l06664"></a><span class="lineno"> 6664</span>&#160;        <span class="keywordflow">if</span> function_space.orig_name.lower() <span class="keywordflow">in</span> \</div><div class="line"><a name="l06665"></a><span class="lineno"> 6665</span>&#160;           [<span class="stringliteral">&quot;w2&quot;</span>, <span class="stringliteral">&quot;w2h&quot;</span>, <span class="stringliteral">&quot;w2v&quot;</span>, <span class="stringliteral">&quot;any_w2&quot;</span>]:</div><div class="line"><a name="l06666"></a><span class="lineno"> 6666</span>&#160;            first_dim = <span class="stringliteral">&quot;1&quot;</span></div><div class="line"><a name="l06667"></a><span class="lineno"> 6667</span>&#160;        <span class="keywordflow">elif</span> (function_space.orig_name.lower() <span class="keywordflow">in</span></div><div class="line"><a name="l06668"></a><span class="lineno"> 6668</span>&#160;              [<span class="stringliteral">&quot;w0&quot;</span>, <span class="stringliteral">&quot;w1&quot;</span>, <span class="stringliteral">&quot;w3&quot;</span>, <span class="stringliteral">&quot;wtheta&quot;</span>]):</div><div class="line"><a name="l06669"></a><span class="lineno"> 6669</span>&#160;            first_dim = <span class="stringliteral">&quot;3&quot;</span></div><div class="line"><a name="l06670"></a><span class="lineno"> 6670</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l06671"></a><span class="lineno"> 6671</span>&#160;            <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l06672"></a><span class="lineno"> 6672</span>&#160;                <span class="stringliteral">&quot;Unsupported space for differential basis &quot;</span></div><div class="line"><a name="l06673"></a><span class="lineno"> 6673</span>&#160;                <span class="stringliteral">&quot;function, expecting one of {0} but found &quot;</span></div><div class="line"><a name="l06674"></a><span class="lineno"> 6674</span>&#160;                <span class="stringliteral">&quot;&#39;{1}&#39;&quot;</span>.format(VALID_FUNCTION_SPACES,</div><div class="line"><a name="l06675"></a><span class="lineno"> 6675</span>&#160;                               function_space.orig_name))</div><div class="line"><a name="l06676"></a><span class="lineno"> 6676</span>&#160;        ndf_name = get_fs_ndf_name(function_space)</div><div class="line"><a name="l06677"></a><span class="lineno"> 6677</span>&#160;</div><div class="line"><a name="l06678"></a><span class="lineno"> 6678</span>&#160;        <span class="keywordflow">if</span> self._kern.eval_shape <span class="keywordflow">in</span> VALID_QUADRATURE_SHAPES:</div><div class="line"><a name="l06679"></a><span class="lineno"> 6679</span>&#160;            <span class="comment"># We need differential basis functions for quadrature</span></div><div class="line"><a name="l06680"></a><span class="lineno"> 6680</span>&#160;            diff_basis_name = get_fs_diff_basis_name(function_space)</div><div class="line"><a name="l06681"></a><span class="lineno"> 6681</span>&#160;            self._arglist.append(diff_basis_name)</div><div class="line"><a name="l06682"></a><span class="lineno"> 6682</span>&#160;</div><div class="line"><a name="l06683"></a><span class="lineno"> 6683</span>&#160;            <span class="keywordflow">if</span> self._kern.eval_shape == <span class="stringliteral">&quot;gh_quadrature_xyoz&quot;</span>:</div><div class="line"><a name="l06684"></a><span class="lineno"> 6684</span>&#160;                dim_list = <span class="stringliteral">&quot;,&quot;</span>.join([first_dim, ndf_name,</div><div class="line"><a name="l06685"></a><span class="lineno"> 6685</span>&#160;                                     <span class="stringliteral">&quot;np_xy&quot;</span>, <span class="stringliteral">&quot;np_z&quot;</span>])</div><div class="line"><a name="l06686"></a><span class="lineno"> 6686</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l06687"></a><span class="lineno"> 6687</span>&#160;                <span class="keywordflow">raise</span> NotImplementedError(</div><div class="line"><a name="l06688"></a><span class="lineno"> 6688</span>&#160;                    <span class="stringliteral">&quot;Internal error: diff-basis for quadrature shape &#39;{0}&#39; &quot;</span></div><div class="line"><a name="l06689"></a><span class="lineno"> 6689</span>&#160;                    <span class="stringliteral">&quot;not yet implemented&quot;</span>.format(self._kern.eval_shape))</div><div class="line"><a name="l06690"></a><span class="lineno"> 6690</span>&#160;</div><div class="line"><a name="l06691"></a><span class="lineno"> 6691</span>&#160;            self._parent.add(DeclGen(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a86b4a6b6d644e586a1765e1a6eaa52a1">_parent</a>, datatype=<span class="stringliteral">&quot;real&quot;</span>,</div><div class="line"><a name="l06692"></a><span class="lineno"> 6692</span>&#160;                                     kind=<span class="stringliteral">&quot;r_def&quot;</span>,</div><div class="line"><a name="l06693"></a><span class="lineno"> 6693</span>&#160;                                     intent=<span class="stringliteral">&quot;in&quot;</span>, dimension=dim_list,</div><div class="line"><a name="l06694"></a><span class="lineno"> 6694</span>&#160;                                     entity_decls=[diff_basis_name]))</div><div class="line"><a name="l06695"></a><span class="lineno"> 6695</span>&#160;</div><div class="line"><a name="l06696"></a><span class="lineno"> 6696</span>&#160;        <span class="keywordflow">elif</span> self._kern.eval_shape <span class="keywordflow">in</span> VALID_EVALUATOR_SHAPES:</div><div class="line"><a name="l06697"></a><span class="lineno"> 6697</span>&#160;            <span class="comment"># We need differential basis functions for an evaluator,</span></div><div class="line"><a name="l06698"></a><span class="lineno"> 6698</span>&#160;            <span class="comment"># potentially for multiple target spaces. _kern.eval_targets is</span></div><div class="line"><a name="l06699"></a><span class="lineno"> 6699</span>&#160;            <span class="comment"># a dict where the values are 2-tuples of</span></div><div class="line"><a name="l06700"></a><span class="lineno"> 6700</span>&#160;            <span class="comment"># (FunctionSpace, argument).</span></div><div class="line"><a name="l06701"></a><span class="lineno"> 6701</span>&#160;            <span class="keywordflow">for</span> _, target <span class="keywordflow">in</span> self._kern.eval_targets.items():</div><div class="line"><a name="l06702"></a><span class="lineno"> 6702</span>&#160;                diff_basis_name = get_fs_diff_basis_name(function_space,</div><div class="line"><a name="l06703"></a><span class="lineno"> 6703</span>&#160;                                                         on_space=target[0])</div><div class="line"><a name="l06704"></a><span class="lineno"> 6704</span>&#160;                self._arglist.append(diff_basis_name)</div><div class="line"><a name="l06705"></a><span class="lineno"> 6705</span>&#160;                nodal_ndf_name = get_fs_ndf_name(target[0])</div><div class="line"><a name="l06706"></a><span class="lineno"> 6706</span>&#160;                dim_list = <span class="stringliteral">&quot;,&quot;</span>.join([first_dim, ndf_name, nodal_ndf_name])</div><div class="line"><a name="l06707"></a><span class="lineno"> 6707</span>&#160;                self._parent.add(DeclGen(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a86b4a6b6d644e586a1765e1a6eaa52a1">_parent</a>, datatype=<span class="stringliteral">&quot;real&quot;</span>,</div><div class="line"><a name="l06708"></a><span class="lineno"> 6708</span>&#160;                                         kind=<span class="stringliteral">&quot;r_def&quot;</span>,</div><div class="line"><a name="l06709"></a><span class="lineno"> 6709</span>&#160;                                         intent=<span class="stringliteral">&quot;in&quot;</span>, dimension=dim_list,</div><div class="line"><a name="l06710"></a><span class="lineno"> 6710</span>&#160;                                         entity_decls=[diff_basis_name]))</div><div class="line"><a name="l06711"></a><span class="lineno"> 6711</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l06712"></a><span class="lineno"> 6712</span>&#160;            <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l06713"></a><span class="lineno"> 6713</span>&#160;                <span class="stringliteral">&quot;Internal error: unrecognised evaluator shape ({0}). Expected &quot;</span></div><div class="line"><a name="l06714"></a><span class="lineno"> 6714</span>&#160;                <span class="stringliteral">&quot;one of: {1}&quot;</span>.format(self._kern.eval_shape,</div><div class="line"><a name="l06715"></a><span class="lineno"> 6715</span>&#160;                                     VALID_EVALUATOR_SHAPES))</div><div class="line"><a name="l06716"></a><span class="lineno"> 6716</span>&#160;</div><div class="line"><a name="l06717"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a987c6f31efdebba201de8a30573b3941"> 6717</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a987c6f31efdebba201de8a30573b3941">orientation</a>(self, function_space):</div><div class="line"><a name="l06718"></a><span class="lineno"> 6718</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; provide orientation information for the function space &#39;&#39;&#39;</span></div><div class="line"><a name="l06719"></a><span class="lineno"> 6719</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> DeclGen</div><div class="line"><a name="l06720"></a><span class="lineno"> 6720</span>&#160;        ndf_name = get_fs_ndf_name(function_space)</div><div class="line"><a name="l06721"></a><span class="lineno"> 6721</span>&#160;        orientation_name = get_fs_orientation_name(function_space)</div><div class="line"><a name="l06722"></a><span class="lineno"> 6722</span>&#160;        self._arglist.append(orientation_name)</div><div class="line"><a name="l06723"></a><span class="lineno"> 6723</span>&#160;        self._parent.add(DeclGen(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a86b4a6b6d644e586a1765e1a6eaa52a1">_parent</a>, datatype=<span class="stringliteral">&quot;integer&quot;</span>,</div><div class="line"><a name="l06724"></a><span class="lineno"> 6724</span>&#160;                                 intent=<span class="stringliteral">&quot;in&quot;</span>, dimension=ndf_name,</div><div class="line"><a name="l06725"></a><span class="lineno"> 6725</span>&#160;                                 entity_decls=[orientation_name]))</div><div class="line"><a name="l06726"></a><span class="lineno"> 6726</span>&#160;</div><div class="line"><a name="l06727"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#aff05cee18ae4afe7996405d743c7cfa5"> 6727</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#aff05cee18ae4afe7996405d743c7cfa5">field_bcs_kernel</a>(self, function_space):</div><div class="line"><a name="l06728"></a><span class="lineno"> 6728</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; implement the boundary_dofs array fix for fields &#39;&#39;&#39;</span></div><div class="line"><a name="l06729"></a><span class="lineno"> 6729</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> DeclGen</div><div class="line"><a name="l06730"></a><span class="lineno"> 6730</span>&#160;        self._arglist.append(<span class="stringliteral">&quot;boundary_dofs&quot;</span>)</div><div class="line"><a name="l06731"></a><span class="lineno"> 6731</span>&#160;        ndf_name = get_fs_ndf_name(function_space)</div><div class="line"><a name="l06732"></a><span class="lineno"> 6732</span>&#160;        self._parent.add(DeclGen(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a86b4a6b6d644e586a1765e1a6eaa52a1">_parent</a>, datatype=<span class="stringliteral">&quot;integer&quot;</span>, intent=<span class="stringliteral">&quot;in&quot;</span>,</div><div class="line"><a name="l06733"></a><span class="lineno"> 6733</span>&#160;                                 dimension=<span class="stringliteral">&quot;,&quot;</span>.join([ndf_name, <span class="stringliteral">&quot;2&quot;</span>]),</div><div class="line"><a name="l06734"></a><span class="lineno"> 6734</span>&#160;                                 entity_decls=[<span class="stringliteral">&quot;boundary_dofs&quot;</span>]))</div><div class="line"><a name="l06735"></a><span class="lineno"> 6735</span>&#160;</div><div class="line"><a name="l06736"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a532fe7b9b2d7a7f7972903bae7d25b51"> 6736</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a532fe7b9b2d7a7f7972903bae7d25b51">operator_bcs_kernel</a>(self, function_space):</div><div class="line"><a name="l06737"></a><span class="lineno"> 6737</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Implement the boundary_dofs array fix for operators. This is the</span></div><div class="line"><a name="l06738"></a><span class="lineno"> 6738</span>&#160;<span class="stringliteral">        same as for fields with the function space set to the &#39;to&#39; space of</span></div><div class="line"><a name="l06739"></a><span class="lineno"> 6739</span>&#160;<span class="stringliteral">        the operator. &#39;&#39;&#39;</span></div><div class="line"><a name="l06740"></a><span class="lineno"> 6740</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#acc72560435e14e43c1388e1282d8bbdf">field_bcs_kernel</a>(function_space)</div><div class="line"><a name="l06741"></a><span class="lineno"> 6741</span>&#160;</div><div class="line"><a name="l06742"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#abc8d87da43f55769aaf1e7fc944bae4c"> 6742</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#abc8d87da43f55769aaf1e7fc944bae4c">quad_rule</a>(self):</div><div class="line"><a name="l06743"></a><span class="lineno"> 6743</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; provide quadrature information for this kernel stub (necessary</span></div><div class="line"><a name="l06744"></a><span class="lineno"> 6744</span>&#160;<span class="stringliteral">        arguments and declarations) &#39;&#39;&#39;</span></div><div class="line"><a name="l06745"></a><span class="lineno"> 6745</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> DeclGen</div><div class="line"><a name="l06746"></a><span class="lineno"> 6746</span>&#160;        self._arglist.extend(self._kern.qr_args)</div><div class="line"><a name="l06747"></a><span class="lineno"> 6747</span>&#160;        self._parent.add(DeclGen(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a86b4a6b6d644e586a1765e1a6eaa52a1">_parent</a>, datatype=<span class="stringliteral">&quot;integer&quot;</span>, intent=<span class="stringliteral">&quot;in&quot;</span>,</div><div class="line"><a name="l06748"></a><span class="lineno"> 6748</span>&#160;                                 entity_decls=[<span class="stringliteral">&quot;np_xy&quot;</span>, <span class="stringliteral">&quot;np_z&quot;</span>]))</div><div class="line"><a name="l06749"></a><span class="lineno"> 6749</span>&#160;        self._parent.add(DeclGen(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a86b4a6b6d644e586a1765e1a6eaa52a1">_parent</a>, datatype=<span class="stringliteral">&quot;real&quot;</span>, kind=<span class="stringliteral">&quot;r_def&quot;</span>,</div><div class="line"><a name="l06750"></a><span class="lineno"> 6750</span>&#160;                                 intent=<span class="stringliteral">&quot;in&quot;</span>,</div><div class="line"><a name="l06751"></a><span class="lineno"> 6751</span>&#160;                                 dimension=<span class="stringliteral">&quot;np_xy&quot;</span>,</div><div class="line"><a name="l06752"></a><span class="lineno"> 6752</span>&#160;                                 entity_decls=[<span class="stringliteral">&quot;weights_xy&quot;</span>]))</div><div class="line"><a name="l06753"></a><span class="lineno"> 6753</span>&#160;        self._parent.add(DeclGen(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a86b4a6b6d644e586a1765e1a6eaa52a1">_parent</a>, datatype=<span class="stringliteral">&quot;real&quot;</span>, kind=<span class="stringliteral">&quot;r_def&quot;</span>,</div><div class="line"><a name="l06754"></a><span class="lineno"> 6754</span>&#160;                                 intent=<span class="stringliteral">&quot;in&quot;</span>,</div><div class="line"><a name="l06755"></a><span class="lineno"> 6755</span>&#160;                                 dimension=<span class="stringliteral">&quot;np_z&quot;</span>,</div><div class="line"><a name="l06756"></a><span class="lineno"> 6756</span>&#160;                                 entity_decls=[<span class="stringliteral">&quot;weights_z&quot;</span>]))</div><div class="line"><a name="l06757"></a><span class="lineno"> 6757</span>&#160;</div><div class="line"><a name="l06758"></a><span class="lineno"> 6758</span>&#160;    @property</div><div class="line"><a name="l06759"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#ae712a076d0d9dcdb94c144746559c0f2"> 6759</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#ae712a076d0d9dcdb94c144746559c0f2">arglist</a>(self):</div><div class="line"><a name="l06760"></a><span class="lineno"> 6760</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;return the kernel argument list. The generate function must be</span></div><div class="line"><a name="l06761"></a><span class="lineno"> 6761</span>&#160;<span class="stringliteral">        called first&#39;&#39;&#39;</span></div><div class="line"><a name="l06762"></a><span class="lineno"> 6762</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a4633caa757c0d32c33891f38dce70190">_arglist</a>:</div><div class="line"><a name="l06763"></a><span class="lineno"> 6763</span>&#160;            <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l06764"></a><span class="lineno"> 6764</span>&#160;                <span class="stringliteral">&quot;Internal error. The argument list in KernStubArgList:&quot;</span></div><div class="line"><a name="l06765"></a><span class="lineno"> 6765</span>&#160;                <span class="stringliteral">&quot;arglist() is empty. Has the generate() method been called?&quot;</span>)</div><div class="line"><a name="l06766"></a><span class="lineno"> 6766</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a4633caa757c0d32c33891f38dce70190">_arglist</a></div><div class="line"><a name="l06767"></a><span class="lineno"> 6767</span>&#160;</div><div class="line"><a name="l06768"></a><span class="lineno"> 6768</span>&#160;</div><div class="line"><a name="l06769"></a><span class="lineno"> 6769</span>&#160;<span class="comment"># class DinoWriters(ArgOrdering):</span></div><div class="line"><a name="l06770"></a><span class="lineno"> 6770</span>&#160;<span class="comment">#    &#39;&#39;&#39;Creates the required writers to dump the state of a Kernel call</span></div><div class="line"><a name="l06771"></a><span class="lineno"> 6771</span>&#160;<span class="comment">#    using dino. The integers are output first, followed by the fields,</span></div><div class="line"><a name="l06772"></a><span class="lineno"> 6772</span>&#160;<span class="comment">#    arrays etc&#39;&#39;&#39;</span></div><div class="line"><a name="l06773"></a><span class="lineno"> 6773</span>&#160;<span class="comment">#    def __init__(self, kern, parent=None, position=None):</span></div><div class="line"><a name="l06774"></a><span class="lineno"> 6774</span>&#160;<span class="comment">#        ArgOrdering.__init__(self, kern)</span></div><div class="line"><a name="l06775"></a><span class="lineno"> 6775</span>&#160;<span class="comment">#        self._parent = parent</span></div><div class="line"><a name="l06776"></a><span class="lineno"> 6776</span>&#160;<span class="comment">#        self._position = position</span></div><div class="line"><a name="l06777"></a><span class="lineno"> 6777</span>&#160;<span class="comment">#        self._name_space_manager = NameSpaceFactory().create()</span></div><div class="line"><a name="l06778"></a><span class="lineno"> 6778</span>&#160;<span class="comment">#        self._scalar_position = None</span></div><div class="line"><a name="l06779"></a><span class="lineno"> 6779</span>&#160;<span class="comment">#        self._array_position = None</span></div><div class="line"><a name="l06780"></a><span class="lineno"> 6780</span>&#160;<span class="comment">#</span></div><div class="line"><a name="l06781"></a><span class="lineno"> 6781</span>&#160;<span class="comment">#    def cell_position(self):</span></div><div class="line"><a name="l06782"></a><span class="lineno"> 6782</span>&#160;<span class="comment">#        &#39;&#39;&#39; get dino to output cell position information &#39;&#39;&#39;</span></div><div class="line"><a name="l06783"></a><span class="lineno"> 6783</span>&#160;<span class="comment">#        # dino outputs a full field so we do not need cell index information</span></div><div class="line"><a name="l06784"></a><span class="lineno"> 6784</span>&#160;<span class="comment">#        pass</span></div><div class="line"><a name="l06785"></a><span class="lineno"> 6785</span>&#160;<span class="comment">#</span></div><div class="line"><a name="l06786"></a><span class="lineno"> 6786</span>&#160;<span class="comment">#    def mesh_height(self):</span></div><div class="line"><a name="l06787"></a><span class="lineno"> 6787</span>&#160;<span class="comment">#        &#39;&#39;&#39; get dino to output the height of the mesh (nlayers)&#39;&#39;&#39;</span></div><div class="line"><a name="l06788"></a><span class="lineno"> 6788</span>&#160;<span class="comment">#        nlayers_name = self._name_space_manager.create_name(</span></div><div class="line"><a name="l06789"></a><span class="lineno"> 6789</span>&#160;<span class="comment">#            root_name=&quot;nlayers&quot;, context=&quot;PSyVars&quot;, label=&quot;nlayers&quot;)</span></div><div class="line"><a name="l06790"></a><span class="lineno"> 6790</span>&#160;<span class="comment">#        self._add_dino_scalar(nlayers_name)</span></div><div class="line"><a name="l06791"></a><span class="lineno"> 6791</span>&#160;<span class="comment">#</span></div><div class="line"><a name="l06792"></a><span class="lineno"> 6792</span>&#160;<span class="comment">#    def field_vector(self, argvect):</span></div><div class="line"><a name="l06793"></a><span class="lineno"> 6793</span>&#160;<span class="comment">#        &#39;&#39;&#39;get dino to output field vector data associated with the argument</span></div><div class="line"><a name="l06794"></a><span class="lineno"> 6794</span>&#160;<span class="comment">#        &#39;argvect&#39; &#39;&#39;&#39;</span></div><div class="line"><a name="l06795"></a><span class="lineno"> 6795</span>&#160;<span class="comment">#        # TBD</span></div><div class="line"><a name="l06796"></a><span class="lineno"> 6796</span>&#160;<span class="comment">#        pass</span></div><div class="line"><a name="l06797"></a><span class="lineno"> 6797</span>&#160;<span class="comment">#</span></div><div class="line"><a name="l06798"></a><span class="lineno"> 6798</span>&#160;<span class="comment">#    def field(self, arg):</span></div><div class="line"><a name="l06799"></a><span class="lineno"> 6799</span>&#160;<span class="comment">#        &#39;&#39;&#39;get dino to output field datat associated with the argument</span></div><div class="line"><a name="l06800"></a><span class="lineno"> 6800</span>&#160;<span class="comment">#        &#39;arg&#39; &#39;&#39;&#39;</span></div><div class="line"><a name="l06801"></a><span class="lineno"> 6801</span>&#160;<span class="comment">#        if arg.intent in [&quot;in&quot;, &quot;inout&quot;]:</span></div><div class="line"><a name="l06802"></a><span class="lineno"> 6802</span>&#160;<span class="comment">#            text = arg.proxy_name + &quot;%data&quot;</span></div><div class="line"><a name="l06803"></a><span class="lineno"> 6803</span>&#160;<span class="comment">#            self._add_dino_array(text)</span></div><div class="line"><a name="l06804"></a><span class="lineno"> 6804</span>&#160;<span class="comment">#</span></div><div class="line"><a name="l06805"></a><span class="lineno"> 6805</span>&#160;<span class="comment">#    def stencil_unknown_extent(self, arg):</span></div><div class="line"><a name="l06806"></a><span class="lineno"> 6806</span>&#160;<span class="comment">#        &#39;&#39;&#39;get dino to output stencil information associated with the argument</span></div><div class="line"><a name="l06807"></a><span class="lineno"> 6807</span>&#160;<span class="comment">#        &#39;arg&#39; if the extent is unknown &#39;&#39;&#39;</span></div><div class="line"><a name="l06808"></a><span class="lineno"> 6808</span>&#160;<span class="comment">#        # TBD</span></div><div class="line"><a name="l06809"></a><span class="lineno"> 6809</span>&#160;<span class="comment">#        pass</span></div><div class="line"><a name="l06810"></a><span class="lineno"> 6810</span>&#160;<span class="comment">#</span></div><div class="line"><a name="l06811"></a><span class="lineno"> 6811</span>&#160;<span class="comment">#    def stencil_unknown_direction(self, arg):</span></div><div class="line"><a name="l06812"></a><span class="lineno"> 6812</span>&#160;<span class="comment">#        &#39;&#39;&#39;get dino to output stencil information associated with the argument</span></div><div class="line"><a name="l06813"></a><span class="lineno"> 6813</span>&#160;<span class="comment">#        &#39;arg&#39; if the direction is unknown &#39;&#39;&#39;</span></div><div class="line"><a name="l06814"></a><span class="lineno"> 6814</span>&#160;<span class="comment">#        # TBD</span></div><div class="line"><a name="l06815"></a><span class="lineno"> 6815</span>&#160;<span class="comment">#        pass</span></div><div class="line"><a name="l06816"></a><span class="lineno"> 6816</span>&#160;<span class="comment">#</span></div><div class="line"><a name="l06817"></a><span class="lineno"> 6817</span>&#160;<span class="comment">#    def stencil(self, arg):</span></div><div class="line"><a name="l06818"></a><span class="lineno"> 6818</span>&#160;<span class="comment">#        &#39;&#39;&#39;get dino to output general stencil information associated with the</span></div><div class="line"><a name="l06819"></a><span class="lineno"> 6819</span>&#160;<span class="comment">#        argument &#39;arg&#39; &#39;&#39;&#39;</span></div><div class="line"><a name="l06820"></a><span class="lineno"> 6820</span>&#160;<span class="comment">#        # TBD</span></div><div class="line"><a name="l06821"></a><span class="lineno"> 6821</span>&#160;<span class="comment">#        pass</span></div><div class="line"><a name="l06822"></a><span class="lineno"> 6822</span>&#160;<span class="comment">#</span></div><div class="line"><a name="l06823"></a><span class="lineno"> 6823</span>&#160;<span class="comment">#    def operator(self, arg):</span></div><div class="line"><a name="l06824"></a><span class="lineno"> 6824</span>&#160;<span class="comment">#        &#39;&#39;&#39; get dino to output the operator arguments &#39;&#39;&#39;</span></div><div class="line"><a name="l06825"></a><span class="lineno"> 6825</span>&#160;<span class="comment">#        # TBD</span></div><div class="line"><a name="l06826"></a><span class="lineno"> 6826</span>&#160;<span class="comment">#        pass</span></div><div class="line"><a name="l06827"></a><span class="lineno"> 6827</span>&#160;<span class="comment">#</span></div><div class="line"><a name="l06828"></a><span class="lineno"> 6828</span>&#160;<span class="comment">#    def scalar(self, scalar_arg):</span></div><div class="line"><a name="l06829"></a><span class="lineno"> 6829</span>&#160;<span class="comment">#        &#39;&#39;&#39;get dino to output the value of the scalar argument&#39;&#39;&#39;</span></div><div class="line"><a name="l06830"></a><span class="lineno"> 6830</span>&#160;<span class="comment">#        if scalar_arg in [&quot;in&quot;, &quot;inout&quot;]:</span></div><div class="line"><a name="l06831"></a><span class="lineno"> 6831</span>&#160;<span class="comment">#            self._add_dino_scalar(scalar_arg.name)</span></div><div class="line"><a name="l06832"></a><span class="lineno"> 6832</span>&#160;<span class="comment">#</span></div><div class="line"><a name="l06833"></a><span class="lineno"> 6833</span>&#160;<span class="comment">#    def fs_common(self, function_space):</span></div><div class="line"><a name="l06834"></a><span class="lineno"> 6834</span>&#160;<span class="comment">#        &#39;&#39;&#39;get dino to output any arguments common to LMA operators and</span></div><div class="line"><a name="l06835"></a><span class="lineno"> 6835</span>&#160;<span class="comment">#        fields on a space. &#39;&#39;&#39;</span></div><div class="line"><a name="l06836"></a><span class="lineno"> 6836</span>&#160;<span class="comment">#        # There is currently one: &quot;ndf&quot;.</span></div><div class="line"><a name="l06837"></a><span class="lineno"> 6837</span>&#160;<span class="comment">#        ndf_name = get_fs_ndf_name(function_space)</span></div><div class="line"><a name="l06838"></a><span class="lineno"> 6838</span>&#160;<span class="comment">#        self._add_dino_scalar(ndf_name)</span></div><div class="line"><a name="l06839"></a><span class="lineno"> 6839</span>&#160;<span class="comment">#</span></div><div class="line"><a name="l06840"></a><span class="lineno"> 6840</span>&#160;<span class="comment">#    def fs_compulsory_field(self, function_space):</span></div><div class="line"><a name="l06841"></a><span class="lineno"> 6841</span>&#160;<span class="comment">#        &#39;&#39;&#39;get dino to output compulsory arguments if there is a field on this</span></div><div class="line"><a name="l06842"></a><span class="lineno"> 6842</span>&#160;<span class="comment">#        function space&#39;&#39;&#39;</span></div><div class="line"><a name="l06843"></a><span class="lineno"> 6843</span>&#160;<span class="comment">#        undf_name = get_fs_undf_name(function_space)</span></div><div class="line"><a name="l06844"></a><span class="lineno"> 6844</span>&#160;<span class="comment">#        self._add_dino_scalar(undf_name)</span></div><div class="line"><a name="l06845"></a><span class="lineno"> 6845</span>&#160;<span class="comment">#</span></div><div class="line"><a name="l06846"></a><span class="lineno"> 6846</span>&#160;<span class="comment">#    def basis(self, function_space):</span></div><div class="line"><a name="l06847"></a><span class="lineno"> 6847</span>&#160;<span class="comment">#        &#39;&#39;&#39;get dino to output basis function information for the function</span></div><div class="line"><a name="l06848"></a><span class="lineno"> 6848</span>&#160;<span class="comment">#        space&#39;&#39;&#39;</span></div><div class="line"><a name="l06849"></a><span class="lineno"> 6849</span>&#160;<span class="comment">#        # TBD</span></div><div class="line"><a name="l06850"></a><span class="lineno"> 6850</span>&#160;<span class="comment">#        pass</span></div><div class="line"><a name="l06851"></a><span class="lineno"> 6851</span>&#160;<span class="comment">#</span></div><div class="line"><a name="l06852"></a><span class="lineno"> 6852</span>&#160;<span class="comment">#    def diff_basis(self, function_space):</span></div><div class="line"><a name="l06853"></a><span class="lineno"> 6853</span>&#160;<span class="comment">#        &#39;&#39;&#39;get dino to output differential basis function information for the</span></div><div class="line"><a name="l06854"></a><span class="lineno"> 6854</span>&#160;<span class="comment">#        function space&#39;&#39;&#39;</span></div><div class="line"><a name="l06855"></a><span class="lineno"> 6855</span>&#160;<span class="comment">#        # TBD</span></div><div class="line"><a name="l06856"></a><span class="lineno"> 6856</span>&#160;<span class="comment">#         pass</span></div><div class="line"><a name="l06857"></a><span class="lineno"> 6857</span>&#160;<span class="comment">#</span></div><div class="line"><a name="l06858"></a><span class="lineno"> 6858</span>&#160;<span class="comment">#    def orientation(self, function_space):</span></div><div class="line"><a name="l06859"></a><span class="lineno"> 6859</span>&#160;<span class="comment">#        &#39;&#39;&#39;get dino to output orientation information for the function</span></div><div class="line"><a name="l06860"></a><span class="lineno"> 6860</span>&#160;<span class="comment">#        space&#39;&#39;&#39;</span></div><div class="line"><a name="l06861"></a><span class="lineno"> 6861</span>&#160;<span class="comment">#        # TBD</span></div><div class="line"><a name="l06862"></a><span class="lineno"> 6862</span>&#160;<span class="comment">#        pass</span></div><div class="line"><a name="l06863"></a><span class="lineno"> 6863</span>&#160;<span class="comment">#</span></div><div class="line"><a name="l06864"></a><span class="lineno"> 6864</span>&#160;<span class="comment">#    def field_bcs_kernel(self, function_space):</span></div><div class="line"><a name="l06865"></a><span class="lineno"> 6865</span>&#160;<span class="comment">#        &#39;&#39;&#39;get dino to output any boundary_dofs information for bc_kernel&#39;&#39;&#39;</span></div><div class="line"><a name="l06866"></a><span class="lineno"> 6866</span>&#160;<span class="comment">#        # TBD</span></div><div class="line"><a name="l06867"></a><span class="lineno"> 6867</span>&#160;<span class="comment">#        pass</span></div><div class="line"><a name="l06868"></a><span class="lineno"> 6868</span>&#160;<span class="comment">#</span></div><div class="line"><a name="l06869"></a><span class="lineno"> 6869</span>&#160;<span class="comment">#    def quad_rule(self):</span></div><div class="line"><a name="l06870"></a><span class="lineno"> 6870</span>&#160;<span class="comment">#        &#39;&#39;&#39;get dino to output qr information &#39;&#39;&#39;</span></div><div class="line"><a name="l06871"></a><span class="lineno"> 6871</span>&#160;<span class="comment">#        # TBD</span></div><div class="line"><a name="l06872"></a><span class="lineno"> 6872</span>&#160;<span class="comment">#        pass</span></div><div class="line"><a name="l06873"></a><span class="lineno"> 6873</span>&#160;<span class="comment">#</span></div><div class="line"><a name="l06874"></a><span class="lineno"> 6874</span>&#160;<span class="comment">#    def generate(self):</span></div><div class="line"><a name="l06875"></a><span class="lineno"> 6875</span>&#160;<span class="comment">#        &#39;&#39;&#39;perform any additional actions before and after kernel</span></div><div class="line"><a name="l06876"></a><span class="lineno"> 6876</span>&#160;<span class="comment">#        argument-list based generation&#39;&#39;&#39;</span></div><div class="line"><a name="l06877"></a><span class="lineno"> 6877</span>&#160;<span class="comment">#        from psyclone.f2pygen import CommentGen</span></div><div class="line"><a name="l06878"></a><span class="lineno"> 6878</span>&#160;<span class="comment">#        self._parent.add(CommentGen(self._parent, &quot; dino output start&quot;),</span></div><div class="line"><a name="l06879"></a><span class="lineno"> 6879</span>&#160;<span class="comment">#                         position=[&quot;before&quot;, self._position])</span></div><div class="line"><a name="l06880"></a><span class="lineno"> 6880</span>&#160;<span class="comment">#        scalar_comment = CommentGen(self._parent, &quot; dino scalars&quot;)</span></div><div class="line"><a name="l06881"></a><span class="lineno"> 6881</span>&#160;<span class="comment">#        self._parent.add(scalar_comment,</span></div><div class="line"><a name="l06882"></a><span class="lineno"> 6882</span>&#160;<span class="comment">#                         position=[&quot;before&quot;, self._position])</span></div><div class="line"><a name="l06883"></a><span class="lineno"> 6883</span>&#160;<span class="comment">#        array_comment = CommentGen(self._parent, &quot; dino arrays&quot;)</span></div><div class="line"><a name="l06884"></a><span class="lineno"> 6884</span>&#160;<span class="comment">#        self._parent.add(array_comment,</span></div><div class="line"><a name="l06885"></a><span class="lineno"> 6885</span>&#160;<span class="comment">#                         position=[&quot;before&quot;, self._position])</span></div><div class="line"><a name="l06886"></a><span class="lineno"> 6886</span>&#160;<span class="comment">#        self._scalar_position = scalar_comment.root</span></div><div class="line"><a name="l06887"></a><span class="lineno"> 6887</span>&#160;<span class="comment">#        self._array_position = array_comment.root</span></div><div class="line"><a name="l06888"></a><span class="lineno"> 6888</span>&#160;<span class="comment">#        self._parent.add(CommentGen(self._parent, &quot; dino output end&quot;),</span></div><div class="line"><a name="l06889"></a><span class="lineno"> 6889</span>&#160;<span class="comment">#                         position=[&quot;before&quot;, self._position])</span></div><div class="line"><a name="l06890"></a><span class="lineno"> 6890</span>&#160;<span class="comment">#        self._parent.add(CommentGen(self._parent, &quot;&quot;),</span></div><div class="line"><a name="l06891"></a><span class="lineno"> 6891</span>&#160;<span class="comment">#                         position=[&quot;before&quot;, self._position])</span></div><div class="line"><a name="l06892"></a><span class="lineno"> 6892</span>&#160;<span class="comment">#        ArgOrdering.generate(self)</span></div><div class="line"><a name="l06893"></a><span class="lineno"> 6893</span>&#160;<span class="comment">#</span></div><div class="line"><a name="l06894"></a><span class="lineno"> 6894</span>&#160;<span class="comment">#    def _add_dino_scalar(self, name):</span></div><div class="line"><a name="l06895"></a><span class="lineno"> 6895</span>&#160;<span class="comment">#        &#39;&#39;&#39; add a dino output call for a scalar variable &#39;&#39;&#39;</span></div><div class="line"><a name="l06896"></a><span class="lineno"> 6896</span>&#160;<span class="comment">#        from psyclone.f2pygen import CallGen</span></div><div class="line"><a name="l06897"></a><span class="lineno"> 6897</span>&#160;<span class="comment">#        self._parent.add(CallGen(self._parent, name=&quot;dino%output_scalar&quot;,</span></div><div class="line"><a name="l06898"></a><span class="lineno"> 6898</span>&#160;<span class="comment">#                                 args=[name]),</span></div><div class="line"><a name="l06899"></a><span class="lineno"> 6899</span>&#160;<span class="comment">#                         position=[&quot;after&quot;, self._scalar_position])</span></div><div class="line"><a name="l06900"></a><span class="lineno"> 6900</span>&#160;<span class="comment">#</span></div><div class="line"><a name="l06901"></a><span class="lineno"> 6901</span>&#160;<span class="comment">#    def _add_dino_array(self, name):</span></div><div class="line"><a name="l06902"></a><span class="lineno"> 6902</span>&#160;<span class="comment">#        &#39;&#39;&#39; add a dino output call for an array variable &#39;&#39;&#39;</span></div><div class="line"><a name="l06903"></a><span class="lineno"> 6903</span>&#160;<span class="comment">#        from psyclone.f2pygen import CallGen</span></div><div class="line"><a name="l06904"></a><span class="lineno"> 6904</span>&#160;<span class="comment">#        self._parent.add(CallGen(self._parent, name=&quot;dino%output_array&quot;,</span></div><div class="line"><a name="l06905"></a><span class="lineno"> 6905</span>&#160;<span class="comment">#                                 args=[name]),</span></div><div class="line"><a name="l06906"></a><span class="lineno"> 6906</span>&#160;<span class="comment">#                         position=[&quot;after&quot;, self._array_position])</span></div><div class="line"><a name="l06907"></a><span class="lineno"> 6907</span>&#160;</div><div class="line"><a name="l06908"></a><span class="lineno"> 6908</span>&#160;</div><div class="line"><a name="l06909"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1FSDescriptor.html"> 6909</a></span>&#160;<span class="keyword">class </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1FSDescriptor.html">FSDescriptor</a>(object):</div><div class="line"><a name="l06910"></a><span class="lineno"> 6910</span>&#160;    <span class="stringliteral">&#39;&#39;&#39; Provides information about a particular function space used by</span></div><div class="line"><a name="l06911"></a><span class="lineno"> 6911</span>&#160;<span class="stringliteral">    a meta-funcs entry in the kernel metadata. &#39;&#39;&#39;</span></div><div class="line"><a name="l06912"></a><span class="lineno"> 6912</span>&#160;</div><div class="line"><a name="l06913"></a><span class="lineno"> 6913</span>&#160;    <span class="keyword">def </span>__init__(self, descriptor):</div><div class="line"><a name="l06914"></a><span class="lineno"> 6914</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1FSDescriptor.html#a13f66aeb12cdc4dacd67117f72275dbb">_descriptor</a> = descriptor</div><div class="line"><a name="l06915"></a><span class="lineno"> 6915</span>&#160;</div><div class="line"><a name="l06916"></a><span class="lineno"> 6916</span>&#160;    @property</div><div class="line"><a name="l06917"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1FSDescriptor.html#a012c18deea44c43976fe74cc7b018390"> 6917</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1FSDescriptor.html#a012c18deea44c43976fe74cc7b018390">requires_basis</a>(self):</div><div class="line"><a name="l06918"></a><span class="lineno"> 6918</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Returns True if a basis function is associated with this</span></div><div class="line"><a name="l06919"></a><span class="lineno"> 6919</span>&#160;<span class="stringliteral">        function space, otherwise it returns False. &#39;&#39;&#39;</span></div><div class="line"><a name="l06920"></a><span class="lineno"> 6920</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;gh_basis&quot;</span> <span class="keywordflow">in</span> self._descriptor.operator_names</div><div class="line"><a name="l06921"></a><span class="lineno"> 6921</span>&#160;</div><div class="line"><a name="l06922"></a><span class="lineno"> 6922</span>&#160;    @property</div><div class="line"><a name="l06923"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1FSDescriptor.html#a6a926154aaacd9b40025056e9ec05dba"> 6923</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1FSDescriptor.html#a6a926154aaacd9b40025056e9ec05dba">requires_diff_basis</a>(self):</div><div class="line"><a name="l06924"></a><span class="lineno"> 6924</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Returns True if a differential basis function is</span></div><div class="line"><a name="l06925"></a><span class="lineno"> 6925</span>&#160;<span class="stringliteral">        associated with this function space, otherwise it returns</span></div><div class="line"><a name="l06926"></a><span class="lineno"> 6926</span>&#160;<span class="stringliteral">        False. &#39;&#39;&#39;</span></div><div class="line"><a name="l06927"></a><span class="lineno"> 6927</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;gh_diff_basis&quot;</span> <span class="keywordflow">in</span> self._descriptor.operator_names</div><div class="line"><a name="l06928"></a><span class="lineno"> 6928</span>&#160;</div><div class="line"><a name="l06929"></a><span class="lineno"> 6929</span>&#160;    @property</div><div class="line"><a name="l06930"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1FSDescriptor.html#a468d4532ad93d01d590f994f17ddd84a"> 6930</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1FSDescriptor.html#a468d4532ad93d01d590f994f17ddd84a">requires_orientation</a>(self):</div><div class="line"><a name="l06931"></a><span class="lineno"> 6931</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Returns True if an orientation function is</span></div><div class="line"><a name="l06932"></a><span class="lineno"> 6932</span>&#160;<span class="stringliteral">        associated with this function space, otherwise it returns</span></div><div class="line"><a name="l06933"></a><span class="lineno"> 6933</span>&#160;<span class="stringliteral">        False. &#39;&#39;&#39;</span></div><div class="line"><a name="l06934"></a><span class="lineno"> 6934</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;gh_orientation&quot;</span> <span class="keywordflow">in</span> self._descriptor.operator_names</div><div class="line"><a name="l06935"></a><span class="lineno"> 6935</span>&#160;</div><div class="line"><a name="l06936"></a><span class="lineno"> 6936</span>&#160;    @property</div><div class="line"><a name="l06937"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1FSDescriptor.html#a0a74503df6a7da4d219a8b04655a4a36"> 6937</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1FSDescriptor.html#a0a74503df6a7da4d219a8b04655a4a36">fs_name</a>(self):</div><div class="line"><a name="l06938"></a><span class="lineno"> 6938</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Returns the raw metadata value of this function space. &#39;&#39;&#39;</span></div><div class="line"><a name="l06939"></a><span class="lineno"> 6939</span>&#160;        <span class="keywordflow">return</span> self._descriptor.function_space_name</div><div class="line"><a name="l06940"></a><span class="lineno"> 6940</span>&#160;</div><div class="line"><a name="l06941"></a><span class="lineno"> 6941</span>&#160;</div><div class="line"><a name="l06942"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1FSDescriptors.html"> 6942</a></span>&#160;<span class="keyword">class </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1FSDescriptors.html">FSDescriptors</a>(object):</div><div class="line"><a name="l06943"></a><span class="lineno"> 6943</span>&#160;    <span class="stringliteral">&#39;&#39;&#39; Contains a collection of FSDescriptor objects and methods</span></div><div class="line"><a name="l06944"></a><span class="lineno"> 6944</span>&#160;<span class="stringliteral">    that provide information across these objects. We have one</span></div><div class="line"><a name="l06945"></a><span class="lineno"> 6945</span>&#160;<span class="stringliteral">    FSDescriptor for each meta-funcs entry in the kernel</span></div><div class="line"><a name="l06946"></a><span class="lineno"> 6946</span>&#160;<span class="stringliteral">    meta-data.</span></div><div class="line"><a name="l06947"></a><span class="lineno"> 6947</span>&#160;<span class="stringliteral">    #TODO #274 this should actually be named something like</span></div><div class="line"><a name="l06948"></a><span class="lineno"> 6948</span>&#160;<span class="stringliteral">    BasisFuncDescriptors as it holds information describing the</span></div><div class="line"><a name="l06949"></a><span class="lineno"> 6949</span>&#160;<span class="stringliteral">    basis/diff-basis functions required by a kernel.</span></div><div class="line"><a name="l06950"></a><span class="lineno"> 6950</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l06951"></a><span class="lineno"> 6951</span>&#160;<span class="stringliteral">    :param descriptors: list of objects describing the basis/diff-basis \</span></div><div class="line"><a name="l06952"></a><span class="lineno"> 6952</span>&#160;<span class="stringliteral">                        functions required by a kernel, as obtained from \</span></div><div class="line"><a name="l06953"></a><span class="lineno"> 6953</span>&#160;<span class="stringliteral">                        meta-data.</span></div><div class="line"><a name="l06954"></a><span class="lineno"> 6954</span>&#160;<span class="stringliteral">    :type descriptors: list of :py:class:`psyclone.DynFuncDescriptor03`.</span></div><div class="line"><a name="l06955"></a><span class="lineno"> 6955</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l06956"></a><span class="lineno"> 6956</span>&#160;<span class="stringliteral">    &#39;&#39;&#39;</span></div><div class="line"><a name="l06957"></a><span class="lineno"> 6957</span>&#160;    <span class="keyword">def </span>__init__(self, descriptors):</div><div class="line"><a name="l06958"></a><span class="lineno"> 6958</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1FSDescriptors.html#a8355530030bd84bf416a1a6ef87291bc">_orig_descriptors</a> = descriptors</div><div class="line"><a name="l06959"></a><span class="lineno"> 6959</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1FSDescriptors.html#a293df552058f4660d439bfa412dc6e12">_descriptors</a> = []</div><div class="line"><a name="l06960"></a><span class="lineno"> 6960</span>&#160;        <span class="keywordflow">for</span> descriptor <span class="keywordflow">in</span> descriptors:</div><div class="line"><a name="l06961"></a><span class="lineno"> 6961</span>&#160;            self._descriptors.append(<a class="code" href="classpsyclone_1_1dynamo0p3_1_1FSDescriptor.html">FSDescriptor</a>(descriptor))</div><div class="line"><a name="l06962"></a><span class="lineno"> 6962</span>&#160;</div><div class="line"><a name="l06963"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1FSDescriptors.html#a50b720c90d0c49f8fe58b7386b667806"> 6963</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1FSDescriptors.html#a50b720c90d0c49f8fe58b7386b667806">exists</a>(self, fspace):</div><div class="line"><a name="l06964"></a><span class="lineno"> 6964</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Return True if a descriptor with the specified function</span></div><div class="line"><a name="l06965"></a><span class="lineno"> 6965</span>&#160;<span class="stringliteral">        space exists, otherwise return False. &#39;&#39;&#39;</span></div><div class="line"><a name="l06966"></a><span class="lineno"> 6966</span>&#160;        <span class="keywordflow">for</span> descriptor <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1FSDescriptors.html#a293df552058f4660d439bfa412dc6e12">_descriptors</a>:</div><div class="line"><a name="l06967"></a><span class="lineno"> 6967</span>&#160;            <span class="comment"># FS descriptors hold information taken from the kernel</span></div><div class="line"><a name="l06968"></a><span class="lineno"> 6968</span>&#160;            <span class="comment"># metadata and therefore it is the original name of</span></div><div class="line"><a name="l06969"></a><span class="lineno"> 6969</span>&#160;            <span class="comment"># the supplied function space that we must look at</span></div><div class="line"><a name="l06970"></a><span class="lineno"> 6970</span>&#160;            <span class="keywordflow">if</span> descriptor.fs_name == fspace.orig_name:</div><div class="line"><a name="l06971"></a><span class="lineno"> 6971</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">True</span></div><div class="line"><a name="l06972"></a><span class="lineno"> 6972</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">False</span></div><div class="line"><a name="l06973"></a><span class="lineno"> 6973</span>&#160;</div><div class="line"><a name="l06974"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1FSDescriptors.html#a6524810ce6c63e99bd028121742368b3"> 6974</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1FSDescriptors.html#a6524810ce6c63e99bd028121742368b3">get_descriptor</a>(self, fspace):</div><div class="line"><a name="l06975"></a><span class="lineno"> 6975</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Return the descriptor with the specified function space</span></div><div class="line"><a name="l06976"></a><span class="lineno"> 6976</span>&#160;<span class="stringliteral">        name. If it does not exist raise an error.&#39;&#39;&#39;</span></div><div class="line"><a name="l06977"></a><span class="lineno"> 6977</span>&#160;        <span class="keywordflow">for</span> descriptor <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1FSDescriptors.html#a293df552058f4660d439bfa412dc6e12">_descriptors</a>:</div><div class="line"><a name="l06978"></a><span class="lineno"> 6978</span>&#160;            <span class="keywordflow">if</span> descriptor.fs_name == fspace.orig_name:</div><div class="line"><a name="l06979"></a><span class="lineno"> 6979</span>&#160;                <span class="keywordflow">return</span> descriptor</div><div class="line"><a name="l06980"></a><span class="lineno"> 6980</span>&#160;        <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l06981"></a><span class="lineno"> 6981</span>&#160;            <span class="stringliteral">&quot;FSDescriptors:get_descriptor: there is no descriptor for &quot;</span></div><div class="line"><a name="l06982"></a><span class="lineno"> 6982</span>&#160;            <span class="stringliteral">&quot;function space {0}&quot;</span>.format(fspace.orig_name))</div><div class="line"><a name="l06983"></a><span class="lineno"> 6983</span>&#160;</div><div class="line"><a name="l06984"></a><span class="lineno"> 6984</span>&#160;    @property</div><div class="line"><a name="l06985"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1FSDescriptors.html#a04db6f5c07745b15ca8b1a188eb77181"> 6985</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1FSDescriptors.html#a04db6f5c07745b15ca8b1a188eb77181">descriptors</a>(self):</div><div class="line"><a name="l06986"></a><span class="lineno"> 6986</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l06987"></a><span class="lineno"> 6987</span>&#160;<span class="stringliteral">        :return: the list of Descriptors, one for each of the meta-funcs</span></div><div class="line"><a name="l06988"></a><span class="lineno"> 6988</span>&#160;<span class="stringliteral">                 entries in the kernel meta-data.</span></div><div class="line"><a name="l06989"></a><span class="lineno"> 6989</span>&#160;<span class="stringliteral">        :rtype: List of :py:class:`psyclone.dynamo0p3.FSDescriptor`</span></div><div class="line"><a name="l06990"></a><span class="lineno"> 6990</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l06991"></a><span class="lineno"> 6991</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1FSDescriptors.html#a293df552058f4660d439bfa412dc6e12">_descriptors</a></div><div class="line"><a name="l06992"></a><span class="lineno"> 6992</span>&#160;</div><div class="line"><a name="l06993"></a><span class="lineno"> 6993</span>&#160;</div><div class="line"><a name="l06994"></a><span class="lineno"> 6994</span>&#160;<span class="keyword">def </span>check_args(call):</div><div class="line"><a name="l06995"></a><span class="lineno"> 6995</span>&#160;    <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l06996"></a><span class="lineno"> 6996</span>&#160;<span class="stringliteral">    Checks that the kernel arguments provided via the invoke call are</span></div><div class="line"><a name="l06997"></a><span class="lineno"> 6997</span>&#160;<span class="stringliteral">    consistent with the information expected, as specified by the</span></div><div class="line"><a name="l06998"></a><span class="lineno"> 6998</span>&#160;<span class="stringliteral">    kernel metadata</span></div><div class="line"><a name="l06999"></a><span class="lineno"> 6999</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l07000"></a><span class="lineno"> 7000</span>&#160;<span class="stringliteral">    :param call: the object produced by the parser that describes the</span></div><div class="line"><a name="l07001"></a><span class="lineno"> 7001</span>&#160;<span class="stringliteral">                 kernel call to be checked.</span></div><div class="line"><a name="l07002"></a><span class="lineno"> 7002</span>&#160;<span class="stringliteral">    :type call: :py:class:`psyclone.parse.KernelCall`</span></div><div class="line"><a name="l07003"></a><span class="lineno"> 7003</span>&#160;<span class="stringliteral">    :raises: GenerationError if the kernel arguments in the Algorithm layer</span></div><div class="line"><a name="l07004"></a><span class="lineno"> 7004</span>&#160;<span class="stringliteral">             do not match up with the kernel meta-data</span></div><div class="line"><a name="l07005"></a><span class="lineno"> 7005</span>&#160;<span class="stringliteral">    &#39;&#39;&#39;</span></div><div class="line"><a name="l07006"></a><span class="lineno"> 7006</span>&#160;    <span class="comment"># stencil arguments</span></div><div class="line"><a name="l07007"></a><span class="lineno"> 7007</span>&#160;    stencil_arg_count = 0</div><div class="line"><a name="l07008"></a><span class="lineno"> 7008</span>&#160;    <span class="keywordflow">for</span> arg_descriptor <span class="keywordflow">in</span> call.ktype.arg_descriptors:</div><div class="line"><a name="l07009"></a><span class="lineno"> 7009</span>&#160;        <span class="keywordflow">if</span> arg_descriptor.stencil:</div><div class="line"><a name="l07010"></a><span class="lineno"> 7010</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> arg_descriptor.stencil[<span class="stringliteral">&#39;extent&#39;</span>]:</div><div class="line"><a name="l07011"></a><span class="lineno"> 7011</span>&#160;                <span class="comment"># an extent argument must be provided</span></div><div class="line"><a name="l07012"></a><span class="lineno"> 7012</span>&#160;                stencil_arg_count += 1</div><div class="line"><a name="l07013"></a><span class="lineno"> 7013</span>&#160;            <span class="keywordflow">if</span> arg_descriptor.stencil[<span class="stringliteral">&#39;type&#39;</span>] == <span class="stringliteral">&#39;xory1d&#39;</span>:</div><div class="line"><a name="l07014"></a><span class="lineno"> 7014</span>&#160;                <span class="comment"># a direction argument must be provided</span></div><div class="line"><a name="l07015"></a><span class="lineno"> 7015</span>&#160;                stencil_arg_count += 1</div><div class="line"><a name="l07016"></a><span class="lineno"> 7016</span>&#160;</div><div class="line"><a name="l07017"></a><span class="lineno"> 7017</span>&#160;    <span class="comment"># qr_argument</span></div><div class="line"><a name="l07018"></a><span class="lineno"> 7018</span>&#160;    <span class="keywordflow">if</span> call.ktype.eval_shape <span class="keywordflow">in</span> VALID_QUADRATURE_SHAPES:</div><div class="line"><a name="l07019"></a><span class="lineno"> 7019</span>&#160;        qr_arg_count = 1</div><div class="line"><a name="l07020"></a><span class="lineno"> 7020</span>&#160;    <span class="keywordflow">else</span>:</div><div class="line"><a name="l07021"></a><span class="lineno"> 7021</span>&#160;        qr_arg_count = 0</div><div class="line"><a name="l07022"></a><span class="lineno"> 7022</span>&#160;</div><div class="line"><a name="l07023"></a><span class="lineno"> 7023</span>&#160;    expected_arg_count = len(call.ktype.arg_descriptors) + \</div><div class="line"><a name="l07024"></a><span class="lineno"> 7024</span>&#160;        stencil_arg_count + qr_arg_count</div><div class="line"><a name="l07025"></a><span class="lineno"> 7025</span>&#160;</div><div class="line"><a name="l07026"></a><span class="lineno"> 7026</span>&#160;    <span class="keywordflow">if</span> expected_arg_count != len(call.args):</div><div class="line"><a name="l07027"></a><span class="lineno"> 7027</span>&#160;        <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l07028"></a><span class="lineno"> 7028</span>&#160;            <span class="stringliteral">&quot;error: expected &#39;{0}&#39; arguments in the algorithm layer but &quot;</span></div><div class="line"><a name="l07029"></a><span class="lineno"> 7029</span>&#160;            <span class="stringliteral">&quot;found &#39;{1}&#39;. Expected &#39;{2}&#39; standard arguments, &#39;{3}&#39; &quot;</span></div><div class="line"><a name="l07030"></a><span class="lineno"> 7030</span>&#160;            <span class="stringliteral">&quot;stencil arguments and &#39;{4}&#39; qr_arguments&#39;&quot;</span>.format(</div><div class="line"><a name="l07031"></a><span class="lineno"> 7031</span>&#160;                expected_arg_count, len(call.args),</div><div class="line"><a name="l07032"></a><span class="lineno"> 7032</span>&#160;                len(call.ktype.arg_descriptors), stencil_arg_count,</div><div class="line"><a name="l07033"></a><span class="lineno"> 7033</span>&#160;                qr_arg_count))</div><div class="line"><a name="l07034"></a><span class="lineno"> 7034</span>&#160;</div><div class="line"><a name="l07035"></a><span class="lineno"> 7035</span>&#160;</div><div class="line"><a name="l07036"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynStencil.html"> 7036</a></span>&#160;<span class="keyword">class </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynStencil.html">DynStencil</a>(object):</div><div class="line"><a name="l07037"></a><span class="lineno"> 7037</span>&#160;    <span class="stringliteral">&#39;&#39;&#39; Provides stencil information about a Dynamo argument &#39;&#39;&#39;</span></div><div class="line"><a name="l07038"></a><span class="lineno"> 7038</span>&#160;    <span class="keyword">def </span>__init__(self, name):</div><div class="line"><a name="l07039"></a><span class="lineno"> 7039</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynStencil.html#ab83b77eaa044d302e092e379a68c0375">_name</a> = name</div><div class="line"><a name="l07040"></a><span class="lineno"> 7040</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynStencil.html#aa2378ea7f78cf4772fcf40b7a0eb46a7">_extent</a> = <span class="keywordtype">None</span></div><div class="line"><a name="l07041"></a><span class="lineno"> 7041</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynStencil.html#afac4a3880181ee98c28b9049f2312c7d">_extent_arg</a> = <span class="keywordtype">None</span></div><div class="line"><a name="l07042"></a><span class="lineno"> 7042</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynStencil.html#a5ede4c0ebdc8d59aff21482ab17dc50d">_direction_arg</a> = <span class="keywordtype">None</span></div><div class="line"><a name="l07043"></a><span class="lineno"> 7043</span>&#160;</div><div class="line"><a name="l07044"></a><span class="lineno"> 7044</span>&#160;    @property</div><div class="line"><a name="l07045"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynStencil.html#aa279e14ac2b0722bc51445923231d492"> 7045</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynStencil.html#aa279e14ac2b0722bc51445923231d492">extent</a>(self):</div><div class="line"><a name="l07046"></a><span class="lineno"> 7046</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;Returns the extent of the stencil if it is known. It will be known</span></div><div class="line"><a name="l07047"></a><span class="lineno"> 7047</span>&#160;<span class="stringliteral">        if it is specified in the metadata.&#39;&#39;&#39;</span></div><div class="line"><a name="l07048"></a><span class="lineno"> 7048</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynStencil.html#aa2378ea7f78cf4772fcf40b7a0eb46a7">_extent</a></div><div class="line"><a name="l07049"></a><span class="lineno"> 7049</span>&#160;</div><div class="line"><a name="l07050"></a><span class="lineno"> 7050</span>&#160;    @property</div><div class="line"><a name="l07051"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynStencil.html#a080beb1055c5fc18e3f23e975813a8b0"> 7051</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynStencil.html#a080beb1055c5fc18e3f23e975813a8b0">extent_arg</a>(self):</div><div class="line"><a name="l07052"></a><span class="lineno"> 7052</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;Returns the algorithm argument associated with the extent value if</span></div><div class="line"><a name="l07053"></a><span class="lineno"> 7053</span>&#160;<span class="stringliteral">        extent has not been provided in the metadata.&#39;&#39;&#39;</span></div><div class="line"><a name="l07054"></a><span class="lineno"> 7054</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynStencil.html#afac4a3880181ee98c28b9049f2312c7d">_extent_arg</a></div><div class="line"><a name="l07055"></a><span class="lineno"> 7055</span>&#160;</div><div class="line"><a name="l07056"></a><span class="lineno"> 7056</span>&#160;    @extent_arg.setter</div><div class="line"><a name="l07057"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynStencil.html#ad320a9acba0d4219d7c07e87cdc1827f"> 7057</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynStencil.html#a080beb1055c5fc18e3f23e975813a8b0">extent_arg</a>(self, value):</div><div class="line"><a name="l07058"></a><span class="lineno"> 7058</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; sets the extent_arg argument. &#39;&#39;&#39;</span></div><div class="line"><a name="l07059"></a><span class="lineno"> 7059</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynStencil.html#afac4a3880181ee98c28b9049f2312c7d">_extent_arg</a> = value</div><div class="line"><a name="l07060"></a><span class="lineno"> 7060</span>&#160;</div><div class="line"><a name="l07061"></a><span class="lineno"> 7061</span>&#160;    @property</div><div class="line"><a name="l07062"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynStencil.html#a2a8b06e112a1d37cb463bf3ade9e9985"> 7062</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynStencil.html#a2a8b06e112a1d37cb463bf3ade9e9985">direction_arg</a>(self):</div><div class="line"><a name="l07063"></a><span class="lineno"> 7063</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;returns the direction argument associated with the direction of</span></div><div class="line"><a name="l07064"></a><span class="lineno"> 7064</span>&#160;<span class="stringliteral">        the stencil if the direction of the stencil is not known&#39;&#39;&#39;</span></div><div class="line"><a name="l07065"></a><span class="lineno"> 7065</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynStencil.html#a5ede4c0ebdc8d59aff21482ab17dc50d">_direction_arg</a></div><div class="line"><a name="l07066"></a><span class="lineno"> 7066</span>&#160;</div><div class="line"><a name="l07067"></a><span class="lineno"> 7067</span>&#160;    @direction_arg.setter</div><div class="line"><a name="l07068"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynStencil.html#a4aa99ae02afa702ecc97a448a810b63f"> 7068</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynStencil.html#a2a8b06e112a1d37cb463bf3ade9e9985">direction_arg</a>(self, value):</div><div class="line"><a name="l07069"></a><span class="lineno"> 7069</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; sets the direction_arg argument. &#39;&#39;&#39;</span></div><div class="line"><a name="l07070"></a><span class="lineno"> 7070</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynStencil.html#a5ede4c0ebdc8d59aff21482ab17dc50d">_direction_arg</a> = value</div><div class="line"><a name="l07071"></a><span class="lineno"> 7071</span>&#160;</div><div class="line"><a name="l07072"></a><span class="lineno"> 7072</span>&#160;</div><div class="line"><a name="l07073"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html"> 7073</a></span>&#160;<span class="keyword">class </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html">DynKernelArguments</a>(Arguments):</div><div class="line"><a name="l07074"></a><span class="lineno"> 7074</span>&#160;    <span class="stringliteral">&#39;&#39;&#39; Provides information about Dynamo kernel call arguments</span></div><div class="line"><a name="l07075"></a><span class="lineno"> 7075</span>&#160;<span class="stringliteral">    collectively, as specified by the kernel argument metadata. &#39;&#39;&#39;</span></div><div class="line"><a name="l07076"></a><span class="lineno"> 7076</span>&#160;</div><div class="line"><a name="l07077"></a><span class="lineno"> 7077</span>&#160;    <span class="keyword">def </span>__init__(self, call, parent_call):</div><div class="line"><a name="l07078"></a><span class="lineno"> 7078</span>&#160;        <span class="keywordflow">if</span> <span class="keyword">False</span>:  <span class="comment"># pylint: disable=using-constant-test</span></div><div class="line"><a name="l07079"></a><span class="lineno"> 7079</span>&#160;            <span class="comment"># For pyreverse</span></div><div class="line"><a name="l07080"></a><span class="lineno"> 7080</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#af9dcde3bad1e14a1bb9a0f51654687cd">_0_to_n</a> = <a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html">DynKernelArgument</a>(<span class="keywordtype">None</span>, <span class="keywordtype">None</span>, <span class="keywordtype">None</span>, <span class="keywordtype">None</span>)</div><div class="line"><a name="l07081"></a><span class="lineno"> 7081</span>&#160;</div><div class="line"><a name="l07082"></a><span class="lineno"> 7082</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#a2ac76cc04092d56b7a619a1f0ceb311b">_name_space_manager</a> = NameSpaceFactory().create()</div><div class="line"><a name="l07083"></a><span class="lineno"> 7083</span>&#160;</div><div class="line"><a name="l07084"></a><span class="lineno"> 7084</span>&#160;        Arguments.__init__(self, parent_call)</div><div class="line"><a name="l07085"></a><span class="lineno"> 7085</span>&#160;</div><div class="line"><a name="l07086"></a><span class="lineno"> 7086</span>&#160;        <span class="comment"># check that the arguments provided by the algorithm layer are</span></div><div class="line"><a name="l07087"></a><span class="lineno"> 7087</span>&#160;        <span class="comment"># consistent with those expected by the kernel(s)</span></div><div class="line"><a name="l07088"></a><span class="lineno"> 7088</span>&#160;        check_args(call)</div><div class="line"><a name="l07089"></a><span class="lineno"> 7089</span>&#160;</div><div class="line"><a name="l07090"></a><span class="lineno"> 7090</span>&#160;        <span class="comment"># create our arguments and add in stencil information where</span></div><div class="line"><a name="l07091"></a><span class="lineno"> 7091</span>&#160;        <span class="comment"># appropriate.</span></div><div class="line"><a name="l07092"></a><span class="lineno"> 7092</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#a4a439698c79c9b92f236e290c9fab490">_args</a> = []</div><div class="line"><a name="l07093"></a><span class="lineno"> 7093</span>&#160;        idx = 0</div><div class="line"><a name="l07094"></a><span class="lineno"> 7094</span>&#160;        <span class="keywordflow">for</span> arg <span class="keywordflow">in</span> call.ktype.arg_descriptors:</div><div class="line"><a name="l07095"></a><span class="lineno"> 7095</span>&#160;</div><div class="line"><a name="l07096"></a><span class="lineno"> 7096</span>&#160;            dyn_argument = <a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html">DynKernelArgument</a>(self, arg, call.args[idx],</div><div class="line"><a name="l07097"></a><span class="lineno"> 7097</span>&#160;                                             parent_call)</div><div class="line"><a name="l07098"></a><span class="lineno"> 7098</span>&#160;            idx += 1</div><div class="line"><a name="l07099"></a><span class="lineno"> 7099</span>&#160;            <span class="keywordflow">if</span> dyn_argument.descriptor.stencil:</div><div class="line"><a name="l07100"></a><span class="lineno"> 7100</span>&#160;                stencil = <a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynStencil.html">DynStencil</a>(dyn_argument.descriptor.stencil[<span class="stringliteral">&#39;type&#39;</span>])</div><div class="line"><a name="l07101"></a><span class="lineno"> 7101</span>&#160;                <span class="keywordflow">if</span> dyn_argument.descriptor.stencil[<span class="stringliteral">&#39;extent&#39;</span>]:</div><div class="line"><a name="l07102"></a><span class="lineno"> 7102</span>&#160;                    <span class="keywordflow">raise</span> GenerationError(<span class="stringliteral">&quot;extent metadata not yet supported&quot;</span>)</div><div class="line"><a name="l07103"></a><span class="lineno"> 7103</span>&#160;                    <span class="comment"># if supported we would add the following</span></div><div class="line"><a name="l07104"></a><span class="lineno"> 7104</span>&#160;                    <span class="comment"># line. However, note there is currently no setter</span></div><div class="line"><a name="l07105"></a><span class="lineno"> 7105</span>&#160;                    <span class="comment"># for extent in DynStencil so this would need to</span></div><div class="line"><a name="l07106"></a><span class="lineno"> 7106</span>&#160;                    <span class="comment"># be added.  stencil.extent =</span></div><div class="line"><a name="l07107"></a><span class="lineno"> 7107</span>&#160;                    <span class="comment"># dyn_argument.descriptor.stencil[&#39;extent&#39;]</span></div><div class="line"><a name="l07108"></a><span class="lineno"> 7108</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l07109"></a><span class="lineno"> 7109</span>&#160;                    <span class="comment"># an extent argument has been added</span></div><div class="line"><a name="l07110"></a><span class="lineno"> 7110</span>&#160;                    stencil.extent_arg = call.args[idx]</div><div class="line"><a name="l07111"></a><span class="lineno"> 7111</span>&#160;                    <span class="comment"># extent_arg is not a standard dynamo argument, it is</span></div><div class="line"><a name="l07112"></a><span class="lineno"> 7112</span>&#160;                    <span class="comment"># an Arg object created by the parser. Therefore its</span></div><div class="line"><a name="l07113"></a><span class="lineno"> 7113</span>&#160;                    <span class="comment"># name may clash. We register and update the name here.</span></div><div class="line"><a name="l07114"></a><span class="lineno"> 7114</span>&#160;                    unique_name = self._name_space_manager.create_name(</div><div class="line"><a name="l07115"></a><span class="lineno"> 7115</span>&#160;                        root_name=stencil.extent_arg.varName,</div><div class="line"><a name="l07116"></a><span class="lineno"> 7116</span>&#160;                        context=<span class="stringliteral">&quot;AlgArgs&quot;</span>,</div><div class="line"><a name="l07117"></a><span class="lineno"> 7117</span>&#160;                        label=stencil.extent_arg.text)</div><div class="line"><a name="l07118"></a><span class="lineno"> 7118</span>&#160;                    stencil.extent_arg.varName = unique_name</div><div class="line"><a name="l07119"></a><span class="lineno"> 7119</span>&#160;                    idx += 1</div><div class="line"><a name="l07120"></a><span class="lineno"> 7120</span>&#160;                <span class="keywordflow">if</span> dyn_argument.descriptor.stencil[<span class="stringliteral">&#39;type&#39;</span>] == <span class="stringliteral">&#39;xory1d&#39;</span>:</div><div class="line"><a name="l07121"></a><span class="lineno"> 7121</span>&#160;                    <span class="comment"># a direction argument has been added</span></div><div class="line"><a name="l07122"></a><span class="lineno"> 7122</span>&#160;                    stencil.direction_arg = call.args[idx]</div><div class="line"><a name="l07123"></a><span class="lineno"> 7123</span>&#160;                    <span class="keywordflow">if</span> stencil.direction_arg.varName <span class="keywordflow">not</span> <span class="keywordflow">in</span> \</div><div class="line"><a name="l07124"></a><span class="lineno"> 7124</span>&#160;                       VALID_STENCIL_DIRECTIONS:</div><div class="line"><a name="l07125"></a><span class="lineno"> 7125</span>&#160;                        <span class="comment"># direction_arg is not a standard dynamo</span></div><div class="line"><a name="l07126"></a><span class="lineno"> 7126</span>&#160;                        <span class="comment"># argument, it is an Arg object created by the</span></div><div class="line"><a name="l07127"></a><span class="lineno"> 7127</span>&#160;                        <span class="comment"># parser. Therefore its name may clash. We</span></div><div class="line"><a name="l07128"></a><span class="lineno"> 7128</span>&#160;                        <span class="comment"># register and update the name here.</span></div><div class="line"><a name="l07129"></a><span class="lineno"> 7129</span>&#160;                        unique_name = self._name_space_manager.create_name(</div><div class="line"><a name="l07130"></a><span class="lineno"> 7130</span>&#160;                            root_name=stencil.direction_arg.varName,</div><div class="line"><a name="l07131"></a><span class="lineno"> 7131</span>&#160;                            context=<span class="stringliteral">&quot;AlgArgs&quot;</span>,</div><div class="line"><a name="l07132"></a><span class="lineno"> 7132</span>&#160;                            label=stencil.direction_arg.text)</div><div class="line"><a name="l07133"></a><span class="lineno"> 7133</span>&#160;                        stencil.direction_arg.varName = unique_name</div><div class="line"><a name="l07134"></a><span class="lineno"> 7134</span>&#160;                    idx += 1</div><div class="line"><a name="l07135"></a><span class="lineno"> 7135</span>&#160;                dyn_argument.stencil = stencil</div><div class="line"><a name="l07136"></a><span class="lineno"> 7136</span>&#160;            self._args.append(dyn_argument)</div><div class="line"><a name="l07137"></a><span class="lineno"> 7137</span>&#160;</div><div class="line"><a name="l07138"></a><span class="lineno"> 7138</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#ac3e523e0a601b00bb90195bdb8f124f2">_dofs</a> = []</div><div class="line"><a name="l07139"></a><span class="lineno"> 7139</span>&#160;</div><div class="line"><a name="l07140"></a><span class="lineno"> 7140</span>&#160;        <span class="comment"># Generate a static list of unique function-space names used</span></div><div class="line"><a name="l07141"></a><span class="lineno"> 7141</span>&#160;        <span class="comment"># by the set of arguments: store the mangled names as these</span></div><div class="line"><a name="l07142"></a><span class="lineno"> 7142</span>&#160;        <span class="comment"># are what we use at the level of an Invoke</span></div><div class="line"><a name="l07143"></a><span class="lineno"> 7143</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#a4682f6fad0da00b7749d659c09e9f669">_unique_fs_names</a> = []</div><div class="line"><a name="l07144"></a><span class="lineno"> 7144</span>&#160;        <span class="comment"># List of corresponding unique function-space objects</span></div><div class="line"><a name="l07145"></a><span class="lineno"> 7145</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#ad299dc1119f382046b71b25396c1d528">_unique_fss</a> = []</div><div class="line"><a name="l07146"></a><span class="lineno"> 7146</span>&#160;        <span class="keywordflow">for</span> arg <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#a4a439698c79c9b92f236e290c9fab490">_args</a>:</div><div class="line"><a name="l07147"></a><span class="lineno"> 7147</span>&#160;            <span class="keywordflow">for</span> function_space <span class="keywordflow">in</span> arg.function_spaces:</div><div class="line"><a name="l07148"></a><span class="lineno"> 7148</span>&#160;                <span class="comment"># We check that function_space is not None because scalar</span></div><div class="line"><a name="l07149"></a><span class="lineno"> 7149</span>&#160;                <span class="comment"># args don&#39;t have one and fields only have one (only</span></div><div class="line"><a name="l07150"></a><span class="lineno"> 7150</span>&#160;                <span class="comment"># operators have two).</span></div><div class="line"><a name="l07151"></a><span class="lineno"> 7151</span>&#160;                <span class="keywordflow">if</span> function_space <span class="keywordflow">and</span> \</div><div class="line"><a name="l07152"></a><span class="lineno"> 7152</span>&#160;                   function_space.mangled_name <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#a4682f6fad0da00b7749d659c09e9f669">_unique_fs_names</a>:</div><div class="line"><a name="l07153"></a><span class="lineno"> 7153</span>&#160;                    self._unique_fs_names.append(function_space.mangled_name)</div><div class="line"><a name="l07154"></a><span class="lineno"> 7154</span>&#160;                    self._unique_fss.append(function_space)</div><div class="line"><a name="l07155"></a><span class="lineno"> 7155</span>&#160;</div><div class="line"><a name="l07156"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#a32d7ed09bec6ad0a52c21e2c6764efc2"> 7156</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#a32d7ed09bec6ad0a52c21e2c6764efc2">get_arg_on_space_name</a>(self, func_space_name):</div><div class="line"><a name="l07157"></a><span class="lineno"> 7157</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l07158"></a><span class="lineno"> 7158</span>&#160;<span class="stringliteral">        Returns the first argument (field or operator) found that is on</span></div><div class="line"><a name="l07159"></a><span class="lineno"> 7159</span>&#160;<span class="stringliteral">        the named function space, as specified in the kernel metadata. Also</span></div><div class="line"><a name="l07160"></a><span class="lineno"> 7160</span>&#160;<span class="stringliteral">        returns the associated FunctionSpace object.</span></div><div class="line"><a name="l07161"></a><span class="lineno"> 7161</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l07162"></a><span class="lineno"> 7162</span>&#160;<span class="stringliteral">        :param str func_space_name: Name of the function space (as specified \</span></div><div class="line"><a name="l07163"></a><span class="lineno"> 7163</span>&#160;<span class="stringliteral">                                    in kernel meta-data) for which to \</span></div><div class="line"><a name="l07164"></a><span class="lineno"> 7164</span>&#160;<span class="stringliteral">                                    find an argument.</span></div><div class="line"><a name="l07165"></a><span class="lineno"> 7165</span>&#160;<span class="stringliteral">        :return: the first kernel argument that is on the named function \</span></div><div class="line"><a name="l07166"></a><span class="lineno"> 7166</span>&#160;<span class="stringliteral">                 space and the associated FunctionSpace object.</span></div><div class="line"><a name="l07167"></a><span class="lineno"> 7167</span>&#160;<span class="stringliteral">        :rtype: (:py:class:`psyclone.dynamo0p3.DynKernelArgument`,</span></div><div class="line"><a name="l07168"></a><span class="lineno"> 7168</span>&#160;<span class="stringliteral">                 :py:class:`psyclone.dynamo0p3.FunctionSpace`)</span></div><div class="line"><a name="l07169"></a><span class="lineno"> 7169</span>&#160;<span class="stringliteral">        :raises: FieldNotFoundError if no field or operator argument is found \</span></div><div class="line"><a name="l07170"></a><span class="lineno"> 7170</span>&#160;<span class="stringliteral">                 for the named function space.</span></div><div class="line"><a name="l07171"></a><span class="lineno"> 7171</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l07172"></a><span class="lineno"> 7172</span>&#160;        <span class="keywordflow">for</span> arg <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#a4a439698c79c9b92f236e290c9fab490">_args</a>:</div><div class="line"><a name="l07173"></a><span class="lineno"> 7173</span>&#160;            <span class="keywordflow">for</span> function_space <span class="keywordflow">in</span> arg.function_spaces:</div><div class="line"><a name="l07174"></a><span class="lineno"> 7174</span>&#160;                <span class="keywordflow">if</span> function_space:</div><div class="line"><a name="l07175"></a><span class="lineno"> 7175</span>&#160;                    <span class="keywordflow">if</span> func_space_name == function_space.orig_name:</div><div class="line"><a name="l07176"></a><span class="lineno"> 7176</span>&#160;                        <span class="keywordflow">return</span> arg, function_space</div><div class="line"><a name="l07177"></a><span class="lineno"> 7177</span>&#160;        <span class="keywordflow">raise</span> FieldNotFoundError(<span class="stringliteral">&quot;DynKernelArguments:get_arg_on_space_name: &quot;</span></div><div class="line"><a name="l07178"></a><span class="lineno"> 7178</span>&#160;                                 <span class="stringliteral">&quot;there is no field or operator with function &quot;</span></div><div class="line"><a name="l07179"></a><span class="lineno"> 7179</span>&#160;                                 <span class="stringliteral">&quot;space {0}&quot;</span>.format(func_space_name))</div><div class="line"><a name="l07180"></a><span class="lineno"> 7180</span>&#160;</div><div class="line"><a name="l07181"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#a30a9d2a559cc1905e5f3a30af6929fb3"> 7181</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#a30a9d2a559cc1905e5f3a30af6929fb3">get_arg_on_space</a>(self, func_space):</div><div class="line"><a name="l07182"></a><span class="lineno"> 7182</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l07183"></a><span class="lineno"> 7183</span>&#160;<span class="stringliteral">        Returns the first argument (field or operator) found that is on</span></div><div class="line"><a name="l07184"></a><span class="lineno"> 7184</span>&#160;<span class="stringliteral">        the specified function space. The mangled name of the supplied</span></div><div class="line"><a name="l07185"></a><span class="lineno"> 7185</span>&#160;<span class="stringliteral">        function space is used for comparison.</span></div><div class="line"><a name="l07186"></a><span class="lineno"> 7186</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l07187"></a><span class="lineno"> 7187</span>&#160;<span class="stringliteral">        :param func_space: The function space for which to find an argument.</span></div><div class="line"><a name="l07188"></a><span class="lineno"> 7188</span>&#160;<span class="stringliteral">        :type func_space: :py:class:`psyclone.dynamo0p3.FunctionSpace`</span></div><div class="line"><a name="l07189"></a><span class="lineno"> 7189</span>&#160;<span class="stringliteral">        :return: the first kernel argument that is on the supplied function</span></div><div class="line"><a name="l07190"></a><span class="lineno"> 7190</span>&#160;<span class="stringliteral">                 space</span></div><div class="line"><a name="l07191"></a><span class="lineno"> 7191</span>&#160;<span class="stringliteral">        :rtype: :py:class:`psyclone.dynamo0p3.DynKernelArgument`</span></div><div class="line"><a name="l07192"></a><span class="lineno"> 7192</span>&#160;<span class="stringliteral">        :raises: FieldNotFoundError if no field or operator argument is found</span></div><div class="line"><a name="l07193"></a><span class="lineno"> 7193</span>&#160;<span class="stringliteral">                 for the specified function space.</span></div><div class="line"><a name="l07194"></a><span class="lineno"> 7194</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l07195"></a><span class="lineno"> 7195</span>&#160;        <span class="keywordflow">for</span> arg <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#a4a439698c79c9b92f236e290c9fab490">_args</a>:</div><div class="line"><a name="l07196"></a><span class="lineno"> 7196</span>&#160;            <span class="keywordflow">for</span> function_space <span class="keywordflow">in</span> arg.function_spaces:</div><div class="line"><a name="l07197"></a><span class="lineno"> 7197</span>&#160;                <span class="keywordflow">if</span> function_space:</div><div class="line"><a name="l07198"></a><span class="lineno"> 7198</span>&#160;                    <span class="keywordflow">if</span> func_space.mangled_name == function_space.mangled_name:</div><div class="line"><a name="l07199"></a><span class="lineno"> 7199</span>&#160;                        <span class="keywordflow">return</span> arg</div><div class="line"><a name="l07200"></a><span class="lineno"> 7200</span>&#160;        <span class="keywordflow">raise</span> FieldNotFoundError(<span class="stringliteral">&quot;DynKernelArguments:get_arg_on_space: there &quot;</span></div><div class="line"><a name="l07201"></a><span class="lineno"> 7201</span>&#160;                                 <span class="stringliteral">&quot;is no field or operator with function space &quot;</span></div><div class="line"><a name="l07202"></a><span class="lineno"> 7202</span>&#160;                                 <span class="stringliteral">&quot;{0} (mangled name = &#39;{1}&#39;)&quot;</span>.format(</div><div class="line"><a name="l07203"></a><span class="lineno"> 7203</span>&#160;                                     func_space.orig_name,</div><div class="line"><a name="l07204"></a><span class="lineno"> 7204</span>&#160;                                     func_space.mangled_name))</div><div class="line"><a name="l07205"></a><span class="lineno"> 7205</span>&#160;</div><div class="line"><a name="l07206"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#aa612aed9e376d3ad8affef9803e381ae"> 7206</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#aa612aed9e376d3ad8affef9803e381ae">has_operator</a>(self, op_type=None):</div><div class="line"><a name="l07207"></a><span class="lineno"> 7207</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Returns true if at least one of the arguments is an operator</span></div><div class="line"><a name="l07208"></a><span class="lineno"> 7208</span>&#160;<span class="stringliteral">        of type op_type (either gh_operator [LMA] or gh_columnwise_operator</span></div><div class="line"><a name="l07209"></a><span class="lineno"> 7209</span>&#160;<span class="stringliteral">        [CMA]). If op_type is None then searches for *any* valid operator</span></div><div class="line"><a name="l07210"></a><span class="lineno"> 7210</span>&#160;<span class="stringliteral">        type. &#39;&#39;&#39;</span></div><div class="line"><a name="l07211"></a><span class="lineno"> 7211</span>&#160;        <span class="keywordflow">if</span> op_type <span class="keywordflow">and</span> op_type <span class="keywordflow">not</span> <span class="keywordflow">in</span> VALID_OPERATOR_NAMES:</div><div class="line"><a name="l07212"></a><span class="lineno"> 7212</span>&#160;            <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l07213"></a><span class="lineno"> 7213</span>&#160;                <span class="stringliteral">&quot;If supplied, op_type must be a valid operator type (one &quot;</span></div><div class="line"><a name="l07214"></a><span class="lineno"> 7214</span>&#160;                <span class="stringliteral">&quot;of {0}) but got {1}&quot;</span>.format(VALID_OPERATOR_NAMES, op_type))</div><div class="line"><a name="l07215"></a><span class="lineno"> 7215</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> op_type:</div><div class="line"><a name="l07216"></a><span class="lineno"> 7216</span>&#160;            <span class="comment"># If no operator type is specified then we match any type</span></div><div class="line"><a name="l07217"></a><span class="lineno"> 7217</span>&#160;            op_list = VALID_OPERATOR_NAMES</div><div class="line"><a name="l07218"></a><span class="lineno"> 7218</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l07219"></a><span class="lineno"> 7219</span>&#160;            op_list = [op_type]</div><div class="line"><a name="l07220"></a><span class="lineno"> 7220</span>&#160;        <span class="keywordflow">for</span> arg <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#a4a439698c79c9b92f236e290c9fab490">_args</a>:</div><div class="line"><a name="l07221"></a><span class="lineno"> 7221</span>&#160;            <span class="keywordflow">if</span> arg.type <span class="keywordflow">in</span> op_list:</div><div class="line"><a name="l07222"></a><span class="lineno"> 7222</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">True</span></div><div class="line"><a name="l07223"></a><span class="lineno"> 7223</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">False</span></div><div class="line"><a name="l07224"></a><span class="lineno"> 7224</span>&#160;</div><div class="line"><a name="l07225"></a><span class="lineno"> 7225</span>&#160;    @property</div><div class="line"><a name="l07226"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#ad6b04096013fae62ba4d1f770c1fb142"> 7226</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#ad6b04096013fae62ba4d1f770c1fb142">unique_fss</a>(self):</div><div class="line"><a name="l07227"></a><span class="lineno"> 7227</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Returns a unique list of function space objects used by the</span></div><div class="line"><a name="l07228"></a><span class="lineno"> 7228</span>&#160;<span class="stringliteral">        arguments of this kernel &#39;&#39;&#39;</span></div><div class="line"><a name="l07229"></a><span class="lineno"> 7229</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#ad299dc1119f382046b71b25396c1d528">_unique_fss</a></div><div class="line"><a name="l07230"></a><span class="lineno"> 7230</span>&#160;</div><div class="line"><a name="l07231"></a><span class="lineno"> 7231</span>&#160;    @property</div><div class="line"><a name="l07232"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#aac022ea68219a9796fdc3adcf19f9c70"> 7232</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#aac022ea68219a9796fdc3adcf19f9c70">unique_fs_names</a>(self):</div><div class="line"><a name="l07233"></a><span class="lineno"> 7233</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Return the list of unique function space names used by the</span></div><div class="line"><a name="l07234"></a><span class="lineno"> 7234</span>&#160;<span class="stringliteral">        arguments of this kernel. The names are unmangled (i.e. as</span></div><div class="line"><a name="l07235"></a><span class="lineno"> 7235</span>&#160;<span class="stringliteral">        specified in the kernel metadata) &#39;&#39;&#39;</span></div><div class="line"><a name="l07236"></a><span class="lineno"> 7236</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#a4682f6fad0da00b7749d659c09e9f669">_unique_fs_names</a></div><div class="line"><a name="l07237"></a><span class="lineno"> 7237</span>&#160;</div><div class="line"><a name="l07238"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#a58d251915c3889ff6582e39d226c83c1"> 7238</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#a58d251915c3889ff6582e39d226c83c1">iteration_space_arg</a>(self, mapping=None):</div><div class="line"><a name="l07239"></a><span class="lineno"> 7239</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l07240"></a><span class="lineno"> 7240</span>&#160;<span class="stringliteral">        Returns an argument we can use to dereference the iteration</span></div><div class="line"><a name="l07241"></a><span class="lineno"> 7241</span>&#160;<span class="stringliteral">        space. This can be a field or operator that is modified or</span></div><div class="line"><a name="l07242"></a><span class="lineno"> 7242</span>&#160;<span class="stringliteral">        alternatively a field that is read if one or more scalars</span></div><div class="line"><a name="l07243"></a><span class="lineno"> 7243</span>&#160;<span class="stringliteral">        are modified. If a kernel writes to more than one argument then</span></div><div class="line"><a name="l07244"></a><span class="lineno"> 7244</span>&#160;<span class="stringliteral">        that requiring the largest iteration space is selected.</span></div><div class="line"><a name="l07245"></a><span class="lineno"> 7245</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l07246"></a><span class="lineno"> 7246</span>&#160;<span class="stringliteral">        :param dict mapping: un-used argument. Retained for consistency</span></div><div class="line"><a name="l07247"></a><span class="lineno"> 7247</span>&#160;<span class="stringliteral">                             with base class.</span></div><div class="line"><a name="l07248"></a><span class="lineno"> 7248</span>&#160;<span class="stringliteral">        :return: Kernel argument from which to obtain iteration space</span></div><div class="line"><a name="l07249"></a><span class="lineno"> 7249</span>&#160;<span class="stringliteral">        :rtype: :py:class:`psyclone.dynamo0p3.DynKernelArgument`</span></div><div class="line"><a name="l07250"></a><span class="lineno"> 7250</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l07251"></a><span class="lineno"> 7251</span>&#160;</div><div class="line"><a name="l07252"></a><span class="lineno"> 7252</span>&#160;        <span class="comment"># Since we always compute operators out to the L1 halo we first</span></div><div class="line"><a name="l07253"></a><span class="lineno"> 7253</span>&#160;        <span class="comment"># check whether this kernel writes to an operator</span></div><div class="line"><a name="l07254"></a><span class="lineno"> 7254</span>&#160;        op_args = psyGen.args_filter(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#a4a439698c79c9b92f236e290c9fab490">_args</a>,</div><div class="line"><a name="l07255"></a><span class="lineno"> 7255</span>&#160;                                     arg_types=VALID_OPERATOR_NAMES,</div><div class="line"><a name="l07256"></a><span class="lineno"> 7256</span>&#160;                                     arg_accesses=GH_WRITE_ACCESSES)</div><div class="line"><a name="l07257"></a><span class="lineno"> 7257</span>&#160;        <span class="keywordflow">if</span> op_args:</div><div class="line"><a name="l07258"></a><span class="lineno"> 7258</span>&#160;            <span class="keywordflow">return</span> op_args[0]</div><div class="line"><a name="l07259"></a><span class="lineno"> 7259</span>&#160;</div><div class="line"><a name="l07260"></a><span class="lineno"> 7260</span>&#160;        <span class="comment"># Is this an inter-grid kernel? If so, then the iteration space</span></div><div class="line"><a name="l07261"></a><span class="lineno"> 7261</span>&#160;        <span class="comment"># is determined by the coarse mesh, irrespective of whether</span></div><div class="line"><a name="l07262"></a><span class="lineno"> 7262</span>&#160;        <span class="comment"># we are prolonging (and thus writing to a field on the fine mesh)</span></div><div class="line"><a name="l07263"></a><span class="lineno"> 7263</span>&#160;        <span class="comment"># or restricting.</span></div><div class="line"><a name="l07264"></a><span class="lineno"> 7264</span>&#160;        <span class="keywordflow">if</span> self._parent_call.is_intergrid:</div><div class="line"><a name="l07265"></a><span class="lineno"> 7265</span>&#160;            fld_args = psyGen.args_filter(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#a4a439698c79c9b92f236e290c9fab490">_args</a>,</div><div class="line"><a name="l07266"></a><span class="lineno"> 7266</span>&#160;                                          arg_types=[<span class="stringliteral">&quot;gh_field&quot;</span>],</div><div class="line"><a name="l07267"></a><span class="lineno"> 7267</span>&#160;                                          arg_meshes=[<span class="stringliteral">&quot;gh_coarse&quot;</span>])</div><div class="line"><a name="l07268"></a><span class="lineno"> 7268</span>&#160;            <span class="keywordflow">return</span> fld_args[0]</div><div class="line"><a name="l07269"></a><span class="lineno"> 7269</span>&#160;</div><div class="line"><a name="l07270"></a><span class="lineno"> 7270</span>&#160;        <span class="comment"># This is not an inter-grid kernel and it does not write to an</span></div><div class="line"><a name="l07271"></a><span class="lineno"> 7271</span>&#160;        <span class="comment"># operator. We now check for fields that are written to. We</span></div><div class="line"><a name="l07272"></a><span class="lineno"> 7272</span>&#160;        <span class="comment"># check first for any modified field on a continuous function</span></div><div class="line"><a name="l07273"></a><span class="lineno"> 7273</span>&#160;        <span class="comment"># space, failing that we try any_space function spaces</span></div><div class="line"><a name="l07274"></a><span class="lineno"> 7274</span>&#160;        <span class="comment"># (because we must assume such a space is continuous) and</span></div><div class="line"><a name="l07275"></a><span class="lineno"> 7275</span>&#160;        <span class="comment"># finally we try discontinuous function spaces. We do this</span></div><div class="line"><a name="l07276"></a><span class="lineno"> 7276</span>&#160;        <span class="comment"># because if a quantity on a continuous FS is modified then</span></div><div class="line"><a name="l07277"></a><span class="lineno"> 7277</span>&#160;        <span class="comment"># our iteration space must be larger (include L1 halo cells)</span></div><div class="line"><a name="l07278"></a><span class="lineno"> 7278</span>&#160;        fld_args = psyGen.args_filter(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#a4a439698c79c9b92f236e290c9fab490">_args</a>,</div><div class="line"><a name="l07279"></a><span class="lineno"> 7279</span>&#160;                                      arg_types=[<span class="stringliteral">&quot;gh_field&quot;</span>],</div><div class="line"><a name="l07280"></a><span class="lineno"> 7280</span>&#160;                                      arg_accesses=GH_WRITE_ACCESSES)</div><div class="line"><a name="l07281"></a><span class="lineno"> 7281</span>&#160;        <span class="keywordflow">if</span> fld_args:</div><div class="line"><a name="l07282"></a><span class="lineno"> 7282</span>&#160;            <span class="keywordflow">for</span> spaces <span class="keywordflow">in</span> [CONTINUOUS_FUNCTION_SPACES,</div><div class="line"><a name="l07283"></a><span class="lineno"> 7283</span>&#160;                           VALID_ANY_SPACE_NAMES,</div><div class="line"><a name="l07284"></a><span class="lineno"> 7284</span>&#160;                           DISCONTINUOUS_FUNCTION_SPACES]:</div><div class="line"><a name="l07285"></a><span class="lineno"> 7285</span>&#160;                <span class="keywordflow">for</span> arg <span class="keywordflow">in</span> fld_args:</div><div class="line"><a name="l07286"></a><span class="lineno"> 7286</span>&#160;                    <span class="keywordflow">if</span> arg.function_space.orig_name <span class="keywordflow">in</span> spaces:</div><div class="line"><a name="l07287"></a><span class="lineno"> 7287</span>&#160;                        <span class="keywordflow">return</span> arg</div><div class="line"><a name="l07288"></a><span class="lineno"> 7288</span>&#160;</div><div class="line"><a name="l07289"></a><span class="lineno"> 7289</span>&#160;        <span class="comment"># No modified fields or operators. Check for unmodified fields...</span></div><div class="line"><a name="l07290"></a><span class="lineno"> 7290</span>&#160;        fld_args = psyGen.args_filter(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#a4a439698c79c9b92f236e290c9fab490">_args</a>, arg_types=[<span class="stringliteral">&quot;gh_field&quot;</span>])</div><div class="line"><a name="l07291"></a><span class="lineno"> 7291</span>&#160;        <span class="keywordflow">if</span> fld_args:</div><div class="line"><a name="l07292"></a><span class="lineno"> 7292</span>&#160;            <span class="keywordflow">return</span> fld_args[0]</div><div class="line"><a name="l07293"></a><span class="lineno"> 7293</span>&#160;</div><div class="line"><a name="l07294"></a><span class="lineno"> 7294</span>&#160;        <span class="comment"># it is an error if we get to here</span></div><div class="line"><a name="l07295"></a><span class="lineno"> 7295</span>&#160;        <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l07296"></a><span class="lineno"> 7296</span>&#160;            <span class="stringliteral">&quot;iteration_space_arg(). The dynamo0.3 api must have a modified &quot;</span></div><div class="line"><a name="l07297"></a><span class="lineno"> 7297</span>&#160;            <span class="stringliteral">&quot;field, a modified operator, or an unmodified field (in the case &quot;</span></div><div class="line"><a name="l07298"></a><span class="lineno"> 7298</span>&#160;            <span class="stringliteral">&quot;of a modified scalar). None of these were found.&quot;</span>)</div><div class="line"><a name="l07299"></a><span class="lineno"> 7299</span>&#160;</div><div class="line"><a name="l07300"></a><span class="lineno"> 7300</span>&#160;    @property</div><div class="line"><a name="l07301"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#aa9eb467f474a7cbca90c1d36d006e4f0"> 7301</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#aa9eb467f474a7cbca90c1d36d006e4f0">dofs</a>(self):</div><div class="line"><a name="l07302"></a><span class="lineno"> 7302</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Currently required for Invoke base class although this</span></div><div class="line"><a name="l07303"></a><span class="lineno"> 7303</span>&#160;<span class="stringliteral">        makes no sense for Dynamo. Need to refactor the Invoke base class</span></div><div class="line"><a name="l07304"></a><span class="lineno"> 7304</span>&#160;<span class="stringliteral">        and remove the need for this property (#279). &#39;&#39;&#39;</span></div><div class="line"><a name="l07305"></a><span class="lineno"> 7305</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#ac3e523e0a601b00bb90195bdb8f124f2">_dofs</a></div><div class="line"><a name="l07306"></a><span class="lineno"> 7306</span>&#160;</div><div class="line"><a name="l07307"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#a80d9f96e3b25dc55c858c9cdcbb75c19"> 7307</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#a80d9f96e3b25dc55c858c9cdcbb75c19">raw_arg_list</a>(self, parent):</div><div class="line"><a name="l07308"></a><span class="lineno"> 7308</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l07309"></a><span class="lineno"> 7309</span>&#160;<span class="stringliteral">        Constructs the class-specific argument list for a kernel.</span></div><div class="line"><a name="l07310"></a><span class="lineno"> 7310</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l07311"></a><span class="lineno"> 7311</span>&#160;<span class="stringliteral">        :param parent: the parent (in the PSyIR) of the kernel call with \</span></div><div class="line"><a name="l07312"></a><span class="lineno"> 7312</span>&#160;<span class="stringliteral">                       which this argument list is associated.</span></div><div class="line"><a name="l07313"></a><span class="lineno"> 7313</span>&#160;<span class="stringliteral">        :type parent: sub-class of :py:class:`psyclone.psyGen.Call`</span></div><div class="line"><a name="l07314"></a><span class="lineno"> 7314</span>&#160;<span class="stringliteral">        :returns: a list of all of the actual arguments to the \</span></div><div class="line"><a name="l07315"></a><span class="lineno"> 7315</span>&#160;<span class="stringliteral">                  kernel call.</span></div><div class="line"><a name="l07316"></a><span class="lineno"> 7316</span>&#160;<span class="stringliteral">        :rtype: list of str.</span></div><div class="line"><a name="l07317"></a><span class="lineno"> 7317</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l07318"></a><span class="lineno"> 7318</span>&#160;        create_arg_list = <a class="code" href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html">KernCallArgList</a>(self._parent_call, parent)</div><div class="line"><a name="l07319"></a><span class="lineno"> 7319</span>&#160;        create_arg_list.generate()</div><div class="line"><a name="l07320"></a><span class="lineno"> 7320</span>&#160;        <span class="comment"># TODO #268 the functionality of KernCallArgList and</span></div><div class="line"><a name="l07321"></a><span class="lineno"> 7321</span>&#160;        <span class="comment"># DynKernelArguments needs revisiting. In particular,</span></div><div class="line"><a name="l07322"></a><span class="lineno"> 7322</span>&#160;        <span class="comment"># KernCallArgList.generate() modifies the PSy AST (in</span></div><div class="line"><a name="l07323"></a><span class="lineno"> 7323</span>&#160;        <span class="comment"># `field_bcs_kernel()`) if the special boundary-condition</span></div><div class="line"><a name="l07324"></a><span class="lineno"> 7324</span>&#160;        <span class="comment"># kernel is called.</span></div><div class="line"><a name="l07325"></a><span class="lineno"> 7325</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#a25a3ab835728fdb15a39db9e2be2df23">_raw_arg_list</a> = create_arg_list.arglist</div><div class="line"><a name="l07326"></a><span class="lineno"> 7326</span>&#160;</div><div class="line"><a name="l07327"></a><span class="lineno"> 7327</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#a25a3ab835728fdb15a39db9e2be2df23">_raw_arg_list</a></div><div class="line"><a name="l07328"></a><span class="lineno"> 7328</span>&#160;</div><div class="line"><a name="l07329"></a><span class="lineno"> 7329</span>&#160;</div><div class="line"><a name="l07330"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html"> 7330</a></span>&#160;<span class="keyword">class </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html">DynKernelArgument</a>(KernelArgument):</div><div class="line"><a name="l07331"></a><span class="lineno"> 7331</span>&#160;    <span class="stringliteral">&#39;&#39;&#39; Provides information about individual Dynamo kernel call</span></div><div class="line"><a name="l07332"></a><span class="lineno"> 7332</span>&#160;<span class="stringliteral">    arguments as specified by the kernel argument metadata. &#39;&#39;&#39;</span></div><div class="line"><a name="l07333"></a><span class="lineno"> 7333</span>&#160;</div><div class="line"><a name="l07334"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a25c28eaa006a7c3e8d6dd648f2302051"> 7334</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a25c28eaa006a7c3e8d6dd648f2302051">__init__</a>(self, kernel_args, arg_meta_data, arg_info, call):</div><div class="line"><a name="l07335"></a><span class="lineno"> 7335</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l07336"></a><span class="lineno"> 7336</span>&#160;<span class="stringliteral">        :param kernel_args: Object encapsulating all arguments to the</span></div><div class="line"><a name="l07337"></a><span class="lineno"> 7337</span>&#160;<span class="stringliteral">                            kernel call</span></div><div class="line"><a name="l07338"></a><span class="lineno"> 7338</span>&#160;<span class="stringliteral">        :type kernel_args: :py:class:`psyclone.dynamo0p3.DynKernelArguments`</span></div><div class="line"><a name="l07339"></a><span class="lineno"> 7339</span>&#160;<span class="stringliteral">        :param arg_meta_data: Information obtained from the meta-data for</span></div><div class="line"><a name="l07340"></a><span class="lineno"> 7340</span>&#160;<span class="stringliteral">                              this kernel argument</span></div><div class="line"><a name="l07341"></a><span class="lineno"> 7341</span>&#160;<span class="stringliteral">        :type arg_meta_data: :py:class:`psyclone.dynamo0p3.DynArgDescriptor03`</span></div><div class="line"><a name="l07342"></a><span class="lineno"> 7342</span>&#160;<span class="stringliteral">        :param arg_info: Information on how this argument is specified in the</span></div><div class="line"><a name="l07343"></a><span class="lineno"> 7343</span>&#160;<span class="stringliteral">                         Algorithm layer</span></div><div class="line"><a name="l07344"></a><span class="lineno"> 7344</span>&#160;<span class="stringliteral">        :type arg_info: :py:class:`psyclone.parse.Arg`</span></div><div class="line"><a name="l07345"></a><span class="lineno"> 7345</span>&#160;<span class="stringliteral">        :param call: The kernel object with which this argument is associated</span></div><div class="line"><a name="l07346"></a><span class="lineno"> 7346</span>&#160;<span class="stringliteral">        :type call: :py:class:`psyclone.dynamo0p3.DynKern`</span></div><div class="line"><a name="l07347"></a><span class="lineno"> 7347</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l07348"></a><span class="lineno"> 7348</span>&#160;        KernelArgument.__init__(self, arg_meta_data, arg_info, call)</div><div class="line"><a name="l07349"></a><span class="lineno"> 7349</span>&#160;        <span class="comment"># Keep a reference to DynKernelArguments object that contains</span></div><div class="line"><a name="l07350"></a><span class="lineno"> 7350</span>&#160;        <span class="comment"># this argument. This permits us to manage name-mangling for</span></div><div class="line"><a name="l07351"></a><span class="lineno"> 7351</span>&#160;        <span class="comment"># any-space function spaces.</span></div><div class="line"><a name="l07352"></a><span class="lineno"> 7352</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a994d27bdaf1d29c30e508db47eb33f6c">_kernel_args</a> = kernel_args</div><div class="line"><a name="l07353"></a><span class="lineno"> 7353</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a9dd50f153433fae3bce3c3442c097e54">_vector_size</a> = arg_meta_data.vector_size</div><div class="line"><a name="l07354"></a><span class="lineno"> 7354</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a723a46e22ca1bfd25ad827b44d7f7671">_type</a> = arg_meta_data.type</div><div class="line"><a name="l07355"></a><span class="lineno"> 7355</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a30bcb867988b5fd1a82b4fa4da78c66f">_stencil</a> = <span class="keywordtype">None</span></div><div class="line"><a name="l07356"></a><span class="lineno"> 7356</span>&#160;        <span class="keywordflow">if</span> arg_meta_data.mesh:</div><div class="line"><a name="l07357"></a><span class="lineno"> 7357</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a95b945c313a25aa24f690d01539602a0">_mesh</a> = arg_meta_data.mesh.lower()</div><div class="line"><a name="l07358"></a><span class="lineno"> 7358</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l07359"></a><span class="lineno"> 7359</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a95b945c313a25aa24f690d01539602a0">_mesh</a> = <span class="keywordtype">None</span></div><div class="line"><a name="l07360"></a><span class="lineno"> 7360</span>&#160;</div><div class="line"><a name="l07361"></a><span class="lineno"> 7361</span>&#160;        <span class="comment"># The list of function-space objects for this argument. Each</span></div><div class="line"><a name="l07362"></a><span class="lineno"> 7362</span>&#160;        <span class="comment"># object can be queried for its original name and for the</span></div><div class="line"><a name="l07363"></a><span class="lineno"> 7363</span>&#160;        <span class="comment"># mangled name (used to make any-space arguments distinct</span></div><div class="line"><a name="l07364"></a><span class="lineno"> 7364</span>&#160;        <span class="comment"># within an invoke). The argument will only have more than</span></div><div class="line"><a name="l07365"></a><span class="lineno"> 7365</span>&#160;        <span class="comment"># one function-space associated with it if it is an operator.</span></div><div class="line"><a name="l07366"></a><span class="lineno"> 7366</span>&#160;        fs1 = <span class="keywordtype">None</span></div><div class="line"><a name="l07367"></a><span class="lineno"> 7367</span>&#160;        fs2 = <span class="keywordtype">None</span></div><div class="line"><a name="l07368"></a><span class="lineno"> 7368</span>&#160;</div><div class="line"><a name="l07369"></a><span class="lineno"> 7369</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#aa76431f4e517f4c74182b5bfb41075c1">is_operator</a>:</div><div class="line"><a name="l07370"></a><span class="lineno"> 7370</span>&#160;</div><div class="line"><a name="l07371"></a><span class="lineno"> 7371</span>&#160;            fs1 = <a class="code" href="classpsyclone_1_1dynamo0p3_1_1FunctionSpace.html">FunctionSpace</a>(arg_meta_data.function_space_to,</div><div class="line"><a name="l07372"></a><span class="lineno"> 7372</span>&#160;                                self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a994d27bdaf1d29c30e508db47eb33f6c">_kernel_args</a>)</div><div class="line"><a name="l07373"></a><span class="lineno"> 7373</span>&#160;            fs2 = <a class="code" href="classpsyclone_1_1dynamo0p3_1_1FunctionSpace.html">FunctionSpace</a>(arg_meta_data.function_space_from,</div><div class="line"><a name="l07374"></a><span class="lineno"> 7374</span>&#160;                                self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a994d27bdaf1d29c30e508db47eb33f6c">_kernel_args</a>)</div><div class="line"><a name="l07375"></a><span class="lineno"> 7375</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l07376"></a><span class="lineno"> 7376</span>&#160;            <span class="keywordflow">if</span> arg_meta_data.function_space:</div><div class="line"><a name="l07377"></a><span class="lineno"> 7377</span>&#160;                fs1 = <a class="code" href="classpsyclone_1_1dynamo0p3_1_1FunctionSpace.html">FunctionSpace</a>(arg_meta_data.function_space,</div><div class="line"><a name="l07378"></a><span class="lineno"> 7378</span>&#160;                                    self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a994d27bdaf1d29c30e508db47eb33f6c">_kernel_args</a>)</div><div class="line"><a name="l07379"></a><span class="lineno"> 7379</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#af7400b005b0ad1586551587cf73594d6">_function_spaces</a> = [fs1, fs2]</div><div class="line"><a name="l07380"></a><span class="lineno"> 7380</span>&#160;</div><div class="line"><a name="l07381"></a><span class="lineno"> 7381</span>&#160;    @property</div><div class="line"><a name="l07382"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#ae0c8e8f769521a1f5f7d096f84b3e780"> 7382</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#ae0c8e8f769521a1f5f7d096f84b3e780">descriptor</a>(self):</div><div class="line"><a name="l07383"></a><span class="lineno"> 7383</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; return a descriptor object which contains Kernel</span></div><div class="line"><a name="l07384"></a><span class="lineno"> 7384</span>&#160;<span class="stringliteral">        metadata about this argument &#39;&#39;&#39;</span></div><div class="line"><a name="l07385"></a><span class="lineno"> 7385</span>&#160;        <span class="keywordflow">return</span> self._arg</div><div class="line"><a name="l07386"></a><span class="lineno"> 7386</span>&#160;</div><div class="line"><a name="l07387"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#ace6467a73d1d127d6407f1bf74d919ac"> 7387</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#ace6467a73d1d127d6407f1bf74d919ac">ref_name</a>(self, function_space=None):</div><div class="line"><a name="l07388"></a><span class="lineno"> 7388</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l07389"></a><span class="lineno"> 7389</span>&#160;<span class="stringliteral">        Returns the name used to dereference this type of argument (depends</span></div><div class="line"><a name="l07390"></a><span class="lineno"> 7390</span>&#160;<span class="stringliteral">        on whether it is a field or operator and, if the latter, whether it</span></div><div class="line"><a name="l07391"></a><span class="lineno"> 7391</span>&#160;<span class="stringliteral">        is the to- or from-space that is specified).</span></div><div class="line"><a name="l07392"></a><span class="lineno"> 7392</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l07393"></a><span class="lineno"> 7393</span>&#160;<span class="stringliteral">        :param function_space: the function space of this argument</span></div><div class="line"><a name="l07394"></a><span class="lineno"> 7394</span>&#160;<span class="stringliteral">        :type function_space: :py:class:`psyclone.dynamo0p3.FunctionSpace`</span></div><div class="line"><a name="l07395"></a><span class="lineno"> 7395</span>&#160;<span class="stringliteral">        :return: the name used to dereference this argument</span></div><div class="line"><a name="l07396"></a><span class="lineno"> 7396</span>&#160;<span class="stringliteral">        :rtype: str</span></div><div class="line"><a name="l07397"></a><span class="lineno"> 7397</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l07398"></a><span class="lineno"> 7398</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> function_space:</div><div class="line"><a name="l07399"></a><span class="lineno"> 7399</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#aa76431f4e517f4c74182b5bfb41075c1">is_operator</a>:</div><div class="line"><a name="l07400"></a><span class="lineno"> 7400</span>&#160;                <span class="comment"># For an operator we use the &#39;from&#39; FS</span></div><div class="line"><a name="l07401"></a><span class="lineno"> 7401</span>&#160;                function_space = self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#af7400b005b0ad1586551587cf73594d6">_function_spaces</a>[1]</div><div class="line"><a name="l07402"></a><span class="lineno"> 7402</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l07403"></a><span class="lineno"> 7403</span>&#160;                function_space = self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#af7400b005b0ad1586551587cf73594d6">_function_spaces</a>[0]</div><div class="line"><a name="l07404"></a><span class="lineno"> 7404</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l07405"></a><span class="lineno"> 7405</span>&#160;            <span class="comment"># Check that the supplied function space is valid for this</span></div><div class="line"><a name="l07406"></a><span class="lineno"> 7406</span>&#160;            <span class="comment"># argument</span></div><div class="line"><a name="l07407"></a><span class="lineno"> 7407</span>&#160;            found = <span class="keyword">False</span></div><div class="line"><a name="l07408"></a><span class="lineno"> 7408</span>&#160;            <span class="keywordflow">for</span> fspace <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a1428144924709de07d4f391bd852656f">function_spaces</a>:</div><div class="line"><a name="l07409"></a><span class="lineno"> 7409</span>&#160;                <span class="keywordflow">if</span> fspace <span class="keywordflow">and</span> fspace.orig_name == function_space.orig_name:</div><div class="line"><a name="l07410"></a><span class="lineno"> 7410</span>&#160;                    found = <span class="keyword">True</span></div><div class="line"><a name="l07411"></a><span class="lineno"> 7411</span>&#160;                    <span class="keywordflow">break</span></div><div class="line"><a name="l07412"></a><span class="lineno"> 7412</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> found:</div><div class="line"><a name="l07413"></a><span class="lineno"> 7413</span>&#160;                <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l07414"></a><span class="lineno"> 7414</span>&#160;                    <span class="stringliteral">&quot;DynKernelArgument:ref_name(fs). The supplied function &quot;</span></div><div class="line"><a name="l07415"></a><span class="lineno"> 7415</span>&#160;                    <span class="stringliteral">&quot;space (fs=&#39;{0}&#39;) is not one of the function spaces &quot;</span></div><div class="line"><a name="l07416"></a><span class="lineno"> 7416</span>&#160;                    <span class="stringliteral">&quot;associated with this argument (fss=&#39;{1}&#39;)&quot;</span>.format(</div><div class="line"><a name="l07417"></a><span class="lineno"> 7417</span>&#160;                        function_space.orig_name,</div><div class="line"><a name="l07418"></a><span class="lineno"> 7418</span>&#160;                        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#ae458c2e6b919e526afda5a48d46b61dc">function_space_names</a>))</div><div class="line"><a name="l07419"></a><span class="lineno"> 7419</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a723a46e22ca1bfd25ad827b44d7f7671">_type</a> == <span class="stringliteral">&quot;gh_field&quot;</span>:</div><div class="line"><a name="l07420"></a><span class="lineno"> 7420</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;vspace&quot;</span></div><div class="line"><a name="l07421"></a><span class="lineno"> 7421</span>&#160;        <span class="keywordflow">elif</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#aa76431f4e517f4c74182b5bfb41075c1">is_operator</a>:</div><div class="line"><a name="l07422"></a><span class="lineno"> 7422</span>&#160;            <span class="keywordflow">if</span> function_space.orig_name == self.descriptor.function_space_from:</div><div class="line"><a name="l07423"></a><span class="lineno"> 7423</span>&#160;                <span class="keywordflow">return</span> <span class="stringliteral">&quot;fs_from&quot;</span></div><div class="line"><a name="l07424"></a><span class="lineno"> 7424</span>&#160;            <span class="keywordflow">elif</span> function_space.orig_name == self.descriptor.function_space_to:</div><div class="line"><a name="l07425"></a><span class="lineno"> 7425</span>&#160;                <span class="keywordflow">return</span> <span class="stringliteral">&quot;fs_to&quot;</span></div><div class="line"><a name="l07426"></a><span class="lineno"> 7426</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l07427"></a><span class="lineno"> 7427</span>&#160;                <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l07428"></a><span class="lineno"> 7428</span>&#160;                    <span class="stringliteral">&quot;ref_name: Error, function space &#39;{0}&#39; is one of the &quot;</span></div><div class="line"><a name="l07429"></a><span class="lineno"> 7429</span>&#160;                    <span class="stringliteral">&quot;gh_operator function spaces &#39;{1}&#39; but is not being &quot;</span></div><div class="line"><a name="l07430"></a><span class="lineno"> 7430</span>&#160;                    <span class="stringliteral">&quot;returned by either function_space from &#39;{2}&#39; or &quot;</span></div><div class="line"><a name="l07431"></a><span class="lineno"> 7431</span>&#160;                    <span class="stringliteral">&quot;function_space_to &#39;{3}&#39;&quot;</span>.format(</div><div class="line"><a name="l07432"></a><span class="lineno"> 7432</span>&#160;                        function_space.orig_name, self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a1428144924709de07d4f391bd852656f">function_spaces</a>,</div><div class="line"><a name="l07433"></a><span class="lineno"> 7433</span>&#160;                        self.descriptor.function_space_from,</div><div class="line"><a name="l07434"></a><span class="lineno"> 7434</span>&#160;                        self.descriptor.function_space_to))</div><div class="line"><a name="l07435"></a><span class="lineno"> 7435</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l07436"></a><span class="lineno"> 7436</span>&#160;            <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l07437"></a><span class="lineno"> 7437</span>&#160;                <span class="stringliteral">&quot;ref_name: Error, unsupported arg type &#39;{0}&#39; found&quot;</span>.</div><div class="line"><a name="l07438"></a><span class="lineno"> 7438</span>&#160;                format(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a723a46e22ca1bfd25ad827b44d7f7671">_type</a>))</div><div class="line"><a name="l07439"></a><span class="lineno"> 7439</span>&#160;</div><div class="line"><a name="l07440"></a><span class="lineno"> 7440</span>&#160;    @property</div><div class="line"><a name="l07441"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#ab094918163a537284522652b5ec38961"> 7441</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#ab094918163a537284522652b5ec38961">type</a>(self):</div><div class="line"><a name="l07442"></a><span class="lineno"> 7442</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Returns the type of this argument. &#39;&#39;&#39;</span></div><div class="line"><a name="l07443"></a><span class="lineno"> 7443</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a723a46e22ca1bfd25ad827b44d7f7671">_type</a></div><div class="line"><a name="l07444"></a><span class="lineno"> 7444</span>&#160;</div><div class="line"><a name="l07445"></a><span class="lineno"> 7445</span>&#160;    @property</div><div class="line"><a name="l07446"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#ad52abf3c34711a262dd95107ecaff4fe"> 7446</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#ad52abf3c34711a262dd95107ecaff4fe">mesh</a>(self):</div><div class="line"><a name="l07447"></a><span class="lineno"> 7447</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l07448"></a><span class="lineno"> 7448</span>&#160;<span class="stringliteral">        Getter for the mesh associated with this argument</span></div><div class="line"><a name="l07449"></a><span class="lineno"> 7449</span>&#160;<span class="stringliteral">        :return: Mesh associated with argument (GH_FINE or GH_COARSE)</span></div><div class="line"><a name="l07450"></a><span class="lineno"> 7450</span>&#160;<span class="stringliteral">        :rtype: str</span></div><div class="line"><a name="l07451"></a><span class="lineno"> 7451</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l07452"></a><span class="lineno"> 7452</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a95b945c313a25aa24f690d01539602a0">_mesh</a></div><div class="line"><a name="l07453"></a><span class="lineno"> 7453</span>&#160;</div><div class="line"><a name="l07454"></a><span class="lineno"> 7454</span>&#160;    @property</div><div class="line"><a name="l07455"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#abfdf0738e4c98d4606b8f9d4e9f37bef"> 7455</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#abfdf0738e4c98d4606b8f9d4e9f37bef">vector_size</a>(self):</div><div class="line"><a name="l07456"></a><span class="lineno"> 7456</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Returns the vector size of this argument as specified in</span></div><div class="line"><a name="l07457"></a><span class="lineno"> 7457</span>&#160;<span class="stringliteral">        the Kernel metadata. &#39;&#39;&#39;</span></div><div class="line"><a name="l07458"></a><span class="lineno"> 7458</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a9dd50f153433fae3bce3c3442c097e54">_vector_size</a></div><div class="line"><a name="l07459"></a><span class="lineno"> 7459</span>&#160;</div><div class="line"><a name="l07460"></a><span class="lineno"> 7460</span>&#160;    @property</div><div class="line"><a name="l07461"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a60fef4a34f635fb98ff305b14908d985"> 7461</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a60fef4a34f635fb98ff305b14908d985">proxy_name</a>(self):</div><div class="line"><a name="l07462"></a><span class="lineno"> 7462</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Returns the proxy name for this argument. &#39;&#39;&#39;</span></div><div class="line"><a name="l07463"></a><span class="lineno"> 7463</span>&#160;        <span class="keywordflow">return</span> self._name+<span class="stringliteral">&quot;_proxy&quot;</span></div><div class="line"><a name="l07464"></a><span class="lineno"> 7464</span>&#160;</div><div class="line"><a name="l07465"></a><span class="lineno"> 7465</span>&#160;    @property</div><div class="line"><a name="l07466"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a2b2e61a33c448141eb35228a29a8f9a9"> 7466</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a2b2e61a33c448141eb35228a29a8f9a9">proxy_declaration_name</a>(self):</div><div class="line"><a name="l07467"></a><span class="lineno"> 7467</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Returns the proxy name for this argument with the array</span></div><div class="line"><a name="l07468"></a><span class="lineno"> 7468</span>&#160;<span class="stringliteral">        dimensions added if required. &#39;&#39;&#39;</span></div><div class="line"><a name="l07469"></a><span class="lineno"> 7469</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a9dd50f153433fae3bce3c3442c097e54">_vector_size</a> &gt; 1:</div><div class="line"><a name="l07470"></a><span class="lineno"> 7470</span>&#160;            <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a60fef4a34f635fb98ff305b14908d985">proxy_name</a>+<span class="stringliteral">&quot;(&quot;</span>+str(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a9dd50f153433fae3bce3c3442c097e54">_vector_size</a>)+<span class="stringliteral">&quot;)&quot;</span></div><div class="line"><a name="l07471"></a><span class="lineno"> 7471</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l07472"></a><span class="lineno"> 7472</span>&#160;            <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a60fef4a34f635fb98ff305b14908d985">proxy_name</a></div><div class="line"><a name="l07473"></a><span class="lineno"> 7473</span>&#160;</div><div class="line"><a name="l07474"></a><span class="lineno"> 7474</span>&#160;    @property</div><div class="line"><a name="l07475"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a7f1362052c7a720813a3ed4ba4fea3c2"> 7475</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a7f1362052c7a720813a3ed4ba4fea3c2">declaration_name</a>(self):</div><div class="line"><a name="l07476"></a><span class="lineno"> 7476</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Returns the name for this argument with the array</span></div><div class="line"><a name="l07477"></a><span class="lineno"> 7477</span>&#160;<span class="stringliteral">        dimensions added if required. &#39;&#39;&#39;</span></div><div class="line"><a name="l07478"></a><span class="lineno"> 7478</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a9dd50f153433fae3bce3c3442c097e54">_vector_size</a> &gt; 1:</div><div class="line"><a name="l07479"></a><span class="lineno"> 7479</span>&#160;            <span class="keywordflow">return</span> self._name+<span class="stringliteral">&quot;(&quot;</span>+str(self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a9dd50f153433fae3bce3c3442c097e54">_vector_size</a>)+<span class="stringliteral">&quot;)&quot;</span></div><div class="line"><a name="l07480"></a><span class="lineno"> 7480</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l07481"></a><span class="lineno"> 7481</span>&#160;            <span class="keywordflow">return</span> self._name</div><div class="line"><a name="l07482"></a><span class="lineno"> 7482</span>&#160;</div><div class="line"><a name="l07483"></a><span class="lineno"> 7483</span>&#160;    @property</div><div class="line"><a name="l07484"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a9cda7dca9d2f373203fbbbc202964697"> 7484</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a9cda7dca9d2f373203fbbbc202964697">proxy_name_indexed</a>(self):</div><div class="line"><a name="l07485"></a><span class="lineno"> 7485</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Returns the proxy name for this argument with an</span></div><div class="line"><a name="l07486"></a><span class="lineno"> 7486</span>&#160;<span class="stringliteral">        additional index which accesses the first element for a vector</span></div><div class="line"><a name="l07487"></a><span class="lineno"> 7487</span>&#160;<span class="stringliteral">        argument. &#39;&#39;&#39;</span></div><div class="line"><a name="l07488"></a><span class="lineno"> 7488</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a9dd50f153433fae3bce3c3442c097e54">_vector_size</a> &gt; 1:</div><div class="line"><a name="l07489"></a><span class="lineno"> 7489</span>&#160;            <span class="keywordflow">return</span> self._name+<span class="stringliteral">&quot;_proxy(1)&quot;</span></div><div class="line"><a name="l07490"></a><span class="lineno"> 7490</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l07491"></a><span class="lineno"> 7491</span>&#160;            <span class="keywordflow">return</span> self._name+<span class="stringliteral">&quot;_proxy&quot;</span></div><div class="line"><a name="l07492"></a><span class="lineno"> 7492</span>&#160;</div><div class="line"><a name="l07493"></a><span class="lineno"> 7493</span>&#160;    @property</div><div class="line"><a name="l07494"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a274c1ca582ac6a53f8c00551f5232240"> 7494</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a274c1ca582ac6a53f8c00551f5232240">name_indexed</a>(self):</div><div class="line"><a name="l07495"></a><span class="lineno"> 7495</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Returns the name for this argument with an</span></div><div class="line"><a name="l07496"></a><span class="lineno"> 7496</span>&#160;<span class="stringliteral">        additional index which accesses the first element for a vector</span></div><div class="line"><a name="l07497"></a><span class="lineno"> 7497</span>&#160;<span class="stringliteral">        argument. &#39;&#39;&#39;</span></div><div class="line"><a name="l07498"></a><span class="lineno"> 7498</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a9dd50f153433fae3bce3c3442c097e54">_vector_size</a> &gt; 1:</div><div class="line"><a name="l07499"></a><span class="lineno"> 7499</span>&#160;            <span class="keywordflow">return</span> self._name+<span class="stringliteral">&quot;(1)&quot;</span></div><div class="line"><a name="l07500"></a><span class="lineno"> 7500</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l07501"></a><span class="lineno"> 7501</span>&#160;            <span class="keywordflow">return</span> self._name</div><div class="line"><a name="l07502"></a><span class="lineno"> 7502</span>&#160;</div><div class="line"><a name="l07503"></a><span class="lineno"> 7503</span>&#160;    @property</div><div class="line"><a name="l07504"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#af86923348c363c45d9991318b77f7ff4"> 7504</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#af86923348c363c45d9991318b77f7ff4">function_space</a>(self):</div><div class="line"><a name="l07505"></a><span class="lineno"> 7505</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l07506"></a><span class="lineno"> 7506</span>&#160;<span class="stringliteral">        :return: the expected finite element function space for this</span></div><div class="line"><a name="l07507"></a><span class="lineno"> 7507</span>&#160;<span class="stringliteral">                 argument as specified by the kernel argument metadata.</span></div><div class="line"><a name="l07508"></a><span class="lineno"> 7508</span>&#160;<span class="stringliteral">        :rtype: :py:class:`psyclone.dynamo0p3.FunctionSpace`</span></div><div class="line"><a name="l07509"></a><span class="lineno"> 7509</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l07510"></a><span class="lineno"> 7510</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a723a46e22ca1bfd25ad827b44d7f7671">_type</a> == <span class="stringliteral">&quot;gh_operator&quot;</span>:</div><div class="line"><a name="l07511"></a><span class="lineno"> 7511</span>&#160;            <span class="comment"># We return the &#39;from&#39; space for an operator argument</span></div><div class="line"><a name="l07512"></a><span class="lineno"> 7512</span>&#160;            <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a5466506ff1fc848cdf4180f0f284d791">function_space_from</a></div><div class="line"><a name="l07513"></a><span class="lineno"> 7513</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l07514"></a><span class="lineno"> 7514</span>&#160;            <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#af7400b005b0ad1586551587cf73594d6">_function_spaces</a>[0]</div><div class="line"><a name="l07515"></a><span class="lineno"> 7515</span>&#160;</div><div class="line"><a name="l07516"></a><span class="lineno"> 7516</span>&#160;    @property</div><div class="line"><a name="l07517"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#ab23381787130f0cceb1989af412b24f6"> 7517</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#ab23381787130f0cceb1989af412b24f6">function_space_to</a>(self):</div><div class="line"><a name="l07518"></a><span class="lineno"> 7518</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Returns the &#39;to&#39; function space of an operator &#39;&#39;&#39;</span></div><div class="line"><a name="l07519"></a><span class="lineno"> 7519</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#af7400b005b0ad1586551587cf73594d6">_function_spaces</a>[0]</div><div class="line"><a name="l07520"></a><span class="lineno"> 7520</span>&#160;</div><div class="line"><a name="l07521"></a><span class="lineno"> 7521</span>&#160;    @property</div><div class="line"><a name="l07522"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a5466506ff1fc848cdf4180f0f284d791"> 7522</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a5466506ff1fc848cdf4180f0f284d791">function_space_from</a>(self):</div><div class="line"><a name="l07523"></a><span class="lineno"> 7523</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Returns the &#39;from&#39; function space of an operator &#39;&#39;&#39;</span></div><div class="line"><a name="l07524"></a><span class="lineno"> 7524</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#af7400b005b0ad1586551587cf73594d6">_function_spaces</a>[1]</div><div class="line"><a name="l07525"></a><span class="lineno"> 7525</span>&#160;</div><div class="line"><a name="l07526"></a><span class="lineno"> 7526</span>&#160;    @property</div><div class="line"><a name="l07527"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a1428144924709de07d4f391bd852656f"> 7527</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a1428144924709de07d4f391bd852656f">function_spaces</a>(self):</div><div class="line"><a name="l07528"></a><span class="lineno"> 7528</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Returns the expected finite element function spaces for this</span></div><div class="line"><a name="l07529"></a><span class="lineno"> 7529</span>&#160;<span class="stringliteral">        argument as a list as specified by the kernel argument</span></div><div class="line"><a name="l07530"></a><span class="lineno"> 7530</span>&#160;<span class="stringliteral">        metadata. We have more than one function space when dealing</span></div><div class="line"><a name="l07531"></a><span class="lineno"> 7531</span>&#160;<span class="stringliteral">        with operators. &#39;&#39;&#39;</span></div><div class="line"><a name="l07532"></a><span class="lineno"> 7532</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#af7400b005b0ad1586551587cf73594d6">_function_spaces</a></div><div class="line"><a name="l07533"></a><span class="lineno"> 7533</span>&#160;</div><div class="line"><a name="l07534"></a><span class="lineno"> 7534</span>&#160;    @property</div><div class="line"><a name="l07535"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#ae458c2e6b919e526afda5a48d46b61dc"> 7535</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#ae458c2e6b919e526afda5a48d46b61dc">function_space_names</a>(self):</div><div class="line"><a name="l07536"></a><span class="lineno"> 7536</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Returns a list of the names of the function spaces associated</span></div><div class="line"><a name="l07537"></a><span class="lineno"> 7537</span>&#160;<span class="stringliteral">        with this argument. We have more than one function space when</span></div><div class="line"><a name="l07538"></a><span class="lineno"> 7538</span>&#160;<span class="stringliteral">        dealing with operators. &#39;&#39;&#39;</span></div><div class="line"><a name="l07539"></a><span class="lineno"> 7539</span>&#160;        fs_names = []</div><div class="line"><a name="l07540"></a><span class="lineno"> 7540</span>&#160;        <span class="keywordflow">for</span> fspace <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#af7400b005b0ad1586551587cf73594d6">_function_spaces</a>:</div><div class="line"><a name="l07541"></a><span class="lineno"> 7541</span>&#160;            <span class="keywordflow">if</span> fspace:</div><div class="line"><a name="l07542"></a><span class="lineno"> 7542</span>&#160;                fs_names.append(fspace.orig_name)</div><div class="line"><a name="l07543"></a><span class="lineno"> 7543</span>&#160;        <span class="keywordflow">return</span> fs_names</div><div class="line"><a name="l07544"></a><span class="lineno"> 7544</span>&#160;</div><div class="line"><a name="l07545"></a><span class="lineno"> 7545</span>&#160;    @property</div><div class="line"><a name="l07546"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a2c78fc0527c7cf8b2aa0f99c31dbdd02"> 7546</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a2c78fc0527c7cf8b2aa0f99c31dbdd02">intent</a>(self):</div><div class="line"><a name="l07547"></a><span class="lineno"> 7547</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l07548"></a><span class="lineno"> 7548</span>&#160;<span class="stringliteral">        Returns the Fortran intent of this argument.</span></div><div class="line"><a name="l07549"></a><span class="lineno"> 7549</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l07550"></a><span class="lineno"> 7550</span>&#160;<span class="stringliteral">        :return: the expected Fortran intent for this argument as specified</span></div><div class="line"><a name="l07551"></a><span class="lineno"> 7551</span>&#160;<span class="stringliteral">                 by the kernel argument metadata</span></div><div class="line"><a name="l07552"></a><span class="lineno"> 7552</span>&#160;<span class="stringliteral">        :rtype: str</span></div><div class="line"><a name="l07553"></a><span class="lineno"> 7553</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l07554"></a><span class="lineno"> 7554</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#aafa5e92fc3c65b65b4b76c0f323d3792">access</a> == <span class="stringliteral">&quot;gh_read&quot;</span>:</div><div class="line"><a name="l07555"></a><span class="lineno"> 7555</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;in&quot;</span></div><div class="line"><a name="l07556"></a><span class="lineno"> 7556</span>&#160;        <span class="keywordflow">elif</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#aafa5e92fc3c65b65b4b76c0f323d3792">access</a> == <span class="stringliteral">&quot;gh_write&quot;</span>:</div><div class="line"><a name="l07557"></a><span class="lineno"> 7557</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;out&quot;</span></div><div class="line"><a name="l07558"></a><span class="lineno"> 7558</span>&#160;        <span class="keywordflow">elif</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#aafa5e92fc3c65b65b4b76c0f323d3792">access</a> == <span class="stringliteral">&quot;gh_readwrite&quot;</span>:</div><div class="line"><a name="l07559"></a><span class="lineno"> 7559</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;inout&quot;</span></div><div class="line"><a name="l07560"></a><span class="lineno"> 7560</span>&#160;        <span class="keywordflow">elif</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#aafa5e92fc3c65b65b4b76c0f323d3792">access</a> <span class="keywordflow">in</span> [<span class="stringliteral">&quot;gh_inc&quot;</span>] + VALID_REDUCTION_NAMES:</div><div class="line"><a name="l07561"></a><span class="lineno"> 7561</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;inout&quot;</span></div><div class="line"><a name="l07562"></a><span class="lineno"> 7562</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l07563"></a><span class="lineno"> 7563</span>&#160;            <span class="keywordflow">raise</span> GenerationError(</div><div class="line"><a name="l07564"></a><span class="lineno"> 7564</span>&#160;                <span class="stringliteral">&quot;Expecting argument access to be one of &#39;gh_read, gh_write, &quot;</span></div><div class="line"><a name="l07565"></a><span class="lineno"> 7565</span>&#160;                <span class="stringliteral">&quot;gh_inc&#39;, &#39;gh_readwrite&#39; or one of {0}, but found &#39;{1}&#39;&quot;</span>.</div><div class="line"><a name="l07566"></a><span class="lineno"> 7566</span>&#160;                format(str(VALID_REDUCTION_NAMES), self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#aafa5e92fc3c65b65b4b76c0f323d3792">access</a>))</div><div class="line"><a name="l07567"></a><span class="lineno"> 7567</span>&#160;</div><div class="line"><a name="l07568"></a><span class="lineno"> 7568</span>&#160;    @property</div><div class="line"><a name="l07569"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a5a7a89d46d98d640ba26a27ee2d7bb25"> 7569</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a5a7a89d46d98d640ba26a27ee2d7bb25">discontinuous</a>(self):</div><div class="line"><a name="l07570"></a><span class="lineno"> 7570</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;Returns True if this argument is known to be on a discontinuous</span></div><div class="line"><a name="l07571"></a><span class="lineno"> 7571</span>&#160;<span class="stringliteral">        function space, otherwise returns False.&#39;&#39;&#39;</span></div><div class="line"><a name="l07572"></a><span class="lineno"> 7572</span>&#160;        <span class="keywordflow">if</span> self.function_space.orig_name <span class="keywordflow">in</span> DISCONTINUOUS_FUNCTION_SPACES:</div><div class="line"><a name="l07573"></a><span class="lineno"> 7573</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">True</span></div><div class="line"><a name="l07574"></a><span class="lineno"> 7574</span>&#160;        <span class="keywordflow">elif</span> self.function_space.orig_name <span class="keywordflow">in</span> VALID_ANY_SPACE_NAMES:</div><div class="line"><a name="l07575"></a><span class="lineno"> 7575</span>&#160;            <span class="comment"># we will eventually look this up based on our dependence</span></div><div class="line"><a name="l07576"></a><span class="lineno"> 7576</span>&#160;            <span class="comment"># analysis but for the moment we assume the worst</span></div><div class="line"><a name="l07577"></a><span class="lineno"> 7577</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">False</span></div><div class="line"><a name="l07578"></a><span class="lineno"> 7578</span>&#160;        <span class="keywordflow">else</span>:  <span class="comment"># must be a continuous function space</span></div><div class="line"><a name="l07579"></a><span class="lineno"> 7579</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">False</span></div><div class="line"><a name="l07580"></a><span class="lineno"> 7580</span>&#160;</div><div class="line"><a name="l07581"></a><span class="lineno"> 7581</span>&#160;    @property</div><div class="line"><a name="l07582"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a2073fccc04eedff3b0ee14d858c3a4c3"> 7582</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a2073fccc04eedff3b0ee14d858c3a4c3">stencil</a>(self):</div><div class="line"><a name="l07583"></a><span class="lineno"> 7583</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;Return stencil information about this kernel argument if it</span></div><div class="line"><a name="l07584"></a><span class="lineno"> 7584</span>&#160;<span class="stringliteral">        exists. The information is returned as a DynStencil object.&#39;&#39;&#39;</span></div><div class="line"><a name="l07585"></a><span class="lineno"> 7585</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a30bcb867988b5fd1a82b4fa4da78c66f">_stencil</a></div><div class="line"><a name="l07586"></a><span class="lineno"> 7586</span>&#160;</div><div class="line"><a name="l07587"></a><span class="lineno"> 7587</span>&#160;    @stencil.setter</div><div class="line"><a name="l07588"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a7be3f1e3695fa75f42da706732f6dfcc"> 7588</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a2073fccc04eedff3b0ee14d858c3a4c3">stencil</a>(self, value):</div><div class="line"><a name="l07589"></a><span class="lineno"> 7589</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;Set stencil information for this kernel argument. The information</span></div><div class="line"><a name="l07590"></a><span class="lineno"> 7590</span>&#160;<span class="stringliteral">        should be provided as a DynStencil object. &#39;&#39;&#39;</span></div><div class="line"><a name="l07591"></a><span class="lineno"> 7591</span>&#160;        self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a30bcb867988b5fd1a82b4fa4da78c66f">_stencil</a> = value</div><div class="line"><a name="l07592"></a><span class="lineno"> 7592</span>&#160;</div><div class="line"><a name="l07593"></a><span class="lineno"> 7593</span>&#160;    @property</div><div class="line"><a name="l07594"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#aa76431f4e517f4c74182b5bfb41075c1"> 7594</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#aa76431f4e517f4c74182b5bfb41075c1">is_operator</a>(self):</div><div class="line"><a name="l07595"></a><span class="lineno"> 7595</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l07596"></a><span class="lineno"> 7596</span>&#160;<span class="stringliteral">        :return: True if this kernel argument represents an operator,</span></div><div class="line"><a name="l07597"></a><span class="lineno"> 7597</span>&#160;<span class="stringliteral">                 False otherwise.</span></div><div class="line"><a name="l07598"></a><span class="lineno"> 7598</span>&#160;<span class="stringliteral">        :rtype: bool</span></div><div class="line"><a name="l07599"></a><span class="lineno"> 7599</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l07600"></a><span class="lineno"> 7600</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a723a46e22ca1bfd25ad827b44d7f7671">_type</a> <span class="keywordflow">in</span> VALID_OPERATOR_NAMES</div><div class="line"><a name="l07601"></a><span class="lineno"> 7601</span>&#160;</div><div class="line"><a name="l07602"></a><span class="lineno"> 7602</span>&#160;</div><div class="line"><a name="l07603"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKernCallFactory.html"> 7603</a></span>&#160;<span class="keyword">class </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernCallFactory.html">DynKernCallFactory</a>(object):</div><div class="line"><a name="l07604"></a><span class="lineno"> 7604</span>&#160;    <span class="stringliteral">&#39;&#39;&#39; Create the necessary framework for a Dynamo kernel call.</span></div><div class="line"><a name="l07605"></a><span class="lineno"> 7605</span>&#160;<span class="stringliteral">    This consists of a Loop over cells containing a call to the</span></div><div class="line"><a name="l07606"></a><span class="lineno"> 7606</span>&#160;<span class="stringliteral">    user-supplied kernel routine. &#39;&#39;&#39;</span></div><div class="line"><a name="l07607"></a><span class="lineno"> 7607</span>&#160;    @staticmethod</div><div class="line"><a name="l07608"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynKernCallFactory.html#aba1111ba27dfa1d055c4347e45d18b46"> 7608</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKernCallFactory.html#aba1111ba27dfa1d055c4347e45d18b46">create</a>(call, parent=None):</div><div class="line"><a name="l07609"></a><span class="lineno"> 7609</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; Create the objects needed for a call to the kernel</span></div><div class="line"><a name="l07610"></a><span class="lineno"> 7610</span>&#160;<span class="stringliteral">        described in the call object &#39;&#39;&#39;</span></div><div class="line"><a name="l07611"></a><span class="lineno"> 7611</span>&#160;</div><div class="line"><a name="l07612"></a><span class="lineno"> 7612</span>&#160;        <span class="comment"># Loop over cells</span></div><div class="line"><a name="l07613"></a><span class="lineno"> 7613</span>&#160;        cloop = <a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html">DynLoop</a>(parent=parent)</div><div class="line"><a name="l07614"></a><span class="lineno"> 7614</span>&#160;</div><div class="line"><a name="l07615"></a><span class="lineno"> 7615</span>&#160;        <span class="comment"># The kernel itself</span></div><div class="line"><a name="l07616"></a><span class="lineno"> 7616</span>&#160;        kern = <a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynKern.html">DynKern</a>()</div><div class="line"><a name="l07617"></a><span class="lineno"> 7617</span>&#160;        kern.load(call, cloop)</div><div class="line"><a name="l07618"></a><span class="lineno"> 7618</span>&#160;</div><div class="line"><a name="l07619"></a><span class="lineno"> 7619</span>&#160;        <span class="comment"># Add the kernel as a child of the loop</span></div><div class="line"><a name="l07620"></a><span class="lineno"> 7620</span>&#160;        cloop.addchild(kern)</div><div class="line"><a name="l07621"></a><span class="lineno"> 7621</span>&#160;</div><div class="line"><a name="l07622"></a><span class="lineno"> 7622</span>&#160;        <span class="comment"># Set-up the loop now we have the kernel object</span></div><div class="line"><a name="l07623"></a><span class="lineno"> 7623</span>&#160;        cloop.load(kern)</div><div class="line"><a name="l07624"></a><span class="lineno"> 7624</span>&#160;</div><div class="line"><a name="l07625"></a><span class="lineno"> 7625</span>&#160;        <span class="comment"># Return the outermost loop</span></div><div class="line"><a name="l07626"></a><span class="lineno"> 7626</span>&#160;        <span class="keywordflow">return</span> cloop</div><div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvoke_html_a8654de66b59a48553c1833ae75383f54"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#a8654de66b59a48553c1833ae75383f54">psyclone.dynamo0p3.DynInvoke.stencil</a></div><div class="ttdeci">stencil</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02924">dynamo0p3.py:2924</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynHaloExchange_html_ab6e8d1f34c19cd0694cb1babdf070735"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchange.html#ab6e8d1f34c19cd0694cb1babdf070735">psyclone.dynamo0p3.DynHaloExchange.required</a></div><div class="ttdeci">def required(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l03674">dynamo0p3.py:3674</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynSchedule_html_acd4461bf90951df030ab017b4ed6a4f3"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynSchedule.html#acd4461bf90951df030ab017b4ed6a4f3">psyclone.dynamo0p3.DynSchedule.view</a></div><div class="ttdeci">def view(self, indent=0)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l03391">dynamo0p3.py:3391</a></div></div>
<div class="ttc" id="classpsyclone_1_1psyGen_1_1Invokes_html"><div class="ttname"><a href="classpsyclone_1_1psyGen_1_1Invokes.html">psyclone.psyGen.Invokes</a></div><div class="ttdef"><b>Definition:</b> <a href="psyGen_8py_source.html#l00341">psyGen.py:341</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynLoop_html"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html">psyclone.dynamo0p3.DynLoop</a></div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04474">dynamo0p3.py:4474</a></div></div>
<div class="ttc" id="classpsyclone_1_1psyGen_1_1Schedule_html"><div class="ttname"><a href="classpsyclone_1_1psyGen_1_1Schedule.html">psyclone.psyGen.Schedule</a></div><div class="ttdef"><b>Definition:</b> <a href="psyGen_8py_source.html#l01375">psyGen.py:1375</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernStubArgList_html_a2a01a6225bf35142026939878c356c60"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a2a01a6225bf35142026939878c356c60">psyclone.dynamo0p3.KernStubArgList.operator</a></div><div class="ttdeci">def operator(self, arg)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06423">dynamo0p3.py:6423</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynMeshes_html_a9ae5eae307fa92466bf4cc321528d62a"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html#a9ae5eae307fa92466bf4cc321528d62a">psyclone.dynamo0p3.DynMeshes._first_var</a></div><div class="ttdeci">_first_var</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01939">dynamo0p3.py:1939</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata_html_a365fb3dafe4977d0aa6af8debd65c545"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#a365fb3dafe4977d0aa6af8debd65c545">psyclone.dynamo0p3.DynKernMetadata._cma_operation</a></div><div class="ttdeci">_cma_operation</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l00852">dynamo0p3.py:852</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns_html_aa66ed0e51d25c095cd5bdcf00f222ba3"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#aa66ed0e51d25c095cd5bdcf00f222ba3">psyclone.dynamo0p3.DynInvokeBasisFns._initialise_xoyoz_qr</a></div><div class="ttdeci">def _initialise_xoyoz_qr(self, parent)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02689">dynamo0p3.py:2689</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata_html_acdab09a5c47f751cad71ba7bb245dc68"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#acdab09a5c47f751cad71ba7bb245dc68">psyclone.dynamo0p3.DynKernMetadata.cma_operation</a></div><div class="ttdeci">def cma_operation(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01271">dynamo0p3.py:1271</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynHaloExchangeStart_html_aa966b6c2e80fe7e524844319ac67716c"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchangeStart.html#aa966b6c2e80fe7e524844319ac67716c">psyclone.dynamo0p3.DynHaloExchangeStart._dag_name</a></div><div class="ttdeci">_dag_name</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l03927">dynamo0p3.py:3927</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil_html_ab3870d8905b66155b3fe7ffddecb2e84"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil.html#ab3870d8905b66155b3fe7ffddecb2e84">psyclone.dynamo0p3.DynInvokeStencil._unique_direction_args</a></div><div class="ttdeci">_unique_direction_args</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01472">dynamo0p3.py:1472</a></div></div>
<div class="ttc" id="classpsyclone_1_1psyGen_1_1Loop_html_a2106cb58bfb0cb510984e46302c831de"><div class="ttname"><a href="classpsyclone_1_1psyGen_1_1Loop.html#a2106cb58bfb0cb510984e46302c831de">psyclone.psyGen.Loop.iteration_space</a></div><div class="ttdeci">def iteration_space(self)</div><div class="ttdef"><b>Definition:</b> <a href="psyGen_8py_source.html#l02783">psyGen.py:2783</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInterGrid_html_ac41e328a128578c277af024299a2c3b9"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInterGrid.html#ac41e328a128578c277af024299a2c3b9">psyclone.dynamo0p3.DynInterGrid.fine</a></div><div class="ttdeci">fine</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02253">dynamo0p3.py:2253</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata_html_a26f6514b3abc8224a0708cdd99cf27aa"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#a26f6514b3abc8224a0708cdd99cf27aa">psyclone.dynamo0p3.DynKernMetadata._identify_cma_op</a></div><div class="ttdeci">def _identify_cma_op(self, cwise_ops)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01127">dynamo0p3.py:1127</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernStubArgList_html_a0955332570e208be3a21abadacee9cac"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a0955332570e208be3a21abadacee9cac">psyclone.dynamo0p3.KernStubArgList.cma_operator</a></div><div class="ttdeci">def cma_operator(self, arg)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06448">dynamo0p3.py:6448</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvoke_html_a8ec1949a5d9f3852e2f5d65fe344cdc7"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#a8ec1949a5d9f3852e2f5d65fe344cdc7">psyclone.dynamo0p3.DynInvoke.gen_code</a></div><div class="ttdeci">def gen_code(self, parent)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l03066">dynamo0p3.py:3066</a></div></div>
<div class="ttc" id="classpsyclone_1_1psyGen_1_1Invoke_html_a1ec704a73a35f61a2afa53950fc4a66b"><div class="ttname"><a href="classpsyclone_1_1psyGen_1_1Invoke.html#a1ec704a73a35f61a2afa53950fc4a66b">psyclone.psyGen.Invoke.psy_unique_vars</a></div><div class="ttdeci">def psy_unique_vars(self)</div><div class="ttdef"><b>Definition:</b> <a href="psyGen_8py_source.html#l00651">psyGen.py:651</a></div></div>
<div class="ttc" id="namespacepsyclone_1_1parse_html"><div class="ttname"><a href="namespacepsyclone_1_1parse.html">psyclone.parse</a></div><div class="ttdef"><b>Definition:</b> <a href="parse_8py_source.html#l00001">parse.py:1</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernStubArgList_html_a81a43c342c431084e11e48b5609a638a"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a81a43c342c431084e11e48b5609a638a">psyclone.dynamo0p3.KernStubArgList.cell_position</a></div><div class="ttdeci">def cell_position(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06333">dynamo0p3.py:6333</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvoke_html_ae113c77719050f71e438a6f4015d0b9c"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#ae113c77719050f71e438a6f4015d0b9c">psyclone.dynamo0p3.DynInvoke.meshes</a></div><div class="ttdeci">meshes</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02940">dynamo0p3.py:2940</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynLoop_html_a98c64dd710b0b0072791b92909b15830"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a98c64dd710b0b0072791b92909b15830">psyclone.dynamo0p3.DynLoop._upper_bound_fortran</a></div><div class="ttdeci">def _upper_bound_fortran(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04689">dynamo0p3.py:4689</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns_html_adc23cd19f80124ec95807dc831a95863"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#adc23cd19f80124ec95807dc831a95863">psyclone.dynamo0p3.DynInvokeBasisFns._eval_targets</a></div><div class="ttdeci">_eval_targets</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02312">dynamo0p3.py:2312</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03_html_ab263d8023f266ba1874c0b116c57697b"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#ab263d8023f266ba1874c0b116c57697b">psyclone.dynamo0p3.DynArgDescriptor03._type</a></div><div class="ttdeci">_type</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l00544">dynamo0p3.py:544</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernStubArgList_html"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html">psyclone.dynamo0p3.KernStubArgList</a></div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06302">dynamo0p3.py:6302</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments_html_ad6b04096013fae62ba4d1f770c1fb142"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#ad6b04096013fae62ba4d1f770c1fb142">psyclone.dynamo0p3.DynKernelArguments.unique_fss</a></div><div class="ttdeci">def unique_fss(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07226">dynamo0p3.py:7226</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynLoop_html_a12bf269a633324a36d7f32bd06248b19"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a12bf269a633324a36d7f32bd06248b19">psyclone.dynamo0p3.DynLoop.load</a></div><div class="ttdeci">def load(self, kern)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04534">dynamo0p3.py:4534</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1FSDescriptors_html_a50b720c90d0c49f8fe58b7386b667806"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1FSDescriptors.html#a50b720c90d0c49f8fe58b7386b667806">psyclone.dynamo0p3.FSDescriptors.exists</a></div><div class="ttdeci">def exists(self, fspace)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06963">dynamo0p3.py:6963</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynHaloExchange_html_ae6f375e975078097400e91c61c82cecf"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchange.html#ae6f375e975078097400e91c61c82cecf">psyclone.dynamo0p3.DynHaloExchange.gen_code</a></div><div class="ttdeci">def gen_code(self, parent)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l03856">dynamo0p3.py:3856</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeCMAOperators_html"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeCMAOperators.html">psyclone.dynamo0p3.DynInvokeCMAOperators</a></div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01789">dynamo0p3.py:1789</a></div></div>
<div class="ttc" id="classpsyclone_1_1psyGen_1_1Node_html_a42ca6fa079802bdbcd72d3deff79d0fc"><div class="ttname"><a href="classpsyclone_1_1psyGen_1_1Node.html#a42ca6fa079802bdbcd72d3deff79d0fc">psyclone.psyGen.Node.calls</a></div><div class="ttdeci">def calls(self)</div><div class="ttdef"><b>Definition:</b> <a href="psyGen_8py_source.html#l01278">psyGen.py:1278</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil_html_a67c2b60f0d1019c84ce955f1dd414794"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil.html#a67c2b60f0d1019c84ce955f1dd414794">psyclone.dynamo0p3.DynInvokeStencil.declare_unique_alg_vars</a></div><div class="ttdeci">def declare_unique_alg_vars(self, parent)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01545">dynamo0p3.py:1545</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil_html_a512854d5de2d73d9f71acedaf3137949"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil.html#a512854d5de2d73d9f71acedaf3137949">psyclone.dynamo0p3.DynInvokeStencil.unique_alg_vars</a></div><div class="ttdeci">def unique_alg_vars(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01540">dynamo0p3.py:1540</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1FunctionSpace_html_ace99ce48ac57abbf297f9e19ae34fd93"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1FunctionSpace.html#ace99ce48ac57abbf297f9e19ae34fd93">psyclone.dynamo0p3.FunctionSpace.orig_name</a></div><div class="ttdeci">def orig_name(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l00428">dynamo0p3.py:428</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynamoPSy_html_a87939573425e9b3bc6c939aeaef4c6e0"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynamoPSy.html#a87939573425e9b3bc6c939aeaef4c6e0">psyclone.dynamo0p3.DynamoPSy._invokes</a></div><div class="ttdeci">_invokes</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01334">dynamo0p3.py:1334</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynHaloExchange_html_ae39dd06329262fd85c329c304155b141"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchange.html#ae39dd06329262fd85c329c304155b141">psyclone.dynamo0p3.DynHaloExchange._compute_halo_read_depth_info</a></div><div class="ttdeci">def _compute_halo_read_depth_info(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l03617">dynamo0p3.py:3617</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeBoundaryConditions_html"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBoundaryConditions.html">psyclone.dynamo0p3.DynInvokeBoundaryConditions</a></div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02865">dynamo0p3.py:2865</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKern_html_a434a612f8d6d10a6c305daed68a90a05"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a434a612f8d6d10a6c305daed68a90a05">psyclone.dynamo0p3.DynKern.incremented_arg</a></div><div class="ttdeci">def incremented_arg(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05510">dynamo0p3.py:5510</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynLoop_html_a8375c9c467fb25eefdd8ab348ae4a45b"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a8375c9c467fb25eefdd8ab348ae4a45b">psyclone.dynamo0p3.DynLoop._name_space_manager</a></div><div class="ttdeci">_name_space_manager</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04487">dynamo0p3.py:4487</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1ArgOrdering_html_aaab1aca69f260698f5541d384bf65415"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#aaab1aca69f260698f5541d384bf65415">psyclone.dynamo0p3.ArgOrdering.field</a></div><div class="ttdeci">def field(self, arg)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05829">dynamo0p3.py:5829</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata_html_ae44a5b914d05da4098f2f8cf164adb44"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#ae44a5b914d05da4098f2f8cf164adb44">psyclone.dynamo0p3.DynKernMetadata.func_descriptors</a></div><div class="ttdeci">def func_descriptors(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01263">dynamo0p3.py:1263</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1HaloDepth_html_a9b79c4954987bd96d0eaa5c44cade64d"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#a9b79c4954987bd96d0eaa5c44cade64d">psyclone.dynamo0p3.HaloDepth.literal_depth</a></div><div class="ttdeci">def literal_depth(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04124">dynamo0p3.py:4124</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynHaloExchange_html_a43880413955768473a8478e17f1982dc"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchange.html#a43880413955768473a8478e17f1982dc">psyclone.dynamo0p3.DynHaloExchange._compute_halo_read_info</a></div><div class="ttdeci">def _compute_halo_read_info(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l03635">dynamo0p3.py:3635</a></div></div>
<div class="ttc" id="classpsyclone_1_1psyGen_1_1Schedule_html_a4c980b1e53473d1fa3cbe245a9ba975a"><div class="ttname"><a href="classpsyclone_1_1psyGen_1_1Schedule.html#a4c980b1e53473d1fa3cbe245a9ba975a">psyclone.psyGen.Schedule.coloured_text</a></div><div class="ttdeci">def coloured_text(self)</div><div class="ttdef"><b>Definition:</b> <a href="psyGen_8py_source.html#l01454">psyGen.py:1454</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1HaloDepth_html_a9ec284ef4c9e724a2559ef6ec796df7c"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#a9ec284ef4c9e724a2559ef6ec796df7c">psyclone.dynamo0p3.HaloDepth._literal_depth</a></div><div class="ttdeci">_literal_depth</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04052">dynamo0p3.py:4052</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1ArgOrdering_html_a3a6a0d4274bd8b1de3981636cf12b1f9"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a3a6a0d4274bd8b1de3981636cf12b1f9">psyclone.dynamo0p3.ArgOrdering.cell_position</a></div><div class="ttdeci">def cell_position(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05772">dynamo0p3.py:5772</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernStubArgList_html_a2fef742e087cd53b83c9daec7e843e5a"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a2fef742e087cd53b83c9daec7e843e5a">psyclone.dynamo0p3.KernStubArgList._name_space_manager</a></div><div class="ttdeci">_name_space_manager</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06331">dynamo0p3.py:6331</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1ArgOrdering_html_ac0254dcd091f305ee7241ac112634c1a"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#ac0254dcd091f305ee7241ac112634c1a">psyclone.dynamo0p3.ArgOrdering.cma_operator</a></div><div class="ttdeci">def cma_operator(self, arg)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05810">dynamo0p3.py:5810</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynLoop_html_afede07b3ebb038a972eaa771eb334146"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#afede07b3ebb038a972eaa771eb334146">psyclone.dynamo0p3.DynLoop.update_halo_exchanges</a></div><div class="ttdeci">def update_halo_exchanges(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04932">dynamo0p3.py:4932</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument_html_ab23381787130f0cceb1989af412b24f6"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#ab23381787130f0cceb1989af412b24f6">psyclone.dynamo0p3.DynKernelArgument.function_space_to</a></div><div class="ttdeci">def function_space_to(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07517">dynamo0p3.py:7517</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKern_html_a3f533a08e00764d606a5cd7effd746bb"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a3f533a08e00764d606a5cd7effd746bb">psyclone.dynamo0p3.DynKern.eval_shape</a></div><div class="ttdeci">def eval_shape(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05429">dynamo0p3.py:5429</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKern_html_a10d2490dc2952c4be2107d78c87fb128"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a10d2490dc2952c4be2107d78c87fb128">psyclone.dynamo0p3.DynKern.fs_descriptors</a></div><div class="ttdeci">def fs_descriptors(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05411">dynamo0p3.py:5411</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvoke_html_a97084217eb37cd1528c75dccf23e0042"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#a97084217eb37cd1528c75dccf23e0042">psyclone.dynamo0p3.DynInvoke.__init__</a></div><div class="ttdeci">def __init__(self, alg_invocation, idx)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02899">dynamo0p3.py:2899</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernCallArgList_html_a6b9f5b1e8bf7a57bb14aaa36d69218ba"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a6b9f5b1e8bf7a57bb14aaa36d69218ba">psyclone.dynamo0p3.KernCallArgList.banded_dofmap</a></div><div class="ttdeci">def banded_dofmap(self, function_space)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06262">dynamo0p3.py:6262</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynLoop_html_ad9bb1df68d49c54206fd30e72cad1c52"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#ad9bb1df68d49c54206fd30e72cad1c52">psyclone.dynamo0p3.DynLoop._kern</a></div><div class="ttdeci">_kern</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04543">dynamo0p3.py:4543</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument_html_a274c1ca582ac6a53f8c00551f5232240"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a274c1ca582ac6a53f8c00551f5232240">psyclone.dynamo0p3.DynKernelArgument.name_indexed</a></div><div class="ttdeci">def name_indexed(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07494">dynamo0p3.py:7494</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvoke_html_a519fa7f3c8ff4eeee92d13289a3d613a"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#a519fa7f3c8ff4eeee92d13289a3d613a">psyclone.dynamo0p3.DynInvoke.field_on_space</a></div><div class="ttdeci">def field_on_space(self, func_space)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l03057">dynamo0p3.py:3057</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernStubArgList_html_af31f3f3931446ab74a34e15c42311120"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#af31f3f3931446ab74a34e15c42311120">psyclone.dynamo0p3.KernStubArgList.stencil_unknown_extent</a></div><div class="ttdeci">def stencil_unknown_extent(self, arg)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06393">dynamo0p3.py:6393</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernCallArgList_html_a15bcf32a9c8ca47c6f2d074e4babaf2a"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a15bcf32a9c8ca47c6f2d074e4babaf2a">psyclone.dynamo0p3.KernCallArgList.fs_compulsory_field</a></div><div class="ttdeci">def fs_compulsory_field(self, function_space)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06124">dynamo0p3.py:6124</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03_html_adbc78bd9230775883d0f468777668158"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#adbc78bd9230775883d0f468777668158">psyclone.dynamo0p3.DynArgDescriptor03.__init__</a></div><div class="ttdeci">def __init__(self, arg_type)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l00523">dynamo0p3.py:523</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1HaloReadAccess_html_a768473832b2570ccb2020ea8f5779570"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1HaloReadAccess.html#a768473832b2570ccb2020ea8f5779570">psyclone.dynamo0p3.HaloReadAccess.needs_clean_outer</a></div><div class="ttdeci">def needs_clean_outer(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04327">dynamo0p3.py:4327</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynFuncDescriptor03_html_aa903cd46cf190e12950e29581c0966ab"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynFuncDescriptor03.html#aa903cd46cf190e12950e29581c0966ab">psyclone.dynamo0p3.DynFuncDescriptor03.function_space_name</a></div><div class="ttdeci">def function_space_name(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l00494">dynamo0p3.py:494</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvoke_html_ac9089cde86f6e4a66f225e69a9736908"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#ac9089cde86f6e4a66f225e69a9736908">psyclone.dynamo0p3.DynInvoke.dofmaps</a></div><div class="ttdeci">dofmaps</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02928">dynamo0p3.py:2928</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynLoop_html_a056323df2353170d6e33f795eb15d0a2"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a056323df2353170d6e33f795eb15d0a2">psyclone.dynamo0p3.DynLoop.gen_code</a></div><div class="ttdeci">def gen_code(self, parent)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05009">dynamo0p3.py:5009</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInterGrid_html"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInterGrid.html">psyclone.dynamo0p3.DynInterGrid</a></div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02239">dynamo0p3.py:2239</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1HaloDepth_html_a752e3a171a3e70f00d52b5985c175716"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#a752e3a171a3e70f00d52b5985c175716">psyclone.dynamo0p3.HaloDepth.__str__</a></div><div class="ttdeci">def __str__(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04170">dynamo0p3.py:4170</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernCallArgList_html_aab1e79d911d89b92deeb857573217193"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#aab1e79d911d89b92deeb857573217193">psyclone.dynamo0p3.KernCallArgList.basis</a></div><div class="ttdeci">def basis(self, function_space)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06155">dynamo0p3.py:6155</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03_html"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html">psyclone.dynamo0p3.DynArgDescriptor03</a></div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l00519">dynamo0p3.py:519</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernCallArgList_html_a4e41295640272645f6b3e5eb71a7bd3e"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a4e41295640272645f6b3e5eb71a7bd3e">psyclone.dynamo0p3.KernCallArgList.fs_intergrid</a></div><div class="ttdeci">def fs_intergrid(self, function_space)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06132">dynamo0p3.py:6132</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynLoop_html_a81e2099aca2c5bd2dc020658e0e94db4"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a81e2099aca2c5bd2dc020658e0e94db4">psyclone.dynamo0p3.DynLoop._lower_bound_name</a></div><div class="ttdeci">_lower_bound_name</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04504">dynamo0p3.py:4504</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvoke_html_a75572ca91c2786ed836e6657b2cec4b8"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#a75572ca91c2786ed836e6657b2cec4b8">psyclone.dynamo0p3.DynInvoke.is_coloured</a></div><div class="ttdeci">def is_coloured(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l03037">dynamo0p3.py:3037</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeDofmaps_html"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeDofmaps.html">psyclone.dynamo0p3.DynInvokeDofmaps</a></div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01626">dynamo0p3.py:1626</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvoke_html_a6c94745504665e2cddcf0967b3144305"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#a6c94745504665e2cddcf0967b3144305">psyclone.dynamo0p3.DynInvoke._schedule</a></div><div class="ttdeci">_schedule</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02909">dynamo0p3.py:2909</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03_html_add67578fbd425bd0ab19a196d01e3ff1"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#add67578fbd425bd0ab19a196d01e3ff1">psyclone.dynamo0p3.DynArgDescriptor03._arg_type</a></div><div class="ttdeci">_arg_type</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l00528">dynamo0p3.py:528</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments_html_a80d9f96e3b25dc55c858c9cdcbb75c19"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#a80d9f96e3b25dc55c858c9cdcbb75c19">psyclone.dynamo0p3.DynKernelArguments.raw_arg_list</a></div><div class="ttdeci">def raw_arg_list(self, parent)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07307">dynamo0p3.py:7307</a></div></div>
<div class="ttc" id="classpsyclone_1_1parse_1_1KernelType_html_aae575d92f86e6ec52cea59d3861641d4"><div class="ttname"><a href="classpsyclone_1_1parse_1_1KernelType.html#aae575d92f86e6ec52cea59d3861641d4">psyclone.parse.KernelType.name</a></div><div class="ttdeci">def name(self)</div><div class="ttdef"><b>Definition:</b> <a href="parse_8py_source.html#l00628">parse.py:628</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKern_html_a64504a14d7197f6915fe5588d1d32807"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a64504a14d7197f6915fe5588d1d32807">psyclone.dynamo0p3.DynKern._qr_args</a></div><div class="ttdeci">_qr_args</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05167">dynamo0p3.py:5167</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1FSDescriptor_html_a468d4532ad93d01d590f994f17ddd84a"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1FSDescriptor.html#a468d4532ad93d01d590f994f17ddd84a">psyclone.dynamo0p3.FSDescriptor.requires_orientation</a></div><div class="ttdeci">def requires_orientation(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06930">dynamo0p3.py:6930</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernCallArgList_html_ae335919033fb2dc35b9f87b39fdc0906"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#ae335919033fb2dc35b9f87b39fdc0906">psyclone.dynamo0p3.KernCallArgList.operator_bcs_kernel</a></div><div class="ttdeci">def operator_bcs_kernel(self, function_space)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06239">dynamo0p3.py:6239</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynStencil_html_a2a8b06e112a1d37cb463bf3ade9e9985"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynStencil.html#a2a8b06e112a1d37cb463bf3ade9e9985">psyclone.dynamo0p3.DynStencil.direction_arg</a></div><div class="ttdeci">def direction_arg(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07062">dynamo0p3.py:7062</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynLoop_html_af1f264ad7e26981899729d37e867aee6"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#af1f264ad7e26981899729d37e867aee6">psyclone.dynamo0p3.DynLoop._upper_bound_name</a></div><div class="ttdeci">_upper_bound_name</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04506">dynamo0p3.py:4506</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument_html_ae458c2e6b919e526afda5a48d46b61dc"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#ae458c2e6b919e526afda5a48d46b61dc">psyclone.dynamo0p3.DynKernelArgument.function_space_names</a></div><div class="ttdeci">def function_space_names(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07535">dynamo0p3.py:7535</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeDofmaps_html_a810f7972ce4120ce7943a4641c2b6cba"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeDofmaps.html#a810f7972ce4120ce7943a4641c2b6cba">psyclone.dynamo0p3.DynInvokeDofmaps.initialise_dofmaps</a></div><div class="ttdeci">def initialise_dofmaps(self, parent)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01717">dynamo0p3.py:1717</a></div></div>
<div class="ttc" id="classpsyclone_1_1psyGen_1_1Node_html_a3e33fe0cdcff6e22a388b89476017700"><div class="ttname"><a href="classpsyclone_1_1psyGen_1_1Node.html#a3e33fe0cdcff6e22a388b89476017700">psyclone.psyGen.Node.parent</a></div><div class="ttdeci">parent</div><div class="ttdef"><b>Definition:</b> <a href="psyGen_8py_source.html#l01238">psyGen.py:1238</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKern_html_a93a6dda29c366911105fc624951b3b3f"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a93a6dda29c366911105fc624951b3b3f">psyclone.dynamo0p3.DynKern.qr_text</a></div><div class="ttdeci">def qr_text(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05449">dynamo0p3.py:5449</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1FSDescriptor_html_a0a74503df6a7da4d219a8b04655a4a36"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1FSDescriptor.html#a0a74503df6a7da4d219a8b04655a4a36">psyclone.dynamo0p3.FSDescriptor.fs_name</a></div><div class="ttdeci">def fs_name(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06937">dynamo0p3.py:6937</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1HaloReadAccess_html_a6997b1406bbac705a15999f07342371c"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1HaloReadAccess.html#a6997b1406bbac705a15999f07342371c">psyclone.dynamo0p3.HaloReadAccess.stencil_type</a></div><div class="ttdeci">def stencil_type(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04341">dynamo0p3.py:4341</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynLoop_html_a88c09bdca492ff43269fbae64e06c6ae"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a88c09bdca492ff43269fbae64e06c6ae">psyclone.dynamo0p3.DynLoop._field_space</a></div><div class="ttdeci">_field_space</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04547">dynamo0p3.py:4547</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil_html_af3e0105fc45b4ae86e2d89e66739531f"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil.html#af3e0105fc45b4ae86e2d89e66739531f">psyclone.dynamo0p3.DynInvokeStencil._kern_args</a></div><div class="ttdeci">_kern_args</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01492">dynamo0p3.py:1492</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernCallArgList_html_a530c10416ddcf177d587f5fe2ec827e0"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a530c10416ddcf177d587f5fe2ec827e0">psyclone.dynamo0p3.KernCallArgList.cma_operator</a></div><div class="ttdeci">def cma_operator(self, arg)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06097">dynamo0p3.py:6097</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1ArgOrdering_html_a3f8c25a562a08acb6558af724105f611"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a3f8c25a562a08acb6558af724105f611">psyclone.dynamo0p3.ArgOrdering.fs_common</a></div><div class="ttdeci">def fs_common(self, function_space)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05885">dynamo0p3.py:5885</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynLoop_html_aca4d102832dff707693443021b645a58"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#aca4d102832dff707693443021b645a58">psyclone.dynamo0p3.DynLoop.upper_bound_name</a></div><div class="ttdeci">def upper_bound_name(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04630">dynamo0p3.py:4630</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeCMAOperators_html_a6b6c4b8dbc8d5f77f3a46c383713b3ab"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeCMAOperators.html#a6b6c4b8dbc8d5f77f3a46c383713b3ab">psyclone.dynamo0p3.DynInvokeCMAOperators.declare_cma_ops</a></div><div class="ttdeci">def declare_cma_ops(self, parent)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01871">dynamo0p3.py:1871</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata_html_ab8e7f4bbb00609ecddef9c66c1616c21"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#ab8e7f4bbb00609ecddef9c66c1616c21">psyclone.dynamo0p3.DynKernMetadata._eval_shape</a></div><div class="ttdeci">_eval_shape</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l00857">dynamo0p3.py:857</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynFuncDescriptor03_html_a1daf8595826f46019f3c885eace814c6"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynFuncDescriptor03.html#a1daf8595826f46019f3c885eace814c6">psyclone.dynamo0p3.DynFuncDescriptor03.operator_names</a></div><div class="ttdeci">def operator_names(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l00499">dynamo0p3.py:499</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeBoundaryConditions_html_a5ed48f5e975178af2fdd05dc6d661b38"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBoundaryConditions.html#a5ed48f5e975178af2fdd05dc6d661b38">psyclone.dynamo0p3.DynInvokeBoundaryConditions.declarations</a></div><div class="ttdeci">def declarations(self, parent)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02875">dynamo0p3.py:2875</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynLoop_html_a9758139bb05a74195f2d02e102277a58"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a9758139bb05a74195f2d02e102277a58">psyclone.dynamo0p3.DynLoop._lower_bound_fortran</a></div><div class="ttdeci">def _lower_bound_fortran(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04648">dynamo0p3.py:4648</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1ArgOrdering_html_a1815cf0ec5d4c5f2fdab681330b2d033"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a1815cf0ec5d4c5f2fdab681330b2d033">psyclone.dynamo0p3.ArgOrdering.mesh_height</a></div><div class="ttdeci">def mesh_height(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05791">dynamo0p3.py:5791</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1HaloDepth_html_aa22905dcd5f158b9d0e7266ec0219cee"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#aa22905dcd5f158b9d0e7266ec0219cee">psyclone.dynamo0p3.HaloDepth._max_depth</a></div><div class="ttdeci">_max_depth</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04063">dynamo0p3.py:4063</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument_html"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html">psyclone.dynamo0p3.DynKernelArgument</a></div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07330">dynamo0p3.py:7330</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernCallArgList_html_a613fee118173f3682330e84bdfe3ae22"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a613fee118173f3682330e84bdfe3ae22">psyclone.dynamo0p3.KernCallArgList._cell_ref_name</a></div><div class="ttdeci">def _cell_ref_name(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06289">dynamo0p3.py:6289</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynStencil_html_ab83b77eaa044d302e092e379a68c0375"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynStencil.html#ab83b77eaa044d302e092e379a68c0375">psyclone.dynamo0p3.DynStencil._name</a></div><div class="ttdeci">_name</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07039">dynamo0p3.py:7039</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernCallArgList_html_af8f56cd931a698c69a982648af1e9978"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#af8f56cd931a698c69a982648af1e9978">psyclone.dynamo0p3.KernCallArgList.field_vector</a></div><div class="ttdeci">def field_vector(self, argvect)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06051">dynamo0p3.py:6051</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1ArgOrdering_html_a75dc0198d318dd291982ca87a3af70b2"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a75dc0198d318dd291982ca87a3af70b2">psyclone.dynamo0p3.ArgOrdering.operator</a></div><div class="ttdeci">def operator(self, arg)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05867">dynamo0p3.py:5867</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1ArgOrdering_html_a1651baaa5383b5e525dbeeb8235f06bc"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a1651baaa5383b5e525dbeeb8235f06bc">psyclone.dynamo0p3.ArgOrdering._kern</a></div><div class="ttdeci">_kern</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05631">dynamo0p3.py:5631</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1HaloWriteAccess_html_aa749ce094789a63b46b186a85cb91705"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1HaloWriteAccess.html#aa749ce094789a63b46b186a85cb91705">psyclone.dynamo0p3.HaloWriteAccess.__init__</a></div><div class="ttdeci">def __init__(self, field)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04236">dynamo0p3.py:4236</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernCallArgList_html_a53a57b6588b7b5e1f97ffa05a6a2236e"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a53a57b6588b7b5e1f97ffa05a6a2236e">psyclone.dynamo0p3.KernCallArgList.operator</a></div><div class="ttdeci">def operator(self, arg)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06090">dynamo0p3.py:6090</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1FSDescriptors_html_a6524810ce6c63e99bd028121742368b3"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1FSDescriptors.html#a6524810ce6c63e99bd028121742368b3">psyclone.dynamo0p3.FSDescriptors.get_descriptor</a></div><div class="ttdeci">def get_descriptor(self, fspace)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06974">dynamo0p3.py:6974</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKern_html_a332244b572bfd2a6c00f29edeb8fec01"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a332244b572bfd2a6c00f29edeb8fec01">psyclone.dynamo0p3.DynKern.ncolours_var</a></div><div class="ttdeci">def ncolours_var(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05385">dynamo0p3.py:5385</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03_html_ac6de0a98c4c4968d5ee757a9a1d3b208"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#ac6de0a98c4c4968d5ee757a9a1d3b208">psyclone.dynamo0p3.DynArgDescriptor03._function_space1</a></div><div class="ttdeci">_function_space1</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l00635">dynamo0p3.py:635</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03_html_a0f6d901fc8392c86469112041971154e"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#a0f6d901fc8392c86469112041971154e">psyclone.dynamo0p3.DynArgDescriptor03.function_space</a></div><div class="ttdeci">def function_space(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l00767">dynamo0p3.py:767</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynGlobalSum_html_adb95915042af0293c5320527a5b2ac96"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynGlobalSum.html#adb95915042af0293c5320527a5b2ac96">psyclone.dynamo0p3.DynGlobalSum._supported_scalars</a></div><div class="ttdeci">_supported_scalars</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l03420">dynamo0p3.py:3420</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynHaloExchange_html_a6ca702fbdfcd162db042388a043bcc7d"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchange.html#a6ca702fbdfcd162db042388a043bcc7d">psyclone.dynamo0p3.DynHaloExchange._compute_halo_write_info</a></div><div class="ttdeci">def _compute_halo_write_info(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l03652">dynamo0p3.py:3652</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernCallArgList_html_a66f0e96cea3cb078dbb96d8df6ebdb87"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a66f0e96cea3cb078dbb96d8df6ebdb87">psyclone.dynamo0p3.KernCallArgList.cell_position</a></div><div class="ttdeci">def cell_position(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06001">dynamo0p3.py:6001</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynHaloExchangeEnd_html"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchangeEnd.html">psyclone.dynamo0p3.DynHaloExchangeEnd</a></div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04006">dynamo0p3.py:4006</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInterGrid_html_ae23bff49ea1e37aee3db057616a817a4"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInterGrid.html#ae23bff49ea1e37aee3db057616a817a4">psyclone.dynamo0p3.DynInterGrid.mmap</a></div><div class="ttdeci">mmap</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02258">dynamo0p3.py:2258</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynamoPSy_html_a141020148f72afddde684416b8dde610"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynamoPSy.html#a141020148f72afddde684416b8dde610">psyclone.dynamo0p3.DynamoPSy.name</a></div><div class="ttdeci">def name(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01337">dynamo0p3.py:1337</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKern_html_a731480dd01bc8d93f89ebe7785887efb"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a731480dd01bc8d93f89ebe7785887efb">psyclone.dynamo0p3.DynKern._setup_basis</a></div><div class="ttdeci">def _setup_basis(self, kmetadata)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05238">dynamo0p3.py:5238</a></div></div>
<div class="ttc" id="classpsyclone_1_1psyGen_1_1Node_html_a68afb39a447656f9ff01930065a1637d"><div class="ttname"><a href="classpsyclone_1_1psyGen_1_1Node.html#a68afb39a447656f9ff01930065a1637d">psyclone.psyGen.Node.is_openmp_parallel</a></div><div class="ttdeci">def is_openmp_parallel(self)</div><div class="ttdef"><b>Definition:</b> <a href="psyGen_8py_source.html#l01355">psyGen.py:1355</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03_html_a9c3c4eb63a05289cf6d530eff81b58e7"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#a9c3c4eb63a05289cf6d530eff81b58e7">psyclone.dynamo0p3.DynArgDescriptor03.function_space_to</a></div><div class="ttdeci">def function_space_to(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l00743">dynamo0p3.py:743</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvoke_html_a88f97e25ac522f7a8e084c7f278df82b"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#a88f97e25ac522f7a8e084c7f278df82b">psyclone.dynamo0p3.DynInvoke._psy_unique_qr_vars</a></div><div class="ttdeci">_psy_unique_qr_vars</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02959">dynamo0p3.py:2959</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernStubArgList_html_a0b883e83313b6ee23d6ab63b79027f1c"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a0b883e83313b6ee23d6ab63b79027f1c">psyclone.dynamo0p3.KernStubArgList.field_vector</a></div><div class="ttdeci">def field_vector(self, argvect)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06355">dynamo0p3.py:6355</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynamoPSy_html"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynamoPSy.html">psyclone.dynamo0p3.DynamoPSy</a></div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01322">dynamo0p3.py:1322</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil_html_a0ee6c78e2401713d08345e64c59400d1"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil.html#a0ee6c78e2401713d08345e64c59400d1">psyclone.dynamo0p3.DynInvokeStencil._unique_extent_args</a></div><div class="ttdeci">_unique_extent_args</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01452">dynamo0p3.py:1452</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1ArgOrdering_html_a6c766cbb2d5453b938b48422c6658d20"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a6c766cbb2d5453b938b48422c6658d20">psyclone.dynamo0p3.ArgOrdering.stencil_unknown_direction</a></div><div class="ttdeci">def stencil_unknown_direction(self, arg)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05848">dynamo0p3.py:5848</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernCallArgList_html_a6f512993240280175cef8ed5d79da98d"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a6f512993240280175cef8ed5d79da98d">psyclone.dynamo0p3.KernCallArgList.orientation</a></div><div class="ttdeci">def orientation(self, function_space)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06206">dynamo0p3.py:6206</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1ArgOrdering_html_a6486b1c8596fec1e5413b02d86b97eea"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a6486b1c8596fec1e5413b02d86b97eea">psyclone.dynamo0p3.ArgOrdering.field_vector</a></div><div class="ttdeci">def field_vector(self, arg)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05819">dynamo0p3.py:5819</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKern_html_a7b8bc2307469e910804aee4337128581"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a7b8bc2307469e910804aee4337128581">psyclone.dynamo0p3.DynKern._fs_descriptors</a></div><div class="ttdeci">_fs_descriptors</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05154">dynamo0p3.py:5154</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInterGrid_html_ad41d162562fedb02c35286d1729a98a8"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInterGrid.html#ad41d162562fedb02c35286d1729a98a8">psyclone.dynamo0p3.DynInterGrid.ncellpercell</a></div><div class="ttdeci">ncellpercell</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02269">dynamo0p3.py:2269</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernStubArgList_html_aff05cee18ae4afe7996405d743c7cfa5"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#aff05cee18ae4afe7996405d743c7cfa5">psyclone.dynamo0p3.KernStubArgList.field_bcs_kernel</a></div><div class="ttdeci">def field_bcs_kernel(self, function_space)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06727">dynamo0p3.py:6727</a></div></div>
<div class="ttc" id="classpsyclone_1_1psyGen_1_1Loop_html_ac2b3ff6efe721114be68b57c3249a0e3"><div class="ttname"><a href="classpsyclone_1_1psyGen_1_1Loop.html#ac2b3ff6efe721114be68b57c3249a0e3">psyclone.psyGen.Loop.coloured_text</a></div><div class="ttdeci">def coloured_text(self)</div><div class="ttdef"><b>Definition:</b> <a href="psyGen_8py_source.html#l02705">psyGen.py:2705</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernStubArgList_html_ad399778e0a713e715cc9b90e923bc17f"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#ad399778e0a713e715cc9b90e923bc17f">psyclone.dynamo0p3.KernStubArgList._first_arg</a></div><div class="ttdeci">_first_arg</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06326">dynamo0p3.py:6326</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments_html_ad299dc1119f382046b71b25396c1d528"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#ad299dc1119f382046b71b25396c1d528">psyclone.dynamo0p3.DynKernelArguments._unique_fss</a></div><div class="ttdeci">_unique_fss</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07145">dynamo0p3.py:7145</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernCallArgList_html_a813f33568d289e645a228f08612fe0f2"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a813f33568d289e645a228f08612fe0f2">psyclone.dynamo0p3.KernCallArgList.cell_map</a></div><div class="ttdeci">def cell_map(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06005">dynamo0p3.py:6005</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument_html_a95b945c313a25aa24f690d01539602a0"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a95b945c313a25aa24f690d01539602a0">psyclone.dynamo0p3.DynKernelArgument._mesh</a></div><div class="ttdeci">_mesh</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07357">dynamo0p3.py:7357</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernStubArgList_html_a532fe7b9b2d7a7f7972903bae7d25b51"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a532fe7b9b2d7a7f7972903bae7d25b51">psyclone.dynamo0p3.KernStubArgList.operator_bcs_kernel</a></div><div class="ttdeci">def operator_bcs_kernel(self, function_space)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06736">dynamo0p3.py:6736</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInterGrid_html_acfd716ab365d9c8065d91e1a1d81ad60"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInterGrid.html#acfd716ab365d9c8065d91e1a1d81ad60">psyclone.dynamo0p3.DynInterGrid.ncolours_var</a></div><div class="ttdeci">ncolours_var</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02282">dynamo0p3.py:2282</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynHaloExchange_html_aaa9f46bc95abf267d196c8e5a1adce17"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchange.html#aaa9f46bc95abf267d196c8e5a1adce17">psyclone.dynamo0p3.DynHaloExchange._compute_stencil_type</a></div><div class="ttdeci">def _compute_stencil_type(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l03569">dynamo0p3.py:3569</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments_html_a2ac76cc04092d56b7a619a1f0ceb311b"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#a2ac76cc04092d56b7a619a1f0ceb311b">psyclone.dynamo0p3.DynKernelArguments._name_space_manager</a></div><div class="ttdeci">_name_space_manager</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07082">dynamo0p3.py:7082</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynFuncDescriptor03_html_a97c43e2cc8489c252eca54155bee6ad7"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynFuncDescriptor03.html#a97c43e2cc8489c252eca54155bee6ad7">psyclone.dynamo0p3.DynFuncDescriptor03._name</a></div><div class="ttdeci">_name</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l00491">dynamo0p3.py:491</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernStubArgList_html_ae3e2b881c08bde1288a44f8474a2ff75"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#ae3e2b881c08bde1288a44f8474a2ff75">psyclone.dynamo0p3.KernStubArgList.banded_dofmap</a></div><div class="ttdeci">def banded_dofmap(self, function_space)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06491">dynamo0p3.py:6491</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument_html_a30bcb867988b5fd1a82b4fa4da78c66f"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a30bcb867988b5fd1a82b4fa4da78c66f">psyclone.dynamo0p3.DynKernelArgument._stencil</a></div><div class="ttdeci">_stencil</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07355">dynamo0p3.py:7355</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument_html_a2073fccc04eedff3b0ee14d858c3a4c3"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a2073fccc04eedff3b0ee14d858c3a4c3">psyclone.dynamo0p3.DynKernelArgument.stencil</a></div><div class="ttdeci">def stencil(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07582">dynamo0p3.py:7582</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata_html_aa3c8f683803c32191f7278595cc20e5f"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#aa3c8f683803c32191f7278595cc20e5f">psyclone.dynamo0p3.DynKernMetadata._arg_descriptors</a></div><div class="ttdeci">_arg_descriptors</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l00869">dynamo0p3.py:869</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments_html"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html">psyclone.dynamo0p3.DynKernelArguments</a></div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07073">dynamo0p3.py:7073</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument_html_ab094918163a537284522652b5ec38961"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#ab094918163a537284522652b5ec38961">psyclone.dynamo0p3.DynKernelArgument.type</a></div><div class="ttdeci">def type(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07441">dynamo0p3.py:7441</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeCMAOperators_html_a0211499e4a8bdcc6d49e424586da3948"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeCMAOperators.html#a0211499e4a8bdcc6d49e424586da3948">psyclone.dynamo0p3.DynInvokeCMAOperators.cma_same_fs_params</a></div><div class="ttdeci">list cma_same_fs_params</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01794">dynamo0p3.py:1794</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynStencil_html_afac4a3880181ee98c28b9049f2312c7d"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynStencil.html#afac4a3880181ee98c28b9049f2312c7d">psyclone.dynamo0p3.DynStencil._extent_arg</a></div><div class="ttdeci">_extent_arg</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07041">dynamo0p3.py:7041</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKern_html_a7d26165d0414c7ed202bb31ffd360061"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a7d26165d0414c7ed202bb31ffd360061">psyclone.dynamo0p3.DynKern.load_meta</a></div><div class="ttdeci">def load_meta(self, ktype)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05188">dynamo0p3.py:5188</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernStubArgList_html_aba190d113df8fea70ec1edf903438b79"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#aba190d113df8fea70ec1edf903438b79">psyclone.dynamo0p3.KernStubArgList.indirection_dofmap</a></div><div class="ttdeci">def indirection_dofmap(self, function_space, operator=None)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06503">dynamo0p3.py:6503</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynLoop_html_afd1dbf56877ef2af98d9eba782404a26"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#afd1dbf56877ef2af98d9eba782404a26">psyclone.dynamo0p3.DynLoop.set_lower_bound</a></div><div class="ttdeci">def set_lower_bound(self, name, index=None)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04589">dynamo0p3.py:4589</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynLoop_html_ab328ffed47890eb3bebc88aa5998fc53"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#ab328ffed47890eb3bebc88aa5998fc53">psyclone.dynamo0p3.DynLoop._add_halo_exchange_code</a></div><div class="ttdeci">def _add_halo_exchange_code(self, halo_field, idx=None)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04882">dynamo0p3.py:4882</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernStubArgList_html_a987c6f31efdebba201de8a30573b3941"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a987c6f31efdebba201de8a30573b3941">psyclone.dynamo0p3.KernStubArgList.orientation</a></div><div class="ttdeci">def orientation(self, function_space)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06717">dynamo0p3.py:6717</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1HaloWriteAccess_html"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1HaloWriteAccess.html">psyclone.dynamo0p3.HaloWriteAccess</a></div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04230">dynamo0p3.py:4230</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1HaloWriteAccess_html_ad7a6eff277e9869a066e218341b163f0"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1HaloWriteAccess.html#ad7a6eff277e9869a066e218341b163f0">psyclone.dynamo0p3.HaloWriteAccess._dirty_outer</a></div><div class="ttdeci">_dirty_outer</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04278">dynamo0p3.py:4278</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInterGrid_html_a298976a70545ca9c9ea9ab81a79a9f74"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInterGrid.html#a298976a70545ca9c9ea9ab81a79a9f74">psyclone.dynamo0p3.DynInterGrid._name_space_manager</a></div><div class="ttdeci">_name_space_manager</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02249">dynamo0p3.py:2249</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns_html_abbbb52ab0d348c916e6e195d5928fe0c"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#abbbb52ab0d348c916e6e195d5928fe0c">psyclone.dynamo0p3.DynInvokeBasisFns._setup_basis_fns_for_call</a></div><div class="ttdeci">def _setup_basis_fns_for_call(self, call)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02359">dynamo0p3.py:2359</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1HaloWriteAccess_html_a87e4f90d63fa2104e001f2c6428c3fe1"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1HaloWriteAccess.html#a87e4f90d63fa2104e001f2c6428c3fe1">psyclone.dynamo0p3.HaloWriteAccess.dirty_outer</a></div><div class="ttdeci">def dirty_outer(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04247">dynamo0p3.py:4247</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynMeshes_html"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html">psyclone.dynamo0p3.DynMeshes</a></div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01899">dynamo0p3.py:1899</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata_html_a517f42b3c2d871cef06619af2e3778ef"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#a517f42b3c2d871cef06619af2e3778ef">psyclone.dynamo0p3.DynKernMetadata.eval_shape</a></div><div class="ttdeci">def eval_shape(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01278">dynamo0p3.py:1278</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1FunctionSpace_html_a3447e6e30ef9e53611e7e484ac89b845"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1FunctionSpace.html#a3447e6e30ef9e53611e7e484ac89b845">psyclone.dynamo0p3.FunctionSpace.mangled_name</a></div><div class="ttdeci">def mangled_name(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l00434">dynamo0p3.py:434</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument_html_aafa5e92fc3c65b65b4b76c0f323d3792"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#aafa5e92fc3c65b65b4b76c0f323d3792">psyclone.dynamo0p3.DynKernelArgument.access</a></div><div class="ttdeci">access</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07554">dynamo0p3.py:7554</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynMeshes_html_a26dbeb0c6c5c382c56fcae0b7da58ae6"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html#a26dbeb0c6c5c382c56fcae0b7da58ae6">psyclone.dynamo0p3.DynMeshes.initialise</a></div><div class="ttdeci">def initialise(self, parent)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02101">dynamo0p3.py:2101</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvoke_html_aad132c0d4e187455c08d35538e78c457"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#aad132c0d4e187455c08d35538e78c457">psyclone.dynamo0p3.DynInvoke.boundary_conditions</a></div><div class="ttdeci">boundary_conditions</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02944">dynamo0p3.py:2944</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata_html_a29ea450540410a4538c93005389fe7a9"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#a29ea450540410a4538c93005389fe7a9">psyclone.dynamo0p3.DynKernMetadata._eval_targets</a></div><div class="ttdeci">_eval_targets</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l00861">dynamo0p3.py:861</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns_html_a8e239708c52ffa287c65464ee77c16aa"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a8e239708c52ffa287c65464ee77c16aa">psyclone.dynamo0p3.DynInvokeBasisFns._name_space_manager</a></div><div class="ttdeci">_name_space_manager</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02298">dynamo0p3.py:2298</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKern_html_a70f602b67faa0cc3d1dc2c18ff45f687"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a70f602b67faa0cc3d1dc2c18ff45f687">psyclone.dynamo0p3.DynKern.updated_arg</a></div><div class="ttdeci">def updated_arg(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05522">dynamo0p3.py:5522</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynHaloExchangeEnd_html_a159052ea44a656c92c7af2d31b4d1fd8"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchangeEnd.html#a159052ea44a656c92c7af2d31b4d1fd8">psyclone.dynamo0p3.DynHaloExchangeEnd._colour_map_name</a></div><div class="ttdeci">_colour_map_name</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04039">dynamo0p3.py:4039</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments_html_a32d7ed09bec6ad0a52c21e2c6764efc2"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#a32d7ed09bec6ad0a52c21e2c6764efc2">psyclone.dynamo0p3.DynKernelArguments.get_arg_on_space_name</a></div><div class="ttdeci">def get_arg_on_space_name(self, func_space_name)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07156">dynamo0p3.py:7156</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynMeshes_html_a387ced89c120fe1b02e27af4663f8dc7"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html#a387ced89c120fe1b02e27af4663f8dc7">psyclone.dynamo0p3.DynMeshes.intergrid_kernels</a></div><div class="ttdeci">def intergrid_kernels(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02230">dynamo0p3.py:2230</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03_html_a0d5ce57c32fbe9646b7a1bb17aa52f8b"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#a0d5ce57c32fbe9646b7a1bb17aa52f8b">psyclone.dynamo0p3.DynArgDescriptor03._vector_size</a></div><div class="ttdeci">_vector_size</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l00541">dynamo0p3.py:541</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInterGrid_html_a471c704742e4f068746ca44e86aa3db0"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInterGrid.html#a471c704742e4f068746ca44e86aa3db0">psyclone.dynamo0p3.DynInterGrid.ncell_fine</a></div><div class="ttdeci">ncell_fine</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02264">dynamo0p3.py:2264</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvoke_html_a5049d82b2420303e6a4207b5f15b5413"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#a5049d82b2420303e6a4207b5f15b5413">psyclone.dynamo0p3.DynInvoke._name_space_manager</a></div><div class="ttdeci">_name_space_manager</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l03083">dynamo0p3.py:3083</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernCallArgList_html"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html">psyclone.dynamo0p3.KernCallArgList</a></div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05984">dynamo0p3.py:5984</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1FunctionSpace_html_a7db82163cd2be436c1aa0a13ab739a84"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1FunctionSpace.html#a7db82163cd2be436c1aa0a13ab739a84">psyclone.dynamo0p3.FunctionSpace._kernel_args</a></div><div class="ttdeci">_kernel_args</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l00417">dynamo0p3.py:417</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynHaloExchange_html_a68f0bca70ce833d95b3388a7dd1377e5"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchange.html#a68f0bca70ce833d95b3388a7dd1377e5">psyclone.dynamo0p3.DynHaloExchange._compute_halo_depth</a></div><div class="ttdeci">def _compute_halo_depth(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l03593">dynamo0p3.py:3593</a></div></div>
<div class="ttc" id="classpsyclone_1_1psyGen_1_1Kern_html_abc6975e1dcdfa711ef7b43807ae38e44"><div class="ttname"><a href="classpsyclone_1_1psyGen_1_1Kern.html#abc6975e1dcdfa711ef7b43807ae38e44">psyclone.psyGen.Kern.name</a></div><div class="ttdeci">name</div><div class="ttdef"><b>Definition:</b> <a href="psyGen_8py_source.html#l03570">psyGen.py:3570</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1HaloDepth_html_a98e2bcdad2d36e7f819b07fb3c4b054a"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#a98e2bcdad2d36e7f819b07fb3c4b054a">psyclone.dynamo0p3.HaloDepth.set_by_value</a></div><div class="ttdeci">def set_by_value(self, max_depth, var_depth, literal_depth, annexed_only, max_depth_m1)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04148">dynamo0p3.py:4148</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns_html_a791303926010438cc25ac3aa522d2698"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a791303926010438cc25ac3aa522d2698">psyclone.dynamo0p3.DynInvokeBasisFns.declare_qr</a></div><div class="ttdeci">def declare_qr(self, parent)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02425">dynamo0p3.py:2425</a></div></div>
<div class="ttc" id="classpsyclone_1_1parse_1_1ParseError_html"><div class="ttname"><a href="classpsyclone_1_1parse_1_1ParseError.html">psyclone.parse.ParseError</a></div><div class="ttdef"><b>Definition:</b> <a href="parse_8py_source.html#l00188">parse.py:188</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1ArgOrdering_html"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html">psyclone.dynamo0p3.ArgOrdering</a></div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05627">dynamo0p3.py:5627</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1HaloDepth_html_ac74d5d72d6cc19ef8fd1bbbdd0b85f27"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#ac74d5d72d6cc19ef8fd1bbbdd0b85f27">psyclone.dynamo0p3.HaloDepth.max_depth</a></div><div class="ttdeci">def max_depth(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04086">dynamo0p3.py:4086</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynFuncDescriptor03_html"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynFuncDescriptor03.html">psyclone.dynamo0p3.DynFuncDescriptor03</a></div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l00450">dynamo0p3.py:450</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynamoPSy_html_a3e6a91f296de55b5643c4ee6fcbb69c1"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynamoPSy.html#a3e6a91f296de55b5643c4ee6fcbb69c1">psyclone.dynamo0p3.DynamoPSy.gen</a></div><div class="ttdeci">def gen(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01344">dynamo0p3.py:1344</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernStubArgList_html_accc69de047d8bad0f774c7ec03032a50"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#accc69de047d8bad0f774c7ec03032a50">psyclone.dynamo0p3.KernStubArgList.fs_compulsory_field</a></div><div class="ttdeci">def fs_compulsory_field(self, function_space)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06556">dynamo0p3.py:6556</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynLoop_html_ab6e98882a59da51132a4a938eb897f48"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#ab6e98882a59da51132a4a938eb897f48">psyclone.dynamo0p3.DynLoop.loop_type</a></div><div class="ttdeci">loop_type</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04483">dynamo0p3.py:4483</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynStencil_html_aa279e14ac2b0722bc51445923231d492"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynStencil.html#aa279e14ac2b0722bc51445923231d492">psyclone.dynamo0p3.DynStencil.extent</a></div><div class="ttdeci">def extent(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07045">dynamo0p3.py:7045</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata_html_a00e7a0376262460a21b8041dad863109"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#a00e7a0376262460a21b8041dad863109">psyclone.dynamo0p3.DynKernMetadata.eval_targets</a></div><div class="ttdeci">def eval_targets(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01293">dynamo0p3.py:1293</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynHaloExchange_html"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchange.html">psyclone.dynamo0p3.DynHaloExchange</a></div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l03542">dynamo0p3.py:3542</a></div></div>
<div class="ttc" id="classpsyclone_1_1psyGen_1_1PSy_html"><div class="ttname"><a href="classpsyclone_1_1psyGen_1_1PSy.html">psyclone.psyGen.PSy</a></div><div class="ttdef"><b>Definition:</b> <a href="psyGen_8py_source.html#l00284">psyGen.py:284</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments_html_aac022ea68219a9796fdc3adcf19f9c70"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#aac022ea68219a9796fdc3adcf19f9c70">psyclone.dynamo0p3.DynKernelArguments.unique_fs_names</a></div><div class="ttdeci">def unique_fs_names(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07232">dynamo0p3.py:7232</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1HaloDepth_html_a6b1d9b5dea66bcb74c8f0ed5863b48bd"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#a6b1d9b5dea66bcb74c8f0ed5863b48bd">psyclone.dynamo0p3.HaloDepth.annexed_only</a></div><div class="ttdeci">def annexed_only(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04074">dynamo0p3.py:4074</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03_html_a8e125b39719a4229126fd74a883c8e7d"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#a8e125b39719a4229126fd74a883c8e7d">psyclone.dynamo0p3.DynArgDescriptor03._function_space2</a></div><div class="ttdeci">_function_space2</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l00707">dynamo0p3.py:707</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1FSDescriptor_html_a012c18deea44c43976fe74cc7b018390"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1FSDescriptor.html#a012c18deea44c43976fe74cc7b018390">psyclone.dynamo0p3.FSDescriptor.requires_basis</a></div><div class="ttdeci">def requires_basis(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06917">dynamo0p3.py:6917</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1HaloWriteAccess_html_a84b4381357c5de55645e59273aa90181"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1HaloWriteAccess.html#a84b4381357c5de55645e59273aa90181">psyclone.dynamo0p3.HaloWriteAccess._compute_from_field</a></div><div class="ttdeci">def _compute_from_field(self, field)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04260">dynamo0p3.py:4260</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03_html_a036f722e3aee79762a82d62fb7a69ec7"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#a036f722e3aee79762a82d62fb7a69ec7">psyclone.dynamo0p3.DynArgDescriptor03.function_spaces</a></div><div class="ttdeci">def function_spaces(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l00783">dynamo0p3.py:783</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument_html_ace6467a73d1d127d6407f1bf74d919ac"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#ace6467a73d1d127d6407f1bf74d919ac">psyclone.dynamo0p3.DynKernelArgument.ref_name</a></div><div class="ttdeci">def ref_name(self, function_space=None)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07387">dynamo0p3.py:7387</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1FSDescriptor_html_a6a926154aaacd9b40025056e9ec05dba"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1FSDescriptor.html#a6a926154aaacd9b40025056e9ec05dba">psyclone.dynamo0p3.FSDescriptor.requires_diff_basis</a></div><div class="ttdeci">def requires_diff_basis(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06923">dynamo0p3.py:6923</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument_html_abfdf0738e4c98d4606b8f9d4e9f37bef"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#abfdf0738e4c98d4606b8f9d4e9f37bef">psyclone.dynamo0p3.DynKernelArgument.vector_size</a></div><div class="ttdeci">def vector_size(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07455">dynamo0p3.py:7455</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernCallArgList_html_ad3a8e049c6ecafa838d4c3836a442e49"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#ad3a8e049c6ecafa838d4c3836a442e49">psyclone.dynamo0p3.KernCallArgList.fs_common</a></div><div class="ttdeci">def fs_common(self, function_space)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06117">dynamo0p3.py:6117</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynLoop_html_aa6a96950d9bc282abc4505cdc7363ede"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#aa6a96950d9bc282abc4505cdc7363ede">psyclone.dynamo0p3.DynLoop.unique_fields_with_halo_reads</a></div><div class="ttdeci">def unique_fields_with_halo_reads(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04810">dynamo0p3.py:4810</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeCMAOperators_html_af02a82df5a1bfc3913c95ef0a43e7c73"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeCMAOperators.html#af02a82df5a1bfc3913c95ef0a43e7c73">psyclone.dynamo0p3.DynInvokeCMAOperators._name_space_manager</a></div><div class="ttdeci">_name_space_manager</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01803">dynamo0p3.py:1803</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument_html_a9cda7dca9d2f373203fbbbc202964697"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a9cda7dca9d2f373203fbbbc202964697">psyclone.dynamo0p3.DynKernelArgument.proxy_name_indexed</a></div><div class="ttdeci">def proxy_name_indexed(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07484">dynamo0p3.py:7484</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynLoop_html_a3ba8465c0dc3bc7ba76d7002fc2ed367"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a3ba8465c0dc3bc7ba76d7002fc2ed367">psyclone.dynamo0p3.DynLoop._field</a></div><div class="ttdeci">_field</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04545">dynamo0p3.py:4545</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1ArgOrdering_html_a931b962e11ff13ace2611a65abf24aa5"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a931b962e11ff13ace2611a65abf24aa5">psyclone.dynamo0p3.ArgOrdering.fs_compulsory_field</a></div><div class="ttdeci">def fs_compulsory_field(self, function_space)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05896">dynamo0p3.py:5896</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKern_html_a1695038ac7d13e1b48aa4cab79a75577"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a1695038ac7d13e1b48aa4cab79a75577">psyclone.dynamo0p3.DynKern._setup</a></div><div class="ttdeci">def _setup(self, ktype, module_name, args, parent)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05253">dynamo0p3.py:5253</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKern_html_a60d8a8c1a2520d12b2c60a723df0a850"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a60d8a8c1a2520d12b2c60a723df0a850">psyclone.dynamo0p3.DynKern._eval_targets</a></div><div class="ttdeci">_eval_targets</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05164">dynamo0p3.py:5164</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKern_html_a739991c89184d7221f51bfa0bfc45ef5"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a739991c89184d7221f51bfa0bfc45ef5">psyclone.dynamo0p3.DynKern._func_descriptors</a></div><div class="ttdeci">_func_descriptors</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05153">dynamo0p3.py:5153</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument_html_ae0c8e8f769521a1f5f7d096f84b3e780"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#ae0c8e8f769521a1f5f7d096f84b3e780">psyclone.dynamo0p3.DynKernelArgument.descriptor</a></div><div class="ttdeci">def descriptor(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07382">dynamo0p3.py:7382</a></div></div>
<div class="ttc" id="classpsyclone_1_1psyGen_1_1Invoke_html_afff15d0cfff3adb378deeab161de6875"><div class="ttname"><a href="classpsyclone_1_1psyGen_1_1Invoke.html#afff15d0cfff3adb378deeab161de6875">psyclone.psyGen.Invoke.schedule</a></div><div class="ttdeci">def schedule(self)</div><div class="ttdef"><b>Definition:</b> <a href="psyGen_8py_source.html#l00662">psyGen.py:662</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernStubArgList_html_a048f8cccde56780b64141af0837b24fa"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a048f8cccde56780b64141af0837b24fa">psyclone.dynamo0p3.KernStubArgList.scalar</a></div><div class="ttdeci">def scalar(self, arg)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06526">dynamo0p3.py:6526</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKern_html_abb32cbaeda1bf57266969e31937680d3"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#abb32cbaeda1bf57266969e31937680d3">psyclone.dynamo0p3.DynKern.eval_targets</a></div><div class="ttdeci">def eval_targets(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05438">dynamo0p3.py:5438</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernStubArgList_html_a86b4a6b6d644e586a1765e1a6eaa52a1"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a86b4a6b6d644e586a1765e1a6eaa52a1">psyclone.dynamo0p3.KernStubArgList._parent</a></div><div class="ttdeci">_parent</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06329">dynamo0p3.py:6329</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument_html_a7f1362052c7a720813a3ed4ba4fea3c2"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a7f1362052c7a720813a3ed4ba4fea3c2">psyclone.dynamo0p3.DynKernelArgument.declaration_name</a></div><div class="ttdeci">def declaration_name(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07475">dynamo0p3.py:7475</a></div></div>
<div class="ttc" id="classpsyclone_1_1psyGen_1_1Invoke_html_a7e09c41cafa5d17214833dc23aec52cf"><div class="ttname"><a href="classpsyclone_1_1psyGen_1_1Invoke.html#a7e09c41cafa5d17214833dc23aec52cf">psyclone.psyGen.Invoke.psy_unique_var_names</a></div><div class="ttdeci">def psy_unique_var_names(self)</div><div class="ttdef"><b>Definition:</b> <a href="psyGen_8py_source.html#l00655">psyGen.py:655</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil_html_a1f6794ee325578ecdf6c6d0d968624f5"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil.html#a1f6794ee325578ecdf6c6d0d968624f5">psyclone.dynamo0p3.DynInvokeStencil._name_space_manager</a></div><div class="ttdeci">_name_space_manager</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01448">dynamo0p3.py:1448</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKern_html_a5990f404454302ebfa8f760f9b04ad0f"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a5990f404454302ebfa8f760f9b04ad0f">psyclone.dynamo0p3.DynKern._is_intergrid</a></div><div class="ttdeci">_is_intergrid</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05170">dynamo0p3.py:5170</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1ArgOrdering_html_aa04177eb8a6e4f253c2fba95e51faec7"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#aa04177eb8a6e4f253c2fba95e51faec7">psyclone.dynamo0p3.ArgOrdering.orientation</a></div><div class="ttdeci">def orientation(self, function_space)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05925">dynamo0p3.py:5925</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument_html_a60fef4a34f635fb98ff305b14908d985"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a60fef4a34f635fb98ff305b14908d985">psyclone.dynamo0p3.DynKernelArgument.proxy_name</a></div><div class="ttdeci">def proxy_name(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07461">dynamo0p3.py:7461</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata_html_ae0241bdcf34e84b803b2320c0367ce30"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#ae0241bdcf34e84b803b2320c0367ce30">psyclone.dynamo0p3.DynKernMetadata._is_intergrid</a></div><div class="ttdeci">_is_intergrid</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l00866">dynamo0p3.py:866</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1ArgOrdering_html_aacac0c302ed31ac61b8a4e6652450fd7"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#aacac0c302ed31ac61b8a4e6652450fd7">psyclone.dynamo0p3.ArgOrdering.cell_map</a></div><div class="ttdeci">def cell_map(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05782">dynamo0p3.py:5782</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil_html_af25f655ae0737a1ef17b96e8de5314dc"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil.html#af25f655ae0737a1ef17b96e8de5314dc">psyclone.dynamo0p3.DynInvokeStencil._declare_unique_direction_vars</a></div><div class="ttdeci">def _declare_unique_direction_vars(self, parent)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01528">dynamo0p3.py:1528</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata_html_a97f319a1a676fc99da2e6733c084de0e"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#a97f319a1a676fc99da2e6733c084de0e">psyclone.dynamo0p3.DynKernMetadata.is_intergrid</a></div><div class="ttdeci">def is_intergrid(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01308">dynamo0p3.py:1308</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKern_html_a1bcc844fb892249179351237be168d66"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a1bcc844fb892249179351237be168d66">psyclone.dynamo0p3.DynKern.colourmap</a></div><div class="ttdeci">def colourmap(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05359">dynamo0p3.py:5359</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynLoop_html_a6ed04440794b00c560157275ce070704"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a6ed04440794b00c560157275ce070704">psyclone.dynamo0p3.DynLoop._field_name</a></div><div class="ttdeci">_field_name</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04546">dynamo0p3.py:4546</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynHaloExchange_html_a9198f4c1fc7512950865f03951c2a0ca"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchange.html#a9198f4c1fc7512950865f03951c2a0ca">psyclone.dynamo0p3.DynHaloExchange.view</a></div><div class="ttdeci">def view(self, indent=0)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l03842">dynamo0p3.py:3842</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynHaloExchangeStart_html_a3e828f2a888258edcb855d7b8a2a9c36"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchangeStart.html#a3e828f2a888258edcb855d7b8a2a9c36">psyclone.dynamo0p3.DynHaloExchangeStart._text_name</a></div><div class="ttdeci">_text_name</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l03925">dynamo0p3.py:3925</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments_html_af9dcde3bad1e14a1bb9a0f51654687cd"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#af9dcde3bad1e14a1bb9a0f51654687cd">psyclone.dynamo0p3.DynKernelArguments._0_to_n</a></div><div class="ttdeci">_0_to_n</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07080">dynamo0p3.py:7080</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments_html_a58d251915c3889ff6582e39d226c83c1"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#a58d251915c3889ff6582e39d226c83c1">psyclone.dynamo0p3.DynKernelArguments.iteration_space_arg</a></div><div class="ttdeci">def iteration_space_arg(self, mapping=None)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07238">dynamo0p3.py:7238</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernCallArgList_html_a833e00d6b4964a64ef9bbe0f91ff2076"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a833e00d6b4964a64ef9bbe0f91ff2076">psyclone.dynamo0p3.KernCallArgList.indirection_dofmap</a></div><div class="ttdeci">def indirection_dofmap(self, function_space, operator=None)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06269">dynamo0p3.py:6269</a></div></div>
<div class="ttc" id="classpsyclone_1_1psyGen_1_1Node_html_a26c38a98f54211eb80dae3fe07d64d30"><div class="ttname"><a href="classpsyclone_1_1psyGen_1_1Node.html#a26c38a98f54211eb80dae3fe07d64d30">psyclone.psyGen.Node.indent</a></div><div class="ttdeci">def indent(self, count, indent=&quot;    &quot;)</div><div class="ttdef"><b>Definition:</b> <a href="psyGen_8py_source.html#l01149">psyGen.py:1149</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInterGrid_html_a551b824866740ad2eaec994a642827a6"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInterGrid.html#a551b824866740ad2eaec994a642827a6">psyclone.dynamo0p3.DynInterGrid.colourmap</a></div><div class="ttdeci">colourmap</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02280">dynamo0p3.py:2280</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynGlobalSum_html_ab850352ac5a8b53740d2f9ebb7c3f82f"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynGlobalSum.html#ab850352ac5a8b53740d2f9ebb7c3f82f">psyclone.dynamo0p3.DynGlobalSum.gen_code</a></div><div class="ttdeci">def gen_code(self, parent)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l03427">dynamo0p3.py:3427</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernStubArgList_html_ac7b8b8ec66058854d569d9745a887f32"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#ac7b8b8ec66058854d569d9745a887f32">psyclone.dynamo0p3.KernStubArgList.fs_common</a></div><div class="ttdeci">def fs_common(self, function_space)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06545">dynamo0p3.py:6545</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernCallFactory_html_aba1111ba27dfa1d055c4347e45d18b46"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernCallFactory.html#aba1111ba27dfa1d055c4347e45d18b46">psyclone.dynamo0p3.DynKernCallFactory.create</a></div><div class="ttdeci">def create(call, parent=None)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07608">dynamo0p3.py:7608</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynGlobalSum_html"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynGlobalSum.html">psyclone.dynamo0p3.DynGlobalSum</a></div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l03405">dynamo0p3.py:3405</a></div></div>
<div class="ttc" id="classpsyclone_1_1psyGen_1_1Loop_html_a792ef7a413409afa60e1c658b1f49310"><div class="ttname"><a href="classpsyclone_1_1psyGen_1_1Loop.html#a792ef7a413409afa60e1c658b1f49310">psyclone.psyGen.Loop.unique_modified_args</a></div><div class="ttdeci">def unique_modified_args(self, mapping, arg_type)</div><div class="ttdef"><b>Definition:</b> <a href="psyGen_8py_source.html#l02828">psyGen.py:2828</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynFuncDescriptor03_html_abd6203197bc707c597752f2fd5f44678"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynFuncDescriptor03.html#abd6203197bc707c597752f2fd5f44678">psyclone.dynamo0p3.DynFuncDescriptor03._func_type</a></div><div class="ttdeci">_func_type</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l00457">dynamo0p3.py:457</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1ArgOrdering_html_acc72560435e14e43c1388e1282d8bbdf"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#acc72560435e14e43c1388e1282d8bbdf">psyclone.dynamo0p3.ArgOrdering.field_bcs_kernel</a></div><div class="ttdeci">def field_bcs_kernel(self, function_space)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05934">dynamo0p3.py:5934</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1ArgOrdering_html_a7f1c8b027d438eb49fc9045dad8de2c6"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a7f1c8b027d438eb49fc9045dad8de2c6">psyclone.dynamo0p3.ArgOrdering.basis</a></div><div class="ttdeci">def basis(self, function_space)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05906">dynamo0p3.py:5906</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil_html_ab1bbeb53b12715e35d9eebff99b2c9fa"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil.html#ab1bbeb53b12715e35d9eebff99b2c9fa">psyclone.dynamo0p3.DynInvokeStencil.initialise_stencil_maps</a></div><div class="ttdeci">def initialise_stencil_maps(self, parent)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01551">dynamo0p3.py:1551</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynHaloExchangeStart_html_ab36d0b93ada041cf787b3aabf68bb42a"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchangeStart.html#ab36d0b93ada041cf787b3aabf68bb42a">psyclone.dynamo0p3.DynHaloExchangeStart._get_hex_end</a></div><div class="ttdeci">def _get_hex_end(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l03970">dynamo0p3.py:3970</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1FunctionSpace_html"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1FunctionSpace.html">psyclone.dynamo0p3.FunctionSpace</a></div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l00410">dynamo0p3.py:410</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKern_html_a1834915de0fe9023daf09167bd7229ed"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a1834915de0fe9023daf09167bd7229ed">psyclone.dynamo0p3.DynKern.qr_required</a></div><div class="ttdeci">def qr_required(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05418">dynamo0p3.py:5418</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument_html_af7400b005b0ad1586551587cf73594d6"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#af7400b005b0ad1586551587cf73594d6">psyclone.dynamo0p3.DynKernelArgument._function_spaces</a></div><div class="ttdeci">_function_spaces</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07379">dynamo0p3.py:7379</a></div></div>
<div class="ttc" id="classpsyclone_1_1parse_1_1KernelType_html_a2c3ef6cc8cee5145f97d3d9b60ecf6af"><div class="ttname"><a href="classpsyclone_1_1parse_1_1KernelType.html#a2c3ef6cc8cee5145f97d3d9b60ecf6af">psyclone.parse.KernelType.get_integer_variable</a></div><div class="ttdeci">def get_integer_variable(self, name)</div><div class="ttdef"><b>Definition:</b> <a href="parse_8py_source.html#l00681">parse.py:681</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeBoundaryConditions_html_a7608ba98dd9536f5a31265c436bcb2a7"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBoundaryConditions.html#a7608ba98dd9536f5a31265c436bcb2a7">psyclone.dynamo0p3.DynInvokeBoundaryConditions.initialise</a></div><div class="ttdeci">def initialise(self, parent)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02883">dynamo0p3.py:2883</a></div></div>
<div class="ttc" id="classpsyclone_1_1psyGen_1_1Invoke_html_ab6699fa93b458cffc4fa3874e0de2e1b"><div class="ttname"><a href="classpsyclone_1_1psyGen_1_1Invoke.html#ab6699fa93b458cffc4fa3874e0de2e1b">psyclone.psyGen.Invoke.name</a></div><div class="ttdeci">def name(self)</div><div class="ttdef"><b>Definition:</b> <a href="psyGen_8py_source.html#l00643">psyGen.py:643</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKern_html_a53af93e8f1a0feed476d6782db1c4165"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a53af93e8f1a0feed476d6782db1c4165">psyclone.dynamo0p3.DynKern.qr_args</a></div><div class="ttdeci">def qr_args(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05460">dynamo0p3.py:5460</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynMeshes_html_a533b4c70c754c4bfa8e087a294d42d91"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html#a533b4c70c754c4bfa8e087a294d42d91">psyclone.dynamo0p3.DynMeshes._mesh_names</a></div><div class="ttdeci">_mesh_names</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01926">dynamo0p3.py:1926</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynLoop_html_aa11190fd2caa3cb687b7b4e061186175"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#aa11190fd2caa3cb687b7b4e061186175">psyclone.dynamo0p3.DynLoop._lower_bound_index</a></div><div class="ttdeci">_lower_bound_index</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04505">dynamo0p3.py:4505</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil_html_a8d443120cbbfeee482c711482356ebf8"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil.html#a8d443120cbbfeee482c711482356ebf8">psyclone.dynamo0p3.DynInvokeStencil._declare_unique_extent_vars</a></div><div class="ttdeci">def _declare_unique_extent_vars(self, parent)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01508">dynamo0p3.py:1508</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil_html"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil.html">psyclone.dynamo0p3.DynInvokeStencil</a></div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01442">dynamo0p3.py:1442</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynMeshes_html_a099eea03cfd32e9e6fe4481204451818"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html#a099eea03cfd32e9e6fe4481204451818">psyclone.dynamo0p3.DynMeshes._schedule</a></div><div class="ttdeci">_schedule</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01931">dynamo0p3.py:1931</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeDofmaps_html_a5860687bf8382d8ea83dab3929e2755b"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeDofmaps.html#a5860687bf8382d8ea83dab3929e2755b">psyclone.dynamo0p3.DynInvokeDofmaps._unique_indirection_maps</a></div><div class="ttdeci">_unique_indirection_maps</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01648">dynamo0p3.py:1648</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns_html_ac43ff1a1fcf0c08d0c2f59a23c8ced5f"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#ac43ff1a1fcf0c08d0c2f59a23c8ced5f">psyclone.dynamo0p3.DynInvokeBasisFns._initialise_xyoz_qr</a></div><div class="ttdeci">def _initialise_xyoz_qr(self, parent)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02641">dynamo0p3.py:2641</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynMeshes_html_af08b7512cf0ecbea909e50ad4d03d0fc"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html#af08b7512cf0ecbea909e50ad4d03d0fc">psyclone.dynamo0p3.DynMeshes._ig_kernels</a></div><div class="ttdeci">_ig_kernels</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01924">dynamo0p3.py:1924</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1ArgOrdering_html_abe3738e0c224dedd864dd24006940ef6"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#abe3738e0c224dedd864dd24006940ef6">psyclone.dynamo0p3.ArgOrdering.indirection_dofmap</a></div><div class="ttdeci">def indirection_dofmap(self, arg, operator=None)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05974">dynamo0p3.py:5974</a></div></div>
<div class="ttc" id="classpsyclone_1_1parse_1_1KernelType_html_a89c1ed3bea5975b4ae70c01510e8cde6"><div class="ttname"><a href="classpsyclone_1_1parse_1_1KernelType.html#a89c1ed3bea5975b4ae70c01510e8cde6">psyclone.parse.KernelType._inits</a></div><div class="ttdeci">_inits</div><div class="ttdef"><b>Definition:</b> <a href="parse_8py_source.html#l00591">parse.py:591</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata_html_a183289eba248b6ade7d1c0abf0cd68c7"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#a183289eba248b6ade7d1c0abf0cd68c7">psyclone.dynamo0p3.DynKernMetadata._validate_inter_grid</a></div><div class="ttdeci">def _validate_inter_grid(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01034">dynamo0p3.py:1034</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument_html_a723a46e22ca1bfd25ad827b44d7f7671"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a723a46e22ca1bfd25ad827b44d7f7671">psyclone.dynamo0p3.DynKernelArgument._type</a></div><div class="ttdeci">_type</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07354">dynamo0p3.py:7354</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKern_html_a030cc0efc6721fe3e45191872bd5ace1"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a030cc0efc6721fe3e45191872bd5ace1">psyclone.dynamo0p3.DynKern._qr_text</a></div><div class="ttdeci">_qr_text</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05165">dynamo0p3.py:5165</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvoke_html"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html">psyclone.dynamo0p3.DynInvoke</a></div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02892">dynamo0p3.py:2892</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernStubArgList_html_a27776e4128b99642df7498d0fe2f2ca6"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a27776e4128b99642df7498d0fe2f2ca6">psyclone.dynamo0p3.KernStubArgList.mesh_ncell2d</a></div><div class="ttdeci">def mesh_ncell2d(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06347">dynamo0p3.py:6347</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument_html_af86923348c363c45d9991318b77f7ff4"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#af86923348c363c45d9991318b77f7ff4">psyclone.dynamo0p3.DynKernelArgument.function_space</a></div><div class="ttdeci">def function_space(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07504">dynamo0p3.py:7504</a></div></div>
<div class="ttc" id="classpsyclone_1_1parse_1_1Descriptor_html"><div class="ttname"><a href="classpsyclone_1_1parse_1_1Descriptor.html">psyclone.parse.Descriptor</a></div><div class="ttdef"><b>Definition:</b> <a href="parse_8py_source.html#l00196">parse.py:196</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1ArgOrdering_html_a3884d69be074c97ce061bb264e2693be"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a3884d69be074c97ce061bb264e2693be">psyclone.dynamo0p3.ArgOrdering.scalar</a></div><div class="ttdeci">def scalar(self, arg)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05876">dynamo0p3.py:5876</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynStencil_html_a080beb1055c5fc18e3f23e975813a8b0"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynStencil.html#a080beb1055c5fc18e3f23e975813a8b0">psyclone.dynamo0p3.DynStencil.extent_arg</a></div><div class="ttdeci">def extent_arg(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07051">dynamo0p3.py:7051</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKern_html_aaacdaa0d8fc3ab44afadfc114fc0ae6c"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#aaacdaa0d8fc3ab44afadfc114fc0ae6c">psyclone.dynamo0p3.DynKern._qr_required</a></div><div class="ttdeci">_qr_required</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05156">dynamo0p3.py:5156</a></div></div>
<div class="ttc" id="namespacepsyclone_1_1psyGen_html"><div class="ttname"><a href="namespacepsyclone_1_1psyGen.html">psyclone.psyGen</a></div><div class="ttdef"><b>Definition:</b> <a href="psyGen_8py_source.html#l00001">psyGen.py:1</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynLoop_html_a362c02a6327448029d8cc8c6a0351418"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a362c02a6327448029d8cc8c6a0351418">psyclone.dynamo0p3.DynLoop.set_upper_bound</a></div><div class="ttdeci">def set_upper_bound(self, name, index=None)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04601">dynamo0p3.py:4601</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKern_html_a304543e5eea8d79deaf9c6001a40b02d"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a304543e5eea8d79deaf9c6001a40b02d">psyclone.dynamo0p3.DynKern.local_vars</a></div><div class="ttdeci">def local_vars(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05465">dynamo0p3.py:5465</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeDofmaps_html_a24664d72760cf4c31c79be51c358839f"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeDofmaps.html#a24664d72760cf4c31c79be51c358839f">psyclone.dynamo0p3.DynInvokeDofmaps._name_space_manager</a></div><div class="ttdeci">_name_space_manager</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01632">dynamo0p3.py:1632</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments_html_a30a9d2a559cc1905e5f3a30af6929fb3"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#a30a9d2a559cc1905e5f3a30af6929fb3">psyclone.dynamo0p3.DynKernelArguments.get_arg_on_space</a></div><div class="ttdeci">def get_arg_on_space(self, func_space)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07181">dynamo0p3.py:7181</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynLoop_html_a1535492551f0316ab3236a7d59726bba"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a1535492551f0316ab3236a7d59726bba">psyclone.dynamo0p3.DynLoop.upper_bound_halo_depth</a></div><div class="ttdeci">def upper_bound_halo_depth(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04635">dynamo0p3.py:4635</a></div></div>
<div class="ttc" id="classpsyclone_1_1psyGen_1_1Node_html_a16164b7e18b21e72a94cd5da552b58a2"><div class="ttname"><a href="classpsyclone_1_1psyGen_1_1Node.html#a16164b7e18b21e72a94cd5da552b58a2">psyclone.psyGen.Node.children</a></div><div class="ttdeci">def children(self)</div><div class="ttdef"><b>Definition:</b> <a href="psyGen_8py_source.html#l01176">psyGen.py:1176</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns_html_ad8479e5a39b535cf5d2d30962b138717"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#ad8479e5a39b535cf5d2d30962b138717">psyclone.dynamo0p3.DynInvokeBasisFns.compute_basis_fns</a></div><div class="ttdeci">def compute_basis_fns(self, parent)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02701">dynamo0p3.py:2701</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03_html_ab8ff6649bcf90fed276bf8ba8c8d87b8"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#ab8ff6649bcf90fed276bf8ba8c8d87b8">psyclone.dynamo0p3.DynArgDescriptor03.type</a></div><div class="ttdeci">def type(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l00806">dynamo0p3.py:806</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument_html_ad52abf3c34711a262dd95107ecaff4fe"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#ad52abf3c34711a262dd95107ecaff4fe">psyclone.dynamo0p3.DynKernelArgument.mesh</a></div><div class="ttdeci">def mesh(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07446">dynamo0p3.py:7446</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments_html_a25a3ab835728fdb15a39db9e2be2df23"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#a25a3ab835728fdb15a39db9e2be2df23">psyclone.dynamo0p3.DynKernelArguments._raw_arg_list</a></div><div class="ttdeci">_raw_arg_list</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07325">dynamo0p3.py:7325</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1FSDescriptors_html"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1FSDescriptors.html">psyclone.dynamo0p3.FSDescriptors</a></div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06942">dynamo0p3.py:6942</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynLoop_html_a33c63569db9441249d5b9faf6299a9fc"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a33c63569db9441249d5b9faf6299a9fc">psyclone.dynamo0p3.DynLoop.view</a></div><div class="ttdeci">def view(self, indent=0)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04509">dynamo0p3.py:4509</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernCallArgList_html_a284163a34aa8727b033aba2cc14af970"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a284163a34aa8727b033aba2cc14af970">psyclone.dynamo0p3.KernCallArgList._parent</a></div><div class="ttdeci">_parent</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05997">dynamo0p3.py:5997</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernStubArgList_html_a8e7edf3d9f5ff907c0faae354a5278e0"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a8e7edf3d9f5ff907c0faae354a5278e0">psyclone.dynamo0p3.KernStubArgList.diff_basis</a></div><div class="ttdeci">def diff_basis(self, function_space)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06649">dynamo0p3.py:6649</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument_html_a25c28eaa006a7c3e8d6dd648f2302051"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a25c28eaa006a7c3e8d6dd648f2302051">psyclone.dynamo0p3.DynKernelArgument.__init__</a></div><div class="ttdeci">def __init__(self, kernel_args, arg_meta_data, arg_info, call)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07334">dynamo0p3.py:7334</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynStencil_html_aa2378ea7f78cf4772fcf40b7a0eb46a7"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynStencil.html#aa2378ea7f78cf4772fcf40b7a0eb46a7">psyclone.dynamo0p3.DynStencil._extent</a></div><div class="ttdeci">_extent</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07040">dynamo0p3.py:7040</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument_html_a9dd50f153433fae3bce3c3442c097e54"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a9dd50f153433fae3bce3c3442c097e54">psyclone.dynamo0p3.DynKernelArgument._vector_size</a></div><div class="ttdeci">_vector_size</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07353">dynamo0p3.py:7353</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1FunctionSpace_html_a14fa188b17bf61943b51d743d9dd8892"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1FunctionSpace.html#a14fa188b17bf61943b51d743d9dd8892">psyclone.dynamo0p3.FunctionSpace._mangled_name</a></div><div class="ttdeci">_mangled_name</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l00420">dynamo0p3.py:420</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernCallArgList_html_a40f165860d73d66ee3315dc1613b256e"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a40f165860d73d66ee3315dc1613b256e">psyclone.dynamo0p3.KernCallArgList.quad_rule</a></div><div class="ttdeci">def quad_rule(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06258">dynamo0p3.py:6258</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvoke_html_a8e69798a97d7a7e659386a8e6b932080"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#a8e69798a97d7a7e659386a8e6b932080">psyclone.dynamo0p3.DynInvoke.iterate_over_dofs_only</a></div><div class="ttdeci">def iterate_over_dofs_only(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l03046">dynamo0p3.py:3046</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeCMAOperators_html_af6a3e7fe5aba5ca2cbbcaf5ddc8c271b"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeCMAOperators.html#af6a3e7fe5aba5ca2cbbcaf5ddc8c271b">psyclone.dynamo0p3.DynInvokeCMAOperators._cma_ops</a></div><div class="ttdeci">_cma_ops</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01814">dynamo0p3.py:1814</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernCallArgList_html_afce3f4d66984e336db84826a6e5e2701"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#afce3f4d66984e336db84826a6e5e2701">psyclone.dynamo0p3.KernCallArgList._arglist</a></div><div class="ttdeci">_arglist</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05998">dynamo0p3.py:5998</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynMeshes_html_ab1f5dea07b94694498f1df053a67f7c5"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html#ab1f5dea07b94694498f1df053a67f7c5">psyclone.dynamo0p3.DynMeshes._needs_colourmap</a></div><div class="ttdeci">_needs_colourmap</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01928">dynamo0p3.py:1928</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata_html"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html">psyclone.dynamo0p3.DynKernMetadata</a></div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l00836">dynamo0p3.py:836</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernStubArgList_html_a8dc2d43aad4fa2edb207a43e932eaf2e"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a8dc2d43aad4fa2edb207a43e932eaf2e">psyclone.dynamo0p3.KernStubArgList._first_arg_decl</a></div><div class="ttdeci">_first_arg_decl</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06327">dynamo0p3.py:6327</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernCallFactory_html"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernCallFactory.html">psyclone.dynamo0p3.DynKernCallFactory</a></div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07603">dynamo0p3.py:7603</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns_html_a8b4af5b307d5584cc3775ed0bd8f93b0"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a8b4af5b307d5584cc3775ed0bd8f93b0">psyclone.dynamo0p3.DynInvokeBasisFns._qr_vars</a></div><div class="ttdeci">_qr_vars</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02308">dynamo0p3.py:2308</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument_html_a994d27bdaf1d29c30e508db47eb33f6c"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a994d27bdaf1d29c30e508db47eb33f6c">psyclone.dynamo0p3.DynKernelArgument._kernel_args</a></div><div class="ttdeci">_kernel_args</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07352">dynamo0p3.py:7352</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvoke_html_ae9c00f3b2e12152ef697bd6c70e89f80"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#ae9c00f3b2e12152ef697bd6c70e89f80">psyclone.dynamo0p3.DynInvoke.unique_proxy_declarations</a></div><div class="ttdeci">def unique_proxy_declarations(self, datatype, access=None)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02988">dynamo0p3.py:2988</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernStubArgList_html_a3f6795073a041eed29f3cd2fd09d0c44"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a3f6795073a041eed29f3cd2fd09d0c44">psyclone.dynamo0p3.KernStubArgList.stencil</a></div><div class="ttdeci">def stencil(self, arg)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06411">dynamo0p3.py:6411</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynStencil_html_a5ede4c0ebdc8d59aff21482ab17dc50d"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynStencil.html#a5ede4c0ebdc8d59aff21482ab17dc50d">psyclone.dynamo0p3.DynStencil._direction_arg</a></div><div class="ttdeci">_direction_arg</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07042">dynamo0p3.py:7042</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1HaloDepth_html_a0d88a9597dfafaa51d993aa5b598a1d9"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#a0d88a9597dfafaa51d993aa5b598a1d9">psyclone.dynamo0p3.HaloDepth._annexed_only</a></div><div class="ttdeci">_annexed_only</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04071">dynamo0p3.py:4071</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03_html_a35ac8ccec63526e2192f0d2eb75435e2"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#a35ac8ccec63526e2192f0d2eb75435e2">psyclone.dynamo0p3.DynArgDescriptor03.function_space_from</a></div><div class="ttdeci">def function_space_from(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l00755">dynamo0p3.py:755</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1FSDescriptor_html"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1FSDescriptor.html">psyclone.dynamo0p3.FSDescriptor</a></div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06909">dynamo0p3.py:6909</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata_html_a2d5182c0cdbec8e223f757fe20d00ede"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#a2d5182c0cdbec8e223f757fe20d00ede">psyclone.dynamo0p3.DynKernMetadata._func_descriptors</a></div><div class="ttdeci">_func_descriptors</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l00888">dynamo0p3.py:888</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvoke_html_a4319b398ff9289af1927513ffb4dd892"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#a4319b398ff9289af1927513ffb4dd892">psyclone.dynamo0p3.DynInvoke.arg_for_funcspace</a></div><div class="ttdeci">def arg_for_funcspace(self, fspace)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l03011">dynamo0p3.py:3011</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeCMAOperators_html_ae5840373f3d5c66ad7cad0ba9dff0f3d"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeCMAOperators.html#ae5840373f3d5c66ad7cad0ba9dff0f3d">psyclone.dynamo0p3.DynInvokeCMAOperators.cma_diff_fs_params</a></div><div class="ttdeci">list cma_diff_fs_params</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01798">dynamo0p3.py:1798</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1FunctionSpace_html_a4758e315e4621500bed3de42267ed8cb"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1FunctionSpace.html#a4758e315e4621500bed3de42267ed8cb">psyclone.dynamo0p3.FunctionSpace._orig_name</a></div><div class="ttdeci">_orig_name</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l00416">dynamo0p3.py:416</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernCallArgList_html_a8bd6ce847f70c29aa2f080e4285f48a1"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a8bd6ce847f70c29aa2f080e4285f48a1">psyclone.dynamo0p3.KernCallArgList.scalar</a></div><div class="ttdeci">def scalar(self, scalar_arg)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06112">dynamo0p3.py:6112</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments_html_aa612aed9e376d3ad8affef9803e381ae"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#aa612aed9e376d3ad8affef9803e381ae">psyclone.dynamo0p3.DynKernelArguments.has_operator</a></div><div class="ttdeci">def has_operator(self, op_type=None)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07206">dynamo0p3.py:7206</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynLoop_html_af98ed18daa2a1e1014dcbef9c7dc9fb7"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#af98ed18daa2a1e1014dcbef9c7dc9fb7">psyclone.dynamo0p3.DynLoop.create_halo_exchanges</a></div><div class="ttdeci">def create_halo_exchanges(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04958">dynamo0p3.py:4958</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1ArgOrdering_html_a95a7f4be43c9b22dc2eb2ae8ba3ab8c8"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a95a7f4be43c9b22dc2eb2ae8ba3ab8c8">psyclone.dynamo0p3.ArgOrdering.operator_bcs_kernel</a></div><div class="ttdeci">def operator_bcs_kernel(self, function_space)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05945">dynamo0p3.py:5945</a></div></div>
<div class="ttc" id="classpsyclone_1_1psyGen_1_1Node_html_a68bdd2c9de759ce07262566af9f9f949"><div class="ttname"><a href="classpsyclone_1_1psyGen_1_1Node.html#a68bdd2c9de759ce07262566af9f9f949">psyclone.psyGen.Node.position</a></div><div class="ttdeci">position</div><div class="ttdef"><b>Definition:</b> <a href="psyGen_8py_source.html#l01107">psyGen.py:1107</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1FSDescriptor_html_a13f66aeb12cdc4dacd67117f72275dbb"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1FSDescriptor.html#a13f66aeb12cdc4dacd67117f72275dbb">psyclone.dynamo0p3.FSDescriptor._descriptor</a></div><div class="ttdeci">_descriptor</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06914">dynamo0p3.py:6914</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynLoop_html_acd859d639f8850d3049e34e9d23a4caa"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#acd859d639f8850d3049e34e9d23a4caa">psyclone.dynamo0p3.DynLoop._iteration_space</a></div><div class="ttdeci">_iteration_space</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04548">dynamo0p3.py:4548</a></div></div>
<div class="ttc" id="classpsyclone_1_1psyGen_1_1Kern_html_ad5ccfbc244cb81b6733b56133ac9e6c1"><div class="ttname"><a href="classpsyclone_1_1psyGen_1_1Kern.html#ad5ccfbc244cb81b6733b56133ac9e6c1">psyclone.psyGen.Kern.is_coloured</a></div><div class="ttdeci">def is_coloured(self)</div><div class="ttdef"><b>Definition:</b> <a href="psyGen_8py_source.html#l03372">psyGen.py:3372</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernStubArgList_html_a3fd82a49fc82f8f816c7203f0c33e27a"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a3fd82a49fc82f8f816c7203f0c33e27a">psyclone.dynamo0p3.KernStubArgList.__init__</a></div><div class="ttdeci">def __init__(self, kern, parent)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06306">dynamo0p3.py:6306</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKern_html_af7b08881b219a0ede28d2400e8f386d7"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#af7b08881b219a0ede28d2400e8f386d7">psyclone.dynamo0p3.DynKern._basis_required</a></div><div class="ttdeci">_basis_required</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05158">dynamo0p3.py:5158</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernCallArgList_html_a667ecc9acd9ace58d801b4eb3f5fbe64"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a667ecc9acd9ace58d801b4eb3f5fbe64">psyclone.dynamo0p3.KernCallArgList.field_bcs_kernel</a></div><div class="ttdeci">def field_bcs_kernel(self, function_space)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06212">dynamo0p3.py:6212</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynHaloExchangeStart_html"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchangeStart.html">psyclone.dynamo0p3.DynHaloExchangeStart</a></div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l03886">dynamo0p3.py:3886</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynLoop_html_a1ff44a76dff13cfb47c2d0fa65923451"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a1ff44a76dff13cfb47c2d0fa65923451">psyclone.dynamo0p3.DynLoop._loop_type</a></div><div class="ttdeci">_loop_type</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04491">dynamo0p3.py:4491</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1ArgOrdering_html_ae447b81eefcae9c0b292084a68c7441d"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#ae447b81eefcae9c0b292084a68c7441d">psyclone.dynamo0p3.ArgOrdering.banded_dofmap</a></div><div class="ttdeci">def banded_dofmap(self, function_space)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05965">dynamo0p3.py:5965</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03_html_aa6d6f4fe9a212eb0cf77abb39df4b9b1"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#aa6d6f4fe9a212eb0cf77abb39df4b9b1">psyclone.dynamo0p3.DynArgDescriptor03._access_descriptor</a></div><div class="ttdeci">_access_descriptor</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l00601">dynamo0p3.py:601</a></div></div>
<div class="ttc" id="namespacepsyclone_1_1configuration_html"><div class="ttname"><a href="namespacepsyclone_1_1configuration.html">psyclone.configuration</a></div><div class="ttdef"><b>Definition:</b> <a href="configuration_8py_source.html#l00001">configuration.py:1</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1HaloDepth_html_afbc641943077a044897b0260b9f301b3"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#afbc641943077a044897b0260b9f301b3">psyclone.dynamo0p3.HaloDepth.var_depth</a></div><div class="ttdeci">def var_depth(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04110">dynamo0p3.py:4110</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKern_html_a9993223ac16168df82b670c3cae892c9"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a9993223ac16168df82b670c3cae892c9">psyclone.dynamo0p3.DynKern._arguments</a></div><div class="ttdeci">_arguments</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05152">dynamo0p3.py:5152</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument_html_a1428144924709de07d4f391bd852656f"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a1428144924709de07d4f391bd852656f">psyclone.dynamo0p3.DynKernelArgument.function_spaces</a></div><div class="ttdeci">def function_spaces(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07527">dynamo0p3.py:7527</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvoke_html_aef9784711c602aa93b7cd18247d485e3"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#aef9784711c602aa93b7cd18247d485e3">psyclone.dynamo0p3.DynInvoke._alg_unique_qr_args</a></div><div class="ttdeci">_alg_unique_qr_args</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02950">dynamo0p3.py:2950</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1HaloDepth_html"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html">psyclone.dynamo0p3.HaloDepth</a></div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04043">dynamo0p3.py:4043</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynLoop_html_a354c164f6362c43df7abb49e145dc698"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a354c164f6362c43df7abb49e145dc698">psyclone.dynamo0p3.DynLoop._halo_read_access</a></div><div class="ttdeci">def _halo_read_access(self, arg)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04825">dynamo0p3.py:4825</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernStubArgList_html_ae712a076d0d9dcdb94c144746559c0f2"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#ae712a076d0d9dcdb94c144746559c0f2">psyclone.dynamo0p3.KernStubArgList.arglist</a></div><div class="ttdeci">def arglist(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06759">dynamo0p3.py:6759</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments_html_ac3e523e0a601b00bb90195bdb8f124f2"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#ac3e523e0a601b00bb90195bdb8f124f2">psyclone.dynamo0p3.DynKernelArguments._dofs</a></div><div class="ttdeci">_dofs</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07138">dynamo0p3.py:7138</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1FSDescriptors_html_a8355530030bd84bf416a1a6ef87291bc"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1FSDescriptors.html#a8355530030bd84bf416a1a6ef87291bc">psyclone.dynamo0p3.FSDescriptors._orig_descriptors</a></div><div class="ttdeci">_orig_descriptors</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06958">dynamo0p3.py:6958</a></div></div>
<div class="ttc" id="classpsyclone_1_1psyGen_1_1Loop_html"><div class="ttname"><a href="classpsyclone_1_1psyGen_1_1Loop.html">psyclone.psyGen.Loop</a></div><div class="ttdef"><b>Definition:</b> <a href="psyGen_8py_source.html#l02619">psyGen.py:2619</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1ArgOrdering_html_adb61c8779c13200cbf923f879f7e26a5"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#adb61c8779c13200cbf923f879f7e26a5">psyclone.dynamo0p3.ArgOrdering.mesh_ncell2d</a></div><div class="ttdeci">def mesh_ncell2d(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05800">dynamo0p3.py:5800</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvoke_html_a20571a324859fc91f788347ffcb7330d"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#a20571a324859fc91f788347ffcb7330d">psyclone.dynamo0p3.DynInvoke.evaluators</a></div><div class="ttdeci">evaluators</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02936">dynamo0p3.py:2936</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynamoInvokes_html_a1ef6db5976529f575e98f1fb272a6cd3"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynamoInvokes.html#a1ef6db5976529f575e98f1fb272a6cd3">psyclone.dynamo0p3.DynamoInvokes._0_to_n</a></div><div class="ttdeci">_0_to_n</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01381">dynamo0p3.py:1381</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernStubArgList_html_a4633caa757c0d32c33891f38dce70190"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a4633caa757c0d32c33891f38dce70190">psyclone.dynamo0p3.KernStubArgList._arglist</a></div><div class="ttdeci">_arglist</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06330">dynamo0p3.py:6330</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynamoInvokes_html"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynamoInvokes.html">psyclone.dynamo0p3.DynamoInvokes</a></div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01373">dynamo0p3.py:1373</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernStubArgList_html_afde64572207d2730f973dbd6dbd4924e"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#afde64572207d2730f973dbd6dbd4924e">psyclone.dynamo0p3.KernStubArgList.basis</a></div><div class="ttdeci">def basis(self, function_space)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06580">dynamo0p3.py:6580</a></div></div>
<div class="ttc" id="classpsyclone_1_1psyGen_1_1PSy_html_a0685d83599bdd6b4df54b97e450f2f2e"><div class="ttname"><a href="classpsyclone_1_1psyGen_1_1PSy.html#a0685d83599bdd6b4df54b97e450f2f2e">psyclone.psyGen.PSy.inline</a></div><div class="ttdeci">def inline(self, module)</div><div class="ttdef"><b>Definition:</b> <a href="psyGen_8py_source.html#l00328">psyGen.py:328</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1HaloReadAccess_html_ad904f710d3138d18313a002293a88a26"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1HaloReadAccess.html#ad904f710d3138d18313a002293a88a26">psyclone.dynamo0p3.HaloReadAccess.__init__</a></div><div class="ttdeci">def __init__(self, field)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04315">dynamo0p3.py:4315</a></div></div>
<div class="ttc" id="classpsyclone_1_1psyGen_1_1Invoke_html_a21a4142f2b3d5beac3fbc6ee49a18811"><div class="ttname"><a href="classpsyclone_1_1psyGen_1_1Invoke.html#a21a4142f2b3d5beac3fbc6ee49a18811">psyclone.psyGen.Invoke.unique_declns_by_intent</a></div><div class="ttdeci">def unique_declns_by_intent(self, datatype)</div><div class="ttdef"><b>Definition:</b> <a href="psyGen_8py_source.html#l00705">psyGen.py:705</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns_html_a06f089ee8ad2d5770a0db66f36703e24"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a06f089ee8ad2d5770a0db66f36703e24">psyclone.dynamo0p3.DynInvokeBasisFns._basis_fns</a></div><div class="ttdeci">_basis_fns</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02303">dynamo0p3.py:2303</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernStubArgList_html_a9cbadd7fa67eec8057a3b63e2761990f"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a9cbadd7fa67eec8057a3b63e2761990f">psyclone.dynamo0p3.KernStubArgList.field</a></div><div class="ttdeci">def field(self, arg)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06377">dynamo0p3.py:6377</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil_html_a36f63462adf0926223c40232d38e3ca4"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil.html#a36f63462adf0926223c40232d38e3ca4">psyclone.dynamo0p3.DynInvokeStencil._unique_direction_vars</a></div><div class="ttdeci">def _unique_direction_vars(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01520">dynamo0p3.py:1520</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynMeshes_html_a91d113792a7629e15784ab37d10ce6d0"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html#a91d113792a7629e15784ab37d10ce6d0">psyclone.dynamo0p3.DynMeshes._name_space_manager</a></div><div class="ttdeci">_name_space_manager</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01920">dynamo0p3.py:1920</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernStubArgList_html_a066c27936d2d59fdda935ba57bb3aa44"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#a066c27936d2d59fdda935ba57bb3aa44">psyclone.dynamo0p3.KernStubArgList.mesh_height</a></div><div class="ttdeci">def mesh_height(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06340">dynamo0p3.py:6340</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns_html"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html">psyclone.dynamo0p3.DynInvokeBasisFns</a></div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02285">dynamo0p3.py:2285</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKern_html_aed208ff1a80ee1d5e6006540f91b1549"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#aed208ff1a80ee1d5e6006540f91b1549">psyclone.dynamo0p3.DynKern.gen_code</a></div><div class="ttdeci">def gen_code(self, parent)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05532">dynamo0p3.py:5532</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynSchedule_html"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynSchedule.html">psyclone.dynamo0p3.DynSchedule</a></div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l03382">dynamo0p3.py:3382</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernCallArgList_html_a0eecf229788497b63a60667ba414b2f3"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a0eecf229788497b63a60667ba414b2f3">psyclone.dynamo0p3.KernCallArgList.stencil</a></div><div class="ttdeci">def stencil(self, arg)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06082">dynamo0p3.py:6082</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynStencil_html"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynStencil.html">psyclone.dynamo0p3.DynStencil</a></div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07036">dynamo0p3.py:7036</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynLoop_html_a3e27c793e731d0af8b3715722b44ce04"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a3e27c793e731d0af8b3715722b44ce04">psyclone.dynamo0p3.DynLoop._stop</a></div><div class="ttdeci">_stop</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05030">dynamo0p3.py:5030</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynMeshes_html_a387ea40bfd30ca397f70aebb5c71052e"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html#a387ea40bfd30ca397f70aebb5c71052e">psyclone.dynamo0p3.DynMeshes._colourmap_init</a></div><div class="ttdeci">def _colourmap_init(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02001">dynamo0p3.py:2001</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernCallArgList_html_a2c2410d54ffcfbf92ca0919eac4f9103"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a2c2410d54ffcfbf92ca0919eac4f9103">psyclone.dynamo0p3.KernCallArgList.mesh_ncell2d</a></div><div class="ttdeci">def mesh_ncell2d(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06045">dynamo0p3.py:6045</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInterGrid_html_a9fc797172504e312ded7967867d466b2"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInterGrid.html#a9fc797172504e312ded7967867d466b2">psyclone.dynamo0p3.DynInterGrid.coarse</a></div><div class="ttdeci">coarse</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02252">dynamo0p3.py:2252</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1HaloDepth_html_acead237039ac82e5535c17be35c9b7e5"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#acead237039ac82e5535c17be35c9b7e5">psyclone.dynamo0p3.HaloDepth._var_depth</a></div><div class="ttdeci">_var_depth</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04056">dynamo0p3.py:4056</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument_html_aa76431f4e517f4c74182b5bfb41075c1"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#aa76431f4e517f4c74182b5bfb41075c1">psyclone.dynamo0p3.DynKernelArgument.is_operator</a></div><div class="ttdeci">def is_operator(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07594">dynamo0p3.py:7594</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernStubArgList_html_abc8d87da43f55769aaf1e7fc944bae4c"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#abc8d87da43f55769aaf1e7fc944bae4c">psyclone.dynamo0p3.KernStubArgList.quad_rule</a></div><div class="ttdeci">def quad_rule(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06742">dynamo0p3.py:6742</a></div></div>
<div class="ttc" id="classpsyclone_1_1parse_1_1KernelType_html_a5cf2320fa76643060debcfc97b83b91b"><div class="ttname"><a href="classpsyclone_1_1parse_1_1KernelType.html#a5cf2320fa76643060debcfc97b83b91b">psyclone.parse.KernelType._ktype</a></div><div class="ttdeci">_ktype</div><div class="ttdef"><b>Definition:</b> <a href="parse_8py_source.html#l00588">parse.py:588</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKern_html_af231c71913c208055c7c800a30eb5cc2"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#af231c71913c208055c7c800a30eb5cc2">psyclone.dynamo0p3.DynKern.gen_stub</a></div><div class="ttdeci">def gen_stub(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05479">dynamo0p3.py:5479</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynamoInvokes_html_a5d77dc8245c92d54669e826168cdce0f"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynamoInvokes.html#a5d77dc8245c92d54669e826168cdce0f">psyclone.dynamo0p3.DynamoInvokes._name_space_manager</a></div><div class="ttdeci">_name_space_manager</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01379">dynamo0p3.py:1379</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns_html_aa9bc9c611ed3035d6922d41fc069c142"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#aa9bc9c611ed3035d6922d41fc069c142">psyclone.dynamo0p3.DynInvokeBasisFns.initialise_basis_fns</a></div><div class="ttdeci">def initialise_basis_fns(self, parent)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02461">dynamo0p3.py:2461</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKern_html_ab99348d7adbe97fa7ace11e64f2be5b0"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#ab99348d7adbe97fa7ace11e64f2be5b0">psyclone.dynamo0p3.DynKern._name_space_manager</a></div><div class="ttdeci">_name_space_manager</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05168">dynamo0p3.py:5168</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1ArgOrdering_html_a6684f61f12fa76c5714f3b51e5dca89b"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a6684f61f12fa76c5714f3b51e5dca89b">psyclone.dynamo0p3.ArgOrdering.quad_rule</a></div><div class="ttdeci">def quad_rule(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05956">dynamo0p3.py:5956</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeDofmaps_html_a2d30908ffc6b8ca9501f195bfb87ab35"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeDofmaps.html#a2d30908ffc6b8ca9501f195bfb87ab35">psyclone.dynamo0p3.DynInvokeDofmaps._unique_cbanded_maps</a></div><div class="ttdeci">_unique_cbanded_maps</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01644">dynamo0p3.py:1644</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil_html_a383ed74e23b6462dffa82531f1a2c267"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeStencil.html#a383ed74e23b6462dffa82531f1a2c267">psyclone.dynamo0p3.DynInvokeStencil._unique_extent_vars</a></div><div class="ttdeci">def _unique_extent_vars(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01500">dynamo0p3.py:1500</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKern_html_ac57b04e61b66fec36adb14f07705b6dc"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#ac57b04e61b66fec36adb14f07705b6dc">psyclone.dynamo0p3.DynKern.written_arg</a></div><div class="ttdeci">def written_arg(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05516">dynamo0p3.py:5516</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvoke_html_ad7c703b366986387918a888c33f37d34"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#ad7c703b366986387918a888c33f37d34">psyclone.dynamo0p3.DynInvoke.unique_fss</a></div><div class="ttdeci">def unique_fss(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l03024">dynamo0p3.py:3024</a></div></div>
<div class="ttc" id="classpsyclone_1_1psyGen_1_1Call_html_a6bd17c037cb747d595e5690133a8443e"><div class="ttname"><a href="classpsyclone_1_1psyGen_1_1Call.html#a6bd17c037cb747d595e5690133a8443e">psyclone.psyGen.Call._name</a></div><div class="ttdeci">_name</div><div class="ttdef"><b>Definition:</b> <a href="psyGen_8py_source.html#l02909">psyGen.py:2909</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynLoop_html_a2ab46a6bad87d296528120231a77e29d"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a2ab46a6bad87d296528120231a77e29d">psyclone.dynamo0p3.DynLoop._add_halo_exchange</a></div><div class="ttdeci">def _add_halo_exchange(self, halo_field)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04913">dynamo0p3.py:4913</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernCallArgList_html_a605fb01cd622f598c3327ee5aba903a9"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a605fb01cd622f598c3327ee5aba903a9">psyclone.dynamo0p3.KernCallArgList._name_space_manager</a></div><div class="ttdeci">_name_space_manager</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05999">dynamo0p3.py:5999</a></div></div>
<div class="ttc" id="classpsyclone_1_1psyGen_1_1PSy_html_afd62d411849a5d84004ed034848fea27"><div class="ttname"><a href="classpsyclone_1_1psyGen_1_1PSy.html#afd62d411849a5d84004ed034848fea27">psyclone.psyGen.PSy._name</a></div><div class="ttdeci">_name</div><div class="ttdef"><b>Definition:</b> <a href="psyGen_8py_source.html#l00309">psyGen.py:309</a></div></div>
<div class="ttc" id="namespacepsyclone_1_1dynamo0p3__builtins_html"><div class="ttname"><a href="namespacepsyclone_1_1dynamo0p3__builtins.html">psyclone.dynamo0p3_builtins</a></div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3__builtins_8py_source.html#l00001">dynamo0p3_builtins.py:1</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernCallArgList_html_a39f19335e6b57509ff6f56e859772e74"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a39f19335e6b57509ff6f56e859772e74">psyclone.dynamo0p3.KernCallArgList.stencil_unknown_extent</a></div><div class="ttdeci">def stencil_unknown_extent(self, arg)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06067">dynamo0p3.py:6067</a></div></div>
<div class="ttc" id="classpsyclone_1_1psyGen_1_1Node_html_ae280d2a4a7fc69bcc4c836a696c8ed94"><div class="ttname"><a href="classpsyclone_1_1psyGen_1_1Node.html#ae280d2a4a7fc69bcc4c836a696c8ed94">psyclone.psyGen.Node.ancestor</a></div><div class="ttdeci">def ancestor(self, my_type, excluding=None)</div><div class="ttdef"><b>Definition:</b> <a href="psyGen_8py_source.html#l01251">psyGen.py:1251</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1ArgOrdering_html_a41d378f72b5a0da177028e0d183c56e3"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a41d378f72b5a0da177028e0d183c56e3">psyclone.dynamo0p3.ArgOrdering.stencil_unknown_extent</a></div><div class="ttdeci">def stencil_unknown_extent(self, arg)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05838">dynamo0p3.py:5838</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeDofmaps_html_ac4b7f46884439de3c2a3fae36a59a3c0"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeDofmaps.html#ac4b7f46884439de3c2a3fae36a59a3c0">psyclone.dynamo0p3.DynInvokeDofmaps._unique_fs_maps</a></div><div class="ttdeci">_unique_fs_maps</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01637">dynamo0p3.py:1637</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1HaloDepth_html_a28f57642fb50e76f572a8b9c03206296"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#a28f57642fb50e76f572a8b9c03206296">psyclone.dynamo0p3.HaloDepth._max_depth_m1</a></div><div class="ttdeci">_max_depth_m1</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04068">dynamo0p3.py:4068</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument_html_a2c78fc0527c7cf8b2aa0f99c31dbdd02"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a2c78fc0527c7cf8b2aa0f99c31dbdd02">psyclone.dynamo0p3.DynKernelArgument.intent</a></div><div class="ttdeci">def intent(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07546">dynamo0p3.py:7546</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernCallArgList_html_aaaf6bbe54b3d5f2f77d2f9794a1cc28e"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#aaaf6bbe54b3d5f2f77d2f9794a1cc28e">psyclone.dynamo0p3.KernCallArgList.diff_basis</a></div><div class="ttdeci">def diff_basis(self, function_space)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06181">dynamo0p3.py:6181</a></div></div>
<div class="ttc" id="namespacepsyclone_1_1f2pygen_html"><div class="ttname"><a href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a></div><div class="ttdef"><b>Definition:</b> <a href="f2pygen_8py_source.html#l00001">f2pygen.py:1</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1FSDescriptors_html_a04db6f5c07745b15ca8b1a188eb77181"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1FSDescriptors.html#a04db6f5c07745b15ca8b1a188eb77181">psyclone.dynamo0p3.FSDescriptors.descriptors</a></div><div class="ttdeci">def descriptors(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06985">dynamo0p3.py:6985</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeDofmaps_html_a029dbc8a78a6ab93975f3ab67fc865f3"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeDofmaps.html#a029dbc8a78a6ab93975f3ab67fc865f3">psyclone.dynamo0p3.DynInvokeDofmaps.declare_dofmaps</a></div><div class="ttdeci">def declare_dofmaps(self, parent)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01759">dynamo0p3.py:1759</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments_html_a4a439698c79c9b92f236e290c9fab490"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#a4a439698c79c9b92f236e290c9fab490">psyclone.dynamo0p3.DynKernelArguments._args</a></div><div class="ttdeci">_args</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07092">dynamo0p3.py:7092</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument_html_a5a7a89d46d98d640ba26a27ee2d7bb25"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a5a7a89d46d98d640ba26a27ee2d7bb25">psyclone.dynamo0p3.DynKernelArgument.discontinuous</a></div><div class="ttdeci">def discontinuous(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07569">dynamo0p3.py:7569</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKern_html_a578c493154b39c44a3aadfa900741233"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a578c493154b39c44a3aadfa900741233">psyclone.dynamo0p3.DynKern._cma_operation</a></div><div class="ttdeci">_cma_operation</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05169">dynamo0p3.py:5169</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1HaloReadAccess_html_aed231a71f7792fb688d9bc12ea382d6c"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1HaloReadAccess.html#aed231a71f7792fb688d9bc12ea382d6c">psyclone.dynamo0p3.HaloReadAccess._needs_clean_outer</a></div><div class="ttdeci">_needs_clean_outer</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04323">dynamo0p3.py:4323</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1ArgOrdering_html_ad8eee666d0871d55b27961224faa80e9"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#ad8eee666d0871d55b27961224faa80e9">psyclone.dynamo0p3.ArgOrdering.stencil</a></div><div class="ttdeci">def stencil(self, arg)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05858">dynamo0p3.py:5858</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata_html_a23e52c1ca8ce0acbfd04b6784efbf5d7"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernMetadata.html#a23e52c1ca8ce0acbfd04b6784efbf5d7">psyclone.dynamo0p3.DynKernMetadata._validate</a></div><div class="ttdeci">def _validate(self, need_evaluator)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l00960">dynamo0p3.py:960</a></div></div>
<div class="ttc" id="namespacepsyclone_1_1expression_html"><div class="ttname"><a href="namespacepsyclone_1_1expression.html">psyclone.expression</a></div><div class="ttdef"><b>Definition:</b> <a href="expression_8py_source.html#l00001">expression.py:1</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1ArgOrdering_html_a1792d63f369ef2304d70a2288bf9258c"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a1792d63f369ef2304d70a2288bf9258c">psyclone.dynamo0p3.ArgOrdering.generate</a></div><div class="ttdeci">def generate(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05633">dynamo0p3.py:5633</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument_html_a5466506ff1fc848cdf4180f0f284d791"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a5466506ff1fc848cdf4180f0f284d791">psyclone.dynamo0p3.DynKernelArgument.function_space_from</a></div><div class="ttdeci">def function_space_from(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07522">dynamo0p3.py:7522</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvoke_html_ae55d826e7486407d39d8a32434bbf07c"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvoke.html#ae55d826e7486407d39d8a32434bbf07c">psyclone.dynamo0p3.DynInvoke.cma_ops</a></div><div class="ttdeci">cma_ops</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02932">dynamo0p3.py:2932</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynHaloExchangeEnd_html_a03600c23d33bb4ae40f90ab5ae23d1a1"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchangeEnd.html#a03600c23d33bb4ae40f90ab5ae23d1a1">psyclone.dynamo0p3.DynHaloExchangeEnd._dag_name</a></div><div class="ttdeci">_dag_name</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04040">dynamo0p3.py:4040</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeCMAOperators_html_a7d1ed5548755dcbf33e6c79a460a5f41"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeCMAOperators.html#a7d1ed5548755dcbf33e6c79a460a5f41">psyclone.dynamo0p3.DynInvokeCMAOperators.initialise_cma_ops</a></div><div class="ttdeci">def initialise_cma_ops(self, parent)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l01835">dynamo0p3.py:1835</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKern_html_a1467c5970619680d6196607fa4b15bbc"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a1467c5970619680d6196607fa4b15bbc">psyclone.dynamo0p3.DynKern._qr_name</a></div><div class="ttdeci">_qr_name</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05166">dynamo0p3.py:5166</a></div></div>
<div class="ttc" id="classpsyclone_1_1psyGen_1_1Kern_html"><div class="ttname"><a href="classpsyclone_1_1psyGen_1_1Kern.html">psyclone.psyGen.Kern</a></div><div class="ttdef"><b>Definition:</b> <a href="psyGen_8py_source.html#l03182">psyGen.py:3182</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInterGrid_html_aa8e21652a77966b0c789c5c921148a80"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInterGrid.html#aa8e21652a77966b0c789c5c921148a80">psyclone.dynamo0p3.DynInterGrid.cell_map</a></div><div class="ttdeci">cell_map</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02277">dynamo0p3.py:2277</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernCallArgList_html_a931deb1444a0cb85032b66a2739bd214"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a931deb1444a0cb85032b66a2739bd214">psyclone.dynamo0p3.KernCallArgList.field</a></div><div class="ttdeci">def field(self, arg)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06061">dynamo0p3.py:6061</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1HaloReadAccess_html_a03ecbb9ede3a67f885cb2bb1bcd5565a"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1HaloReadAccess.html#a03ecbb9ede3a67f885cb2bb1bcd5565a">psyclone.dynamo0p3.HaloReadAccess._compute_from_field</a></div><div class="ttdeci">def _compute_from_field(self, field)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04355">dynamo0p3.py:4355</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1HaloReadAccess_html_ab589e42ff99d8dafd8d7a243231348f8"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1HaloReadAccess.html#ab589e42ff99d8dafd8d7a243231348f8">psyclone.dynamo0p3.HaloReadAccess._stencil_type</a></div><div class="ttdeci">_stencil_type</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04322">dynamo0p3.py:4322</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKern_html_adb1b64e3c3fdeb850b16a7ff35743b83"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#adb1b64e3c3fdeb850b16a7ff35743b83">psyclone.dynamo0p3.DynKern.qr_name</a></div><div class="ttdeci">def qr_name(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05455">dynamo0p3.py:5455</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03_html_a0ffecabdcdb593f2098b024e82a684e9"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynArgDescriptor03.html#a0ffecabdcdb593f2098b024e82a684e9">psyclone.dynamo0p3.DynArgDescriptor03.vector_size</a></div><div class="ttdeci">def vector_size(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l00800">dynamo0p3.py:800</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynFuncDescriptor03_html_a50d5e442d7161abb9aa9a3307a4ad397"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynFuncDescriptor03.html#a50d5e442d7161abb9aa9a3307a4ad397">psyclone.dynamo0p3.DynFuncDescriptor03._operator_names</a></div><div class="ttdeci">_operator_names</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l00466">dynamo0p3.py:466</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynFuncDescriptor03_html_a2a18e367f444f5f930d6b26181b14f2b"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynFuncDescriptor03.html#a2a18e367f444f5f930d6b26181b14f2b">psyclone.dynamo0p3.DynFuncDescriptor03._function_space_name</a></div><div class="ttdeci">_function_space_name</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l00475">dynamo0p3.py:475</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernStubArgList_html_af8c1491ab742fee68f0310774b94df26"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernStubArgList.html#af8c1491ab742fee68f0310774b94df26">psyclone.dynamo0p3.KernStubArgList.stencil_unknown_direction</a></div><div class="ttdeci">def stencil_unknown_direction(self, arg)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06402">dynamo0p3.py:6402</a></div></div>
<div class="ttc" id="classpsyclone_1_1parse_1_1KernelType_html_adc72127ce62cac03e022d11735835ce9"><div class="ttname"><a href="classpsyclone_1_1parse_1_1KernelType.html#adc72127ce62cac03e022d11735835ce9">psyclone.parse.KernelType.getkerneldescriptors</a></div><div class="ttdeci">def getkerneldescriptors(self, ast, var_name='meta_args')</div><div class="ttdef"><b>Definition:</b> <a href="parse_8py_source.html#l00594">parse.py:594</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKern_html_a7fe4641a1a9e166d8d39ec01cde935ea"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a7fe4641a1a9e166d8d39ec01cde935ea">psyclone.dynamo0p3.DynKern._eval_shape</a></div><div class="ttdeci">_eval_shape</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05160">dynamo0p3.py:5160</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernCallArgList_html_aa881eb303b8899914b1966e5d3d5281c"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#aa881eb303b8899914b1966e5d3d5281c">psyclone.dynamo0p3.KernCallArgList.arglist</a></div><div class="ttdeci">def arglist(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06274">dynamo0p3.py:6274</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynHaloExchangeStart_html_a236038487501eea4285b63c119846ec4"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchangeStart.html#a236038487501eea4285b63c119846ec4">psyclone.dynamo0p3.DynHaloExchangeStart.required</a></div><div class="ttdeci">def required(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l03954">dynamo0p3.py:3954</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments_html_aa9eb467f474a7cbca90c1d36d006e4f0"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#aa9eb467f474a7cbca90c1d36d006e4f0">psyclone.dynamo0p3.DynKernelArguments.dofs</a></div><div class="ttdeci">def dofs(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07301">dynamo0p3.py:7301</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynLoop_html_a78f6b013a7ce8269108b6b582e4ba998"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a78f6b013a7ce8269108b6b582e4ba998">psyclone.dynamo0p3.DynLoop._variable_name</a></div><div class="ttdeci">_variable_name</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04492">dynamo0p3.py:4492</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynHaloExchange_html_a0afb6ca563169f95acdba0f8a94ef06c"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchange.html#a0afb6ca563169f95acdba0f8a94ef06c">psyclone.dynamo0p3.DynHaloExchange._halo_exchange_name</a></div><div class="ttdeci">_halo_exchange_name</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l03567">dynamo0p3.py:3567</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKern_html_aad47462ba71b44c4ee49b8ccc6d7d996"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#aad47462ba71b44c4ee49b8ccc6d7d996">psyclone.dynamo0p3.DynKern.cma_operation</a></div><div class="ttdeci">def cma_operation(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05343">dynamo0p3.py:5343</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKern_html_a201d000d786855726295b9cca7fb7516"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a201d000d786855726295b9cca7fb7516">psyclone.dynamo0p3.DynKern.is_intergrid</a></div><div class="ttdeci">def is_intergrid(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05350">dynamo0p3.py:5350</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns_html_a5bb807a88dfeaa83029dbd46de7ffb9d"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a5bb807a88dfeaa83029dbd46de7ffb9d">psyclone.dynamo0p3.DynInvokeBasisFns.deallocate</a></div><div class="ttdeci">def deallocate(self, parent)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02824">dynamo0p3.py:2824</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynLoop_html_a91980de066f60536e247ba1b736eeafc"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a91980de066f60536e247ba1b736eeafc">psyclone.dynamo0p3.DynLoop._upper_bound_halo_depth</a></div><div class="ttdeci">_upper_bound_halo_depth</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04507">dynamo0p3.py:4507</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1HaloDepth_html_a09d622939f894cc8a6093a2b52877d68"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1HaloDepth.html#a09d622939f894cc8a6093a2b52877d68">psyclone.dynamo0p3.HaloDepth.max_depth_m1</a></div><div class="ttdeci">def max_depth_m1(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04098">dynamo0p3.py:4098</a></div></div>
<div class="ttc" id="classpsyclone_1_1parse_1_1KernelType_html"><div class="ttname"><a href="classpsyclone_1_1parse_1_1KernelType.html">psyclone.parse.KernelType</a></div><div class="ttdef"><b>Definition:</b> <a href="parse_8py_source.html#l00537">parse.py:537</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1FSDescriptors_html_a293df552058f4660d439bfa412dc6e12"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1FSDescriptors.html#a293df552058f4660d439bfa412dc6e12">psyclone.dynamo0p3.FSDescriptors._descriptors</a></div><div class="ttdeci">_descriptors</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06959">dynamo0p3.py:6959</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument_html_a2b2e61a33c448141eb35228a29a8f9a9"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernelArgument.html#a2b2e61a33c448141eb35228a29a8f9a9">psyclone.dynamo0p3.DynKernelArgument.proxy_declaration_name</a></div><div class="ttdeci">def proxy_declaration_name(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07466">dynamo0p3.py:7466</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments_html_a4682f6fad0da00b7749d659c09e9f669"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKernelArguments.html#a4682f6fad0da00b7749d659c09e9f669">psyclone.dynamo0p3.DynKernelArguments._unique_fs_names</a></div><div class="ttdeci">_unique_fs_names</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l07143">dynamo0p3.py:7143</a></div></div>
<div class="ttc" id="classpsyclone_1_1psyGen_1_1Node_html_a681c8ae703092153cdd1cd1b2eb82e9e"><div class="ttname"><a href="classpsyclone_1_1psyGen_1_1Node.html#a681c8ae703092153cdd1cd1b2eb82e9e">psyclone.psyGen.Node.walk</a></div><div class="ttdeci">def walk(self, children, my_type)</div><div class="ttdef"><b>Definition:</b> <a href="psyGen_8py_source.html#l01242">psyGen.py:1242</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynLoop_html_a2646ac6016870a47c86c3b537b40daa6"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a2646ac6016870a47c86c3b537b40daa6">psyclone.dynamo0p3.DynLoop.has_inc_arg</a></div><div class="ttdeci">def has_inc_arg(self, mapping=None)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04801">dynamo0p3.py:4801</a></div></div>
<div class="ttc" id="classpsyclone_1_1psyGen_1_1Node_html_a785ad9bd632033c16273bcfae09e28d8"><div class="ttname"><a href="classpsyclone_1_1psyGen_1_1Node.html#a785ad9bd632033c16273bcfae09e28d8">psyclone.psyGen.Node._children</a></div><div class="ttdeci">_children</div><div class="ttdef"><b>Definition:</b> <a href="psyGen_8py_source.html#l00886">psyGen.py:886</a></div></div>
<div class="ttc" id="classpsyclone_1_1parse_1_1KernelType_html_a5ede30b40bbcae17632416023e5f75fc"><div class="ttname"><a href="classpsyclone_1_1parse_1_1KernelType.html#a5ede30b40bbcae17632416023e5f75fc">psyclone.parse.KernelType.get_integer_array</a></div><div class="ttdeci">def get_integer_array(self, name)</div><div class="ttdef"><b>Definition:</b> <a href="parse_8py_source.html#l00708">parse.py:708</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1ArgOrdering_html_a0335069a7e6706d533c85607fec143ee"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1ArgOrdering.html#a0335069a7e6706d533c85607fec143ee">psyclone.dynamo0p3.ArgOrdering.diff_basis</a></div><div class="ttdeci">def diff_basis(self, function_space)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05915">dynamo0p3.py:5915</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynHaloExchangeStart_html_a2069c1041b9650e0d02733f02727da4f"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchangeStart.html#a2069c1041b9650e0d02733f02727da4f">psyclone.dynamo0p3.DynHaloExchangeStart._colour_map_name</a></div><div class="ttdeci">_colour_map_name</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l03926">dynamo0p3.py:3926</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns_html_a8f99f6e109a53abede33fdfb25a2eb76"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a8f99f6e109a53abede33fdfb25a2eb76">psyclone.dynamo0p3.DynInvokeBasisFns._initialise_xyz_qr</a></div><div class="ttdeci">def _initialise_xyz_qr(self, parent)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02629">dynamo0p3.py:2629</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernCallArgList_html_a5a1a66d6d07bb2ae7b316000ce3e339f"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a5a1a66d6d07bb2ae7b316000ce3e339f">psyclone.dynamo0p3.KernCallArgList.stencil_unknown_direction</a></div><div class="ttdeci">def stencil_unknown_direction(self, arg)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06075">dynamo0p3.py:6075</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1HaloReadAccess_html"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1HaloReadAccess.html">psyclone.dynamo0p3.HaloReadAccess</a></div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04309">dynamo0p3.py:4309</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1KernCallArgList_html_a2d99ac4d537a80b2b46a5c149e0ea512"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1KernCallArgList.html#a2d99ac4d537a80b2b46a5c149e0ea512">psyclone.dynamo0p3.KernCallArgList.mesh_height</a></div><div class="ttdeci">def mesh_height(self)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l06030">dynamo0p3.py:6030</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKern_html"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKern.html">psyclone.dynamo0p3.DynKern</a></div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05144">dynamo0p3.py:5144</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynMeshes_html_abe3627432efa9e99adf07b6798e8da41"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynMeshes.html#abe3627432efa9e99adf07b6798e8da41">psyclone.dynamo0p3.DynMeshes.declarations</a></div><div class="ttdeci">def declarations(self, parent)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02038">dynamo0p3.py:2038</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynLoop_html_a048f0f694be0fa4a376250074b32a795"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynLoop.html#a048f0f694be0fa4a376250074b32a795">psyclone.dynamo0p3.DynLoop._start</a></div><div class="ttdeci">_start</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05029">dynamo0p3.py:5029</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynHaloExchangeEnd_html_ad505c6feed09f84f04343c7fbf85c91a"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynHaloExchangeEnd.html#ad505c6feed09f84f04343c7fbf85c91a">psyclone.dynamo0p3.DynHaloExchangeEnd._text_name</a></div><div class="ttdeci">_text_name</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l04038">dynamo0p3.py:4038</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynKern_html_a8aba35c92f189b62f485895e1a2b2ec7"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynKern.html#a8aba35c92f189b62f485895e1a2b2ec7">psyclone.dynamo0p3.DynKern.load</a></div><div class="ttdeci">def load(self, call, parent=None)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l05172">dynamo0p3.py:5172</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_cc83beaa2b47d1d560813d6d01181a21.html">psyclone</a></li><li class="navelem"><b>dynamo0p3.py</b></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
