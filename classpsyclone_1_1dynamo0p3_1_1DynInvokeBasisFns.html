<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>PSyclone: psyclone.dynamo0p3.DynInvokeBasisFns Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="psyclone_v1.0_small.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PSyclone
   &#160;<span id="projectnumber">1.7.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">psyclone.dynamo0p3.DynInvokeBasisFns Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Inheritance diagram for psyclone.dynamo0p3.DynInvokeBasisFns:</div>
<div class="dyncontent">
<div class="center"><img src="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns__inherit__graph.png" border="0" usemap="#psyclone_8dynamo0p3_8DynInvokeBasisFns_inherit__map" alt="Inheritance graph"/></div>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for psyclone.dynamo0p3.DynInvokeBasisFns:</div>
<div class="dyncontent">
<div class="center"><img src="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns__coll__graph.png" border="0" usemap="#psyclone_8dynamo0p3_8DynInvokeBasisFns_coll__map" alt="Collaboration graph"/></div>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a9dc0720878e41e2047feb55a1ce9ac7f"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a9dc0720878e41e2047feb55a1ce9ac7f"></a>
def&#160;</td><td class="memItemRight" valign="bottom"><b>__init__</b> (self, schedule)</td></tr>
<tr class="separator:a9dc0720878e41e2047feb55a1ce9ac7f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a791303926010438cc25ac3aa522d2698"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a791303926010438cc25ac3aa522d2698">declare_qr</a> (self, parent)</td></tr>
<tr class="separator:a791303926010438cc25ac3aa522d2698"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa9bc9c611ed3035d6922d41fc069c142"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#aa9bc9c611ed3035d6922d41fc069c142">initialise_basis_fns</a> (self, parent)</td></tr>
<tr class="separator:aa9bc9c611ed3035d6922d41fc069c142"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad8479e5a39b535cf5d2d30962b138717"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#ad8479e5a39b535cf5d2d30962b138717">compute_basis_fns</a> (self, parent)</td></tr>
<tr class="separator:ad8479e5a39b535cf5d2d30962b138717"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5bb807a88dfeaa83029dbd46de7ffb9d"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a5bb807a88dfeaa83029dbd46de7ffb9d">deallocate</a> (self, parent)</td></tr>
<tr class="separator:a5bb807a88dfeaa83029dbd46de7ffb9d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><pre class="fragment">Holds all information on the basis and differential basis
functions required by an invoke. This covers both those required for
quadrature and for evaluators.

:param schedule: the schedule of the Invoke for which to extract \
                 information on all required basis/diff-basis functions.
:type schedule: :py:class:`psyclone.dynamo0p3.DynSchedule`

:raises InternalError: if a call in the supplied Schedule has an \
                       unrecognised evaluator shape.
</pre> 
<p>Definition at line <a class="el" href="dynamo0p3_8py_source.html#l02285">2285</a> of file <a class="el" href="dynamo0p3_8py_source.html">dynamo0p3.py</a>.</p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="ad8479e5a39b535cf5d2d30962b138717"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def psyclone.dynamo0p3.DynInvokeBasisFns.compute_basis_fns </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>parent</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Generates the necessary Fortran to compute the values of
any basis/diff-basis arrays required

:param parent: Node in the f2pygen AST which will be the parent
       of the assignments created in this routine
:type parent: :py:class:`psyclone.f2pygen.SubroutineGen`
</pre> 
<p>Definition at line <a class="el" href="dynamo0p3_8py_source.html#l02701">2701</a> of file <a class="el" href="dynamo0p3_8py_source.html">dynamo0p3.py</a>.</p>
<div class="fragment"><div class="line"><a name="l02701"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#ad8479e5a39b535cf5d2d30962b138717"> 2701</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#ad8479e5a39b535cf5d2d30962b138717">compute_basis_fns</a>(self, parent):</div><div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;<span class="stringliteral">        Generates the necessary Fortran to compute the values of</span></div><div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;<span class="stringliteral">        any basis/diff-basis arrays required</span></div><div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;<span class="stringliteral">        :param parent: Node in the f2pygen AST which will be the parent</span></div><div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;<span class="stringliteral">                       of the assignments created in this routine</span></div><div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;<span class="stringliteral">        :type parent: :py:class:`psyclone.f2pygen.SubroutineGen`</span></div><div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> CommentGen, AssignGen, CallGen, DoGen, \</div><div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;            DeclGen</div><div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;        loop_var_list = set()</div><div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;        op_name_list = []</div><div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;        <span class="comment"># add calls to compute the values of any basis arrays</span></div><div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a06f089ee8ad2d5770a0db66f36703e24">_basis_fns</a>:</div><div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;            parent.add(CommentGen(parent, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;            parent.add(CommentGen(parent, <span class="stringliteral">&quot; Compute basis/diff-basis arrays&quot;</span>))</div><div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;            parent.add(CommentGen(parent, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;</div><div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;        <span class="keywordflow">for</span> basis_fn <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a06f089ee8ad2d5770a0db66f36703e24">_basis_fns</a>:</div><div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;</div><div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;            <span class="comment"># Currently there are only two possible types of basis function</span></div><div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;            <span class="comment"># and we store which we have in is_diff_basis. If support for</span></div><div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;            <span class="comment"># other basis function types is added in future then the if-blocks</span></div><div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;            <span class="comment"># (further down) that use is_diff_basis will have to be changed.</span></div><div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;            <span class="keywordflow">if</span> basis_fn[<span class="stringliteral">&quot;type&quot;</span>] == <span class="stringliteral">&quot;diff-basis&quot;</span>:</div><div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;                is_diff_basis = <span class="keyword">True</span></div><div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;            <span class="keywordflow">elif</span> basis_fn[<span class="stringliteral">&quot;type&quot;</span>] == <span class="stringliteral">&quot;basis&quot;</span>:</div><div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;                is_diff_basis = <span class="keyword">False</span></div><div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;                <span class="keywordflow">raise</span> InternalError(</div><div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;                    <span class="stringliteral">&quot;Unrecognised type of basis function: &#39;{0}&#39;. Expected one &quot;</span></div><div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;                    <span class="stringliteral">&quot;of &#39;basis&#39; or &#39;diff-basis&#39;.&quot;</span>. format(basis_fn[<span class="stringliteral">&quot;type&quot;</span>]))</div><div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;            <span class="keywordflow">if</span> basis_fn[<span class="stringliteral">&quot;shape&quot;</span>] <span class="keywordflow">in</span> VALID_QUADRATURE_SHAPES:</div><div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;                <span class="keywordflow">if</span> is_diff_basis:</div><div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;                    op_name = get_fs_operator_name(<span class="stringliteral">&quot;gh_diff_basis&quot;</span>,</div><div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;                                                   basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>],</div><div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;                                                   qr_var=basis_fn[<span class="stringliteral">&quot;qr_var&quot;</span>])</div><div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;                    op_name = get_fs_operator_name(<span class="stringliteral">&quot;gh_basis&quot;</span>,</div><div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;                                                   basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>],</div><div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;                                                   qr_var=basis_fn[<span class="stringliteral">&quot;qr_var&quot;</span>])</div><div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;                <span class="keywordflow">if</span> op_name <span class="keywordflow">in</span> op_name_list:</div><div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;                    <span class="comment"># Jump over any basis arrays we&#39;ve seen before</span></div><div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;                    <span class="keywordflow">continue</span></div><div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;                op_name_list.append(op_name)</div><div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;</div><div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;                <span class="comment"># Create the argument list</span></div><div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;                <span class="keywordflow">if</span> is_diff_basis:</div><div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;                    args = [<span class="stringliteral">&quot;DIFF_BASIS&quot;</span>,</div><div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;                            basis_fn[<span class="stringliteral">&quot;arg&quot;</span>].proxy_name_indexed + <span class="stringliteral">&quot;%&quot;</span> +</div><div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;                            basis_fn[<span class="stringliteral">&quot;arg&quot;</span>].ref_name(basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>]),</div><div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;                            diff_basis_first_dim_name(basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>]),</div><div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;                            get_fs_ndf_name(basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>]), op_name]</div><div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;                    args = [<span class="stringliteral">&quot;BASIS&quot;</span>,</div><div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;                            basis_fn[<span class="stringliteral">&quot;arg&quot;</span>].proxy_name_indexed + <span class="stringliteral">&quot;%&quot;</span> +</div><div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;                            basis_fn[<span class="stringliteral">&quot;arg&quot;</span>].ref_name(basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>]),</div><div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;                            basis_first_dim_name(basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>]),</div><div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;                            get_fs_ndf_name(basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>]), op_name]</div><div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;                <span class="comment"># insert the basis array call</span></div><div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;                parent.add(</div><div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;                    CallGen(parent,</div><div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;                            name=basis_fn[<span class="stringliteral">&quot;qr_var&quot;</span>]+<span class="stringliteral">&quot;%compute_function&quot;</span>,</div><div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;                            args=args))</div><div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;            <span class="keywordflow">elif</span> basis_fn[<span class="stringliteral">&quot;shape&quot;</span>].lower() == <span class="stringliteral">&quot;gh_evaluator&quot;</span>:</div><div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;                <span class="comment"># We have an evaluator. We may need this on more than one</span></div><div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;                <span class="comment"># function space.</span></div><div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;                <span class="keywordflow">for</span> space <span class="keywordflow">in</span> basis_fn[<span class="stringliteral">&quot;nodal_fspaces&quot;</span>]:</div><div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;                    <span class="keywordflow">if</span> is_diff_basis:</div><div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;                        op_name = get_fs_operator_name(<span class="stringliteral">&quot;gh_diff_basis&quot;</span>,</div><div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;                                                       basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>],</div><div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;                                                       on_space=space)</div><div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;                    <span class="keywordflow">else</span>:</div><div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;                        op_name = get_fs_operator_name(<span class="stringliteral">&quot;gh_basis&quot;</span>,</div><div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;                                                       basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>],</div><div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;                                                       on_space=space)</div><div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;                    <span class="keywordflow">if</span> op_name <span class="keywordflow">in</span> op_name_list:</div><div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;                        <span class="comment"># Jump over any basis arrays we&#39;ve seen before</span></div><div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;                        <span class="keywordflow">continue</span></div><div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;                    op_name_list.append(op_name)</div><div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;</div><div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;                    nodal_loop_var = <span class="stringliteral">&quot;df_nodal&quot;</span></div><div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;                    loop_var_list.add(nodal_loop_var)</div><div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;</div><div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;                    <span class="comment"># Loop over dofs of target function space</span></div><div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;                    nodal_dof_loop = DoGen(</div><div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;                        parent, nodal_loop_var, <span class="stringliteral">&quot;1&quot;</span>, get_fs_ndf_name(space))</div><div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;                    parent.add(nodal_dof_loop)</div><div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;</div><div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;                    dof_loop_var = <span class="stringliteral">&quot;df_&quot;</span> + basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>].mangled_name</div><div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;                    loop_var_list.add(dof_loop_var)</div><div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;</div><div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;                    dof_loop = DoGen(nodal_dof_loop, dof_loop_var,</div><div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;                                     <span class="stringliteral">&quot;1&quot;</span>, get_fs_ndf_name(basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>]))</div><div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;                    nodal_dof_loop.add(dof_loop)</div><div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;                    lhs = op_name + <span class="stringliteral">&quot;(:,&quot;</span> + <span class="stringliteral">&quot;df_&quot;</span> + \</div><div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;                        basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>].mangled_name + <span class="stringliteral">&quot;,&quot;</span> + <span class="stringliteral">&quot;df_nodal)&quot;</span></div><div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;                    <span class="keywordflow">if</span> is_diff_basis:</div><div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;                        rhs = <span class="stringliteral">&quot;%&quot;</span>.join(</div><div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;                            [basis_fn[<span class="stringliteral">&quot;arg&quot;</span>].proxy_name_indexed,</div><div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;                             basis_fn[<span class="stringliteral">&quot;arg&quot;</span>].ref_name(basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>]),</div><div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;                             <span class="stringliteral">&quot;call_function(DIFF_BASIS,&quot;</span> + dof_loop_var +</div><div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;                             <span class="stringliteral">&quot;,nodes_&quot;</span> + space.mangled_name +</div><div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;                             <span class="stringliteral">&quot;(:,&quot;</span> + nodal_loop_var + <span class="stringliteral">&quot;))&quot;</span>])</div><div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;                    <span class="keywordflow">else</span>:</div><div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;                        rhs = <span class="stringliteral">&quot;%&quot;</span>.join(</div><div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;                            [basis_fn[<span class="stringliteral">&quot;arg&quot;</span>].proxy_name_indexed,</div><div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;                             basis_fn[<span class="stringliteral">&quot;arg&quot;</span>].ref_name(basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>]),</div><div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;                             <span class="stringliteral">&quot;call_function(BASIS,&quot;</span> + dof_loop_var +</div><div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;                             <span class="stringliteral">&quot;,nodes_&quot;</span> + space.mangled_name +</div><div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;                             <span class="stringliteral">&quot;(:,&quot;</span> + nodal_loop_var + <span class="stringliteral">&quot;))&quot;</span>])</div><div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;                    dof_loop.add(AssignGen(dof_loop, lhs=lhs, rhs=rhs))</div><div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;                <span class="keywordflow">raise</span> InternalError(</div><div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;                    <span class="stringliteral">&quot;Unrecognised shape &#39;{0}&#39; specified for basis function. &quot;</span></div><div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;                    <span class="stringliteral">&quot;Should be one of: {1}&quot;</span>.format(basis_fn[<span class="stringliteral">&#39;shape&#39;</span>],</div><div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;                                                   VALID_EVALUATOR_SHAPES))</div><div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;        <span class="keywordflow">if</span> loop_var_list:</div><div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;            <span class="comment"># Declare any loop variables</span></div><div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;            parent.add(DeclGen(parent, datatype=<span class="stringliteral">&quot;integer&quot;</span>,</div><div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;                               entity_decls=sorted(loop_var_list)))</div><div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;</div><div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns_html_ad8479e5a39b535cf5d2d30962b138717"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#ad8479e5a39b535cf5d2d30962b138717">psyclone.dynamo0p3.DynInvokeBasisFns.compute_basis_fns</a></div><div class="ttdeci">def compute_basis_fns(self, parent)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02701">dynamo0p3.py:2701</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns_html_a06f089ee8ad2d5770a0db66f36703e24"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a06f089ee8ad2d5770a0db66f36703e24">psyclone.dynamo0p3.DynInvokeBasisFns._basis_fns</a></div><div class="ttdeci">_basis_fns</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02303">dynamo0p3.py:2303</a></div></div>
<div class="ttc" id="namespacepsyclone_1_1f2pygen_html"><div class="ttname"><a href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a></div><div class="ttdef"><b>Definition:</b> <a href="f2pygen_8py_source.html#l00001">f2pygen.py:1</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5bb807a88dfeaa83029dbd46de7ffb9d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def psyclone.dynamo0p3.DynInvokeBasisFns.deallocate </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>parent</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Add code to deallocate all basis/diff-basis function arrays

:param parent: node in the f2pygen AST to which the deallocate
       calls will be added
:type parent: :py:class:`psyclone.f2pygen.SubroutineGen`
</pre> 
<p>Definition at line <a class="el" href="dynamo0p3_8py_source.html#l02824">2824</a> of file <a class="el" href="dynamo0p3_8py_source.html">dynamo0p3.py</a>.</p>

<p>References <a class="el" href="dynamo0p3_8py_source.html#l02303">psyclone.dynamo0p3.DynInvokeBasisFns._basis_fns</a>.</p>
<div class="fragment"><div class="line"><a name="l02824"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a5bb807a88dfeaa83029dbd46de7ffb9d"> 2824</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a5bb807a88dfeaa83029dbd46de7ffb9d">deallocate</a>(self, parent):</div><div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;<span class="stringliteral">        Add code to deallocate all basis/diff-basis function arrays</span></div><div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;<span class="stringliteral">        :param parent: node in the f2pygen AST to which the deallocate</span></div><div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;<span class="stringliteral">                       calls will be added</span></div><div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;<span class="stringliteral">        :type parent: :py:class:`psyclone.f2pygen.SubroutineGen`</span></div><div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> CommentGen, DeallocateGen</div><div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;</div><div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a06f089ee8ad2d5770a0db66f36703e24">_basis_fns</a>:</div><div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;            <span class="comment"># deallocate all allocated basis function arrays</span></div><div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;            parent.add(CommentGen(parent, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;            parent.add(CommentGen(parent, <span class="stringliteral">&quot; Deallocate basis arrays&quot;</span>))</div><div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;            parent.add(CommentGen(parent, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;</div><div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;        func_space_var_names = set()</div><div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;        <span class="keywordflow">for</span> basis_fn <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a06f089ee8ad2d5770a0db66f36703e24">_basis_fns</a>:</div><div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;            <span class="comment"># add the basis array name to the list to use later</span></div><div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;            <span class="keywordflow">if</span> basis_fn[<span class="stringliteral">&quot;type&quot;</span>] == <span class="stringliteral">&quot;basis&quot;</span>:</div><div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;                <span class="keywordflow">for</span> fspace <span class="keywordflow">in</span> basis_fn[<span class="stringliteral">&quot;nodal_fspaces&quot;</span>]:</div><div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;                    op_name = get_fs_operator_name(<span class="stringliteral">&quot;gh_basis&quot;</span>,</div><div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;                                                   basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>],</div><div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;                                                   qr_var=basis_fn[<span class="stringliteral">&quot;qr_var&quot;</span>],</div><div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;                                                   on_space=fspace)</div><div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;                    func_space_var_names.add(op_name)</div><div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;            <span class="keywordflow">elif</span> basis_fn[<span class="stringliteral">&quot;type&quot;</span>] == <span class="stringliteral">&quot;diff-basis&quot;</span>:</div><div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;                <span class="keywordflow">for</span> fspace <span class="keywordflow">in</span> basis_fn[<span class="stringliteral">&quot;nodal_fspaces&quot;</span>]:</div><div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;                    op_name = get_fs_operator_name(<span class="stringliteral">&quot;gh_diff_basis&quot;</span>,</div><div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;                                                   basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>],</div><div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;                                                   qr_var=basis_fn[<span class="stringliteral">&quot;qr_var&quot;</span>],</div><div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;                                                   on_space=fspace)</div><div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;                    func_space_var_names.add(op_name)</div><div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;                <span class="keywordflow">raise</span> InternalError(</div><div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;                    <span class="stringliteral">&quot;Unrecognised type of basis function: &#39;{0}&#39;. Should be &quot;</span></div><div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;                    <span class="stringliteral">&quot;one of &#39;basis&#39; or &#39;diff-basis&#39;.&quot;</span>.format(basis_fn[<span class="stringliteral">&quot;type&quot;</span>]))</div><div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;        <span class="keywordflow">if</span> func_space_var_names:</div><div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;            <span class="comment"># add the required deallocate call</span></div><div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;            parent.add(DeallocateGen(parent, sorted(func_space_var_names)))</div><div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;</div><div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns_html_a06f089ee8ad2d5770a0db66f36703e24"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a06f089ee8ad2d5770a0db66f36703e24">psyclone.dynamo0p3.DynInvokeBasisFns._basis_fns</a></div><div class="ttdeci">_basis_fns</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02303">dynamo0p3.py:2303</a></div></div>
<div class="ttc" id="namespacepsyclone_1_1f2pygen_html"><div class="ttname"><a href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a></div><div class="ttdef"><b>Definition:</b> <a href="f2pygen_8py_source.html#l00001">f2pygen.py:1</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns_html_a5bb807a88dfeaa83029dbd46de7ffb9d"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a5bb807a88dfeaa83029dbd46de7ffb9d">psyclone.dynamo0p3.DynInvokeBasisFns.deallocate</a></div><div class="ttdeci">def deallocate(self, parent)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02824">dynamo0p3.py:2824</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a791303926010438cc25ac3aa522d2698"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def psyclone.dynamo0p3.DynInvokeBasisFns.declare_qr </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>parent</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Create the declarations for any quadrature objects passed
in to an invoke. These are added as children of the supplied
parent node.

:param parent: the node in the f2pygen AST that will be the
       parent of all of the declarations (i.e. the
       PSy-layer subroutine)
:type parent: :py:class:`psyclone.f2pygen.BaseGen`
</pre> 
<p>Definition at line <a class="el" href="dynamo0p3_8py_source.html#l02425">2425</a> of file <a class="el" href="dynamo0p3_8py_source.html">dynamo0p3.py</a>.</p>

<p>References <a class="el" href="dynamo0p3_8py_source.html#l02308">psyclone.dynamo0p3.DynInvokeBasisFns._qr_vars</a>.</p>
<div class="fragment"><div class="line"><a name="l02425"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a791303926010438cc25ac3aa522d2698"> 2425</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a791303926010438cc25ac3aa522d2698">declare_qr</a>(self, parent):</div><div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;<span class="stringliteral">        Create the declarations for any quadrature objects passed</span></div><div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;<span class="stringliteral">        in to an invoke. These are added as children of the supplied</span></div><div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;<span class="stringliteral">        parent node.</span></div><div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;<span class="stringliteral">        :param parent: the node in the f2pygen AST that will be the</span></div><div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;<span class="stringliteral">                       parent of all of the declarations (i.e. the</span></div><div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;<span class="stringliteral">                       PSy-layer subroutine)</span></div><div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;<span class="stringliteral">        :type parent: :py:class:`psyclone.f2pygen.BaseGen`</span></div><div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> TypeDeclGen</div><div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;        <span class="comment"># Create a single declaration for each quadrature type</span></div><div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;        <span class="keywordflow">for</span> shape <span class="keywordflow">in</span> VALID_QUADRATURE_SHAPES:</div><div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;            <span class="keywordflow">if</span> shape <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a8b4af5b307d5584cc3775ed0bd8f93b0">_qr_vars</a> <span class="keywordflow">and</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a8b4af5b307d5584cc3775ed0bd8f93b0">_qr_vars</a>[shape]:</div><div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;                <span class="comment"># The PSy-layer routine is passed objects of</span></div><div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;                <span class="comment"># quadrature_* type</span></div><div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;                parent.add(</div><div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;                    TypeDeclGen(parent,</div><div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;                                datatype=QUADRATURE_TYPE_MAP[shape][<span class="stringliteral">&quot;type&quot;</span>],</div><div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;                                entity_decls=self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a8b4af5b307d5584cc3775ed0bd8f93b0">_qr_vars</a>[shape],</div><div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;                                intent=<span class="stringliteral">&quot;in&quot;</span>))</div><div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;                <span class="comment"># For each of these we&#39;ll need a corresponding proxy, use</span></div><div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;                <span class="comment"># our namespace manager to avoid clashes...</span></div><div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;                var_names = []</div><div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;                <span class="keywordflow">for</span> var <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a8b4af5b307d5584cc3775ed0bd8f93b0">_qr_vars</a>[shape]:</div><div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;                    var_names.append(</div><div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;                        self._name_space_manager.create_name(</div><div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;                            root_name=var+<span class="stringliteral">&quot;_proxy&quot;</span>, context=<span class="stringliteral">&quot;PSyVars&quot;</span>,</div><div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;                            label=var+<span class="stringliteral">&quot;_proxy&quot;</span>))</div><div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;                parent.add(</div><div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;                    TypeDeclGen(</div><div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;                        parent,</div><div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;                        datatype=QUADRATURE_TYPE_MAP[shape][<span class="stringliteral">&quot;proxy_type&quot;</span>],</div><div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;                        entity_decls=var_names))</div><div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;</div><div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns_html_a791303926010438cc25ac3aa522d2698"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a791303926010438cc25ac3aa522d2698">psyclone.dynamo0p3.DynInvokeBasisFns.declare_qr</a></div><div class="ttdeci">def declare_qr(self, parent)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02425">dynamo0p3.py:2425</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns_html_a8b4af5b307d5584cc3775ed0bd8f93b0"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a8b4af5b307d5584cc3775ed0bd8f93b0">psyclone.dynamo0p3.DynInvokeBasisFns._qr_vars</a></div><div class="ttdeci">_qr_vars</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02308">dynamo0p3.py:2308</a></div></div>
<div class="ttc" id="namespacepsyclone_1_1f2pygen_html"><div class="ttname"><a href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a></div><div class="ttdef"><b>Definition:</b> <a href="f2pygen_8py_source.html#l00001">f2pygen.py:1</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aa9bc9c611ed3035d6922d41fc069c142"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def psyclone.dynamo0p3.DynInvokeBasisFns.initialise_basis_fns </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>parent</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Create the declarations and assignments required for the
basis-functions required by an invoke. These are added as children
of the supplied parent node in the AST.

:param parent: the node in the f2pygen AST that will be the
       parent of all of the declarations and assignments.
:type parent: :py:class:`psyclone.f2pygen.SubroutineGen`

:raises InternalError: if an invalid entry is encountered in the \
               self._basis_fns list.
</pre> 
<p>Definition at line <a class="el" href="dynamo0p3_8py_source.html#l02461">2461</a> of file <a class="el" href="dynamo0p3_8py_source.html">dynamo0p3.py</a>.</p>

<p>References <a class="el" href="dynamo0p3_8py_source.html#l02303">psyclone.dynamo0p3.DynInvokeBasisFns._basis_fns</a>, <a class="el" href="dynamo0p3_8py_source.html#l00861">psyclone.dynamo0p3.DynKernMetadata._eval_targets</a>, <a class="el" href="dynamo0p3_8py_source.html#l02312">psyclone.dynamo0p3.DynInvokeBasisFns._eval_targets</a>, <a class="el" href="dynamo0p3_8py_source.html#l02689">psyclone.dynamo0p3.DynInvokeBasisFns._initialise_xoyoz_qr()</a>, <a class="el" href="dynamo0p3_8py_source.html#l02641">psyclone.dynamo0p3.DynInvokeBasisFns._initialise_xyoz_qr()</a>, <a class="el" href="dynamo0p3_8py_source.html#l02629">psyclone.dynamo0p3.DynInvokeBasisFns._initialise_xyz_qr()</a>, and <a class="el" href="dynamo0p3_8py_source.html#l02308">psyclone.dynamo0p3.DynInvokeBasisFns._qr_vars</a>.</p>
<div class="fragment"><div class="line"><a name="l02461"></a><span class="lineno"><a class="line" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#aa9bc9c611ed3035d6922d41fc069c142"> 2461</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#aa9bc9c611ed3035d6922d41fc069c142">initialise_basis_fns</a>(self, parent):</div><div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;</span></div><div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;<span class="stringliteral">        Create the declarations and assignments required for the</span></div><div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;<span class="stringliteral">        basis-functions required by an invoke. These are added as children</span></div><div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;<span class="stringliteral">        of the supplied parent node in the AST.</span></div><div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;<span class="stringliteral">        :param parent: the node in the f2pygen AST that will be the</span></div><div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;<span class="stringliteral">                       parent of all of the declarations and assignments.</span></div><div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;<span class="stringliteral">        :type parent: :py:class:`psyclone.f2pygen.SubroutineGen`</span></div><div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;<span class="stringliteral">        :raises InternalError: if an invalid entry is encountered in the \</span></div><div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;<span class="stringliteral">                               self._basis_fns list.</span></div><div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;<span class="stringliteral">        &#39;&#39;&#39;</span></div><div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a> <span class="keyword">import</span> CommentGen, AssignGen, DeclGen, \</div><div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;            AllocateGen, UseGen</div><div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;        var_dim_list = []</div><div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;        basis_declarations = []</div><div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;        op_name_list = []</div><div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;</div><div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;        <span class="comment"># We need BASIS and/or DIFF_BASIS if any kernel requires quadrature</span></div><div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;        <span class="comment"># or an evaluator</span></div><div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a8b4af5b307d5584cc3775ed0bd8f93b0">_qr_vars</a> <span class="keywordflow">or</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#adc23cd19f80124ec95807dc831a95863">_eval_targets</a>:</div><div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;            parent.add(UseGen(parent, name=<span class="stringliteral">&quot;function_space_mod&quot;</span>,</div><div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;                              only=<span class="keyword">True</span>,</div><div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;                              funcnames=[<span class="stringliteral">&quot;BASIS&quot;</span>, <span class="stringliteral">&quot;DIFF_BASIS&quot;</span>]))</div><div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;</div><div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a8b4af5b307d5584cc3775ed0bd8f93b0">_qr_vars</a>:</div><div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;            parent.add(CommentGen(parent, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;            parent.add(CommentGen(parent, <span class="stringliteral">&quot; Look-up quadrature variables&quot;</span>))</div><div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;            parent.add(CommentGen(parent, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;</div><div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;            <span class="comment"># Look-up the module- and type-names from the QUADRATURE_TYPE_MAP</span></div><div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;            <span class="keywordflow">for</span> shp <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a8b4af5b307d5584cc3775ed0bd8f93b0">_qr_vars</a>:</div><div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;                parent.add(UseGen(parent,</div><div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;                                  name=QUADRATURE_TYPE_MAP[shp][<span class="stringliteral">&quot;module&quot;</span>],</div><div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;                                  only=<span class="keyword">True</span>,</div><div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;                                  funcnames=[</div><div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;                                      QUADRATURE_TYPE_MAP[shp][<span class="stringliteral">&quot;type&quot;</span>],</div><div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;                                      QUADRATURE_TYPE_MAP[shp][<span class="stringliteral">&quot;proxy_type&quot;</span>]]))</div><div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a8f99f6e109a53abede33fdfb25a2eb76">_initialise_xyz_qr</a>(parent)</div><div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#ac43ff1a1fcf0c08d0c2f59a23c8ced5f">_initialise_xyoz_qr</a>(parent)</div><div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;            self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#aa66ed0e51d25c095cd5bdcf00f222ba3">_initialise_xoyoz_qr</a>(parent)</div><div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;</div><div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#adc23cd19f80124ec95807dc831a95863">_eval_targets</a>:</div><div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;            parent.add(CommentGen(parent, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;            parent.add(CommentGen(parent,</div><div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;                                  <span class="stringliteral">&quot; Initialise evaluator-related quantities &quot;</span></div><div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;                                  <span class="stringliteral">&quot;for the target function spaces&quot;</span>))</div><div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;            parent.add(CommentGen(parent, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;</div><div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;        <span class="keywordflow">for</span> (fspace, arg) <span class="keywordflow">in</span> self._eval_targets.values():</div><div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;            <span class="comment"># We need the list of nodes for each unique FS upon which we need</span></div><div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;            <span class="comment"># to evaluate basis/diff-basis functions</span></div><div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;            nodes_name = <span class="stringliteral">&quot;nodes_&quot;</span> + fspace.mangled_name</div><div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;            parent.add(AssignGen(</div><div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;                parent, lhs=nodes_name,</div><div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;                rhs=<span class="stringliteral">&quot;%&quot;</span>.join([arg.proxy_name_indexed, arg.ref_name(fspace),</div><div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;                              <span class="stringliteral">&quot;get_nodes()&quot;</span>]),</div><div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;                pointer=<span class="keyword">True</span>))</div><div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;            parent.add(DeclGen(parent, datatype=<span class="stringliteral">&quot;real&quot;</span>, kind=<span class="stringliteral">&quot;r_def&quot;</span>,</div><div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;                               pointer=<span class="keyword">True</span>,</div><div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;                               entity_decls=[nodes_name+<span class="stringliteral">&quot;(:,:) =&gt; null()&quot;</span>]))</div><div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;</div><div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a06f089ee8ad2d5770a0db66f36703e24">_basis_fns</a>:</div><div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;            parent.add(CommentGen(parent, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;            parent.add(CommentGen(parent, <span class="stringliteral">&quot; Allocate basis/diff-basis arrays&quot;</span>))</div><div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;            parent.add(CommentGen(parent, <span class="stringliteral">&quot;&quot;</span>))</div><div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;</div><div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;        <span class="comment"># Loop over the list of dicts describing each basis function</span></div><div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;        <span class="comment"># required by this Invoke.</span></div><div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;        <span class="keywordflow">for</span> basis_fn <span class="keywordflow">in</span> self.<a class="code" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a06f089ee8ad2d5770a0db66f36703e24">_basis_fns</a>:</div><div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;            <span class="comment"># Get the extent of the first dimension of the basis array and</span></div><div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;            <span class="comment"># store whether we have a basis or a differential basis function.</span></div><div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;            <span class="comment"># Currently there are only those two possible types of basis</span></div><div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;            <span class="comment"># function and we store which we have in is_diff_basis. Should</span></div><div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;            <span class="comment"># further basis-function types be added in the future then the if</span></div><div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;            <span class="comment"># blocks that use if_diff_basis further down must be updated.</span></div><div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;            <span class="keywordflow">if</span> basis_fn[<span class="stringliteral">&#39;type&#39;</span>] == <span class="stringliteral">&quot;basis&quot;</span>:</div><div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;                first_dim = basis_first_dim_name(basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>])</div><div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;                dim_space = <span class="stringliteral">&quot;get_dim_space()&quot;</span></div><div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;                is_diff_basis = <span class="keyword">False</span></div><div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;            <span class="keywordflow">elif</span> basis_fn[<span class="stringliteral">&#39;type&#39;</span>] == <span class="stringliteral">&quot;diff-basis&quot;</span>:</div><div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;                first_dim = diff_basis_first_dim_name(basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>])</div><div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;                dim_space = <span class="stringliteral">&quot;get_dim_space_diff()&quot;</span></div><div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;                is_diff_basis = <span class="keyword">True</span></div><div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;                <span class="keywordflow">raise</span> InternalError(</div><div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;                    <span class="stringliteral">&quot;Unrecognised type of basis function: &#39;{0}&#39;. Should be &quot;</span></div><div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;                    <span class="stringliteral">&quot;either &#39;basis&#39; or &#39;diff-basis&#39;.&quot;</span>.format(basis_fn[<span class="stringliteral">&#39;type&#39;</span>]))</div><div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;</div><div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;            <span class="keywordflow">if</span> first_dim <span class="keywordflow">not</span> <span class="keywordflow">in</span> var_dim_list:</div><div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;                var_dim_list.append(first_dim)</div><div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;                rhs = <span class="stringliteral">&quot;%&quot;</span>.join([basis_fn[<span class="stringliteral">&quot;arg&quot;</span>].proxy_name_indexed,</div><div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;                                basis_fn[<span class="stringliteral">&quot;arg&quot;</span>].ref_name(basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>]),</div><div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;                                dim_space])</div><div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;                parent.add(AssignGen(parent, lhs=first_dim, rhs=rhs))</div><div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;</div><div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;            <span class="keywordflow">if</span> basis_fn[<span class="stringliteral">&quot;shape&quot;</span>] <span class="keywordflow">in</span> VALID_QUADRATURE_SHAPES:</div><div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;</div><div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;                <span class="keywordflow">if</span> is_diff_basis:</div><div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;                    op_name = get_fs_operator_name(<span class="stringliteral">&quot;gh_diff_basis&quot;</span>,</div><div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;                                                   basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>],</div><div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;                                                   qr_var=basis_fn[<span class="stringliteral">&quot;qr_var&quot;</span>])</div><div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;                    op_name = get_fs_operator_name(<span class="stringliteral">&quot;gh_basis&quot;</span>,</div><div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;                                                   basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>],</div><div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;                                                   qr_var=basis_fn[<span class="stringliteral">&quot;qr_var&quot;</span>])</div><div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;                <span class="keywordflow">if</span> op_name <span class="keywordflow">in</span> op_name_list:</div><div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;                    <span class="keywordflow">continue</span></div><div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;                <span class="comment"># We haven&#39;t seen a basis with this name before so</span></div><div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;                <span class="comment"># need to declare it and add allocate statement</span></div><div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;                op_name_list.append(op_name)</div><div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;</div><div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;                <span class="comment"># Dimensionality of the basis arrays depends on the</span></div><div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;                <span class="comment"># type of quadrature...</span></div><div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;                alloc_args = qr_basis_alloc_args(first_dim, basis_fn)</div><div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;                parent.add(</div><div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;                    AllocateGen(parent, op_name+<span class="stringliteral">&quot;(&quot;</span>+<span class="stringliteral">&quot;, &quot;</span>.join(alloc_args)+<span class="stringliteral">&quot;)&quot;</span>))</div><div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;                <span class="comment"># Add basis function variable to list to declare later.</span></div><div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;                <span class="comment"># We use the length of alloc_args to determine how</span></div><div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;                <span class="comment"># many dimensions this array has.</span></div><div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;                basis_declarations.append(</div><div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;                    op_name+<span class="stringliteral">&quot;(&quot;</span>+<span class="stringliteral">&quot;,&quot;</span>.join([<span class="stringliteral">&quot;:&quot;</span>]*len(alloc_args))+<span class="stringliteral">&quot;)&quot;</span>)</div><div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;</div><div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;            <span class="keywordflow">elif</span> basis_fn[<span class="stringliteral">&quot;shape&quot;</span>].lower() == <span class="stringliteral">&quot;gh_evaluator&quot;</span>:</div><div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;                <span class="comment"># This is an evaluator and thus may be required on more than</span></div><div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;                <span class="comment"># one function space</span></div><div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;                <span class="keywordflow">for</span> target_space <span class="keywordflow">in</span> basis_fn[<span class="stringliteral">&quot;nodal_fspaces&quot;</span>]:</div><div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;                    <span class="keywordflow">if</span> is_diff_basis:</div><div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;                        op_name = get_fs_operator_name(</div><div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;                            <span class="stringliteral">&quot;gh_diff_basis&quot;</span>, basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>],</div><div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;                            qr_var=basis_fn[<span class="stringliteral">&quot;qr_var&quot;</span>],</div><div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;                            on_space=target_space)</div><div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;                    <span class="keywordflow">else</span>:</div><div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;                        op_name = get_fs_operator_name(</div><div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;                            <span class="stringliteral">&quot;gh_basis&quot;</span>, basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>],</div><div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;                            qr_var=basis_fn[<span class="stringliteral">&quot;qr_var&quot;</span>],</div><div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;                            on_space=target_space)</div><div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;                    <span class="keywordflow">if</span> op_name <span class="keywordflow">in</span> op_name_list:</div><div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;                        <span class="keywordflow">continue</span></div><div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;                    <span class="comment"># We haven&#39;t seen a basis with this name before so</span></div><div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;                    <span class="comment"># need to declare it and add allocate statement</span></div><div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;                    op_name_list.append(op_name)</div><div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;</div><div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;                    ndf_nodal_name = get_fs_ndf_name(target_space)</div><div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;                    alloc_args_str = <span class="stringliteral">&quot;, &quot;</span>.join(</div><div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;                        [first_dim, get_fs_ndf_name(basis_fn[<span class="stringliteral">&quot;fspace&quot;</span>]),</div><div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;                         ndf_nodal_name])</div><div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;                    parent.add(AllocateGen(parent,</div><div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;                                           op_name+<span class="stringliteral">&quot;(&quot;</span>+alloc_args_str+<span class="stringliteral">&quot;)&quot;</span>))</div><div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;                    <span class="comment"># add basis function variable to list to declare later</span></div><div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;                    basis_declarations.append(op_name+<span class="stringliteral">&quot;(:,:,:)&quot;</span>)</div><div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;                <span class="keywordflow">raise</span> InternalError(</div><div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;                    <span class="stringliteral">&quot;Unrecognised evaluator shape: &#39;{0}&#39;. Should be one of &quot;</span></div><div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;                    <span class="stringliteral">&quot;{1}&quot;</span>.format(basis_fn[<span class="stringliteral">&quot;shape&quot;</span>], VALID_EVALUATOR_SHAPES))</div><div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;</div><div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;        <span class="keywordflow">if</span> var_dim_list:</div><div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;            <span class="comment"># declare dim and diff_dim for all function spaces</span></div><div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;            parent.add(DeclGen(parent, datatype=<span class="stringliteral">&quot;integer&quot;</span>,</div><div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;                               entity_decls=var_dim_list))</div><div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;        <span class="keywordflow">if</span> basis_declarations:</div><div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;            <span class="comment"># declare the basis function arrays</span></div><div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;            parent.add(DeclGen(parent, datatype=<span class="stringliteral">&quot;real&quot;</span>,</div><div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;                               allocatable=<span class="keyword">True</span>,</div><div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;                               kind=<span class="stringliteral">&quot;r_def&quot;</span>,</div><div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;                               entity_decls=basis_declarations))</div><div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;</div><div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns_html_aa66ed0e51d25c095cd5bdcf00f222ba3"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#aa66ed0e51d25c095cd5bdcf00f222ba3">psyclone.dynamo0p3.DynInvokeBasisFns._initialise_xoyoz_qr</a></div><div class="ttdeci">def _initialise_xoyoz_qr(self, parent)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02689">dynamo0p3.py:2689</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns_html_adc23cd19f80124ec95807dc831a95863"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#adc23cd19f80124ec95807dc831a95863">psyclone.dynamo0p3.DynInvokeBasisFns._eval_targets</a></div><div class="ttdeci">_eval_targets</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02312">dynamo0p3.py:2312</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns_html_ac43ff1a1fcf0c08d0c2f59a23c8ced5f"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#ac43ff1a1fcf0c08d0c2f59a23c8ced5f">psyclone.dynamo0p3.DynInvokeBasisFns._initialise_xyoz_qr</a></div><div class="ttdeci">def _initialise_xyoz_qr(self, parent)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02641">dynamo0p3.py:2641</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns_html_a8b4af5b307d5584cc3775ed0bd8f93b0"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a8b4af5b307d5584cc3775ed0bd8f93b0">psyclone.dynamo0p3.DynInvokeBasisFns._qr_vars</a></div><div class="ttdeci">_qr_vars</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02308">dynamo0p3.py:2308</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns_html_a06f089ee8ad2d5770a0db66f36703e24"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a06f089ee8ad2d5770a0db66f36703e24">psyclone.dynamo0p3.DynInvokeBasisFns._basis_fns</a></div><div class="ttdeci">_basis_fns</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02303">dynamo0p3.py:2303</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns_html_aa9bc9c611ed3035d6922d41fc069c142"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#aa9bc9c611ed3035d6922d41fc069c142">psyclone.dynamo0p3.DynInvokeBasisFns.initialise_basis_fns</a></div><div class="ttdeci">def initialise_basis_fns(self, parent)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02461">dynamo0p3.py:2461</a></div></div>
<div class="ttc" id="namespacepsyclone_1_1f2pygen_html"><div class="ttname"><a href="namespacepsyclone_1_1f2pygen.html">psyclone.f2pygen</a></div><div class="ttdef"><b>Definition:</b> <a href="f2pygen_8py_source.html#l00001">f2pygen.py:1</a></div></div>
<div class="ttc" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns_html_a8f99f6e109a53abede33fdfb25a2eb76"><div class="ttname"><a href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a8f99f6e109a53abede33fdfb25a2eb76">psyclone.dynamo0p3.DynInvokeBasisFns._initialise_xyz_qr</a></div><div class="ttdeci">def _initialise_xyz_qr(self, parent)</div><div class="ttdef"><b>Definition:</b> <a href="dynamo0p3_8py_source.html#l02629">dynamo0p3.py:2629</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns_aa9bc9c611ed3035d6922d41fc069c142_cgraph.png" border="0" usemap="#classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns_aa9bc9c611ed3035d6922d41fc069c142_cgraph" alt=""/></div>
<map name="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns_aa9bc9c611ed3035d6922d41fc069c142_cgraph" id="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns_aa9bc9c611ed3035d6922d41fc069c142_cgraph">
<area shape="rect" id="node2" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#aa66ed0e51d25c095cd5bdcf00f222ba3" title="psyclone.dynamo0p3.DynInvoke\lBasisFns._initialise_xoyoz_qr" alt="" coords="265,5,477,47"/>
<area shape="rect" id="node3" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#ac43ff1a1fcf0c08d0c2f59a23c8ced5f" title="psyclone.dynamo0p3.DynInvoke\lBasisFns._initialise_xyoz_qr" alt="" coords="265,71,477,112"/>
<area shape="rect" id="node4" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html#a8f99f6e109a53abede33fdfb25a2eb76" title="psyclone.dynamo0p3.DynInvoke\lBasisFns._initialise_xyz_qr" alt="" coords="265,136,477,177"/>
</map>
</div>
</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>src/psyclone/<a class="el" href="dynamo0p3_8py_source.html">dynamo0p3.py</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><b>psyclone</b></li><li class="navelem"><b>dynamo0p3</b></li><li class="navelem"><a class="el" href="classpsyclone_1_1dynamo0p3_1_1DynInvokeBasisFns.html">DynInvokeBasisFns</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
